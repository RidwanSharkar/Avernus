"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983,850,462],{6121:function(e,t,o){o.d(t,{w:function(){return i}});class i{addDamageNumber(e,t,o,i){let n="damage_".concat(this.nextId++),s={id:n,damage:e,isCritical:t,position:o.clone(),timestamp:Date.now(),damageType:i};return this.damageNumbers.push(s),n}removeDamageNumber(e){let t=this.damageNumbers.findIndex(t=>t.id===e);-1!==t&&this.damageNumbers.splice(t,1)}getDamageNumbers(){return[...this.damageNumbers]}cleanup(){let e=Date.now();this.damageNumbers=this.damageNumbers.filter(t=>e-t.timestamp<5e3),this.damageNumbers.length>50&&(this.damageNumbers.sort((e,t)=>t.timestamp-e.timestamp),this.damageNumbers=this.damageNumbers.slice(0,50))}clear(){this.damageNumbers.length=0,this.nextId=0}getCount(){return this.damageNumbers.length}constructor(){this.damageNumbers=[],this.nextId=0}}},9667:function(e,t,o){o.d(t,{R:function(){return d}});var i=o(1448),n=o(73),s=o(6862),r=o(8001),l=o(3478),a=o(246),h=o(6776),c=o(6520);o(2265);class d{initializePools(){this.config.enableObjectPooling&&(this.meshPool=new c.L(()=>new i.Mesh,e=>{e.geometry=new i.BoxGeometry(1,1,1),e.material=new i.MeshStandardMaterial,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.visible=!0,e.castShadow=!0,e.receiveShadow=!0},this.config.maxPoolSize),this.geometryPool=new c.L(()=>new i.BoxGeometry(1,1,1),e=>{},this.config.maxPoolSize),this.materialPool=new c.L(()=>new i.MeshStandardMaterial,e=>{e.color.setHex(16777215),e.opacity=1,e.transparent=!1,e.wireframe=!1},this.config.maxPoolSize))}initializeEnemyConfigs(){this.enemyConfigs=new Map([[r.Z.DUMMY,{baseHealth:500,size:new i.Vector3(1,2,1),color:new i.Color(9127187),colliderRadius:1}],[r.Z.GRUNT,{baseHealth:500,size:new i.Vector3(.8,1.8,.8),color:new i.Color(16729156),colliderRadius:2}],[r.Z.ELITE,{baseHealth:1e3,size:new i.Vector3(1.2,2.2,1.2),color:new i.Color(4474111),colliderRadius:2}],[r.Z.BOSS,{baseHealth:2e3,size:new i.Vector3(2,3,2),color:new i.Color(9055202),colliderRadius:2}]])}createEnemy(e){let t=this.world.createEntity(),o=this.enemyConfigs.get(e.type),c=e.level||1,d=e.scale||1,u=this.world.createComponent(n.w);u.position.copy(e.position),u.setScale(d,d,d),t.addComponent(u);let m=this.world.createComponent(r.C);m.type=e.type,m.level=c,t.addComponent(m);let g=this.world.createComponent(s.S),p=e.health||o.baseHealth*c;g.maxHealth=p,g.currentHealth=p,e.type===r.Z.DUMMY&&("function"==typeof g.enableRegeneration?g.enableRegeneration(10,2):(console.error("Health component missing enableRegeneration method - object pooling issue",g),g.canRegenerate=!0,g.regenerationRate=10,g.regenerationDelay=2)),t.addComponent(g);let f=this.world.createComponent(l.YM);f.type=l.F5.SPHERE,f.radius=o.colliderRadius*d,f.layer=l.aB.ENEMY,f.setOffset(0,o.size.y*d*.5,0),t.addComponent(f);let y=this.world.createComponent(a.T);if(e.type===r.Z.ELITE||e.type===r.Z.BOSS?(y.mesh=null,y.geometry=null,y.material=null):e.type===r.Z.GRUNT?(y.mesh=null,y.geometry=null,y.material=null):y.mesh=this.createEnemyMesh(o,e.color||o.color,d),"function"==typeof y.setCastShadow?y.setCastShadow(!0):console.warn("⚠️ Renderer component missing setCastShadow method:",y),"function"==typeof y.setReceiveShadow?y.setReceiveShadow(!0):console.warn("⚠️ Renderer component missing setReceiveShadow method:",y),t.addComponent(y),this.config.enableHealthBars){let n=this.world.createComponent(h.T),s={width:Math.max(.8,o.size.x*d*.8),height:.08,offset:new i.Vector3(0,o.size.y*d+1.25,0),showWhenFull:e.type===r.Z.DUMMY,fadeDistance:15,...this.config.healthBarConfig};e.type===r.Z.DUMMY&&(s.healthColor=new i.Color(43775)),n.width=s.width||n.width,n.height=s.height||n.height,s.offset&&n.offset.copy(s.offset),n.showWhenFull=void 0!==s.showWhenFull?s.showWhenFull:n.showWhenFull,n.fadeDistance=s.fadeDistance||n.fadeDistance,s.healthColor&&n.healthColor.copy(s.healthColor),t.addComponent(n)}return console.log("\uD83C\uDFED Created ".concat(m.getDisplayName()," (").concat(e.type,") at position:"),e.position),console.log("\uD83C\uDFA8 Renderer setup for ".concat(e.type,":"),{hasMesh:!!y.mesh,hasGeometry:!!y.geometry,hasMaterial:!!y.material}),this.world.notifyEntityAdded(t),t}createEnemyMesh(e,t,o){let n,s,r;return this.config.enableObjectPooling?(n=this.geometryPool.acquire(),s=this.materialPool.acquire(),r=this.meshPool.acquire(),n.dispose(),n=new i.BoxGeometry(e.size.x*o,e.size.y*o,e.size.z*o)):(n=new i.BoxGeometry(e.size.x*o,e.size.y*o,e.size.z*o),s=new i.MeshStandardMaterial,r=new i.Mesh),s.color.copy(t),s.roughness=.7,s.metalness=.1,r.geometry=n,r.material=s,r.castShadow=!0,r.receiveShadow=!0,r.name="enemy",r.userData.isEnemy=!0,r.position.y=e.size.y*o/2,r}createEliteEnemyGroup(e){let t=new i.Group;return t.name="elite-enemy",t.userData.isEnemy=!0,t.userData.entityId=e,t}createTrainingDummy(e){return this.createEnemy({type:r.Z.DUMMY,level:1,position:e.clone(),health:500,color:new i.Color(9127187)})}createGrunt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.createEnemy({type:r.Z.GRUNT,level:t,position:e.clone(),color:new i.Color(16729156)})}createElite(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.createEnemy({type:r.Z.ELITE,level:t,position:e.clone(),color:new i.Color(4474111)})}createBoss(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.createEnemy({type:r.Z.BOSS,level:t,position:e.clone(),color:new i.Color(9055202)})}spawnEnemiesInCircle(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.Z.GRUNT,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=[],a=2*Math.PI/o;for(let r=0;r<o;r++){let o=r*a,h=new i.Vector3(e.x+Math.cos(o)*t,e.y,e.z+Math.sin(o)*t),c=this.createEnemy({type:n,level:s,position:h});l.push(c)}return l}spawnEnemiesInArea(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.Z.GRUNT,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=[];for(let r=0;r<o;r++){let o=new i.Vector3(e.x+(Math.random()-.5)*t.x,e.y,e.z+(Math.random()-.5)*t.z),r=this.createEnemy({type:n,level:s,position:o});l.push(r)}return l}releaseEnemy(e){if(!this.config.enableObjectPooling)return;let t=e.getComponent(a.T);if(t&&t.mesh){let e=t.mesh;e instanceof i.Mesh&&(e.geometry&&this.geometryPool&&this.geometryPool.release(e.geometry),e.material&&this.materialPool&&this.materialPool.release(e.material),this.meshPool&&this.meshPool.release(e))}}getPoolStats(){return this.config.enableObjectPooling?{meshPool:this.meshPool.getPoolSize(),geometryPool:this.geometryPool.getPoolSize(),materialPool:this.materialPool.getPoolSize()}:null}dispose(){if(this.config.enableObjectPooling){var e,t,o;null===(e=this.meshPool)||void 0===e||e.clear(),null===(t=this.geometryPool)||void 0===t||t.clear(),null===(o=this.materialPool)||void 0===o||o.clear()}}constructor(e,t={}){this.world=e,this.config={enableObjectPooling:!1!==t.enableObjectPooling,maxPoolSize:t.maxPoolSize||50,enableHealthBars:!1!==t.enableHealthBars,healthBarConfig:t.healthBarConfig||{}},this.initializePools(),this.initializeEnemyConfigs()}}},948:function(e,t,o){o.d(t,{v:function(){return i}});class i{on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){let o=this.listeners.get(e);if(o){let e=o.indexOf(t);-1!==e&&o.splice(e,1)}}emit(e,t){let o=this.listeners.get(e);if(o)for(let e of[...o])e(t)}once(e,t){let o=i=>{t(i),this.off(e,o)};this.on(e,o)}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}getListenerCount(e){var t;return(null===(t=this.listeners.get(e))||void 0===t?void 0:t.length)||0}constructor(){this.listeners=new Map}}},6366:function(e,t,o){o.d(t,{M:function(){return n}});var i=o(1448);class n{static clamp(e,t,o){return Math.max(t,Math.min(o,e))}static lerp(e,t,o){return e+(t-e)*o}static smoothStep(e,t,o){let i=this.clamp((o-e)/(t-e),0,1);return i*i*(3-2*i)}static distance2D(e,t,o,i){let n=o-e,s=i-t;return Math.sqrt(n*n+s*s)}static distance3D(e,t,o,i,n,s){let r=i-e,l=n-t,a=s-o;return Math.sqrt(r*r+l*l+a*a)}static normalizeAngle(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}static random(e,t){return Math.random()*(t-e)+e}static randomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static pointInCircle(e,t,o,i,n){let s=e-o,r=t-i;return s*s+r*r<=n*n}static vector3Distance(e,t){return e.distanceTo(t)}static vector3Lerp(e,t,o){return new i.Vector3().lerpVectors(e,t,o)}static degToRad(e){return e*this.DEG_TO_RAD}static radToDeg(e){return e*this.RAD_TO_DEG}static approximately(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-4;return Math.abs(e-t)<o}static map(e,t,o,i,n){return(e-t)*(n-i)/(o-t)+i}}n.DEG_TO_RAD=Math.PI/180,n.RAD_TO_DEG=180/Math.PI},6018:function(e,t,o){o.d(t,{C:function(){return s},m:function(){return n}});var i=o(1448);let n=()=>{let e=[];for(let t=0;t<22;t++){let o=t/22*Math.PI*2,n=46+(4*Math.random()-2),s=Math.cos(o)*n,r=Math.sin(o)*n,l=.75+.4*Math.random();e.push({position:new i.Vector3(s,0,r),scale:l});let a=o+Math.PI/22,h=34*Math.cos(a),c=34*Math.sin(a);e.push({position:new i.Vector3(h,0,c),scale:.9*l})}return e},s=e=>{let t=.618033988749*e,o=new i.ConeGeometry(5,8,16,8),n=o.attributes.position.array;for(let e=0;e<n.length;e+=3){let o=n[e],i=n[e+1],s=n[e+2];if(i>-3.5&&i<3.5){let r=Math.sin(.5*o+t)*Math.cos(.3*s+2*t),l=Math.cos(.3*o+3*t)*Math.sin(.5*s+4*t),a=Math.sin(1.2*o+5*t)*Math.cos(.8*s+6*t)*.3,h=Math.cos(.9*o+7*t)*Math.sin(1.1*s+8*t)*.3,c=1-Math.abs(i)/2,d=.4+.3*Math.sin(10*t);n[e]+=(r+a)*d*c,n[e+2]+=(l+h)*d*c,n[e+1]+=.2*Math.sin(.2*o+.2*s+t)*c}}return o.attributes.position.needsUpdate=!0,o.computeVertexNormals(),o}},6520:function(e,t,o){o.d(t,{L:function(){return i}});class i{acquire(){return this.pool.length>0?this.pool.pop():this.createFn()}release(e){this.pool.length<this.maxSize&&(this.resetFn(e),this.pool.push(e))}clear(){this.pool.length=0}getPoolSize(){return this.pool.length}constructor(e,t,o=100){this.pool=[],this.createFn=e,this.resetFn=t,this.maxSize=o}}},4183:function(e,t,o){o.d(t,{k:function(){return n}});var i=o(1448);class n{getCellKey(e,t,o){return"".concat(e,",").concat(t,",").concat(o)}getCellCoords(e){return new i.Vector3(Math.floor(e.x/this.cellSize),Math.floor(e.y/this.cellSize),Math.floor(e.z/this.cellSize))}getCellsForBounds(e){let t=[],o=this.getCellCoords(e.min),i=this.getCellCoords(e.max);for(let e=o.x;e<=i.x;e++)for(let n=o.y;n<=i.y;n++)for(let s=o.z;s<=i.z;s++)t.push(this.getCellKey(e,n,s));return t}insert(e,t){this.remove(e);let o={entity:e,bounds:t.clone()},i=this.getCellsForBounds(t);for(let e of i)this.grid.has(e)||this.grid.set(e,[]),this.grid.get(e).push(o);this.entityCells.set(e.id,i)}remove(e){let t=this.entityCells.get(e.id);if(t){for(let o of t){let t=this.grid.get(o);if(t){let i=t.findIndex(t=>t.entity.id===e.id);-1!==i&&t.splice(i,1),0===t.length&&this.grid.delete(o)}}this.entityCells.delete(e.id)}}update(e,t){let o=this.entityCells.get(e.id)||[],i=this.getCellsForBounds(t);if(this.arraysEqual(o,i))for(let i of o){let o=this.grid.get(i);if(o){let i=o.find(t=>t.entity.id===e.id);i&&i.bounds.copy(t)}}else this.insert(e,t)}arraysEqual(e,t){if(e.length!==t.length)return!1;let o=[...e].sort(),i=[...t].sort();return o.every((e,t)=>e===i[t])}query(e){let t=[],o=new Set;for(let i of this.getCellsForBounds(e)){let n=this.grid.get(i);if(n)for(let i of n)!o.has(i.entity.id)&&(o.add(i.entity.id),e.intersectsBox(i.bounds)&&t.push(i))}return t}queryRadius(e,t){this.tempBox.setFromCenterAndSize(e,new i.Vector3(2*t,2*t,2*t));let o=this.query(this.tempBox),n=[],s=t*t;for(let t of o)this.tempVector.copy(e),t.bounds.clampPoint(this.tempVector,this.tempVector),e.distanceToSquared(this.tempVector)<=s&&n.push(t);return n}queryPoint(e){let t=this.getCellCoords(e),o=this.getCellKey(t.x,t.y,t.z),i=this.grid.get(o);if(!i)return[];let n=[];for(let t of i)t.bounds.containsPoint(e)&&n.push(t);return n}getNearbyEntities(e,t){let o=this.entityCells.get(e.id);if(!o)return[];let n=[],s=new Set,r=t*t,l=this.getEntityEntry(e);if(!l)return[];let a=new i.Vector3;for(let h of(l.bounds.getCenter(a),this.getExpandedCells(o,Math.ceil(t/this.cellSize)))){let t=this.grid.get(h);if(t)for(let o of t){if(o.entity.id===e.id||s.has(o.entity.id))continue;s.add(o.entity.id);let t=new i.Vector3;o.bounds.getCenter(t),a.distanceToSquared(t)<=r&&n.push(o.entity)}}return n}getEntityEntry(e){let t=this.entityCells.get(e.id);if(!t||0===t.length)return null;let o=this.grid.get(t[0]);return o&&o.find(t=>t.entity.id===e.id)||null}getExpandedCells(e,t){let o=new Set;for(let i of e){let[e,n,s]=i.split(",").map(Number);for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)for(let l=-t;l<=t;l++)o.add(this.getCellKey(e+i,n+r,s+l))}return Array.from(o)}clear(){this.grid.clear(),this.entityCells.clear()}getStats(){let e=this.grid.size,t=this.entityCells.size,o=0,i=0;return this.grid.forEach(e=>{i+=e.length,o=Math.max(o,e.length)}),{totalCells:e,totalEntities:t,averageEntitiesPerCell:e>0?i/e:0,maxEntitiesInCell:o}}debugVisualize(){let e=[];return e.push("Spatial Hash Stats: ".concat(JSON.stringify(this.getStats(),null,2))),this.grid.forEach((t,o)=>{t.length>0&&e.push("Cell ".concat(o,": ").concat(t.length," entities"))}),e}constructor(e=5){this.tempBox=new i.Box3,this.tempVector=new i.Vector3,this.cellSize=e,this.grid=new Map,this.entityCells=new Map}}}}]);