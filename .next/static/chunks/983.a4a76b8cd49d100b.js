"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983],{6121:function(e,t,i){i.d(t,{w:function(){return o}});class o{addDamageNumber(e,t,i,o){let s="damage_".concat(this.nextId++),n={id:s,damage:e,isCritical:t,position:i.clone(),timestamp:Date.now(),damageType:o};return this.damageNumbers.push(n),s}removeDamageNumber(e){let t=this.damageNumbers.findIndex(t=>t.id===e);-1!==t&&this.damageNumbers.splice(t,1)}getDamageNumbers(){return[...this.damageNumbers]}cleanup(){let e=Date.now();this.damageNumbers=this.damageNumbers.filter(t=>e-t.timestamp<5e3),this.damageNumbers.length>50&&(this.damageNumbers.sort((e,t)=>t.timestamp-e.timestamp),this.damageNumbers=this.damageNumbers.slice(0,50))}clear(){this.damageNumbers.length=0,this.nextId=0}getCount(){return this.damageNumbers.length}constructor(){this.damageNumbers=[],this.nextId=0}}},9667:function(e,t,i){i.d(t,{R:function(){return d}});var o=i(1448),s=i(73),n=i(6862),r=i(8001),l=i(3478),a=i(246),h=i(6776),c=i(6520);i(2265);class d{initializePools(){this.config.enableObjectPooling&&(this.meshPool=new c.L(()=>new o.Mesh,e=>{e.geometry=new o.BoxGeometry(1,1,1),e.material=new o.MeshStandardMaterial,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.visible=!0,e.castShadow=!0,e.receiveShadow=!0},this.config.maxPoolSize),this.geometryPool=new c.L(()=>new o.BoxGeometry(1,1,1),e=>{},this.config.maxPoolSize),this.materialPool=new c.L(()=>new o.MeshStandardMaterial,e=>{e.color.setHex(16777215),e.opacity=1,e.transparent=!1,e.wireframe=!1},this.config.maxPoolSize))}initializeEnemyConfigs(){this.enemyConfigs=new Map([[r.Z.DUMMY,{baseHealth:500,size:new o.Vector3(1,2,1),color:new o.Color(9127187),colliderRadius:1}],[r.Z.GRUNT,{baseHealth:500,size:new o.Vector3(.8,1.8,.8),color:new o.Color(16729156),colliderRadius:2}],[r.Z.ELITE,{baseHealth:1e3,size:new o.Vector3(1.2,2.2,1.2),color:new o.Color(4474111),colliderRadius:2}],[r.Z.BOSS,{baseHealth:2e3,size:new o.Vector3(2,3,2),color:new o.Color(9055202),colliderRadius:2}]])}createEnemy(e){let t=this.world.createEntity(),i=this.enemyConfigs.get(e.type),c=e.level||1,d=e.scale||1,u=this.world.createComponent(s.w);u.position.copy(e.position),u.setScale(d,d,d),t.addComponent(u);let m=this.world.createComponent(r.C);m.type=e.type,m.level=c,t.addComponent(m);let g=this.world.createComponent(n.S),f=e.health||i.baseHealth*c;g.maxHealth=f,g.currentHealth=f,e.type===r.Z.DUMMY&&("function"==typeof g.enableRegeneration?g.enableRegeneration(10,2):(g.canRegenerate=!0,g.regenerationRate=10,g.regenerationDelay=2)),t.addComponent(g);let p=this.world.createComponent(l.YM);p.type=l.F5.SPHERE,p.radius=i.colliderRadius*d,p.layer=l.aB.ENEMY,p.setOffset(0,i.size.y*d*.5,0),t.addComponent(p);let y=this.world.createComponent(a.T);if(e.type===r.Z.ELITE||e.type===r.Z.BOSS?(y.mesh=null,y.geometry=null,y.material=null):e.type===r.Z.GRUNT?(y.mesh=null,y.geometry=null,y.material=null):y.mesh=this.createEnemyMesh(i,e.color||i.color,d),"function"==typeof y.setCastShadow&&y.setCastShadow(!0),"function"==typeof y.setReceiveShadow&&y.setReceiveShadow(!0),t.addComponent(y),this.config.enableHealthBars){let s=this.world.createComponent(h.T),n={width:Math.max(.8,i.size.x*d*.8),height:.08,offset:new o.Vector3(0,i.size.y*d+1.25,0),showWhenFull:e.type===r.Z.DUMMY,fadeDistance:15,...this.config.healthBarConfig};e.type===r.Z.DUMMY&&(n.healthColor=new o.Color(43775)),s.width=n.width||s.width,s.height=n.height||s.height,n.offset&&s.offset.copy(n.offset),s.showWhenFull=void 0!==n.showWhenFull?n.showWhenFull:s.showWhenFull,s.fadeDistance=n.fadeDistance||s.fadeDistance,n.healthColor&&s.healthColor.copy(n.healthColor),t.addComponent(s)}return this.world.notifyEntityAdded(t),t}createEnemyMesh(e,t,i){let s,n,r;return this.config.enableObjectPooling?(s=this.geometryPool.acquire(),n=this.materialPool.acquire(),r=this.meshPool.acquire(),s.dispose(),s=new o.BoxGeometry(e.size.x*i,e.size.y*i,e.size.z*i)):(s=new o.BoxGeometry(e.size.x*i,e.size.y*i,e.size.z*i),n=new o.MeshStandardMaterial,r=new o.Mesh),n.color.copy(t),n.roughness=.7,n.metalness=.1,r.geometry=s,r.material=n,r.castShadow=!0,r.receiveShadow=!0,r.name="enemy",r.userData.isEnemy=!0,r.position.y=e.size.y*i/2,r}createEliteEnemyGroup(e){let t=new o.Group;return t.name="elite-enemy",t.userData.isEnemy=!0,t.userData.entityId=e,t}createTrainingDummy(e){return this.createEnemy({type:r.Z.DUMMY,level:1,position:e.clone(),health:500,color:new o.Color(9127187)})}createGrunt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.createEnemy({type:r.Z.GRUNT,level:t,position:e.clone(),color:new o.Color(16729156)})}createElite(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.createEnemy({type:r.Z.ELITE,level:t,position:e.clone(),color:new o.Color(4474111)})}createBoss(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.createEnemy({type:r.Z.BOSS,level:t,position:e.clone(),color:new o.Color(9055202)})}spawnEnemiesInCircle(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.Z.GRUNT,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=[],a=2*Math.PI/i;for(let r=0;r<i;r++){let i=r*a,h=new o.Vector3(e.x+Math.cos(i)*t,e.y,e.z+Math.sin(i)*t),c=this.createEnemy({type:s,level:n,position:h});l.push(c)}return l}spawnEnemiesInArea(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.Z.GRUNT,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=[];for(let r=0;r<i;r++){let i=new o.Vector3(e.x+(Math.random()-.5)*t.x,e.y,e.z+(Math.random()-.5)*t.z),r=this.createEnemy({type:s,level:n,position:i});l.push(r)}return l}releaseEnemy(e){if(!this.config.enableObjectPooling)return;let t=e.getComponent(a.T);if(t&&t.mesh){let e=t.mesh;e instanceof o.Mesh&&(e.geometry&&this.geometryPool&&this.geometryPool.release(e.geometry),e.material&&this.materialPool&&this.materialPool.release(e.material),this.meshPool&&this.meshPool.release(e))}}getPoolStats(){return this.config.enableObjectPooling?{meshPool:this.meshPool.getPoolSize(),geometryPool:this.geometryPool.getPoolSize(),materialPool:this.materialPool.getPoolSize()}:null}dispose(){if(this.config.enableObjectPooling){var e,t,i;null===(e=this.meshPool)||void 0===e||e.clear(),null===(t=this.geometryPool)||void 0===t||t.clear(),null===(i=this.materialPool)||void 0===i||i.clear()}}constructor(e,t={}){this.world=e,this.config={enableObjectPooling:!1!==t.enableObjectPooling,maxPoolSize:t.maxPoolSize||50,enableHealthBars:!1!==t.enableHealthBars,healthBarConfig:t.healthBarConfig||{}},this.initializePools(),this.initializeEnemyConfigs()}}},948:function(e,t,i){i.d(t,{v:function(){return o}});class o{on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){let i=this.listeners.get(e);if(i){let e=i.indexOf(t);-1!==e&&i.splice(e,1)}}emit(e,t){let i=this.listeners.get(e);if(i)for(let e of[...i])e(t)}once(e,t){let i=o=>{t(o),this.off(e,i)};this.on(e,i)}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}getListenerCount(e){var t;return(null===(t=this.listeners.get(e))||void 0===t?void 0:t.length)||0}constructor(){this.listeners=new Map}}},6366:function(e,t,i){i.d(t,{M:function(){return s}});var o=i(1448);class s{static clamp(e,t,i){return Math.max(t,Math.min(i,e))}static lerp(e,t,i){return e+(t-e)*i}static smoothStep(e,t,i){let o=this.clamp((i-e)/(t-e),0,1);return o*o*(3-2*o)}static distance2D(e,t,i,o){let s=i-e,n=o-t;return Math.sqrt(s*s+n*n)}static distance3D(e,t,i,o,s,n){let r=o-e,l=s-t,a=n-i;return Math.sqrt(r*r+l*l+a*a)}static normalizeAngle(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}static random(e,t){return Math.random()*(t-e)+e}static randomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static pointInCircle(e,t,i,o,s){let n=e-i,r=t-o;return n*n+r*r<=s*s}static vector3Distance(e,t){return e.distanceTo(t)}static vector3Lerp(e,t,i){return new o.Vector3().lerpVectors(e,t,i)}static degToRad(e){return e*this.DEG_TO_RAD}static radToDeg(e){return e*this.RAD_TO_DEG}static approximately(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-4;return Math.abs(e-t)<i}static map(e,t,i,o,s){return(e-t)*(s-o)/(i-t)+o}}s.DEG_TO_RAD=Math.PI/180,s.RAD_TO_DEG=180/Math.PI},6018:function(e,t,i){i.d(t,{C:function(){return n},m:function(){return s}});var o=i(1448);let s=()=>{let e=[];for(let t=0;t<22;t++){let i=t/22*Math.PI*2,s=46+(4*Math.random()-2),n=Math.cos(i)*s,r=Math.sin(i)*s,l=.75+.4*Math.random();e.push({position:new o.Vector3(n,0,r),scale:l});let a=i+Math.PI/22,h=34*Math.cos(a),c=34*Math.sin(a);e.push({position:new o.Vector3(h,0,c),scale:.9*l})}return e},n=e=>{let t=.618033988749*e,i=new o.ConeGeometry(5,8,16,8),s=i.attributes.position.array;for(let e=0;e<s.length;e+=3){let i=s[e],o=s[e+1],n=s[e+2];if(o>-3.5&&o<3.5){let r=Math.sin(.5*i+t)*Math.cos(.3*n+2*t),l=Math.cos(.3*i+3*t)*Math.sin(.5*n+4*t),a=Math.sin(1.2*i+5*t)*Math.cos(.8*n+6*t)*.3,h=Math.cos(.9*i+7*t)*Math.sin(1.1*n+8*t)*.3,c=1-Math.abs(o)/2,d=.4+.3*Math.sin(10*t);s[e]+=(r+a)*d*c,s[e+2]+=(l+h)*d*c,s[e+1]+=.2*Math.sin(.2*i+.2*n+t)*c}}return i.attributes.position.needsUpdate=!0,i.computeVertexNormals(),i}},6520:function(e,t,i){i.d(t,{L:function(){return o}});class o{acquire(){return this.pool.length>0?this.pool.pop():this.createFn()}release(e){this.pool.length<this.maxSize&&(this.resetFn(e),this.pool.push(e))}clear(){this.pool.length=0}getPoolSize(){return this.pool.length}constructor(e,t,i=100){this.pool=[],this.createFn=e,this.resetFn=t,this.maxSize=i}}},4183:function(e,t,i){i.d(t,{k:function(){return s}});var o=i(1448);class s{getCellKey(e,t,i){return"".concat(e,",").concat(t,",").concat(i)}getCellCoords(e){return new o.Vector3(Math.floor(e.x/this.cellSize),Math.floor(e.y/this.cellSize),Math.floor(e.z/this.cellSize))}getCellsForBounds(e){let t=[],i=this.getCellCoords(e.min),o=this.getCellCoords(e.max);for(let e=i.x;e<=o.x;e++)for(let s=i.y;s<=o.y;s++)for(let n=i.z;n<=o.z;n++)t.push(this.getCellKey(e,s,n));return t}insert(e,t){this.remove(e);let i={entity:e,bounds:t.clone()},o=this.getCellsForBounds(t);for(let e of o)this.grid.has(e)||this.grid.set(e,[]),this.grid.get(e).push(i);this.entityCells.set(e.id,o)}remove(e){let t=this.entityCells.get(e.id);if(t){for(let i of t){let t=this.grid.get(i);if(t){let o=t.findIndex(t=>t.entity.id===e.id);-1!==o&&t.splice(o,1),0===t.length&&this.grid.delete(i)}}this.entityCells.delete(e.id)}}update(e,t){let i=this.entityCells.get(e.id)||[],o=this.getCellsForBounds(t);if(this.arraysEqual(i,o))for(let o of i){let i=this.grid.get(o);if(i){let o=i.find(t=>t.entity.id===e.id);o&&o.bounds.copy(t)}}else this.insert(e,t)}arraysEqual(e,t){if(e.length!==t.length)return!1;let i=[...e].sort(),o=[...t].sort();return i.every((e,t)=>e===o[t])}query(e){let t=[],i=new Set;for(let o of this.getCellsForBounds(e)){let s=this.grid.get(o);if(s)for(let o of s)!i.has(o.entity.id)&&(i.add(o.entity.id),e.intersectsBox(o.bounds)&&t.push(o))}return t}queryRadius(e,t){this.tempBox.setFromCenterAndSize(e,new o.Vector3(2*t,2*t,2*t));let i=this.query(this.tempBox),s=[],n=t*t;for(let t of i)this.tempVector.copy(e),t.bounds.clampPoint(this.tempVector,this.tempVector),e.distanceToSquared(this.tempVector)<=n&&s.push(t);return s}queryPoint(e){let t=this.getCellCoords(e),i=this.getCellKey(t.x,t.y,t.z),o=this.grid.get(i);if(!o)return[];let s=[];for(let t of o)t.bounds.containsPoint(e)&&s.push(t);return s}getNearbyEntities(e,t){let i=this.entityCells.get(e.id);if(!i)return[];let s=[],n=new Set,r=t*t,l=this.getEntityEntry(e);if(!l)return[];let a=new o.Vector3;for(let h of(l.bounds.getCenter(a),this.getExpandedCells(i,Math.ceil(t/this.cellSize)))){let t=this.grid.get(h);if(t)for(let i of t){if(i.entity.id===e.id||n.has(i.entity.id))continue;n.add(i.entity.id);let t=new o.Vector3;i.bounds.getCenter(t),a.distanceToSquared(t)<=r&&s.push(i.entity)}}return s}getEntityEntry(e){let t=this.entityCells.get(e.id);if(!t||0===t.length)return null;let i=this.grid.get(t[0]);return i&&i.find(t=>t.entity.id===e.id)||null}getExpandedCells(e,t){let i=new Set;for(let o of e){let[e,s,n]=o.split(",").map(Number);for(let o=-t;o<=t;o++)for(let r=-t;r<=t;r++)for(let l=-t;l<=t;l++)i.add(this.getCellKey(e+o,s+r,n+l))}return Array.from(i)}clear(){this.grid.clear(),this.entityCells.clear()}getStats(){let e=this.grid.size,t=this.entityCells.size,i=0,o=0;return this.grid.forEach(e=>{o+=e.length,i=Math.max(i,e.length)}),{totalCells:e,totalEntities:t,averageEntitiesPerCell:e>0?o/e:0,maxEntitiesInCell:i}}debugVisualize(){let e=[];return e.push("Spatial Hash Stats: ".concat(JSON.stringify(this.getStats(),null,2))),this.grid.forEach((t,i)=>{t.length>0&&e.push("Cell ".concat(i,": ").concat(t.length," entities"))}),e}constructor(e=5){this.tempBox=new o.Box3,this.tempVector=new o.Vector3,this.cellSize=e,this.grid=new Map,this.entityCells=new Map}}}}]);