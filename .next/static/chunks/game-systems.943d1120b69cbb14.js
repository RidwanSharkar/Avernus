"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[893],{5050:function(e,t,i){i.d(t,{Ge:function(){return n},g3:function(){return r},j4:function(){return a}});let s=0,o=0;function a(e){s=e}function n(e){o=e}function r(e){let t=Math.random()<.11+.03*s,i=2+.15*o;return{damage:Math.floor(t?e*i:e),isCritical:t}}},45:function(e,t,i){i.d(t,{D:function(){return r}});var s=i(4058),o=i(948);class a extends o.v{start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.accumulator=0,this.frameId=requestAnimationFrame(this.gameLoop.bind(this)))}stop(){this.isRunning&&(this.isRunning=!1,this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=0))}getCurrentFPS(){return this.currentFPS}getFixedTimeStep(){return this.fixedTimeStep}gameLoop(e){if(!this.isRunning)return;let t=Math.min((e-this.lastTime)/1e3,this.maxFrameTime);this.lastTime=e,this.currentTime=e,this.updateFPS(t),this.accumulator+=t;let i=0;for(;this.accumulator>=this.fixedTimeStep&&i<this.maxSubSteps;)this.emit("fixedUpdate",{fixedDeltaTime:this.fixedTimeStep}),this.accumulator-=this.fixedTimeStep,i++;this.emit("update",{deltaTime:t});let s=this.accumulator/this.fixedTimeStep;this.emit("render",{deltaTime:t,interpolation:s}),this.frameId=requestAnimationFrame(this.gameLoop.bind(this))}updateFPS(e){this.frameCount++,this.fpsUpdateTime+=e,this.fpsUpdateTime>=1&&(this.currentFPS=Math.round(this.frameCount/this.fpsUpdateTime),this.frameCount=0,this.fpsUpdateTime=0)}pause(){this.isRunning&&this.stop()}resume(){this.isRunning||this.start()}isPaused(){return!this.isRunning}getCurrentTime(){return this.currentTime}getInterpolationRatio(){return this.accumulator/this.fixedTimeStep}constructor(){super(),this.isRunning=!1,this.lastTime=0,this.accumulator=0,this.currentTime=0,this.frameId=0,this.fixedTimeStep=1/60,this.maxFrameTime=1/30,this.maxSubSteps=5,this.frameCount=0,this.fpsUpdateTime=0,this.currentFPS=0}}class n extends o.v{initialize(e){this.canvas=e,e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mousemove",this.onMouseMove.bind(this)),e.addEventListener("wheel",this.onWheel.bind(this)),e.addEventListener("contextmenu",e=>e.preventDefault())}requestPointerLock(){this.canvas&&this.canvas.requestPointerLock()}exitPointerLock(){document.exitPointerLock()}isKeyPressed(e){return this.keys.has(e.toLowerCase())}isMouseButtonPressed(e){return this.mouseButtons.has(e)}getMousePosition(){return{...this.mousePosition}}getMouseDelta(){return{...this.mouseDelta}}getInputState(){return{keys:new Set(this.keys),mouse:{x:this.mousePosition.x,y:this.mousePosition.y,deltaX:this.mouseDelta.x,deltaY:this.mouseDelta.y,buttons:new Set(this.mouseButtons)}}}checkDoubleTap(e){let t=e.toLowerCase(),i=this.keyTimings.get(t);return!!i&&(Date.now(),!!i.hasValidFirstTap&&!!i.isInDoubleTapSequence&&i.secondPressTime>0&&i.secondPressTime-i.firstReleaseTime<=this.DOUBLE_TAP_THRESHOLD)}resetDoubleTap(e){let t=e.toLowerCase(),i=this.keyTimings.get(t);i&&(i.firstPressTime=0,i.firstReleaseTime=0,i.secondPressTime=0,i.isInDoubleTapSequence=!1,i.hasValidFirstTap=!1)}update(){this.mouseDelta.x=0,this.mouseDelta.y=0,this.cleanupOldTimings()}cleanupOldTimings(){let e=Date.now(),t=[];this.keyTimings.forEach((i,s)=>{let o=Math.max(i.firstPressTime,i.firstReleaseTime,i.secondPressTime);o>0&&e-o>5e3&&t.push(s)}),t.forEach(e=>this.keyTimings.delete(e))}getDoubleTapDebugInfo(e){let t=e.toLowerCase(),i=this.keyTimings.get(t);if(!i)return null;let s=Date.now();return{key:t,firstPressTime:i.firstPressTime,firstReleaseTime:i.firstReleaseTime,secondPressTime:i.secondPressTime,hasValidFirstTap:i.hasValidFirstTap,isInDoubleTapSequence:i.isInDoubleTapSequence,timeSinceFirstPress:i.firstPressTime>0?s-i.firstPressTime:0,timeSinceFirstRelease:i.firstReleaseTime>0?s-i.firstReleaseTime:0,timeSinceSecondPress:i.secondPressTime>0?s-i.secondPressTime:0,threshold:this.DOUBLE_TAP_THRESHOLD}}setupEventListeners(){document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this)),document.addEventListener("mousedown",this.onMouseDown.bind(this)),document.addEventListener("mouseup",this.onMouseUp.bind(this)),document.addEventListener("mousemove",this.onMouseMove.bind(this)),document.addEventListener("wheel",this.onWheel.bind(this)),document.addEventListener("pointerlockchange",this.onPointerLockChange.bind(this)),document.addEventListener("pointerlockerror",this.onPointerLockError.bind(this)),document.addEventListener("contextmenu",e=>e.preventDefault()),window.addEventListener("blur",this.onWindowBlur.bind(this)),window.addEventListener("focus",this.onWindowFocus.bind(this))}onKeyDown(e){let t=e.key.toLowerCase();if(!this.keys.has(t)){this.keys.add(t),this.emit("keyDown",{key:e.key,code:e.code});let i=Date.now(),s=this.keyTimings.get(t);s||(s={firstPressTime:0,firstReleaseTime:0,secondPressTime:0,isInDoubleTapSequence:!1,hasValidFirstTap:!1},this.keyTimings.set(t,s)),s.hasValidFirstTap?s.hasValidFirstTap&&!s.isInDoubleTapSequence&&(i-s.firstReleaseTime<=this.DOUBLE_TAP_THRESHOLD?(s.secondPressTime=i,s.isInDoubleTapSequence=!0):(s.firstPressTime=i,s.firstReleaseTime=0,s.secondPressTime=0,s.isInDoubleTapSequence=!1,s.hasValidFirstTap=!1)):(s.firstPressTime=i,s.isInDoubleTapSequence=!1,s.hasValidFirstTap=!1)}this.isGameKey(t)&&e.preventDefault()}onKeyUp(e){let t=e.key.toLowerCase();if(this.keys.has(t)){this.keys.delete(t),this.emit("keyUp",{key:e.key,code:e.code});let i=this.keyTimings.get(t);if(i){let e=Date.now();!i.hasValidFirstTap&&i.firstPressTime>0?(i.firstReleaseTime=e,i.hasValidFirstTap=!0):i.isInDoubleTapSequence&&setTimeout(()=>{i&&(i.firstPressTime=0,i.firstReleaseTime=0,i.secondPressTime=0,i.isInDoubleTapSequence=!1,i.hasValidFirstTap=!1)},100)}}}onMouseDown(e){this.mouseButtons.add(e.button),this.emit("mouseDown",{button:e.button,x:e.clientX,y:e.clientY})}onMouseUp(e){this.mouseButtons.delete(e.button),this.emit("mouseUp",{button:e.button,x:e.clientX,y:e.clientY})}onMouseMove(e){if(this.isPointerLocked)this.mouseDelta.x+=e.movementX,this.mouseDelta.y+=e.movementY;else{this.previousMousePosition.x=this.mousePosition.x,this.previousMousePosition.y=this.mousePosition.y,this.mousePosition.x=e.clientX,this.mousePosition.y=e.clientY;let t=this.mousePosition.x-this.previousMousePosition.x,i=this.mousePosition.y-this.previousMousePosition.y;this.mouseDelta.x+=t,this.mouseDelta.y+=i}this.emit("mouseMove",{x:this.mousePosition.x,y:this.mousePosition.y,deltaX:this.mouseDelta.x,deltaY:this.mouseDelta.y})}onWheel(e){this.emit("wheel",{deltaX:e.deltaX,deltaY:e.deltaY,deltaZ:e.deltaZ}),e.preventDefault()}onPointerLockChange(){this.isPointerLocked=null!==document.pointerLockElement}onPointerLockError(){console.warn("Pointer lock failed"),this.isPointerLocked=!1}onWindowBlur(){this.keys.clear(),this.mouseButtons.clear(),this.keyTimings.clear()}onWindowFocus(){this.mouseDelta.x=0,this.mouseDelta.y=0}isGameKey(e){return["w","a","s","d"," ","shift","tab","escape"].includes(e)}destroy(){document.removeEventListener("keydown",this.onKeyDown.bind(this)),document.removeEventListener("keyup",this.onKeyUp.bind(this)),document.removeEventListener("mousedown",this.onMouseDown.bind(this)),document.removeEventListener("mouseup",this.onMouseUp.bind(this)),document.removeEventListener("mousemove",this.onMouseMove.bind(this)),document.removeEventListener("wheel",this.onWheel.bind(this)),document.removeEventListener("pointerlockchange",this.onPointerLockChange.bind(this)),document.removeEventListener("pointerlockerror",this.onPointerLockError.bind(this)),window.removeEventListener("blur",this.onWindowBlur.bind(this)),window.removeEventListener("focus",this.onWindowFocus.bind(this)),this.canvas&&(this.canvas.removeEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.removeEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.removeEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.removeEventListener("wheel",this.onWheel.bind(this))),this.keys.clear(),this.mouseButtons.clear(),this.keyTimings.clear(),this.removeAllListeners()}constructor(){super(),this.keys=new Set,this.mouseButtons=new Set,this.mousePosition={x:0,y:0},this.mouseDelta={x:0,y:0},this.previousMousePosition={x:0,y:0},this.isPointerLocked=!1,this.canvas=null,this.keyTimings=new Map,this.DOUBLE_TAP_THRESHOLD=200,this.setupEventListeners()}}class r extends o.v{async initialize(e){if(this.isInitialized){console.warn("Engine already initialized");return}this.canvas=e,this.inputManager.initialize(e),this.isInitialized=!0,this.emit("initialized")}start(){if(!this.isInitialized)throw Error("Engine must be initialized before starting");if(this.isRunning){console.warn("Engine already running");return}this.isRunning=!0,this.gameLoop.start(),this.emit("started")}stop(){this.isRunning&&(this.isRunning=!1,this.gameLoop.stop(),this.emit("stopped"))}pause(){this.isRunning&&(this.gameLoop.pause(),this.emit("paused"))}resume(){this.isRunning&&(this.gameLoop.resume(),this.emit("resumed"))}getWorld(){return this.world}getInputManager(){return this.inputManager}getCanvas(){return this.canvas}isEngineRunning(){return this.isRunning}getCurrentFPS(){return this.gameLoop.getCurrentFPS()}getPerformanceStats(){return{fps:this.gameLoop.getCurrentFPS(),frameTime:this.frameTime,updateTime:this.updateTime,renderTime:this.renderTime}}enableDebugMode(e){this.debugMode=e}isDebugMode(){return this.debugMode}setupGameLoop(){this.gameLoop.on("fixedUpdate",e=>{let{fixedDeltaTime:t}=e,i=performance.now();this.world.fixedUpdate(t),this.debugMode&&(this.updateTime=performance.now()-i)}),this.gameLoop.on("update",e=>{let{deltaTime:t}=e,i=performance.now();this.world.update(t),this.inputManager.update(),this.debugMode&&(this.updateTime=performance.now()-i),this.emit("update",{deltaTime:t})}),this.gameLoop.on("render",e=>{let{deltaTime:t,interpolation:i}=e,s=performance.now();this.world.render(t),this.debugMode&&(this.renderTime=performance.now()-s,this.frameTime=this.updateTime+this.renderTime),this.emit("render",{deltaTime:t,interpolation:i})})}destroy(){this.stop(),this.world.destroy(),this.inputManager.destroy(),this.removeAllListeners(),this.isInitialized=!1}requestPointerLock(){this.inputManager.requestPointerLock()}exitPointerLock(){this.inputManager.exitPointerLock()}isKeyPressed(e){return this.inputManager.isKeyPressed(e)}isMouseButtonPressed(e){return this.inputManager.isMouseButtonPressed(e)}getMouseDelta(){return this.inputManager.getMouseDelta()}constructor(e={}){super(),this.canvas=null,this.isInitialized=!1,this.isRunning=!1,this.debugMode=!1,this.frameTime=0,this.updateTime=0,this.renderTime=0,this.world=new s.q,this.gameLoop=new a,this.inputManager=new n,this.debugMode=e.enableDebug||!1,this.setupGameLoop()}}},3980:function(e,t,i){i.d(t,{J:function(){return s},w:function(){return o}});class s{addComponent(e){let t=e.componentType||e.constructor.name;return console.log("\uD83D\uDD27 Adding component ".concat(t," to entity ").concat(this.id)),this.components.set(t,e),e}removeComponent(e){this.components.delete(e.name)}getComponent(e){let t=e.componentType||e.name,i=this.components.get(t);if(!i&&e.componentType&&(i=this.components.get(e.name))&&console.log("\uD83D\uDD27 Found component using constructor name fallback: ".concat(e.name)),!i){for(let[t,s]of Array.from(this.components.entries()))if(s instanceof e){.01>Math.random()&&console.log("\uD83D\uDD27 Found component using instanceof check: ".concat(t," -> ").concat(e.name)),i=s;break}}if(i){let e=i.componentType||i.constructor.name;e===t||i.constructor.name.match(/^[a-z]$/)||console.warn("\uD83D\uDEA8 Component type mismatch! Requested: ".concat(t,", Got: ").concat(e),i)}else .001>Math.random()&&console.warn("❌ Component not found: ".concat(t,". Available components:"),Array.from(this.components.keys()));return i}hasComponent(e){let t=e.componentType||e.name;if(this.components.has(t)||e.componentType&&this.components.has(e.name))return!0;for(let t of Array.from(this.components.values()))if(t instanceof e)return!0;return!1}hasComponents(e){return e.every(e=>this.hasComponent(e))}getAllComponents(){return Array.from(this.components.values())}getComponentNames(){return Array.from(this.components.keys())}isActive(){return this.active}setActive(e){this.active=e}destroy(){this.components.clear(),this.active=!1}constructor(){this.components=new Map,this.active=!0,this.id=s.nextId++}}s.nextId=1;class o{constructor(){this.enabled=!0}}},9131:function(e,t,i){i.d(t,{FU:function(){return a},Kg:function(){return o},xP:function(){return s}});class s{matchesEntity(e){return e.isActive()&&e.hasComponents(this.requiredComponents)}constructor(){this.enabled=!0,this.priority=0}}class o extends s{}class a extends s{}},4058:function(e,t,i){i.d(t,{q:function(){return n}});var s=i(3980),o=i(9131),a=i(6520);class n{createEntity(){let e=new s.J;return this.entities.set(e.id,e),e}destroyEntity(e){this.entitiesToDestroy.push(e)}notifyEntityAdded(e){for(let t of this.systems)t.onEntityAdded&&t.matchesEntity(e)&&t.onEntityAdded(e)}getEntity(e){return this.entities.get(e)}getAllEntities(){return Array.from(this.entities.values())}addSystem(e){var t;this.systems.push(e),this.systems.sort((e,t)=>e.priority-t.priority),e instanceof o.Kg&&this.renderSystems.push(e),e instanceof o.FU&&this.physicsSystems.push(e),null===(t=e.onEnable)||void 0===t||t.call(e)}getSystem(e){return this.systems.find(t=>t instanceof e)}removeSystem(e){let t=this.systems.findIndex(t=>t instanceof e);if(-1!==t){var i;let e=this.systems[t];null===(i=e.onDisable)||void 0===i||i.call(e),this.systems.splice(t,1);let s=this.renderSystems.findIndex(t=>t===e);-1!==s&&this.renderSystems.splice(s,1);let o=this.physicsSystems.findIndex(t=>t===e);-1!==o&&this.physicsSystems.splice(o,1)}}createComponent(e){let t=e.componentType||e.name;if(["Health","HealthBar","Transform","Movement","Collider","Renderer","Enemy","Projectile","Animation"].includes(t))return console.log("Creating ".concat(t," component without pooling to avoid prototype issues")),new e;let i=this.componentPools.get(t);return i||(i=new a.L(()=>new e,e=>e.reset(),100),this.componentPools.set(t,i)),i.acquire()}returnComponent(e){let t=this.componentPools.get(e.constructor.name);t&&t.release(e)}update(e){for(let t of(this.cleanupDestroyedEntities(),this.systems)){if(!t.enabled)continue;let i=this.getEntitiesForSystem(t);t.update(i,e)}}fixedUpdate(e){for(let t of this.physicsSystems){if(!t.enabled)continue;let i=this.getEntitiesForSystem(t);t.fixedUpdate(i,e)}}render(e){for(let t of this.renderSystems){if(!t.enabled)continue;let i=this.getEntitiesForSystem(t);t.render(i,e)}}getEntitiesForSystem(e){let t=[];for(let i of Array.from(this.entities.values()))e.matchesEntity(i)&&t.push(i);return t}cleanupDestroyedEntities(){for(let e of this.entitiesToDestroy){let t=this.entities.get(e);if(t){for(let e of this.systems)e.onEntityRemoved&&e.matchesEntity(t)&&e.onEntityRemoved(t);for(let e of t.getAllComponents())this.returnComponent(e);t.destroy(),this.entities.delete(e)}}this.entitiesToDestroy.length=0}queryEntities(e){let t=[];for(let i of Array.from(this.entities.values()))i.isActive()&&i.hasComponents(e)&&t.push(i);return t}emitEvent(e,t){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t)}getEvents(e){return this.events.get(e)||[]}clearEvents(e){this.events.set(e,[])}destroy(){for(let e of Array.from(this.entities.values()))e.destroy();for(let t of(this.entities.clear(),this.systems)){var e;null===(e=t.onDisable)||void 0===e||e.call(t)}this.systems.length=0,this.renderSystems.length=0,this.physicsSystems.length=0,this.componentPools.clear(),this.events.clear()}constructor(){this.entities=new Map,this.systems=[],this.renderSystems=[],this.physicsSystems=[],this.componentPools=new Map,this.entitiesToDestroy=[],this.events=new Map}}},3478:function(e,t,i){i.d(t,{F5:function(){return a},YM:function(){return h},aB:function(){return n}});var s,o,a,n,r=i(1448),l=i(3980);(s=a||(a={})).SPHERE="sphere",s.BOX="box",s.CAPSULE="capsule",s.CYLINDER="cylinder",(o=n||(n={}))[o.DEFAULT=1]="DEFAULT",o[o.PLAYER=2]="PLAYER",o[o.ENEMY=4]="ENEMY",o[o.PROJECTILE=8]="PROJECTILE",o[o.ENVIRONMENT=16]="ENVIRONMENT",o[o.PICKUP=32]="PICKUP";class h extends l.w{getDefaultMask(e){switch(e){case 2:return 52;case 4:return 26;case 8:return 22;case 16:return 14;case 32:return 2;default:return 4294967295}}static createSphere(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new h("sphere",e,t)}static createBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=new h("box",0,t);return i.size.copy(e),i}static createCapsule(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=new h("capsule",e,i);return s.height=t,s}static createCylinder(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=new h("cylinder",e,i);return s.height=t,s}setOffset(e,t,i){this.offset.set(e,t,i),this.boundsNeedUpdate=!0}setLayer(e){this.layer=e,this.mask=this.getDefaultMask(e)}setMask(e){this.mask=e}canCollideWith(e){return(this.mask&e.layer)!=0&&(e.mask&this.layer)!=0}updateBounds(e){if(!this.boundsNeedUpdate&&!this.isStatic)return;let t=e.clone().add(this.offset);switch(this.type){case"sphere":this.boundingSphere.set(t,this.radius),this.bounds.setFromCenterAndSize(t,new r.Vector3(2*this.radius,2*this.radius,2*this.radius));break;case"box":this.bounds.setFromCenterAndSize(t,this.size),this.boundingSphere.setFromPoints([t.clone().add(new r.Vector3(-this.size.x/2,-this.size.y/2,-this.size.z/2)),t.clone().add(new r.Vector3(this.size.x/2,this.size.y/2,this.size.z/2))]);break;case"capsule":let i=Math.max(this.radius,this.size.x/2,this.size.z/2);this.boundingSphere.set(t,Math.max(i,this.height/2)),this.bounds.setFromCenterAndSize(t,new r.Vector3(2*i,this.height,2*i));break;case"cylinder":this.boundingSphere.set(t,Math.max(this.radius,this.height/2)),this.bounds.setFromCenterAndSize(t,new r.Vector3(2*this.radius,this.height,2*this.radius))}this.boundsNeedUpdate=!1}intersects(e,t,i){return this.updateBounds(t),e.updateBounds(i),!!this.boundingSphere.intersectsSphere(e.boundingSphere)&&this.preciseIntersection(e,t,i)}preciseIntersection(e,t,i){let s=t.clone().add(this.offset),o=i.clone().add(e.offset);if("sphere"===this.type&&"sphere"===e.type)return s.distanceTo(o)<=this.radius+e.radius;if("box"===this.type&&"box"===e.type)return this.bounds.intersectsBox(e.bounds);if("sphere"===this.type&&"box"===e.type||"box"===this.type&&"sphere"===e.type){let t="sphere"===this.type?this:e,i="box"===this.type?this:e,a="sphere"===this.type?s:o,n=new r.Vector3;return i.bounds.clampPoint(a,n),a.distanceTo(n)<=t.radius}if("sphere"===this.type&&"cylinder"===e.type||"cylinder"===this.type&&"sphere"===e.type){let t="sphere"===this.type?this:e,i="cylinder"===this.type?this:e,a="sphere"===this.type?s:o,n="cylinder"===this.type?s:o;return!(Math.abs(a.y-n.y)>i.height/2+t.radius)&&Math.sqrt(Math.pow(a.x-n.x,2)+Math.pow(a.z-n.z,2))<=t.radius+i.radius}return this.bounds.intersectsBox(e.bounds)}getClosestPoint(e,t){this.updateBounds(t);let i=t.clone().add(this.offset);switch(this.type){case"sphere":let s=e.clone().sub(i).normalize();return i.clone().add(s.multiplyScalar(this.radius));case"box":let o=new r.Vector3;return this.bounds.clampPoint(e,o),o;default:let a=new r.Vector3;return this.bounds.clampPoint(e,a),a}}getVolume(){switch(this.type){case"sphere":return 4/3*Math.PI*Math.pow(this.radius,3);case"box":return this.size.x*this.size.y*this.size.z;case"cylinder":return Math.PI*Math.pow(this.radius,2)*this.height;case"capsule":return 4/3*Math.PI*Math.pow(this.radius,3)+Math.PI*Math.pow(this.radius,2)*(this.height-2*this.radius);default:return 1}}reset(){this.type="sphere",this.radius=.5,this.size.set(1,1,1),this.height=2,this.offset.set(0,0,0),this.layer=1,this.mask=this.getDefaultMask(1),this.isTrigger=!1,this.isStatic=!1,this.bounds=new r.Box3,this.boundingSphere=new r.Sphere,this.boundsNeedUpdate=!0,this.onCollisionEnter=void 0,this.onCollisionStay=void 0,this.onCollisionExit=void 0,this.onTriggerEnter=void 0,this.onTriggerStay=void 0,this.onTriggerExit=void 0,this.enabled=!0}clone(){let e=new h(this.type,this.radius,this.layer);return e.size.copy(this.size),e.height=this.height,e.offset.copy(this.offset),e.mask=this.mask,e.isTrigger=this.isTrigger,e.isStatic=this.isStatic,e}constructor(e="sphere",t=.5,i=1){super(),this.componentType="Collider",this.type=e,this.radius=t,this.size=new r.Vector3(1,1,1),this.height=2,this.offset=new r.Vector3(0,0,0),this.layer=i,this.mask=this.getDefaultMask(i),this.isTrigger=!1,this.isStatic=!1,this.bounds=new r.Box3,this.boundingSphere=new r.Sphere,this.boundsNeedUpdate=!0}}h.componentType="Collider"},8001:function(e,t,i){i.d(t,{C:function(){return n},Z:function(){return o}});var s,o,a=i(3980);(s=o||(o={})).DUMMY="dummy",s.GRUNT="grunt",s.ELITE="elite",s.BOSS="boss";class n extends a.w{calculateExperienceReward(){return({dummy:5,grunt:10,elite:25,boss:100})[this.type]*this.level}calculateAggroRange(){return({dummy:0,grunt:5,elite:8,boss:12})[this.type]}calculateAttackRange(){return({dummy:0,grunt:1.5,elite:2,boss:3})[this.type]}calculateAttackDamage(){return({dummy:0,grunt:15,elite:25,boss:50})[this.type]*this.level}calculateAttackCooldown(){return({dummy:0,grunt:2,elite:1.5,boss:1})[this.type]}calculateMovementSpeed(){return({dummy:0,grunt:3,elite:0,boss:2.5})[this.type]}canAttack(e){return!!this.isAggressive&&!this.isDead&&0!==this.attackDamage&&e-this.lastAttackTime>=this.attackCooldown}performAttack(e){this.lastAttackTime=e}takeDamage(){}die(e){this.isDead=!0,this.deathTime=e}canRespawnNow(e){return!!this.canRespawn&&!!this.isDead&&e-this.deathTime>=this.respawnTime}respawn(){this.isDead=!1,this.deathTime=0,this.lastAttackTime=0,this.unfreeze(),this.removeVenom()}freeze(e,t){this.isDead||(this.isFrozen=!0,this.freezeStartTime=t,this.freezeDuration=e,this.movementSpeed=0)}unfreeze(){this.isFrozen=!1,this.freezeStartTime=0,this.freezeDuration=0,this.movementSpeed=this.originalMovementSpeed}updateFreezeStatus(e){this.isFrozen&&e-this.freezeStartTime>=this.freezeDuration&&this.unfreeze()}canMove(){return!this.isFrozen&&!this.isDead}applyVenom(e,t,i){this.isDead||(this.isVenomous=!0,this.venomStartTime=i,this.venomDuration=e,this.venomDamagePerSecond=t,this.lastVenomDamageTime=i)}removeVenom(){this.isVenomous=!1,this.venomStartTime=0,this.venomDuration=0,this.venomDamagePerSecond=0,this.lastVenomDamageTime=0}updateVenomStatus(e){return this.isVenomous?e-this.venomStartTime>=this.venomDuration?(this.removeVenom(),{shouldDealDamage:!1,damage:0}):e-this.lastVenomDamageTime>=1?(this.lastVenomDamageTime=e,{shouldDealDamage:!0,damage:this.venomDamagePerSecond}):{shouldDealDamage:!1,damage:0}:{shouldDealDamage:!1,damage:0}}setLevel(e){this.level=Math.max(1,e),this.experienceReward=this.calculateExperienceReward(),this.attackDamage=this.calculateAttackDamage()}getDisplayName(){return"".concat({dummy:"Training Dummy",grunt:"Grunt",elite:"Elite",boss:"Boss"}[this.type]," (Lv.").concat(this.level,")")}reset(){this.type="dummy",this.level=1,this.experienceReward=this.calculateExperienceReward(),this.isAggressive=!1,this.aggroRange=this.calculateAggroRange(),this.attackRange=this.calculateAttackRange(),this.attackDamage=this.calculateAttackDamage(),this.attackCooldown=this.calculateAttackCooldown(),this.lastAttackTime=0,this.movementSpeed=this.calculateMovementSpeed(),this.isDead=!1,this.deathTime=0,this.respawnTime=30,this.canRespawn=!0,this.enabled=!0,this.isFrozen=!1,this.freezeStartTime=0,this.freezeDuration=0,this.originalMovementSpeed=this.movementSpeed,this.isVenomous=!1,this.venomStartTime=0,this.venomDuration=0,this.venomDamagePerSecond=0,this.lastVenomDamageTime=0}clone(){let e=new n(this.type,this.level);return e.experienceReward=this.experienceReward,e.isAggressive=this.isAggressive,e.aggroRange=this.aggroRange,e.attackRange=this.attackRange,e.attackDamage=this.attackDamage,e.attackCooldown=this.attackCooldown,e.lastAttackTime=this.lastAttackTime,e.movementSpeed=this.movementSpeed,e.isDead=this.isDead,e.deathTime=this.deathTime,e.respawnTime=this.respawnTime,e.canRespawn=this.canRespawn,e.isFrozen=this.isFrozen,e.freezeStartTime=this.freezeStartTime,e.freezeDuration=this.freezeDuration,e.originalMovementSpeed=this.originalMovementSpeed,e.isVenomous=this.isVenomous,e.venomStartTime=this.venomStartTime,e.venomDuration=this.venomDuration,e.venomDamagePerSecond=this.venomDamagePerSecond,e.lastVenomDamageTime=this.lastVenomDamageTime,e}constructor(e="dummy",t=1){super(),this.componentType="Enemy",this.type=e,this.level=t,this.experienceReward=this.calculateExperienceReward(),this.isAggressive="dummy"!==e,this.aggroRange=this.calculateAggroRange(),this.attackRange=this.calculateAttackRange(),this.attackDamage=this.calculateAttackDamage(),this.attackCooldown=this.calculateAttackCooldown(),this.lastAttackTime=0,this.movementSpeed=this.calculateMovementSpeed(),this.isDead=!1,this.deathTime=0,this.respawnTime=30,this.canRespawn=!0,this.isFrozen=!1,this.freezeStartTime=0,this.freezeDuration=0,this.originalMovementSpeed=this.movementSpeed,this.isVenomous=!1,this.venomStartTime=0,this.venomDuration=0,this.venomDamagePerSecond=0,this.lastVenomDamageTime=0}}n.componentType="Enemy"},6862:function(e,t,i){i.d(t,{S:function(){return a}});var s=i(3980),o=i(3974);class a extends s.w{takeDamage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now()/1e3,i=arguments.length>2?arguments[2]:void 0;if(this.isDead||this.isInvulnerable||e<=0)return!1;let s=e;if(i){let t=i.getComponent(o.W);t&&(s=t.absorbDamage(e))}return s>0&&(this.currentHealth=Math.max(0,this.currentHealth-s),this.lastDamageTime=t,this.isInvulnerable=!0,this.invulnerabilityTimer=this.invulnerabilityDuration,this.currentHealth<=0&&(this.isDead=!0)),!0}heal(e){if(this.isDead||e<=0)return!1;let t=this.currentHealth;return this.currentHealth=Math.min(this.maxHealth,this.currentHealth+e),this.currentHealth>t}setMaxHealth(e){let t=this.getHealthRatio();this.maxHealth=Math.max(1,e),this.currentHealth=Math.floor(this.maxHealth*t)}getHealthRatio(){return this.maxHealth>0?this.currentHealth/this.maxHealth:0}getHealthPercentage(){return 100*this.getHealthRatio()}isFullHealth(){return this.currentHealth>=this.maxHealth}isLowHealth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.25;return this.getHealthRatio()<=e}isCriticalHealth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return this.getHealthRatio()<=e}revive(e){this.isDead=!1,this.currentHealth=void 0!==e?Math.min(this.maxHealth,e):this.maxHealth,this.isInvulnerable=!1,this.invulnerabilityTimer=0}update(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now()/1e3;this.isInvulnerable&&(this.invulnerabilityTimer-=e,this.invulnerabilityTimer<=0&&(this.isInvulnerable=!1,this.invulnerabilityTimer=0)),this.canRegenerate&&!this.isDead&&!this.isFullHealth()&&t-this.lastDamageTime>=this.regenerationDelay&&this.heal(this.regenerationRate*e)}setInvulnerable(e){this.isInvulnerable=!0,this.invulnerabilityTimer=e}removeInvulnerability(){this.isInvulnerable=!1,this.invulnerabilityTimer=0}enableRegeneration(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;this.canRegenerate=!0,this.regenerationRate=e,this.regenerationDelay=t}disableRegeneration(){this.canRegenerate=!1}reset(){this.currentHealth=this.maxHealth,this.isInvulnerable=!1,this.invulnerabilityTimer=0,this.isDead=!1,this.canRegenerate=!1,this.regenerationRate=5,this.regenerationDelay=3,this.lastDamageTime=0,this.enabled=!0}clone(){let e=new a(this.maxHealth);return e.currentHealth=this.currentHealth,e.isInvulnerable=this.isInvulnerable,e.invulnerabilityDuration=this.invulnerabilityDuration,e.invulnerabilityTimer=this.invulnerabilityTimer,e.isDead=this.isDead,e.canRegenerate=this.canRegenerate,e.regenerationRate=this.regenerationRate,e.regenerationDelay=this.regenerationDelay,e.lastDamageTime=this.lastDamageTime,e}constructor(e=100){super(),this.componentType="Health",this.maxHealth=e,this.currentHealth=e,this.isInvulnerable=!1,this.invulnerabilityDuration=.5,this.invulnerabilityTimer=0,this.isDead=!1,this.canRegenerate=!1,this.regenerationRate=5,this.regenerationDelay=3,this.lastDamageTime=0}}a.componentType="Health"},6776:function(e,t,i){i.d(t,{T:function(){return a}});var s=i(1448),o=i(3980);class a extends o.w{createHealthBarMeshes(){this.group=new s.Group;let e=new s.PlaneGeometry(this.width+2*this.borderWidth,this.height+2*this.borderWidth),t=new s.MeshBasicMaterial({color:this.borderColor,transparent:!0,opacity:.8});this.borderMesh=new s.Mesh(e,t),this.borderMesh.position.z=-.001,this.group.add(this.borderMesh);let i=new s.PlaneGeometry(this.width,this.height),o=new s.MeshBasicMaterial({color:this.backgroundColor,transparent:!0,opacity:.7});this.backgroundMesh=new s.Mesh(i,o),this.group.add(this.backgroundMesh);let a=new s.PlaneGeometry(this.width,this.height),n=new s.MeshBasicMaterial({color:this.healthColor,transparent:!0,opacity:.9});this.healthMesh=new s.Mesh(a,n),this.healthMesh.position.z=.001,this.group.add(this.healthMesh),this.group.lookAt(0,0,1)}updateHealthBar(e,t,i,o){this.currentHealthRatio=Math.max(0,Math.min(1,e)),Math.abs(this.lastHealthRatio-this.currentHealthRatio)>.01?this.lastHealthRatio=s.MathUtils.lerp(this.lastHealthRatio,this.currentHealthRatio,this.animationSpeed*o):this.lastHealthRatio=this.currentHealthRatio,this.updateHealthMesh(),this.updateHealthColor(),this.updateVisibility(t,i),this.updatePositionAndRotation(t,i),this.updateDamageFlash(o)}updateHealthMesh(){this.healthMesh.scale.x=this.lastHealthRatio;let e=this.width*(1-this.lastHealthRatio)/2;this.healthMesh.position.x=-e}updateHealthColor(){let e;if(this.currentHealthRatio<=this.criticalHealthThreshold)e=this.criticalHealthColor;else if(this.currentHealthRatio<=this.lowHealthThreshold){let t=(this.currentHealthRatio-this.criticalHealthThreshold)/(this.lowHealthThreshold-this.criticalHealthThreshold);e=new s.Color().lerpColors(this.criticalHealthColor,this.lowHealthColor,t)}else{let t=(this.currentHealthRatio-this.lowHealthThreshold)/(1-this.lowHealthThreshold);e=new s.Color().lerpColors(this.lowHealthColor,this.healthColor,t)}this.healthMesh.material.color.copy(e)}updateVisibility(e,t){let i=e.distanceTo(t),s=i<=this.fadeDistance;if(!this.showWhenFull&&this.currentHealthRatio>=.99&&(s=!1),this.isVisible=s,this.group.visible=this.isVisible,this.isVisible&&i>.7*this.fadeDistance){let e=Math.max(.1,1-(i-.7*this.fadeDistance)/(.3*this.fadeDistance));this.backgroundMesh.material.opacity=.7*e,this.healthMesh.material.opacity=.9*e,this.borderMesh.material.opacity=.8*e}else this.isVisible&&(this.backgroundMesh.material.opacity=.7,this.healthMesh.material.opacity=.9,this.borderMesh.material.opacity=.8)}updatePositionAndRotation(e,t){let i=t.clone().add(this.offset);this.group.position.copy(i),this.group.lookAt(e)}updateDamageFlash(e){if(this.damageFlashTimer>0){this.damageFlashTimer-=e;let t=this.damageFlashTimer/this.damageFlashDuration,i=new s.Color(1,1,1),o=this.healthMesh.material.color.clone();o.lerp(i,.5*t),this.healthMesh.material.color.copy(o)}}triggerDamageFlash(){this.damageFlashTimer=this.damageFlashDuration}setHealthRatio(e){let t=this.currentHealthRatio;this.currentHealthRatio=Math.max(0,Math.min(1,e)),this.currentHealthRatio<t&&this.triggerDamageFlash()}getGroup(){return this.group}dispose(){this.backgroundMesh.geometry.dispose(),this.backgroundMesh.material.dispose(),this.healthMesh.geometry.dispose(),this.healthMesh.material.dispose(),this.borderMesh.geometry.dispose(),this.borderMesh.material.dispose(),this.group.parent&&this.group.parent.remove(this.group)}reset(){this.currentHealthRatio=1,this.lastHealthRatio=1,this.isVisible=!0,this.damageFlashTimer=0,this.enabled=!0,this.updateHealthMesh(),this.updateHealthColor()}clone(){return new a({width:this.width,height:this.height,offset:this.offset.clone(),backgroundColor:this.backgroundColor.clone(),healthColor:this.healthColor.clone(),lowHealthColor:this.lowHealthColor.clone(),criticalHealthColor:this.criticalHealthColor.clone(),borderColor:this.borderColor.clone(),borderWidth:this.borderWidth,showWhenFull:this.showWhenFull,fadeDistance:this.fadeDistance,lowHealthThreshold:this.lowHealthThreshold,criticalHealthThreshold:this.criticalHealthThreshold})}constructor(e={}){var t,i,o,a,n,r;super(),this.componentType="HealthBar",this.width=e.width||1,this.height=e.height||.1,this.offset=(null===(t=e.offset)||void 0===t?void 0:t.clone())||new s.Vector3(0,1.5,0),this.backgroundColor=(null===(i=e.backgroundColor)||void 0===i?void 0:i.clone())||new s.Color(3355443),this.healthColor=(null===(o=e.healthColor)||void 0===o?void 0:o.clone())||new s.Color(65280),this.lowHealthColor=(null===(a=e.lowHealthColor)||void 0===a?void 0:a.clone())||new s.Color(16776960),this.criticalHealthColor=(null===(n=e.criticalHealthColor)||void 0===n?void 0:n.clone())||new s.Color(16711680),this.borderColor=(null===(r=e.borderColor)||void 0===r?void 0:r.clone())||new s.Color(0),this.borderWidth=e.borderWidth||.02,this.showWhenFull=void 0!==e.showWhenFull&&e.showWhenFull,this.fadeDistance=e.fadeDistance||20,this.lowHealthThreshold=e.lowHealthThreshold||.5,this.criticalHealthThreshold=e.criticalHealthThreshold||.25,this.isVisible=!0,this.currentHealthRatio=1,this.lastHealthRatio=1,this.animationSpeed=5,this.damageFlashTimer=0,this.damageFlashDuration=.2,this.createHealthBarMeshes()}}a.componentType="HealthBar"},7771:function(e,t,i){i.d(t,{i:function(){return a}});var s=i(1448),o=i(3980);class a extends o.w{addForce(e){this.acceleration.add(e)}addImpulse(e){this.velocity.add(e)}jump(){this.canJump&&(this.isGrounded||this.canFly)&&(this.velocity.y=this.jumpForce,this.isGrounded=!1)}setMoveDirection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.moveDirection.copy(e).normalize(),this.inputStrength=Math.max(0,Math.min(1,t))}freeze(e){let t=Date.now();this.isFrozen=!0,this.frozenUntil=t+e,console.log("\uD83E\uDDCA Player frozen for ".concat(e,"ms until ").concat(this.frozenUntil," (current: ").concat(t,")"))}slow(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=Date.now();this.isSlowed=!0,this.slowedUntil=i+e,this.movementSpeedMultiplier=t,console.log("\uD83D\uDC0C Player slowed to ".concat(100*t,"% speed for ").concat(e,"ms until ").concat(this.slowedUntil))}updateDebuffs(){let e=Date.now();this.isFrozen&&e>=this.frozenUntil&&(this.isFrozen=!1,this.frozenUntil=0,console.log("\uD83E\uDDCA Player unfrozen")),this.isSlowed&&e>=this.slowedUntil&&(this.isSlowed=!1,this.slowedUntil=0,this.movementSpeedMultiplier=1,console.log("\uD83D\uDC0C Player no longer slowed"))}getEffectiveMaxSpeed(){return this.isFrozen?0:this.maxSpeed*this.movementSpeedMultiplier}startDash(e,t,i){if(this.isDashing)return!1;let s=this.dashCharges.findIndex(e=>e.isAvailable);return -1!==s&&(this.isDashing=!0,this.dashDirection.copy(e).normalize(),this.dashStartTime=i,this.dashStartPosition.copy(t),this.dashCharges[s].isAvailable=!1,this.dashCharges[s].cooldownStartTime=i,setTimeout(()=>{this.dashCharges[s].isAvailable=!0,this.dashCharges[s].cooldownStartTime=null},6e3),!0)}updateDash(e){if(!this.isDashing)return{isComplete:!1,newPosition:null};let t=Math.min((e-this.dashStartTime)/this.dashDuration,1);if(t>=1)return this.isDashing=!1,{isComplete:!0,newPosition:this.dashStartPosition.clone().add(this.dashDirection.clone().multiplyScalar(this.dashDistance))};let i=this.dashDirection.clone().multiplyScalar(this.dashDistance*(1-Math.pow(1-t,2)));return{isComplete:!1,newPosition:this.dashStartPosition.clone().add(i)}}cancelDash(){this.isDashing=!1,this.dashDirection.set(0,0,0),this.dashStartTime=0}stop(){this.velocity.set(0,0,0),this.acceleration.set(0,0,0),this.moveDirection.set(0,0,0),this.inputStrength=0}getSpeed(){return this.velocity.length()}getHorizontalSpeed(){return Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.z*this.velocity.z)}isMoving(){return this.getSpeed()>.01}isMovingHorizontally(){return this.getHorizontalSpeed()>.01}isFalling(){return this.velocity.y<-.1}isRising(){return this.velocity.y>.1}getAvailableDashCharges(){return this.dashCharges.filter(e=>e.isAvailable).length}getDashChargeStatus(){let e=Date.now()/1e3;return this.dashCharges.map(t=>({isAvailable:t.isAvailable,cooldownRemaining:t.cooldownStartTime?Math.max(0,6-(e-t.cooldownStartTime)):0}))}startCharge(e,t,i){return!this.isCharging&&!this.isDashing&&(this.isCharging=!0,this.chargeDirection.copy(e).normalize(),this.chargeStartTime=i,this.chargeStartPosition.copy(t),!0)}updateCharge(e){if(!this.isCharging)return{isComplete:!1,newPosition:null};let t=Math.min((e-this.chargeStartTime)/this.chargeDuration,1);if(t>=1)return this.isCharging=!1,{isComplete:!0,newPosition:this.chargeStartPosition.clone().add(this.chargeDirection.clone().multiplyScalar(this.chargeDistance))};let i=this.chargeDirection.clone().multiplyScalar(this.chargeDistance*(1-Math.pow(1-t,2)));return{isComplete:!1,newPosition:this.chargeStartPosition.clone().add(i)}}cancelCharge(){this.isCharging=!1,this.chargeDirection.set(0,0,0),this.chargeStartTime=0}clampVelocity(){let e=this.getEffectiveMaxSpeed(),t=new s.Vector3(this.velocity.x,0,this.velocity.z);t.length()>e&&(0===e?(this.velocity.x=0,this.velocity.z=0):(t.normalize().multiplyScalar(e),this.velocity.x=t.x,this.velocity.z=t.z))}applyFriction(e){if(!this.canMove)return;let t=Math.pow(this.friction,e);this.velocity.x*=t,this.velocity.z*=t,.01>Math.abs(this.velocity.x)&&(this.velocity.x=0),.01>Math.abs(this.velocity.z)&&(this.velocity.z=0)}applyGravity(e){this.canFly||(this.velocity.y+=this.gravity*e)}reset(){this.velocity?this.velocity.set(0,0,0):this.velocity=new s.Vector3(0,0,0),this.acceleration?this.acceleration.set(0,0,0):this.acceleration=new s.Vector3(0,0,0),this.moveDirection?this.moveDirection.set(0,0,0):this.moveDirection=new s.Vector3(0,0,0),this.inputStrength=0,this.isGrounded=!1,this.canMove=!0,this.canJump=!0,this.canFly=!1,this.maxSpeed=5,this.friction=.8,this.jumpForce=20,this.gravity=-12.5,this.enabled=!0,this.isFrozen=!1,this.frozenUntil=0,this.isSlowed=!1,this.slowedUntil=0,this.movementSpeedMultiplier=1,this.isDashing=!1,this.dashDirection.set(0,0,0),this.dashStartTime=0,this.dashDuration=.35,this.dashDistance=4,this.dashStartPosition.set(0,0,0),this.maxDashCharges=3,this.dashCharges=Array.from({length:this.maxDashCharges},()=>({isAvailable:!0,cooldownStartTime:null})),this.isCharging=!1,this.chargeDirection.set(0,0,0),this.chargeStartTime=0,this.chargeDuration=.35,this.chargeDistance=9,this.chargeStartPosition.set(0,0,0)}clone(){let e=new a(this.maxSpeed,this.friction,this.jumpForce,this.gravity);return e.velocity.copy(this.velocity),e.acceleration.copy(this.acceleration),e.moveDirection.copy(this.moveDirection),e.inputStrength=this.inputStrength,e.isGrounded=this.isGrounded,e.canMove=this.canMove,e.canJump=this.canJump,e.canFly=this.canFly,e.isFrozen=this.isFrozen,e.frozenUntil=this.frozenUntil,e.isSlowed=this.isSlowed,e.slowedUntil=this.slowedUntil,e.movementSpeedMultiplier=this.movementSpeedMultiplier,e.isDashing=this.isDashing,e.dashDirection.copy(this.dashDirection),e.dashStartTime=this.dashStartTime,e.dashDuration=this.dashDuration,e.dashDistance=this.dashDistance,e.dashStartPosition.copy(this.dashStartPosition),e.maxDashCharges=this.maxDashCharges,e.dashCharges=this.dashCharges.map(e=>({isAvailable:e.isAvailable,cooldownStartTime:e.cooldownStartTime})),e.isCharging=this.isCharging,e.chargeDirection.copy(this.chargeDirection),e.chargeStartTime=this.chargeStartTime,e.chargeDuration=this.chargeDuration,e.chargeDistance=this.chargeDistance,e.chargeStartPosition.copy(this.chargeStartPosition),e}constructor(e=3.65,t=.8,i=20,o=-12.5){super(),this.componentType="Movement",this.velocity=new s.Vector3(0,0,0),this.acceleration=new s.Vector3(0,0,0),this.maxSpeed=e,this.friction=t,this.isGrounded=!1,this.jumpForce=i,this.gravity=o,this.canMove=!0,this.canJump=!0,this.canFly=!1,this.isFrozen=!1,this.frozenUntil=0,this.isSlowed=!1,this.slowedUntil=0,this.movementSpeedMultiplier=1,this.moveDirection=new s.Vector3(0,0,0),this.inputStrength=0,this.isDashing=!1,this.dashDirection=new s.Vector3(0,0,0),this.dashStartTime=0,this.dashDuration=.35,this.dashDistance=4,this.dashStartPosition=new s.Vector3(0,0,0),this.maxDashCharges=3,this.dashCharges=Array.from({length:this.maxDashCharges},()=>({isAvailable:!0,cooldownStartTime:null})),this.isCharging=!1,this.chargeDirection=new s.Vector3(0,0,0),this.chargeStartTime=0,this.chargeDuration=.35,this.chargeDistance=9,this.chargeStartPosition=new s.Vector3(0,0,0)}}a.componentType="Movement"},1168:function(e,t,i){i.d(t,{W:function(){return a}});var s=i(1448),o=i(3980);class a extends o.w{setDirection(e){this.velocity.copy(e).normalize().multiplyScalar(this.speed)}addGravity(e){this.gravity=e}setPiercing(e){this.piercing=e}setExplosive(e){this.explosionRadius=e}setBouncing(e){this.maxBounces=e}setMaxDistance(e){this.maxDistance=e}setStartPosition(e){this.startPosition.copy(e)}hasHitTarget(e){return this.hitTargets.has(e)}addHitTarget(e){this.hitTargets.add(e)}canHitTarget(e){return e!==this.owner&&(!!this.piercing||!this.hasHitTarget(e))}isExpired(){return this.lifetime>=this.maxLifetime||this.distanceTraveled>=this.maxDistance}canBounce(){return this.bounces<this.maxBounces}bounce(e){if(!this.canBounce())return;let t=this.velocity.clone().reflect(e);this.velocity.copy(t),this.bounces++}update(e){this.lifetime+=e;let t=this.velocity.length()*e;this.distanceTraveled+=t,0!==this.gravity&&(this.velocity.y+=this.gravity*e)}getPosition(e){return e.clone()}getPredictedPosition(e,t){let i=e.clone();return i.add(this.velocity.clone().multiplyScalar(t)),i}reset(){this.velocity.set(0,0,0),this.speed=20,this.damage=10,this.lifetime=0,this.maxLifetime=5,this.piercing=!1,this.hitTargets.clear(),this.explosionRadius=0,this.gravity=0,this.bounces=0,this.maxBounces=0,this.owner=-1,this.distanceTraveled=0,this.maxDistance=1/0,this.startPosition.set(0,0,0),this.enabled=!0}clone(){let e=new a(this.speed,this.damage,this.maxLifetime,this.owner);return e.velocity.copy(this.velocity),e.lifetime=this.lifetime,e.piercing=this.piercing,e.hitTargets=new Set(this.hitTargets),e.explosionRadius=this.explosionRadius,e.gravity=this.gravity,e.bounces=this.bounces,e.maxBounces=this.maxBounces,e.distanceTraveled=this.distanceTraveled,e.maxDistance=this.maxDistance,e.startPosition.copy(this.startPosition),e}constructor(e=20,t=10,i=5,o=-1){super(),this.componentType="Projectile",this.velocity=new s.Vector3(0,0,0),this.speed=e,this.damage=t,this.lifetime=0,this.maxLifetime=i,this.piercing=!1,this.hitTargets=new Set,this.explosionRadius=0,this.gravity=0,this.bounces=0,this.maxBounces=0,this.owner=o,this.distanceTraveled=0,this.maxDistance=1/0,this.startPosition=new s.Vector3(0,0,0)}}a.componentType="Projectile"},246:function(e,t,i){i.d(t,{T:function(){return a}});var s=i(1448),o=i(3980);class a extends o.w{setGeometry(e){this.geometry&&this.geometry!==e&&this.geometry.dispose(),this.geometry=e,this.needsUpdate=!0}setMaterial(e){this.material&&this.material!==e&&(Array.isArray(this.material)?this.material.forEach(e=>e.dispose()):this.material.dispose()),this.material=e,this.needsUpdate=!0}createMesh(){return this.geometry&&this.material?(this.mesh&&this.disposeMesh(),this.mesh=new s.Mesh(this.geometry,this.material),this.mesh.castShadow=this.castShadow,this.mesh.receiveShadow=this.receiveShadow,this.mesh.frustumCulled=this.frustumCulled,this.mesh.visible=this.visible,this.mesh.renderOrder=this.renderOrder,this.needsUpdate=!1,this.mesh):null}updateMesh(){this.mesh&&(this.mesh instanceof s.Mesh?(this.mesh.castShadow=this.castShadow,this.mesh.receiveShadow=this.receiveShadow):this.mesh instanceof s.Group&&this.mesh.traverse(e=>{e instanceof s.Mesh&&(e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow)}),this.mesh.frustumCulled=this.frustumCulled,this.mesh.visible=this.visible,this.mesh.renderOrder=this.renderOrder,this.needsUpdate&&this.geometry&&this.material&&this.mesh instanceof s.Mesh&&(this.mesh.geometry=this.geometry,this.mesh.material=this.material,this.needsUpdate=!1))}setVisible(e){this.visible=e,this.mesh&&(this.mesh.visible=e)}setCastShadow(e){this.castShadow=e,this.mesh instanceof s.Mesh?this.mesh.castShadow=e:this.mesh instanceof s.Group&&this.mesh.traverse(t=>{t instanceof s.Mesh&&(t.castShadow=e)})}setReceiveShadow(e){this.receiveShadow=e,this.mesh instanceof s.Mesh?this.mesh.receiveShadow=e:this.mesh instanceof s.Group&&this.mesh.traverse(t=>{t instanceof s.Mesh&&(t.receiveShadow=e)})}setupAnimations(e){this.mesh&&(this.animations=e,e.length>0&&(this.animationMixer=new s.AnimationMixer(this.mesh)))}playAnimation(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2;if(!this.animationMixer)return null;let o=this.animations.find(t=>t.name===e);if(!o)return null;this.currentAnimation&&this.currentAnimation.fadeOut(i);let a=this.animationMixer.clipAction(o);return a.setLoop(t?s.LoopRepeat:s.LoopOnce,t?1/0:1),a.fadeIn(i),a.play(),this.currentAnimation=a,a}stopAnimation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.currentAnimation&&(this.currentAnimation.fadeOut(e),this.currentAnimation=null)}updateAnimations(e){this.animationMixer&&this.animationMixer.update(e)}setupInstancing(e,t){this.isInstanced=!0,this.instancedMesh=e,this.instanceId=t}updateInstanceMatrix(e){this.isInstanced&&this.instancedMesh&&this.instanceId>=0&&(this.instancedMesh.setMatrixAt(this.instanceId,e),this.instancedMesh.instanceMatrix.needsUpdate=!0)}setInstanceVisible(e){if(this.isInstanced&&this.instancedMesh&&this.instanceId>=0){let t=new s.Matrix4;this.instancedMesh.getMatrixAt(this.instanceId,t),e||t.scale(new s.Vector3(0,0,0)),this.instancedMesh.setMatrixAt(this.instanceId,t),this.instancedMesh.instanceMatrix.needsUpdate=!0}}disposeMesh(){this.mesh&&(this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh=null)}dispose(){this.disposeMesh(),this.geometry&&(this.geometry.dispose(),this.geometry=null),this.material&&(Array.isArray(this.material)?this.material.forEach(e=>e.dispose()):this.material.dispose(),this.material=null),this.animationMixer&&(this.animationMixer.stopAllAction(),this.animationMixer=null),this.animations=[],this.currentAnimation=null,this.instancedMesh=null}reset(){this.dispose(),this.castShadow=!0,this.receiveShadow=!0,this.frustumCulled=!0,this.visible=!0,this.renderOrder=0,this.needsUpdate=!0,this.isInstanced=!1,this.instanceId=-1,this.enabled=!0}clone(){return new a({castShadow:this.castShadow,receiveShadow:this.receiveShadow,frustumCulled:this.frustumCulled,visible:this.visible,renderOrder:this.renderOrder})}constructor(e={}){var t,i,s,o,a;super(),this.componentType="Renderer",this.mesh=null,this.geometry=null,this.material=null,this.animationMixer=null,this.animations=[],this.currentAnimation=null,this.isInstanced=!1,this.instancedMesh=null,this.instanceId=-1,this.castShadow=null===(t=e.castShadow)||void 0===t||t,this.receiveShadow=null===(i=e.receiveShadow)||void 0===i||i,this.frustumCulled=null===(s=e.frustumCulled)||void 0===s||s,this.visible=null===(o=e.visible)||void 0===o||o,this.renderOrder=null!==(a=e.renderOrder)&&void 0!==a?a:0,this.needsUpdate=!0}}a.componentType="Renderer"},3974:function(e,t,i){i.d(t,{W:function(){return o}});var s=i(3980);class o extends s.w{absorbDamage(e){if(this.currentShield<=0)return e;let t=Math.min(e,this.currentShield);return this.currentShield-=t,this.lastDamageTime=Date.now(),this.isRegenerating=!1,e-t}update(e){if(this.currentShield>=this.maxShield){this.isRegenerating=!1;return}if((Date.now()-this.lastDamageTime)/1e3>=this.regenDelay){this.isRegenerating||(this.isRegenerating=!0);let t=this.regenRate*e;this.currentShield=Math.min(this.maxShield,this.currentShield+t)}}getShieldPercentage(){return this.maxShield>0?this.currentShield/this.maxShield:0}isFullShield(){return this.currentShield>=this.maxShield}isShieldDepleted(){return this.currentShield<=0}restoreShield(){this.currentShield=this.maxShield,this.isRegenerating=!1}setShield(e,t){this.currentShield=Math.max(0,Math.min(t,e)),this.maxShield=t}reset(){this.currentShield=this.maxShield,this.lastDamageTime=0,this.isRegenerating=!1,this.enabled=!0}constructor(e=200,t=20,i=5){super(),this.componentType="Shield",this.maxShield=e,this.currentShield=e,this.regenRate=t,this.regenDelay=i,this.lastDamageTime=0,this.isRegenerating=!1}}o.componentType="Shield"},2115:function(e,t,i){i.d(t,{N:function(){return o}});var s=i(3980);class o extends s.w{canAttack(e){return!!this.isActive&&!this.isDead&&!!this.currentTarget&&e-this.lastAttackTime>=this.attackCooldown}performAttack(e){this.lastAttackTime=e}canSearchForTargets(e){return e-this.lastTargetSearchTime>=this.targetSearchCooldown}updateTargetSearch(e){this.lastTargetSearchTime=e}setTarget(e){this.currentTarget=e}clearTarget(){this.currentTarget=null}die(e){this.isDead=!0,this.isActive=!1,this.deathTime=e,this.clearTarget()}getDisplayName(){return"Tower ".concat(this.towerIndex+1," (Owner: ").concat(this.ownerId,")")}reset(){this.ownerId="",this.towerIndex=0,this.attackRange=8,this.attackDamage=10,this.attackCooldown=1.5,this.lastAttackTime=0,this.projectileSpeed=20,this.currentTarget=null,this.targetSearchRange=9,this.lastTargetSearchTime=0,this.targetSearchCooldown=.5,this.isActive=!0,this.isDead=!1,this.deathTime=0,this.enabled=!0}clone(){let e=new o(this.ownerId,this.towerIndex);return e.attackRange=this.attackRange,e.attackDamage=this.attackDamage,e.attackCooldown=this.attackCooldown,e.lastAttackTime=this.lastAttackTime,e.projectileSpeed=this.projectileSpeed,e.currentTarget=this.currentTarget,e.targetSearchRange=this.targetSearchRange,e.lastTargetSearchTime=this.lastTargetSearchTime,e.targetSearchCooldown=this.targetSearchCooldown,e.isActive=this.isActive,e.isDead=this.isDead,e.deathTime=this.deathTime,e}constructor(e="",t=0){super(),this.componentType="Tower",this.ownerId=e,this.towerIndex=t,this.attackRange=10,this.attackDamage=10,this.attackCooldown=1.5,this.lastAttackTime=0,this.projectileSpeed=20,this.currentTarget=null,this.targetSearchRange=this.attackRange+1,this.lastTargetSearchTime=0,this.targetSearchCooldown=.5,this.isActive=!0,this.isDead=!1,this.deathTime=0}}o.componentType="Tower"},73:function(e,t,i){i.d(t,{w:function(){return a}});var s=i(1448),o=i(3980);class a extends o.w{setPosition(e,t,i){this.position.set(e,t,i),this.markMatrixDirty()}setRotation(e,t,i){this.rotation.set(e,t,i),this.updateQuaternion(),this.markMatrixDirty()}setScale(e,t,i){this.scale.set(e,t,i),this.markMatrixDirty()}translate(e,t,i){this.position.x+=e,this.position.y+=t,this.position.z+=i,this.markMatrixDirty()}rotate(e,t,i){this.rotation.x+=e,this.rotation.y+=t,this.rotation.z+=i,this.updateQuaternion(),this.markMatrixDirty()}lookAt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector3(0,1,0),i=new s.Matrix4;i.lookAt(this.position,e,t),this.quaternion.setFromRotationMatrix(i),this.rotation.setFromQuaternion(this.quaternion),this.markMatrixDirty()}getForward(){let e=new s.Vector3(0,0,-1);return e.applyQuaternion(this.quaternion),e}getRight(){let e=new s.Vector3(1,0,0);return e.applyQuaternion(this.quaternion),e}getUp(){let e=new s.Vector3(0,1,0);return e.applyQuaternion(this.quaternion),e}getWorldPosition(){this.updateWorldMatrix();let e=new s.Vector3;return e.setFromMatrixPosition(this.worldMatrix),e}getWorldRotation(){this.updateWorldMatrix();let e=new s.Quaternion;return e.setFromRotationMatrix(this.worldMatrix),e}getWorldScale(){this.updateWorldMatrix();let e=new s.Vector3;return e.setFromMatrixScale(this.worldMatrix),e}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixNeedsUpdate=!1}updateWorldMatrix(){this.matrixNeedsUpdate&&this.updateMatrix(),this.parent?(this.parent.updateWorldMatrix(),this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix)):this.worldMatrix.copy(this.matrix)}addChild(e){e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e)}removeChild(e){let t=this.children.indexOf(e);-1!==t&&(this.children.splice(t,1),e.parent=null)}removeFromParent(){this.parent&&this.parent.removeChild(this)}updateQuaternion(){this.quaternion.setFromEuler(this.rotation)}markMatrixDirty(){for(let e of(this.matrixNeedsUpdate=!0,this.children))e.markMatrixDirty()}reset(){for(this.position?this.position.set(0,0,0):this.position=new s.Vector3(0,0,0),this.rotation?this.rotation.set(0,0,0):this.rotation=new s.Euler(0,0,0),this.scale?this.scale.set(1,1,1):this.scale=new s.Vector3(1,1,1),this.quaternion?this.quaternion.set(0,0,0,1):this.quaternion=new s.Quaternion,this.matrix?this.matrix.identity():this.matrix=new s.Matrix4,this.worldMatrix?this.worldMatrix.identity():this.worldMatrix=new s.Matrix4,this.matrixNeedsUpdate=!0,this.removeFromParent();this.children.length>0;)this.removeChild(this.children[0]);this.enabled=!0}clone(){let e=new a(this.position,this.rotation,this.scale);return e.quaternion.copy(this.quaternion),e}constructor(e=new s.Vector3(0,0,0),t=new s.Euler(0,0,0),i=new s.Vector3(1,1,1)){super(),this.componentType="Transform",this.matrixNeedsUpdate=!0,this.parent=null,this.children=[],this.position=e.clone(),this.rotation=t.clone(),this.scale=i.clone(),this.quaternion=new s.Quaternion,this.matrix=new s.Matrix4,this.worldMatrix=new s.Matrix4,this.updateQuaternion()}}a.componentType="Transform"},2082:function(e,t,i){i.d(t,{D:function(){return r}});var s=i(1448),o=i(9131),a=i(73),n=i(6366);class r extends o.xP{setTarget(e){this.target=e}setConfig(e){this.config={...this.config,...e},this.spherical.radius=this.config.distance}update(e,t){if(!this.target)return;let i=this.target.getComponent(a.w);i&&(this.handleMouseInput(),this.targetLookAt.copy(i.position),this.targetLookAt.y+=this.config.height,this.targetPosition.setFromSpherical(this.spherical),this.targetPosition.add(this.targetLookAt),this.currentPosition.lerp(this.targetPosition,this.config.smoothing),this.currentLookAt.lerp(this.targetLookAt,this.config.smoothing),this.camera.position.copy(this.currentPosition),this.camera.lookAt(this.currentLookAt))}handleMouseInput(){let e=this.inputManager.getMouseDelta();(0!==e.x||0!==e.y)&&this.isRightMouseDown&&(this.spherical.theta-=e.x*this.config.mouseSensitivity,this.spherical.phi-=e.y*this.config.mouseSensitivity,this.spherical.phi=n.M.clamp(this.spherical.phi,this.config.minPolarAngle,this.config.maxPolarAngle),this.spherical.theta=n.M.normalizeAngle(this.spherical.theta))}setupEventListeners(){this.inputManager.on("mouseDown",e=>{let{button:t}=e;2===t&&(this.isRightMouseDown=!0)}),this.inputManager.on("mouseUp",e=>{let{button:t}=e;2===t&&(this.isRightMouseDown=!1)}),this.wheelListenerAdded||(this.inputManager.on("wheel",e=>{let{deltaY:t}=e;this.spherical.radius+=.01*t,this.spherical.radius=n.M.clamp(this.spherical.radius,2,this.config.maxDistance)}),this.wheelListenerAdded=!0)}setupInitialPosition(){this.currentPosition.setFromSpherical(this.spherical),this.currentLookAt.set(0,this.config.height,0),this.targetPosition.copy(this.currentPosition),this.targetLookAt.copy(this.currentLookAt),this.camera.position.copy(this.currentPosition),this.camera.lookAt(this.currentLookAt)}getCameraDirection(){let e=new s.Vector3;return this.camera.getWorldDirection(e),e}getCameraRight(){let e=this.getCameraDirection(),t=new s.Vector3;return t.crossVectors(e,new s.Vector3(0,1,0)),t.normalize(),t}getCameraForward(){let e=this.getCameraRight(),t=new s.Vector3;return t.crossVectors(new s.Vector3(0,1,0),e),t.normalize(),t}getDistance(){return this.spherical.radius}setDistance(e){this.spherical.radius=n.M.clamp(e,2,this.config.maxDistance)}getHorizontalAngle(){return this.spherical.theta}getVerticalAngle(){return this.spherical.phi}setAngles(e,t){this.spherical.theta=n.M.normalizeAngle(e),this.spherical.phi=n.M.clamp(t,this.config.minPolarAngle,this.config.maxPolarAngle)}resetCamera(){this.spherical.radius=this.config.distance,this.spherical.phi=Math.PI/3,this.spherical.theta=0,this.setupInitialPosition()}snapToTarget(){if(!this.target)return;let e=this.target.getComponent(a.w);if(e&&e.position){if(void 0===e.position.x||void 0===e.position.y||void 0===e.position.z){console.warn("CameraSystem: Target position is not properly initialized, skipping snapToTarget");return}this.targetLookAt.copy(e.position),this.targetLookAt.y+=this.config.height,this.targetPosition.setFromSpherical(this.spherical),this.targetPosition.add(this.targetLookAt),this.currentPosition.copy(this.targetPosition),this.currentLookAt.copy(this.targetLookAt),this.camera.position.copy(this.currentPosition),this.camera.lookAt(this.currentLookAt)}}getCamera(){return this.camera}constructor(e,t,i){super(),this.requiredComponents=[a.w],this.target=null,this.config={distance:10,height:5,mouseSensitivity:.005,smoothing:.1,minPolarAngle:Math.PI/3.5,maxPolarAngle:Math.PI/2.5,maxDistance:11.5},this.spherical=new s.Spherical(10,Math.PI/3,0),this.targetPosition=new s.Vector3,this.currentPosition=new s.Vector3,this.currentLookAt=new s.Vector3,this.targetLookAt=new s.Vector3,this.isRightMouseDown=!1,this.wheelListenerAdded=!1,this.camera=e,this.inputManager=t,this.priority=900,i&&(this.config={...this.config,...i}),this.spherical.radius=this.config.distance,this.spherical.phi=Math.PI/3,this.spherical.theta=0,this.setupEventListeners(),this.setupInitialPosition()}}},2158:function(e,t,i){i.d(t,{s:function(){return h}});var s=i(1448),o=i(9131),a=i(73),n=i(7771),r=i(3478),l=i(4183);class h extends o.FU{update(e,t){this.updateSpatialHash(e),this.detectCollisions(e),this.processCollisionCallbacks(),this.resolveCollisions()}fixedUpdate(e,t){this.resolveCollisions()}updateSpatialHash(e){for(let t of e){let e=t.getComponent(a.w),i=t.getComponent(r.YM);if(!e.enabled||!i.enabled){this.spatialHash.remove(t);continue}i.updateBounds(e.getWorldPosition()),this.spatialHash.update(t,i.bounds)}}detectCollisions(e){this.collisionPairs.length=0,this.collisionChecks=0,this.actualCollisions=0;let t=new Set;for(let i of e){let e=i.getComponent(a.w),s=i.getComponent(r.YM);if(e.enabled&&s.enabled)for(let o of this.spatialHash.query(s.bounds)){let n=o.entity;if(i.id===n.id)continue;let l=i.id<n.id?"".concat(i.id,"-").concat(n.id):"".concat(n.id,"-").concat(i.id);if(t.has(l))continue;t.add(l);let h=n.getComponent(a.w),c=n.getComponent(r.YM);if((null==h?void 0:h.enabled)&&(null==c?void 0:c.enabled)&&s.canCollideWith(c)&&(this.collisionChecks++,s.intersects(c,e.getWorldPosition(),h.getWorldPosition()))){this.actualCollisions++,(2===s.layer&&16===c.layer||16===s.layer&&2===c.layer)&&console.log("\uD83D\uDD0D Pillar collision detected between entities ".concat(i.id," and ").concat(n.id));let e={entityA:i,entityB:n,colliderA:s,colliderB:c};this.collisionPairs.push(e)}}}}processCollisionCallbacks(){let e=new Map;for(let t of this.collisionPairs){let i=t.entityA.id<t.entityB.id?"".concat(t.entityA.id,"-").concat(t.entityB.id):"".concat(t.entityB.id,"-").concat(t.entityA.id);e.set(i,t),this.activeCollisions.has(i)?this.triggerCollisionStay(t):this.triggerCollisionEnter(t)}this.activeCollisions.forEach((t,i)=>{e.has(i)||this.triggerCollisionExit(t)}),this.activeCollisions=e}triggerCollisionEnter(e){var t,i,s,o,a,n,r,l;e.colliderA.isTrigger||e.colliderB.isTrigger?(null===(t=(i=e.colliderA).onTriggerEnter)||void 0===t||t.call(i,e.colliderB,e.entityB),null===(s=(o=e.colliderB).onTriggerEnter)||void 0===s||s.call(o,e.colliderA,e.entityA)):(null===(a=(n=e.colliderA).onCollisionEnter)||void 0===a||a.call(n,e.colliderB,e.entityB),null===(r=(l=e.colliderB).onCollisionEnter)||void 0===r||r.call(l,e.colliderA,e.entityA))}triggerCollisionStay(e){var t,i,s,o,a,n,r,l;e.colliderA.isTrigger||e.colliderB.isTrigger?(null===(t=(i=e.colliderA).onTriggerStay)||void 0===t||t.call(i,e.colliderB,e.entityB),null===(s=(o=e.colliderB).onTriggerStay)||void 0===s||s.call(o,e.colliderA,e.entityA)):(null===(a=(n=e.colliderA).onCollisionStay)||void 0===a||a.call(n,e.colliderB,e.entityB),null===(r=(l=e.colliderB).onCollisionStay)||void 0===r||r.call(l,e.colliderA,e.entityA))}triggerCollisionExit(e){var t,i,s,o,a,n,r,l;e.colliderA.isTrigger||e.colliderB.isTrigger?(null===(t=(i=e.colliderA).onTriggerExit)||void 0===t||t.call(i,e.colliderB,e.entityB),null===(s=(o=e.colliderB).onTriggerExit)||void 0===s||s.call(o,e.colliderA,e.entityA)):(null===(a=(n=e.colliderA).onCollisionExit)||void 0===a||a.call(n,e.colliderB,e.entityB),null===(r=(l=e.colliderB).onCollisionExit)||void 0===r||r.call(l,e.colliderA,e.entityA))}resolveCollisions(){for(let e of this.collisionPairs)e.colliderA.isTrigger||e.colliderB.isTrigger||this.resolveCollision(e)}resolveCollision(e){let t=e.entityA.getComponent(a.w),i=e.entityB.getComponent(a.w),s=t.getWorldPosition(),o=i.getWorldPosition();if(!s||!s.clone||!o||!o.clone){console.warn("CollisionSystem: Invalid positions for collision resolution",{posA:s,posB:o});return}let l=s.clone().sub(o),h=l.length();0===h?l.set(0,1,0):l.normalize();let c=0,d=(c="sphere"===e.colliderA.type&&"sphere"===e.colliderB.type?e.colliderA.radius+e.colliderB.radius:"sphere"===e.colliderA.type&&"cylinder"===e.colliderB.type?e.colliderA.radius+e.colliderB.radius:"cylinder"===e.colliderA.type&&"sphere"===e.colliderB.type?e.colliderA.radius+e.colliderB.radius:this.getApproximateRadius(e.colliderA)+this.getApproximateRadius(e.colliderB))-h;if(d>0){(2===e.colliderA.layer&&16===e.colliderB.layer||16===e.colliderA.layer&&2===e.colliderB.layer)&&console.log("\uD83C\uDFDB️ Pillar collision detected! Distance: ".concat(h.toFixed(2),", Required: ").concat(c.toFixed(2),", Overlap: ").concat(d.toFixed(2)));let s=1;(e.colliderA.isStatic||e.colliderB.isStatic)&&(s=1.1);let o=l.multiplyScalar(d*s),a=e.entityA.getComponent(n.i),u=e.entityB.getComponent(n.i),g=.5,m=.5;if(e.colliderA.isStatic&&!e.colliderB.isStatic)g=0,m=1;else if(!e.colliderA.isStatic&&e.colliderB.isStatic)g=1,m=0;else if(!e.colliderA.isStatic&&!e.colliderB.isStatic){let t=e.colliderA.layer===r.aB.PLAYER,i=e.colliderB.layer===r.aB.PLAYER||e.colliderB.layer===r.aB.ENEMY;if(t&&i){let e=!!a&&a.canMove,t=!!u&&u.canMove;e&&t?(g=.5,m=.5):e&&!t?(g=1,m=0):!e&&t?(g=0,m=1):(g=0,m=0)}else a&&!u?(g=.8,m=.2):!a&&u&&(g=.2,m=.8)}if(g>0&&o&&o.clone){let i=o.clone().multiplyScalar(g);if(t.translate(i.x,i.y,i.z),a&&e.colliderB.isStatic&&a.velocity&&a.velocity.clone&&l&&l.clone){let e=a.velocity.clone().projectOnVector(l.clone().negate());e.length()>0&&a.velocity.sub(e)}}if(m>0){let t=o.clone().multiplyScalar(-m);if(i.translate(t.x,t.y,t.z),u&&e.colliderA.isStatic){let e=u.velocity.clone().projectOnVector(l);e.length()>0&&u.velocity.sub(e)}}}}getApproximateRadius(e){switch(e.type){case"sphere":return e.radius;case"box":return .5*Math.max(e.size.x,e.size.y,e.size.z);case"capsule":case"cylinder":return Math.max(e.radius,.5*e.height);default:return .5}}queryColliders(e){return this.spatialHash.query(e).map(e=>e.entity)}queryCollidersRadius(e,t){return this.spatialHash.queryRadius(e,t).map(e=>e.entity)}queryCollidersPoint(e){return this.spatialHash.queryPoint(e).map(e=>e.entity)}getCollidersInLayer(e,t){return(t?this.spatialHash.query(t):Array.from(this.spatialHash.entityCells.keys()).map(e=>this.spatialHash.query(new s.Box3().setFromCenterAndSize(new s.Vector3,new s.Vector3(1e3,1e3,1e3))).find(t=>t.entity.id===e)).filter(Boolean)).filter(t=>{let i=t.entity.getComponent(r.YM);return i&&i.layer===e}).map(e=>e.entity)}getPerformanceStats(){return{collisionChecks:this.collisionChecks,actualCollisions:this.actualCollisions,activeCollisions:this.activeCollisions.size,spatialHashStats:this.spatialHash.getStats()}}onEntityRemoved(e){this.spatialHash.remove(e);let t=[];for(let i of(this.activeCollisions.forEach((i,s)=>{(i.entityA.id===e.id||i.entityB.id===e.id)&&t.push(s)}),t))this.activeCollisions.delete(i)}onDisable(){this.spatialHash.clear(),this.activeCollisions.clear(),this.collisionPairs.length=0}constructor(e=5){super(),this.requiredComponents=[a.w,r.YM],this.collisionPairs=[],this.activeCollisions=new Map,this.lastUpdateTime=0,this.collisionChecks=0,this.actualCollisions=0,this.priority=15,this.spatialHash=new l.k(e)}}},244:function(e,t,i){i.d(t,{b:function(){return u}});var s=i(9131),o=i(6862),a=i(3974),n=i(8001),r=i(73),l=i(246),h=i(7771),c=i(5050),d=i(6121);class u extends s.xP{setEnemyDamageCallback(e){this.onEnemyDamageCallback=e}setPlayerDamageCallback(e){this.onPlayerDamageCallback=e}update(e,t){let i=Date.now()/1e3;this.updateHealthComponents(e,t,i),this.processDamageQueue(i),this.processHealQueue(i),this.handleDeathAndRespawn(e,i),this.damageNumberManager.cleanup(),this.damageQueue.length=0,this.healQueue.length=0,this.deadEntities.length=0}updateHealthComponents(e,t,i){for(let s of e){let e=s.getComponent(o.S);if(!e||!e.enabled)continue;e.update(t,i);let r=s.getComponent(a.W);r&&r.update(t);let l=s.getComponent(n.C);l&&l.updateFreezeStatus(i)}}processDamageQueue(e){for(let t of this.damageQueue)this.applyDamage(t,e)}processHealQueue(e){for(let t of this.healQueue)this.applyHealing(t,e)}applyDamage(e,t){let{target:i,damage:s,source:a,damageType:l}=e,h=i.getComponent(o.S);if(!h||!h.enabled)return;if("charge"===l){let e=i.getComponent(n.C),t=e?"Enemy(".concat(e.getDisplayName(),")"):"Player(".concat(i.id,")");console.log("⚔️ CombatSystem processing charge damage: ".concat(s," to ").concat(t,", source: ").concat(null==a?void 0:a.id,", hasPlayerCallback: ").concat(!!this.onPlayerDamageCallback))}let d=i.getComponent(n.C);if(d&&this.onEnemyDamageCallback){let e=(0,c.g3)(s),t=e.damage;console.log("\uD83C\uDF10 Routing ".concat(t," damage to enemy ").concat(i.id," through multiplayer server")),this.onEnemyDamageCallback(i.id.toString(),t);let o=i.getComponent(r.w);if(o){let i=o.getWorldPosition();i.y+=1.5,this.damageNumberManager.addDamageNumber(t,e.isCritical,i,l)}let n=a?"Entity ".concat(a.id):"Unknown",h=this.getEntityDisplayName(i),d=e.isCritical?" CRITICAL":"";console.log("\uD83D\uDCA5 ".concat(n," dealt ").concat(t).concat(d," ").concat(l||"damage"," to ").concat(h," (routed to server)"));return}if(!d&&this.onPlayerDamageCallback&&a&&a.id!==i.id){let e=(0,c.g3)(s),t=e.damage;console.log("⚔️ Routing ".concat(t," PVP damage to player ").concat(i.id," through multiplayer server")),this.onPlayerDamageCallback(i.id.toString(),t);let o=i.getComponent(r.w);if(o){let i=o.getWorldPosition();i&&void 0!==i.x&&void 0!==i.y&&void 0!==i.z?(i.y+=1.5,this.damageNumberManager.addDamageNumber(t,e.isCritical,i,l||"pvp")):console.warn("⚠️ Skipping PVP damage number creation - invalid position:",i)}let n=a?"Player ".concat(a.id):"Unknown",h="Player ".concat(i.id),d=e.isCritical?" CRITICAL":"";console.log("⚔️ ".concat(n," dealt ").concat(t).concat(d," PVP ").concat(l||"damage"," to ").concat(h," (routed to server)"));return}let u=(0,c.g3)(s),g=u.damage;if(h.takeDamage(g,t,i)){this.totalDamageDealt+=g;let e=i.getComponent(r.w);if(e){let t=e.getWorldPosition();t&&void 0!==t.x&&void 0!==t.y&&void 0!==t.z?(t.y+=3,this.damageNumberManager.addDamageNumber(g,u.isCritical,t,l)):console.warn("⚠️ Skipping damage number creation - invalid position:",t)}let s=a?"Entity ".concat(a.id):"Unknown",o=this.getEntityDisplayName(i),n=u.isCritical?" CRITICAL":"";console.log("\uD83D\uDCA5 ".concat(s," dealt ").concat(g).concat(n," ").concat(l||"damage"," to ").concat(o," (").concat(h.currentHealth,"/").concat(h.maxHealth," HP)")),h.isDead&&this.handleEntityDeath(i,a,t),this.triggerDamageEffects(i,g,a,l,u.isCritical)}}applyHealing(e,t){let{target:i,amount:s,source:a}=e,n=i.getComponent(o.S);if(n&&n.enabled&&n.heal(s)){this.totalHealingDone+=s;let e=a?"Entity ".concat(a.id):"Unknown",t=this.getEntityDisplayName(i);console.log("\uD83D\uDC9A ".concat(e," healed ").concat(t," for ").concat(s," HP (").concat(n.currentHealth,"/").concat(n.maxHealth," HP)")),this.triggerHealingEffects(i,s,a)}}handleEntityDeath(e,t,i){let s=e.getComponent(n.C);s&&(s.die(i||Date.now()/1e3),this.enemiesKilled++,console.log("\uD83D\uDC80 ".concat(s.getDisplayName()," has been defeated!")),t&&this.awardExperience(t,s.experienceReward),this.triggerDeathEffects(e,t)),this.deadEntities.push(e)}handleDeathAndRespawn(e,t){for(let i of e){let e=i.getComponent(o.S),s=i.getComponent(n.C);e&&s&&s.isDead&&s.canRespawnNow(t)&&this.respawnEnemy(i,s,e)}}respawnEnemy(e,t,i){t.respawn(),i.revive(),console.log("\uD83D\uDD04 ".concat(t.getDisplayName()," has respawned!")),this.triggerRespawnEffects(e)}triggerDamageEffects(e,t,i,s,o){let a=e.getComponent(r.w);if(a&&console.log("\uD83C\uDFAF Damage effect".concat(o?" (CRITICAL)":""," at position:"),a.position),"projectile"===s&&i){var n,c;let t=i.getComponent(l.T);if(null==t?void 0:null===(c=t.mesh)||void 0===c?void 0:null===(n=c.userData)||void 0===n?void 0:n.isBarrageArrow){console.log("\uD83C\uDFF9 Barrage arrow hit detected, applying slow effect to target ".concat(e.id));let t=e.getComponent(h.i);t&&(t.slow(5e3,.5),console.log("\uD83D\uDC0C Applied 50% slow for 5 seconds to target ".concat(e.id)))}}}triggerHealingEffects(e,t,i){let s=e.getComponent(r.w);s&&console.log("✨ Healing effect at position:",s.position)}triggerDeathEffects(e,t){let i=e.getComponent(r.w);i&&console.log("\uD83D\uDC80 Death effect at position:",i.position)}triggerRespawnEffects(e){let t=e.getComponent(r.w);t&&console.log("\uD83C\uDF1F Respawn effect at position:",t.position)}awardExperience(e,t){console.log("⭐ Entity ".concat(e.id," gained ").concat(t," experience!"))}getEntityDisplayName(e){let t=e.getComponent(n.C);return t?t.getDisplayName():"Entity ".concat(e.id)}queueDamage(e,t,i,s){this.damageQueue.push({target:e,damage:t,source:i,damageType:s,timestamp:Date.now()/1e3})}queueHealing(e,t,i){this.healQueue.push({target:e,amount:t,source:i,timestamp:Date.now()/1e3})}dealDamageImmediate(e,t,i,s){let a=e.getComponent(o.S);if(!a||!a.enabled)return!1;let n=(0,c.g3)(t),l=n.damage,h=Date.now()/1e3,d=a.takeDamage(l,h,e);if(d){this.totalDamageDealt+=l;let t=e.getComponent(r.w);if(t){let e=t.getWorldPosition();e.y+=1.5,this.damageNumberManager.addDamageNumber(l,n.isCritical,e,s)}a.isDead&&this.handleEntityDeath(e,i,h),this.triggerDamageEffects(e,l,i,s,n.isCritical)}return d}healImmediate(e,t,i){let s=e.getComponent(o.S);if(!s||!s.enabled)return!1;let a=s.heal(t);return a&&(this.totalHealingDone+=t,this.triggerHealingEffects(e,t,i)),a}isEntityDead(e){let t=e.getComponent(o.S);return!!t&&t.isDead}getEntityHealthRatio(e){let t=e.getComponent(o.S);return t?t.getHealthRatio():0}canEntityTakeDamage(e){let t=e.getComponent(o.S);return!!t&&!t.isDead&&!t.isInvulnerable}getCombatStats(){return{totalDamageDealt:this.totalDamageDealt,totalHealingDone:this.totalHealingDone,enemiesKilled:this.enemiesKilled,queuedDamageEvents:this.damageQueue.length,queuedHealEvents:this.healQueue.length}}resetStats(){this.totalDamageDealt=0,this.totalHealingDone=0,this.enemiesKilled=0}getDamageNumbers(){return this.damageNumberManager.getDamageNumbers()}removeDamageNumber(e){this.damageNumberManager.removeDamageNumber(e)}onDisable(){this.damageQueue.length=0,this.healQueue.length=0,this.deadEntities.length=0,this.damageNumberManager.clear(),this.resetStats()}constructor(e){super(),this.requiredComponents=[o.S],this.damageQueue=[],this.healQueue=[],this.deadEntities=[],this.totalDamageDealt=0,this.totalHealingDone=0,this.enemiesKilled=0,this.world=e,this.damageNumberManager=new d.w,this.priority=25}}},7223:function(e,t,i){i.d(t,{s:function(){return D}});var s=i(1448),o=i(9131),a=i(73),n=i(7771),r=i(6862),l=i(8001),h=i(246),c=i(3478),d=i(244),u=i(7125),g=i(8815),m=i(6098),p=i(7019),y=i(319);class D extends o.xP{setPlayer(e){this.playerEntity=e}update(e,t){if(!this.playerEntity)return;let i=this.playerEntity.getComponent(a.w),s=this.playerEntity.getComponent(n.i);i&&s&&("function"==typeof s.updateDebuffs?s.updateDebuffs():console.warn("⚠️ Player Movement component missing updateDebuffs method:",s),this.handleWeaponSwitching(),this.handleDashMovement(s,i),this.handleChargeMovement(s,i),s.isDashing||s.isCharging||s.isFrozen||this.handleMovementInput(s),this.handleCombatInput(i),this.updateDeflectBarrier(i))}handleMovementInput(e){if(!this.playerEntity)return;let t=this.playerEntity.getComponent(a.w);if(!t)return;this.checkForDashInput(e,t);let i=new s.Vector3(0,0,0),o=!1;if(this.inputManager.isKeyPressed("w")&&(i.z-=1,o=!0),this.inputManager.isKeyPressed("s")&&(i.z+=1,o=!0),this.inputManager.isKeyPressed("a")&&(i.x-=1,o=!0),this.inputManager.isKeyPressed("d")&&(i.x+=1,o=!0),i.length()>0&&i.normalize(),o){let t=new s.Vector3;this.camera.getWorldDirection(t);let o=new s.Vector3;o.crossVectors(t,new s.Vector3(0,1,0)).normalize();let a=new s.Vector3;a.crossVectors(new s.Vector3(0,1,0),o).normalize();let n=new s.Vector3;n.addScaledVector(o,i.x),n.addScaledVector(a,-i.z),n.normalize(),e.setMoveDirection(n,1)}else e.setMoveDirection(new s.Vector3(0,0,0),0);this.inputManager.isKeyPressed(" ")&&e.jump()}handleWeaponSwitching(){let e=Date.now()/1e3;!(e-this.lastWeaponSwitchTime<this.weaponSwitchCooldown)&&(this.inputManager.isKeyPressed("1")?this.currentWeapon!==u.v.SWORD&&(this.currentWeapon=u.v.SWORD,this.currentSubclass=u.p.DIVINITY,this.fireRate=this.swordFireRate,this.lastWeaponSwitchTime=e,this.swordComboStep=1,console.log("\uD83D\uDDE1️ Switched to Sword")):this.inputManager.isKeyPressed("2")?this.currentWeapon!==u.v.BOW&&(this.currentWeapon=u.v.BOW,this.currentSubclass=u.p.ELEMENTAL,this.fireRate=.225,this.lastWeaponSwitchTime=e,console.log("\uD83C\uDFF9 Switched to Bow")):this.inputManager.isKeyPressed("3")?this.currentWeapon!==u.v.SCYTHE&&(this.currentWeapon=u.v.SCYTHE,this.currentSubclass=u.p.CHAOS,this.fireRate=this.scytheFireRate,this.lastWeaponSwitchTime=e,console.log("⚡ Switched to Scythe")):this.inputManager.isKeyPressed("4")&&this.currentWeapon!==u.v.SABRES&&(this.currentWeapon=u.v.SABRES,this.currentSubclass=u.p.FROST,this.fireRate=this.sabresFireRate,this.lastWeaponSwitchTime=e,console.log("⚔️ Switched to Sabres")))}handleCombatInput(e){this.currentWeapon===u.v.BOW?this.handleBowInput(e):this.currentWeapon===u.v.SCYTHE?this.handleScytheInput(e):this.currentWeapon===u.v.SWORD?this.handleSwordInput(e):this.currentWeapon===u.v.SABRES&&this.handleSabresInput(e)}handleBowInput(e){if(!this.inputManager.isKeyPressed("r")||this.isViperStingCharging||this.isCharging||this.performViperSting(e),!this.inputManager.isKeyPressed("q")||(console.log("\uD83C\uDFF9 Q key pressed for Barrage!",{isBarrageCharging:this.isBarrageCharging,isCharging:this.isCharging,isViperStingCharging:this.isViperStingCharging}),this.isBarrageCharging||this.isCharging||this.isViperStingCharging||this.performBarrage(e)),!this.inputManager.isKeyPressed("e")||(console.log("\uD83D\uDC0D E key pressed for Cobra Shot!",{isCharging:this.isCharging,isViperStingCharging:this.isViperStingCharging,isBarrageCharging:this.isBarrageCharging,isCobraShotCharging:this.isCobraShotCharging,currentWeapon:this.currentWeapon}),this.isCharging||this.isViperStingCharging||this.isBarrageCharging||this.isCobraShotCharging||this.performCobraShot(e)),this.inputManager.isMouseButtonPressed(0))this.isCharging||this.isViperStingCharging||this.isBarrageCharging||this.isCobraShotCharging||(this.isCharging=!0,this.chargeProgress=0,console.log("\uD83C\uDFF9 Started charging bow")),this.isViperStingCharging||this.isBarrageCharging||this.isCobraShotCharging||(this.chargeProgress=Math.min(this.chargeProgress+.0125,1));else if(this.isCharging){if(this.isViperStingCharging||this.isBarrageCharging||this.isCobraShotCharging){console.log("\uD83C\uDFF9 Cancelling regular bow shot due to ability charging"),this.isCharging=!1,this.chargeProgress=0;return}let t=this.chargeProgress;this.fireProjectile(e),this.isCharging=!1,this.chargeProgress=0,this.triggerBowReleaseEffects(t)}}handleScytheInput(e){this.inputManager.isMouseButtonPressed(0)?(this.isCharging||(this.isCharging=!0,this.chargeProgress=0,console.log("⚡ Started charging scythe (spinning)")),this.chargeProgress+=.03,this.fireEntropicBoltProjectile(e)):this.isCharging&&(console.log("⚡ Stopped charging scythe (spinning)"),this.isCharging=!1,this.chargeProgress=0),this.inputManager.isKeyPressed("r")&&!this.isCharging&&this.fireCrossentropyBoltAbility(e),this.inputManager.isKeyPressed("q")&&!this.isCharging&&this.performReanimateAbility(e),this.inputManager.isKeyPressed("e")&&!this.isCharging&&this.performFrostNovaAbility(e)}fireProjectile(e){let t=Date.now()/1e3;if(t-this.lastFireTime<this.fireRate)return;this.lastFireTime=t;let i=new s.Vector3;this.camera.getWorldDirection(i),i.normalize();let o=new s.Vector3;o.crossVectors(i,new s.Vector3(0,1,0)).normalize();let a=new s.Matrix4;a.makeRotationAxis(o,Math.PI/6),i.applyMatrix4(a),i.normalize();let n=this.chargeProgress>=.7&&this.chargeProgress<=.98;if(this.chargeProgress>=1)console.log("\uD83C\uDFF9 Firing CHARGED ARROW with full charge: ".concat(this.chargeProgress)),this.createChargedArrowProjectile(e.position.clone(),i);else if(n)console.log("✨ Firing PERFECT SHOT with charge: ".concat(this.chargeProgress)),this.createPerfectShotProjectile(e.position.clone(),i);else{let t=Math.atan2(i.x,i.z);console.log("\uD83E\uDDED Firing ".concat(this.currentWeapon," at angle: ").concat((180*t/Math.PI).toFixed(1),"\xb0")),this.createProjectile(e.position.clone(),i)}}fireEntropicBoltProjectile(e){let t=Date.now()/1e3;if(t-this.lastFireTime<this.scytheFireRate)return;this.lastFireTime=t;let i=new s.Vector3;this.camera.getWorldDirection(i),i.normalize();let o=new s.Vector3;o.crossVectors(i,new s.Vector3(0,1,0)).normalize();let a=new s.Matrix4;a.makeRotationAxis(o,Math.PI/6),i.applyMatrix4(a),i.normalize();let n=this.isCharging?" (SPINNING)":"";console.log("⚡ Firing EntropicBolt".concat(n," - charge: ").concat(this.chargeProgress.toFixed(2)," - rate: ").concat(this.scytheFireRate,"s")),this.createEntropicBoltProjectile(e.position.clone(),i)}fireCrossentropyBoltAbility(e){let t=Date.now()/1e3;if(t-this.lastCrossentropyTime<this.crossentropyFireRate)return;this.lastCrossentropyTime=t;let i=new s.Vector3;this.camera.getWorldDirection(i),i.normalize();let o=new s.Vector3;o.crossVectors(i,new s.Vector3(0,1,0)).normalize();let a=new s.Matrix4;a.makeRotationAxis(o,Math.PI/6),i.applyMatrix4(a),i.normalize(),console.log("⚔️ Firing CrossentropyBolt ability (R key) - rate: ".concat(this.crossentropyFireRate,"s")),this.createCrossentropyBoltProjectile(e.position.clone(),i)}createProjectile(e,t){if(!this.playerEntity)return;let i=this.world.queryEntities([a.w,r.S,c.YM]).filter(e=>{var t;return e.id!==this.playerEntity.id&&!(null===(t=e.getComponent(r.S))||void 0===t?void 0:t.isDead)}).length>0,s=void 0!==this.onProjectileCreatedCallback;if(!i&&!s){console.log("\uD83C\uDFF9 No valid targets found, skipping projectile creation");return}let o=e.clone();o.add(t.clone().multiplyScalar(1)),o.y+=.5;let n={speed:25,damage:10,lifetime:3,maxDistance:25,subclass:this.currentSubclass,level:this.currentLevel,opacity:1};this.projectileSystem.createProjectile(this.world,o,t,this.playerEntity.id,n),this.onProjectileCreatedCallback&&this.onProjectileCreatedCallback("regular_arrow",o,t,n)}createEntropicBoltProjectile(e,t){if(!this.playerEntity)return;let i=this.world.queryEntities([a.w,r.S,c.YM]).filter(e=>{var t;return e.id!==this.playerEntity.id&&!(null===(t=e.getComponent(r.S))||void 0===t?void 0:t.isDead)}).length>0,s=void 0!==this.onProjectileCreatedCallback;if(!i&&!s){console.log("⚡ No valid targets found, skipping EntropicBolt creation");return}let o=window.gameUI;if(o&&!o.canCastEntropicBolt()){console.log("⚡ Not enough mana to cast Entropic Bolt (requires 15 mana)");return}o&&(o.consumeMana(10),console.log("⚡ Consumed 15 mana for Entropic Bolt"));let n=e.clone();n.add(t.clone().multiplyScalar(1)),n.y+=.75;let l={speed:20,damage:20,lifetime:5,piercing:!1,explosive:!1,explosionRadius:0,subclass:this.currentSubclass,level:this.currentLevel,opacity:1};this.projectileSystem.createEntropicBoltProjectile(this.world,n,t,this.playerEntity.id,l),this.onProjectileCreatedCallback&&this.onProjectileCreatedCallback("entropic_bolt",n,t,l)}createCrossentropyBoltProjectile(e,t){if(!this.playerEntity)return;let i=window.gameUI;if(i&&!i.canCastCrossentropyBolt()){console.log("⚔️ Not enough mana to cast Crossentropy Bolt (requires 40 mana)");return}i&&(i.consumeMana(40),console.log("⚔️ Consumed 40 mana for Crossentropy Bolt"));let s=e.clone();s.add(t.clone().multiplyScalar(1)),s.y+=.75;let o={speed:15,damage:90,lifetime:5,piercing:!1,explosive:!1,explosionRadius:0,subclass:this.currentSubclass,level:this.currentLevel,opacity:1};this.projectileSystem.createCrossentropyBoltProjectile(this.world,s,t,this.playerEntity.id,o),this.onProjectileCreatedCallback&&this.onProjectileCreatedCallback("crossentropy_bolt",s,t,o)}performReanimateAbility(e){if(!this.playerEntity)return;let t=Date.now()/1e3;if(t-this.lastReanimateTime<1){console.log("\uD83E\uDE78 Reanimate on cooldown - please wait");return}this.lastReanimateTime=t;let i=window.gameUI;if(i&&i.getCurrentMana(),i&&!i.canCastReanimate())return;if(i){let e=i.getCurrentMana();i.consumeMana(20);let t=i.getCurrentMana();console.log("\uD83E\uDE78 Reanimate mana consumption - Before: ".concat(e,", After: ").concat(t,", Consumed: ").concat(e-t))}console.log("\uD83C\uDF3F Reanimate ability activated - triggering visual effects"),this.triggerReanimateEffect(e);let s=this.playerEntity.getComponent(r.S);s&&(s.heal(30)?console.log("\uD83E\uDE78 Reanimate healed player for 20 HP. Current health: ".concat(s.currentHealth,"/").concat(s.maxHealth)):console.log("\uD83E\uDE78 Reanimate cast successfully but player already at full health"))}triggerReanimateEffect(e){console.log("\uD83C\uDF3F Triggering Reanimate healing effect"),this.onReanimateCallback&&this.onReanimateCallback();let t=e.position;console.log("\uD83C\uDF3F Healing effect at position: ".concat(t.x.toFixed(2),", ").concat(t.y.toFixed(2),", ").concat(t.z.toFixed(2)))}performFrostNovaAbility(e){if(!this.playerEntity)return;let t=Date.now()/1e3;if(t-this.lastFrostNovaTime<this.frostNovaFireRate){console.log("❄️ Frost Nova on cooldown for ".concat((this.frostNovaFireRate-(t-this.lastFrostNovaTime)).toFixed(1),"s"));return}let i=window.gameUI;if(i&&!i.canCastFrostNova()){console.log("❄️ Not enough mana to cast Frost Nova (requires 25 mana)");return}i&&(i.consumeMana(50),console.log("❄️ Consumed 25 mana for Frost Nova")),this.lastFrostNovaTime=t,console.log("❄️ Frost Nova ability activated!");let o=e.getWorldPosition(),a=new s.Vector3;this.camera.getWorldDirection(a),a.normalize(),this.onFrostNovaCallback&&this.onFrostNovaCallback(o,a),this.freezeEnemiesInRadius(o,6,t),(0,m.triggerGlobalFrostNova)(o)}performCobraShot(e){if(!this.playerEntity)return;let t=Date.now()/1e3;if(t-this.lastCobraShotTime<this.cobraShotFireRate){console.log("\uD83D\uDC0D Cobra Shot on cooldown for ".concat((this.cobraShotFireRate-(t-this.lastCobraShotTime)).toFixed(1),"s"));return}let i=window.gameUI;if(i&&!i.canCastCobraShot()){console.log("\uD83D\uDC0D Not enough energy to cast Cobra Shot (requires 40 energy)");return}i&&(i.consumeEnergy(40),console.log("\uD83D\uDC0D Consumed 40 energy for Cobra Shot")),console.log("\uD83D\uDC0D Cobra Shot activated - starting charge!"),this.isCobraShotCharging=!0,this.cobraShotChargeProgress=0,this.lastCobraShotTime=t;let s=Date.now(),o=setInterval(()=>{let t=Date.now()-s;this.cobraShotChargeProgress=Math.min(t/750,1),this.cobraShotChargeProgress>=1&&(clearInterval(o),this.fireCobraShot(e),this.isCobraShotCharging=!1,this.cobraShotChargeProgress=0)},16)}fireCobraShot(e){console.log("\uD83D\uDC0D Firing Cobra Shot projectile!");let t=e.getWorldPosition();t.y+=1;let i=new s.Vector3;this.camera.getWorldDirection(i),i.normalize();let o=new s.Vector3;o.crossVectors(i,new s.Vector3(0,1,0)).normalize();let a=new s.Matrix4;a.makeRotationAxis(o,Math.PI/6),i.applyMatrix4(a),i.normalize();let n=t.clone();n.add(i.clone().multiplyScalar(1)),this.onCobraShotCallback&&this.onCobraShotCallback(n,i),(0,p.triggerGlobalCobraShot)(n,i),this.onProjectileCreatedCallback&&this.onProjectileCreatedCallback("cobra_shot_projectile",n,i,{speed:16,damage:29,lifetime:8,venomDuration:6})}freezeEnemiesInRadius(e,t,i){let s=this.world.getAllEntities(),o=0,n=0;s.forEach(s=>{var h;let c=s.getComponent(a.w),u=s.getComponent(r.S);if(!c||!u||u.isDead||s.id===(null===(h=this.playerEntity)||void 0===h?void 0:h.id))return;let g=c.position,p=e.distanceTo(g);if(p<=t){let e=s.getComponent(l.C);if(e)e.freeze(6,i),o++,console.log("❄️ Frozen enemy at distance ".concat(p.toFixed(2)," units")),(0,m.addGlobalFrozenEnemy)(s.id.toString(),g);else{let e=this.world.getSystem(d.b);e&&this.playerEntity&&(e.queueDamage(s,50,this.playerEntity,"frost_nova"),n++,console.log("❄️ Frost Nova hit player ".concat(s.id," for ").concat(50," damage at distance ").concat(p.toFixed(2)," units")),this.onDebuffCallback?(console.log("❄️ Broadcasting freeze effect to PVP player ".concat(s.id)),console.log("\uD83D\uDD0D Debug: Calling debuff callback with entityId=".concat(s.id,", type=frozen, duration=3000")),this.onDebuffCallback(s.id,"frozen",6e3,g),console.log("✅ Debug: Debuff callback completed")):console.warn("⚠️ Debug: onDebuffCallback is not set!"))}}}),o>0&&console.log("❄️ Frost Nova froze ".concat(o," enemies within ").concat(t," unit radius")),n>0&&console.log("❄️ Frost Nova damaged ".concat(n," players within ").concat(t," unit radius"))}createChargedArrowProjectile(e,t){if(!this.playerEntity)return;let i=e.clone();i.add(t.clone().multiplyScalar(1)),i.y+=.5;let s={speed:35,damage:50,lifetime:2,piercing:!0,explosive:!1,subclass:this.currentSubclass,level:this.currentLevel,opacity:1};this.projectileSystem.createChargedArrowProjectile(this.world,i,t,this.playerEntity.id,s),this.onProjectileCreatedCallback&&this.onProjectileCreatedCallback("charged_arrow",i,t,s)}createPerfectShotProjectile(e,t){if(!this.playerEntity)return;let i=e.clone();i.add(t.clone().multiplyScalar(1)),i.y+=.5,this.projectileSystem.createChargedArrowProjectile(this.world,i,t,this.playerEntity.id,{speed:40,damage:75,lifetime:6,piercing:!0,explosive:!1,subclass:this.currentSubclass,level:this.currentLevel,opacity:1}),this.onProjectileCreatedCallback&&this.onProjectileCreatedCallback("perfect_shot",i,t,{speed:40,damage:75,lifetime:6,piercing:!0,subclass:this.currentSubclass,level:this.currentLevel,opacity:1}),console.log("✨ Perfect shot projectile created with enhanced stats!")}setWeaponSubclass(e){this.currentSubclass=e,console.log("\uD83C\uDFF9 Weapon subclass changed to: ".concat(e))}setBowReleaseCallback(e){this.onBowReleaseCallback=e}setDivineStormCallback(e){this.onDivineStormCallback=e}setProjectileCreatedCallback(e){this.onProjectileCreatedCallback=e}setViperStingCallback(e){this.onViperStingCallback=e}setBarrageCallback(e){this.onBarrageCallback=e}setReanimateCallback(e){this.onReanimateCallback=e}setFrostNovaCallback(e){this.onFrostNovaCallback=e}setCobraShotCallback(e){this.onCobraShotCallback=e}setChargeCallback(e){this.onChargeCallback=e}setDeflectCallback(e){this.onDeflectCallback=e}setDebuffCallback(e){this.onDebuffCallback=e}triggerBowReleaseEffects(e){this.onBowReleaseCallback&&this.onBowReleaseCallback(e,e>=.75&&e<=.98)}setWeaponLevel(e){this.currentLevel=e,console.log("⬆️ Weapon level changed to: ".concat(e))}getCurrentWeaponConfig(){return{weapon:this.currentWeapon,subclass:this.currentSubclass,level:this.currentLevel}}getCurrentWeapon(){return this.currentWeapon}getCurrentSubclass(){return this.currentSubclass}isWeaponCharging(){return this.isCharging}getChargeProgress(){return this.chargeProgress}isViperStingChargingActive(){return this.isViperStingCharging}getViperStingChargeProgress(){return this.viperStingChargeProgress}isBarrageChargingActive(){return this.isBarrageCharging}getBarrageChargeProgress(){return this.barrageChargeProgress}isCobraShotChargingActive(){return this.isCobraShotCharging}getCobraShotChargeProgress(){return this.cobraShotChargeProgress}isWeaponSwinging(){return this.isSwinging}getSwordComboStep(){return this.swordComboStep}isDivineStormActive(){return this.isDivineStorming}isChargeActive(){return this.isSwordCharging}isDeflectActive(){return this.isDeflecting}handleSwordInput(e){!this.inputManager.isMouseButtonPressed(0)||this.isSwinging||this.isDivineStorming||this.isSwordCharging||this.isDeflecting||this.performSwordMeleeAttack(e),!this.inputManager.isKeyPressed("r")||this.isDivineStorming||this.isSwinging||this.isSwordCharging||this.isDeflecting||this.performDivineStorm(e),!this.inputManager.isKeyPressed("e")||this.isSwordCharging||this.isDivineStorming||this.isSwinging||this.isDeflecting||this.performCharge(e),!this.inputManager.isKeyPressed("q")||this.isDeflecting||this.isDivineStorming||this.isSwinging||this.isSwordCharging||this.performDeflect(e),Date.now()/1e3-this.lastSwordAttackTime>this.swordComboResetTime&&(this.swordComboStep=1)}performSwordMeleeAttack(e){let t=Date.now()/1e3;t-this.lastFireTime<this.swordFireRate||(this.lastFireTime=t,this.lastSwordAttackTime=t,console.log("\uD83D\uDDE1️ Sword melee attack - Combo step ".concat(this.swordComboStep)),this.isSwinging=!0,this.performMeleeDamage(e))}onSwordSwingComplete(){this.isSwinging&&(console.log("\uD83D\uDDE1️ Sword swing completed - was combo step ".concat(this.swordComboStep)),this.isSwinging=!1,this.swordComboStep=this.swordComboStep%3+1,console.log("\uD83D\uDDE1️ Next combo step will be: ".concat(this.swordComboStep)))}handleSabresInput(e){this.inputManager.isMouseButtonPressed(0)&&!this.isSwinging&&this.performSabresMeleeAttack(e)}performSabresMeleeAttack(e){let t=Date.now()/1e3;t-this.lastFireTime<this.sabresFireRate||(this.lastFireTime=t,console.log("⚔️ Sabres dual attack initiated"),this.isSwinging=!0,this.performSabresMeleeDamage(e))}onSabresSwingComplete(){this.isSwinging&&(console.log("⚔️ Sabres dual swing completed"),this.isSwinging=!1)}performSabresMeleeDamage(e){Date.now();let t=this.world.getAllEntities().filter(e=>e.hasComponent(r.S)&&e.hasComponent(a.w)&&e!==this.playerEntity),i=Math.PI/2,o=new s.Vector3;this.camera.getWorldDirection(o),o.normalize();let n=0;for(let s of t){let t=s.getComponent(a.w),l=s.getComponent(r.S);if(!t||!l||l.isDead)continue;let h=t.position.clone().sub(e.position),c=h.length();if(c>3.8||(h.normalize(),Math.acos(Math.max(-1,Math.min(1,o.dot(h))))>i/2))continue;let u=this.world.getSystem(d.b);u&&(u.queueDamage(s,19,this.playerEntity||void 0),setTimeout(()=>{l.isDead||u.queueDamage(s,23,this.playerEntity||void 0)},100),n++,console.log("⚔️ Sabres hit target at distance ".concat(c.toFixed(2)," for ").concat(42," total damage")))}0===n?console.log("⚔️ Sabres attack missed - no targets in range"):console.log("⚔️ Sabres attack hit ".concat(n," target(s)"))}performMeleeDamage(e){let t=this.world.getAllEntities(),i=e.position,o=new s.Vector3;this.camera.getWorldDirection(o),o.normalize();let n=Math.PI/2,l=25;switch(this.swordComboStep){case 1:l=25;break;case 2:l=30;break;case 3:l=40}let h=this.world.getSystem(d.b),c=0;if(t.forEach(e=>{var t;let s=e.getComponent(a.w),d=e.getComponent(r.S);if(!s||!d||e.id===(null===(t=this.playerEntity)||void 0===t?void 0:t.id))return;let u=s.position,g=u.clone().sub(i),m=g.length();if(console.log("\uD83C\uDFAF PVP Sword check - Entity ".concat(e.id,": Player pos (").concat(i.x.toFixed(2),", ").concat(i.y.toFixed(2),", ").concat(i.z.toFixed(2),"), Enemy pos (").concat(u.x.toFixed(2),", ").concat(u.y.toFixed(2),", ").concat(u.z.toFixed(2),"), Distance: ").concat(m.toFixed(2),", Range: ").concat(4.6)),m<=4.6){g.normalize();let t=o.angleTo(g),i=180*t/Math.PI,s=n/2*180/Math.PI;console.log("\uD83C\uDFAF PVP Sword angle check - Entity ".concat(e.id,": Angle ").concat(i.toFixed(1),"\xb0, Max angle: ").concat(s.toFixed(1),"\xb0")),t<=n/2?(console.log("\uD83D\uDDE1️ PVP Sword hit confirmed! Entity ".concat(e.id," at distance ").concat(m.toFixed(2),", angle ").concat(i.toFixed(1),"\xb0")),h&&this.playerEntity&&(h.queueDamage(e,l,this.playerEntity,"melee"),console.log("\uD83D\uDCA5 Queued ".concat(l," melee damage to entity ").concat(e.id," (combo step ").concat(this.swordComboStep,")")),c++)):console.log("❌ PVP Sword missed - Entity ".concat(e.id," outside attack cone (").concat(i.toFixed(1),"\xb0 > ").concat(s.toFixed(1),"\xb0)"))}else console.log("❌ PVP Sword missed - Entity ".concat(e.id," out of range (").concat(m.toFixed(2)," > ").concat(4.6,")"))}),c>0){let e=window.gameUI;if(e){let t=e.getCurrentRage?e.getCurrentRage():"unknown",i=Math.min(5*c,5);e.gainRage(i);let s=e.getCurrentRage?e.getCurrentRage():"unknown";console.log("\uD83D\uDDE1️ Gained ".concat(i," rage from hitting ").concat(c," enemies with sword combo ").concat(this.swordComboStep," - Rage: ").concat(t," → ").concat(s))}}}checkForDashInput(e,t){for(let{key:i,direction:o}of[{key:"w",direction:new s.Vector3(0,0,-1)},{key:"s",direction:new s.Vector3(0,0,1)},{key:"a",direction:new s.Vector3(-1,0,0)},{key:"d",direction:new s.Vector3(1,0,0)}])if(this.inputManager.checkDoubleTap(i)){let s=this.inputManager.getDoubleTapDebugInfo(i);console.log("\uD83D\uDD0D Double tap detected for key '".concat(i.toUpperCase(),"':"),s);let a=this.getWorldSpaceDirection(o),n=Date.now()/1e3;e.startDash(a,t.position,n)?(console.log("\uD83C\uDFC3 Dash started in direction: ".concat(i.toUpperCase())),this.inputManager.resetDoubleTap(i)):console.warn("❌ Dash failed to start for key: ".concat(i.toUpperCase()));break}}handleDashMovement(e,t){if(!e.isDashing)return;let i=Date.now()/1e3,s=e.updateDash(i);if(s.newPosition){let i=s.newPosition.length();i<=29?t.position.copy(s.newPosition):(console.warn("Dash cancelled: would move too far from origin (".concat(i.toFixed(2)," > ").concat(29,")")),e.cancelDash())}s.isComplete&&console.log("\uD83C\uDFC1 Dash completed")}handleChargeMovement(e,t){if(!e.isCharging)return;let i=Date.now()/1e3;if(this.chargeStoppedByCollision){e.cancelCharge();return}let s=e.updateCharge(i);if(s.newPosition){let i=s.newPosition.length(),o=this.checkPillarCollision(s.newPosition);i>29?(console.warn("Charge cancelled: would move too far from origin (".concat(i.toFixed(2)," > ").concat(29,")")),e.cancelCharge(),this.onChargeComplete()):o.hasCollision?(console.warn("Charge cancelled: would collide with pillar at [".concat(o.pillarCenter.toArray().join(", "),"]")),e.cancelCharge(),this.onChargeComplete()):this.chargeStoppedByCollision||t.position.copy(s.newPosition)}(s.isComplete||this.chargeStoppedByCollision)&&(console.log("⚔️ Charge movement completed"),this.onChargeComplete())}checkPillarCollision(e){for(let t of this.PILLAR_POSITIONS){let i=new s.Vector3(e.x,0,e.z),o=new s.Vector3(t.x,0,t.z);if(i.distanceTo(o)<this.PILLAR_RADIUS){let e=i.clone().sub(o).normalize();return 0===e.length()&&e.set(1,0,0),{hasCollision:!0,normal:e,pillarCenter:t.clone()}}}return{hasCollision:!1,normal:new s.Vector3,pillarCenter:new s.Vector3}}getWorldSpaceDirection(e){let t=new s.Vector3;this.camera.getWorldDirection(t);let i=new s.Vector3;i.crossVectors(t,new s.Vector3(0,1,0)).normalize();let o=new s.Vector3;o.crossVectors(new s.Vector3(0,1,0),i).normalize();let a=new s.Vector3;return a.addScaledVector(i,e.x),a.addScaledVector(o,-e.z),a.normalize(),a}performDivineStorm(e){let t=window.gameUI;if(t&&!t.canCastDivineStorm()){console.log("⚡ Not enough rage to cast Divine Storm (requires minimum 20 rage)");return}let i=Date.now()/1e3;if(i-this.lastDivineStormTime<this.divineStormCooldown){console.log("⏰ Divine Storm on cooldown for ".concat((this.divineStormCooldown-(i-this.lastDivineStormTime)).toFixed(1),"s"));return}let o=t?t.getCurrentRage():40;t&&(t.consumeAllRage(),console.log("⚡ Consumed ".concat(o," rage for Divine Storm")));let a=500*Math.floor(o/10),n=1e3+a;if(console.log("⚡ Divine Storm activated! Duration: ".concat(n/1e3,"s (base: 4s + bonus: ").concat(a/1e3,"s from ").concat(o," rage)")),this.isDivineStorming=!0,this.lastDivineStormTime=i,this.onDivineStormCallback){let t=new s.Vector3;this.camera.getWorldDirection(t),t.normalize(),this.onDivineStormCallback(e.position.clone(),t,n)}setTimeout(()=>{this.isDivineStorming=!1,console.log("⚡ Divine Storm completed")},n)}performCharge(e){let t=Date.now()/1e3;if(t-this.lastChargeTime<this.chargeCooldown){console.log("⏰ Charge on cooldown for ".concat((this.chargeCooldown-(t-this.lastChargeTime)).toFixed(1),"s"));return}if(console.log("⚔️ Charge activated!"),this.isSwordCharging=!0,this.lastChargeTime=t,this.chargeStoppedByCollision=!1,this.onChargeCallback){let t=new s.Vector3;this.camera.getWorldDirection(t),t.normalize(),this.onChargeCallback(e.position.clone(),t)}let i=window.gameUI;if(i&&(i.gainRage(20),console.log("⚔️ Gained 20 rage from using Charge ability")),this.playerEntity){let i=this.playerEntity.getComponent(n.i);if(i){let o=new s.Vector3;this.camera.getWorldDirection(o),o.y=0,o.normalize(),i.startCharge(o,e.position,t)?(console.log("⚔️ Charge movement started with 10.5 distance"),this.scheduleChargeDamage(e,o,t)):console.warn("⚔️ Charge failed to start (already charging or dashing)")}}}scheduleChargeDamage(e,t,i){this.chargeHitEntities.clear(),this.chargeStoppedByCollision=!1;let o=setInterval(()=>{let h=Date.now()/1e3;if(!this.isSwordCharging||h-i>.75||this.chargeStoppedByCollision){clearInterval(o);return}let u=this.world.getAllEntities(),g=e.position,m=!1;console.log("\uD83D\uDD0D Charge collision check - Total entities in world: ".concat(u.length));let p=window.pvpPlayers||new Map,y=window.localSocketId;if(console.log("\uD83D\uDD0D Also checking ".concat(p.size," server players directly for collision")),p.forEach((e,i)=>{if(i===y)return;let o=1e3*i.length+i.charCodeAt(0);if(this.chargeHitEntities.has(o))return;let a=new s.Vector3(e.position.x,e.position.y,e.position.z),n=g.distanceTo(a);console.log("\uD83D\uDD0D Direct server player check - ".concat(i,": distance=").concat(n.toFixed(2),", stopDistance=").concat("1.90")),n<=1.9&&e.health>0&&(console.log("⚔️ Direct server collision detected with player ".concat(i,"!")),this.chargeHitEntities.add(o),m=!0,this.onProjectileCreatedCallback&&this.onProjectileCreatedCallback("sword_charge_hit",g.clone(),t.clone(),{damage:40,targetId:i,hitPosition:{x:a.x,y:a.y,z:a.z}}))}),u.forEach(e=>{var i;if(e.id===(null===(i=this.playerEntity)||void 0===i?void 0:i.id)||this.chargeHitEntities.has(e.id))return;let s=e.getComponent(a.w),o=e.getComponent(r.S),n=e.getComponent(c.YM),h=e.getComponent(l.C),u=h?"Enemy(".concat(h.getDisplayName(),")"):"Player(".concat(e.id,")");if(console.log("\uD83D\uDD0D Checking entity ".concat(e.id," (").concat(u,"): transform=").concat(!!s,", health=").concat(!!o,", collider=").concat(!!n,", isDead=").concat(null==o?void 0:o.isDead)),!s||!o||o.isDead)return;let p=s.position,y=g.distanceTo(p),D=n?n.radius+1:2.5;if(console.log("\uD83D\uDD0D Entity ".concat(e.id," (").concat(u,"): playerPos=[").concat(g.x.toFixed(2),", ").concat(g.y.toFixed(2),", ").concat(g.z.toFixed(2),"], entityPos=[").concat(p.x.toFixed(2),", ").concat(p.y.toFixed(2),", ").concat(p.z.toFixed(2),"], distance=").concat(y.toFixed(2),", stopDistance=").concat(D.toFixed(2),", colliderRadius=").concat((null==n?void 0:n.radius)||"none")),y<=D){this.chargeHitEntities.add(e.id),m=!0;let i=this.world.getSystem(d.b);if(i&&this.playerEntity){i.queueDamage(e,40,this.playerEntity,"charge");let s=e.getComponent(l.C),o=s?"Enemy(".concat(s.getDisplayName(),")"):"Player(".concat(e.id,")");console.log("⚔️ Charge hit ".concat(o," for ").concat(40," damage at distance ").concat(y.toFixed(2))),this.onProjectileCreatedCallback&&this.onProjectileCreatedCallback("sword_charge_hit",g.clone(),t.clone(),{damage:40,targetId:e.id,hitPosition:{x:p.x,y:p.y,z:p.z}})}}}),m){if(console.log("⚔️ Charge stopped by collision - ending charge movement"),this.chargeStoppedByCollision=!0,this.playerEntity){let e=this.playerEntity.getComponent(n.i);e&&e.cancelCharge()}clearInterval(o),this.onChargeComplete()}},50)}onChargeComplete(){console.log("⚔️ Charge completed"),this.isSwordCharging=!1}performDeflect(e){let t=Date.now()/1e3;if(t-this.lastDeflectTime<this.deflectCooldown){console.log("⏰ Deflect on cooldown for ".concat((this.deflectCooldown-(t-this.lastDeflectTime)).toFixed(1),"s"));return}if(console.log("\uD83D\uDEE1️ Deflect activated!"),this.isDeflecting=!0,this.lastDeflectTime=t,this.onDeflectCallback){let t=new s.Vector3;this.camera.getWorldDirection(t),t.normalize(),this.onDeflectCallback(e.position.clone(),t)}this.setupDeflectBarrier(e),setTimeout(()=>{this.onDeflectComplete()},1e3*this.deflectDuration)}performViperSting(e){let t=Date.now()/1e3;if(t-this.lastViperStingTime<this.viperStingFireRate){console.log("⏰ Viper Sting on cooldown for ".concat((this.viperStingFireRate-(t-this.lastViperStingTime)).toFixed(1),"s"));return}let i=window.gameUI;if(i&&!i.canCastViperSting()){console.log("\uD83D\uDC0D Not enough energy to cast Viper Sting (requires 60 energy)");return}i&&(i.consumeEnergy(60),console.log("\uD83D\uDC0D Consumed 60 energy for Viper Sting")),console.log("\uD83D\uDC0D Viper Sting activated - starting charge!"),this.isViperStingCharging=!0,this.viperStingChargeProgress=0,this.lastViperStingTime=t;let s=Date.now(),o=setInterval(()=>{let t=Date.now()-s;this.viperStingChargeProgress=Math.min(t/1e3,1),this.viperStingChargeProgress>=1&&(clearInterval(o),this.fireViperSting(e),this.isViperStingCharging=!1,this.viperStingChargeProgress=0)},16)}fireViperSting(e){console.log("\uD83D\uDC0D Firing Viper Sting projectile!");let t=e.getWorldPosition();t.y+=1;let i=new s.Vector3;this.camera.getWorldDirection(i),i.normalize();let o=new s.Vector3;o.crossVectors(i,new s.Vector3(0,1,0)).normalize();let a=new s.Matrix4;a.makeRotationAxis(o,Math.PI/6),i.applyMatrix4(a),i.normalize();let n=t.clone();n.add(i.clone().multiplyScalar(1)),this.onViperStingCallback&&this.onViperStingCallback(t,i),(0,y.triggerGlobalViperSting)()&&console.log("\uD83D\uDC0D Viper Sting visual effects successfully triggered!"),this.onProjectileCreatedCallback&&this.onProjectileCreatedCallback("viper_sting_projectile",n,i,{speed:16,damage:61,lifetime:5,isReturning:!1})}performBarrage(e){console.log("\uD83C\uDFF9 performBarrage called!");let t=Date.now()/1e3;if(t-this.lastBarrageTime<this.barrageFireRate){console.log("⏰ Barrage on cooldown for ".concat((this.barrageFireRate-(t-this.lastBarrageTime)).toFixed(1),"s"));return}let i=window.gameUI;if(i&&!i.canCastBarrage()){console.log("\uD83C\uDFF9 Not enough energy to cast Barrage (requires 40 energy)");return}i&&(i.consumeEnergy(40),console.log("\uD83C\uDFF9 Consumed 40 energy for Barrage")),console.log("\uD83C\uDFF9 Barrage activated - starting charge!"),this.isBarrageCharging=!0,this.barrageChargeProgress=0,this.lastBarrageTime=t;let s=Date.now(),o=setInterval(()=>{let t=Date.now()-s;this.barrageChargeProgress=Math.min(t/500,1),this.barrageChargeProgress>=1&&(clearInterval(o),this.fireBarrage(e),this.isBarrageCharging=!1,this.barrageChargeProgress=0)},16)}fireBarrage(e){console.log("\uD83C\uDFF9 Firing Barrage projectiles!");let t=e.getWorldPosition();t.y+=1;let i=new s.Vector3;this.camera.getWorldDirection(i);let o=new s.Vector3;o.crossVectors(i,new s.Vector3(0,1,0)).normalize();let a=new s.Matrix4;a.makeRotationAxis(o,Math.PI/6),i.applyMatrix4(a),i.normalize(),[0,Math.PI/12,-Math.PI/12,Math.PI/6,-Math.PI/6].forEach(e=>{let o=i.clone(),a=new s.Matrix4().makeRotationY(e);o.applyMatrix4(a),o.normalize();let n=t.clone();n.add(o.clone().multiplyScalar(1));let r={speed:22,damage:30,lifetime:8,maxDistance:25,piercing:!1,subclass:this.currentSubclass,level:1,opacity:1},l=this.projectileSystem.createProjectile(this.world,n,o,this.playerEntity.id,r),c=l.getComponent(h.T);(null==c?void 0:c.mesh)&&(c.mesh.userData.isBarrageArrow=!0,c.mesh.userData.isRegularArrow=!1),this.onProjectileCreatedCallback&&this.onProjectileCreatedCallback("barrage_projectile",n,o,r),console.log("\uD83C\uDFF9 Created Barrage arrow ".concat(l.id," at angle ").concat((180*e/Math.PI).toFixed(1),"\xb0"))}),this.onBarrageCallback&&this.onBarrageCallback(t,i),console.log("\uD83C\uDFF9 Barrage successfully fired with 5 ECS projectiles!")}setupDeflectBarrier(e){let t=e.getWorldPosition(),i=new s.Vector3(0,0,0);if(this.playerEntity){let e=this.playerEntity.getComponent(n.i);if(e&&e.inputStrength>.1){let t=e.moveDirection;if(t.length()>.1){let e=Math.atan2(t.x,t.z);i.y=e}}else{let e=new s.Vector3;this.camera.getWorldDirection(e),i.y=Math.atan2(e.x,e.z)}}this.deflectBarrier.activate(t,i,this.playerEntity||void 0)}updateDeflectBarrier(e){if(this.deflectBarrier.isBarrierActive()){let t=e.getWorldPosition(),i=new s.Vector3(0,0,0);if(this.playerEntity){let e=this.playerEntity.getComponent(n.i);if(e&&e.inputStrength>.1){let t=e.moveDirection;if(t.length()>.1){let e=Math.atan2(t.x,t.z);i.y=e}}else{let e=new s.Vector3;this.camera.getWorldDirection(e),i.y=Math.atan2(e.x,e.z)}}this.deflectBarrier.updatePosition(t,i)}}onDeflectComplete(){console.log("\uD83D\uDEE1️ Deflect completed"),this.isDeflecting=!1,this.deflectBarrier.deactivate()}getWeaponSwitchCooldown(){let e=Date.now()/1e3;return{current:Math.max(0,this.weaponSwitchCooldown-(e-this.lastWeaponSwitchTime)),max:this.weaponSwitchCooldown}}getAbilityCooldowns(){let e=Date.now()/1e3,t={};return this.currentWeapon===u.v.SWORD?(t.Q={current:Math.max(0,this.deflectCooldown-(e-this.lastDeflectTime)),max:this.deflectCooldown,isActive:this.isDeflecting},t.E={current:Math.max(0,this.chargeCooldown-(e-this.lastChargeTime)),max:this.chargeCooldown,isActive:this.isSwordCharging},t.R={current:Math.max(0,this.divineStormCooldown-(e-this.lastDivineStormTime)),max:this.divineStormCooldown,isActive:this.isDivineStorming}):this.currentWeapon===u.v.BOW?(t.Q={current:Math.max(0,this.barrageFireRate-(e-this.lastBarrageTime)),max:this.barrageFireRate,isActive:this.isBarrageCharging},t.E={current:Math.max(0,this.cobraShotFireRate-(e-this.lastCobraShotTime)),max:this.cobraShotFireRate,isActive:!1},t.R={current:Math.max(0,this.viperStingFireRate-(e-this.lastViperStingTime)),max:this.viperStingFireRate,isActive:this.isViperStingCharging}):this.currentWeapon===u.v.SCYTHE&&(t.Q={current:Math.max(0,1-(e-this.lastReanimateTime)),max:1,isActive:!1},t.E={current:Math.max(0,this.frostNovaFireRate-(e-this.lastFrostNovaTime)),max:this.frostNovaFireRate,isActive:!1},t.R={current:Math.max(0,this.crossentropyFireRate-(e-this.lastCrossentropyTime)),max:this.crossentropyFireRate,isActive:!1}),t}constructor(e,t,i,o){super(),this.requiredComponents=[a.w,n.i],this.playerEntity=null,this.lastFireTime=0,this.lastCrossentropyTime=0,this.lastReanimateTime=0,this.lastViperStingTime=0,this.lastFrostNovaTime=0,this.lastCobraShotTime=0,this.fireRate=.225,this.swordFireRate=.75,this.sabresFireRate=.6,this.scytheFireRate=.33,this.crossentropyFireRate=1,this.viperStingFireRate=2,this.reanimateFireRate=1.5,this.frostNovaFireRate=12,this.cobraShotFireRate=2,this.currentWeapon=u.v.BOW,this.currentSubclass=u.p.ELEMENTAL,this.currentLevel=1,this.isCharging=!1,this.chargeProgress=0,this.isSwinging=!1,this.isViperStingCharging=!1,this.viperStingChargeProgress=0,this.isBarrageCharging=!1,this.barrageChargeProgress=0,this.lastBarrageTime=0,this.barrageFireRate=5,this.isCobraShotCharging=!1,this.cobraShotChargeProgress=0,this.swordComboStep=1,this.lastSwordAttackTime=0,this.swordComboResetTime=1,this.isDivineStorming=!1,this.lastDivineStormTime=0,this.divineStormCooldown=10,this.isSwordCharging=!1,this.lastChargeTime=0,this.chargeCooldown=8,this.isDeflecting=!1,this.lastDeflectTime=0,this.deflectCooldown=8,this.deflectDuration=3,this.lastWeaponSwitchTime=0,this.weaponSwitchCooldown=3,this.PILLAR_POSITIONS=[new s.Vector3(0,0,-5),new s.Vector3(-4.25,0,2.5),new s.Vector3(4.25,0,2.5)],this.PILLAR_RADIUS=.7,this.chargeHitEntities=new Set,this.chargeStoppedByCollision=!1,this.camera=e,this.inputManager=t,this.world=i,this.projectileSystem=o,this.deflectBarrier=new g.l(i),this.priority=5}}},4451:function(e,t,i){i.d(t,{C:function(){return l}});var s=i(1448),o=i(9131),a=i(73),n=i(6862),r=i(6776);class l extends o.Kg{update(e,t){for(let i of e){let e=i.getComponent(a.w),s=i.getComponent(n.S),o=i.getComponent(r.T);if(!e.enabled||!s.enabled||!o.enabled)continue;let l=e.getWorldPosition(),h=this.camera.position;o.updateHealthBar(s.getHealthRatio(),h,l,t)}}render(e,t){}onEntityAdded(e){let t=e.getComponent(r.T);t&&this.scene.add(t.getGroup())}onEntityRemoved(e){let t=e.getComponent(r.T);t&&(this.scene.remove(t.getGroup()),t.dispose())}onDisable(){let e=[];for(let t of(this.scene.traverse(t=>{t instanceof s.Group&&t.userData.isHealthBar&&e.push(t)}),e))this.scene.remove(t)}constructor(e,t){super(),this.requiredComponents=[a.w,n.S,r.T],this.scene=e,this.camera=t,this.priority=100}}},5773:function(e,t,i){i.d(t,{F:function(){return r}});var s=i(1448),o=i(9131),a=i(73),n=i(7771);class r extends o.FU{update(e,t){for(let i of e){let e=i.getComponent(a.w),s=i.getComponent(n.i);e&&s&&e.enabled&&s.enabled&&s.canMove&&("function"==typeof s.updateDebuffs?s.updateDebuffs():console.warn("⚠️ Movement component missing updateDebuffs method:",s),this.updateMovement(e,s,t))}}fixedUpdate(e,t){for(let i of e){let e=i.getComponent(a.w),s=i.getComponent(n.i);e&&s&&e.enabled&&s.enabled&&s.canMove&&this.applyPhysics(e,s,t)}}updateMovement(e,t,i){let o=t.velocity.clone().multiplyScalar(i),a=e.position.clone(),n=a.clone().add(o),r=new s.Vector3(n.x,0,n.z).length(),l=this.checkPillarCollision(n);if(r>=29){let t=new s.Vector3(a.x,0,a.z),i=t.clone().normalize(),n=new s.Vector3(-i.z,0,i.x),r=new s.Vector3(o.x,0,o.z),l=n.multiplyScalar(r.dot(n)),h=t.add(l);h.normalize().multiplyScalar(29),e.setPosition(h.x,a.y+o.y,h.z)}else if(l.hasCollision){let i=this.calculatePillarSliding(a,o,l);e.setPosition(i.x,i.y,i.z);let s=t.velocity.clone().projectOnVector(l.normal);t.velocity.sub(s.multiplyScalar(.5))}else e.translate(o.x,o.y,o.z);e.matrixNeedsUpdate=!0}checkPillarCollision(e){for(let t of this.PILLAR_POSITIONS){let i=new s.Vector3(e.x,0,e.z),o=new s.Vector3(t.x,0,t.z);if(i.distanceTo(o)<this.PILLAR_RADIUS){let e=i.clone().sub(o).normalize();return 0===e.length()&&e.set(1,0,0),{hasCollision:!0,normal:e,pillarCenter:t.clone()}}}return{hasCollision:!1,normal:new s.Vector3,pillarCenter:new s.Vector3}}calculatePillarSliding(e,t,i){let o=new s.Vector3(-i.normal.z,0,i.normal.x),a=t.clone().projectOnVector(o),n=e.clone().add(a),r=new s.Vector3(i.pillarCenter.x,0,i.pillarCenter.z),l=new s.Vector3(n.x,0,n.z);if(l.distanceTo(r)<this.PILLAR_RADIUS){let e=l.clone().sub(r).normalize();0===e.length()&&e.set(1,0,0);let t=r.clone().add(e.multiplyScalar(this.PILLAR_RADIUS));n.x=t.x,n.z=t.z}return n}applyPhysics(e,t,i){if(t.applyGravity(i),t.inputStrength>0){let e=t.getEffectiveMaxSpeed(),i=t.moveDirection.clone();i.multiplyScalar(e*t.inputStrength),t.velocity.x=i.x,t.velocity.z=i.z}else t.velocity.x=0,t.velocity.z=0;t.velocity.add(t.acceleration.clone().multiplyScalar(i)),t.acceleration.set(0,0,0),e.position.y<=.5&&t.velocity.y<=0?(e.position.y=.5,t.velocity.y=0,t.isGrounded=!0):t.isGrounded=!1}constructor(){super(),this.requiredComponents=[a.w,n.i],this.PILLAR_POSITIONS=[new s.Vector3(0,0,-5),new s.Vector3(-4.25,0,2.5),new s.Vector3(4.25,0,2.5)],this.PILLAR_RADIUS=.7,this.priority=15}}},2972:function(e,t,i){i.d(t,{c:function(){return u}});var s=i(1448),o=i(9131),a=i(73),n=i(1168),r=i(6862),l=i(246),h=i(3478),c=i(8001),d=i(6520);class u extends o.xP{setCombatSystem(e){this.combatSystem=e}update(e,t){for(let i of(this.projectilesToDestroy.length=0,e)){let e=i.getComponent(a.w),s=i.getComponent(n.W);if(e.enabled&&s.enabled){if(s.update(t),s.isExpired()){this.projectilesToDestroy.push(i.id);continue}this.moveProjectile(e,s,t),this.checkCollisions(i,e,s),this.checkWorldBounds(i,e)}}for(let e of this.projectilesToDestroy)this.world.destroyEntity(e)}moveProjectile(e,t,i){this.tempVector.copy(t.velocity).multiplyScalar(i),e.translate(this.tempVector.x,this.tempVector.y,this.tempVector.z),e.matrixNeedsUpdate=!0}checkCollisions(e,t,i){let s=t.position,o=this.world.queryEntities([a.w,r.S,h.YM]);if(0!==o.length)for(let t of o){if(t.id===e.id||t.id===i.owner){t.id===i.owner&&console.log("\uD83D\uDEAB Projectile ".concat(e.id," skipping owner ").concat(i.owner," (target ").concat(t.id,")"));continue}if(!i.canHitTarget(t.id))continue;let o=t.getComponent(a.w),n=t.getComponent(r.S),l=t.getComponent(h.YM);if(n.isDead||l.layer!==h.aB.ENEMY&&l.layer!==h.aB.PLAYER)continue;if(l.layer===h.aB.PLAYER&&t.id===i.owner){console.log("\uD83D\uDEAB Extra safety: Projectile ".concat(e.id," prevented from hitting owner ").concat(i.owner," (PVP mode)"));continue}let c=o.getWorldPosition(),d=l.radius;if(s.distanceToSquared(c)<=(.2+d)**2&&(this.handleHit(e,t,i,n),!i.piercing)){this.projectilesToDestroy.push(e.id);break}}}handleHit(e,t,i,s){if(i.addHitTarget(t.id),this.combatSystem){var o,a,n,r;let s=e.getComponent(l.T),h=null==s?void 0:null===(a=s.mesh)||void 0===a?void 0:null===(o=a.userData)||void 0===o?void 0:o.isCrossentropyBolt,c=null==s?void 0:null===(r=s.mesh)||void 0===r?void 0:null===(n=r.userData)||void 0===n?void 0:n.isEntropicBolt,d="projectile";h?d="crossentropy":c&&(d="entropic"),h?console.log("\uD83D\uDFE2 CrossEntropy bolt hit detected, using green damage numbers"):c&&console.log("⚡ Entropic bolt hit detected, using green damage numbers"),this.combatSystem.queueDamage(t,i.damage,e,d)}else{let e=Date.now()/1e3;if(s.takeDamage(i.damage,e,t)){let e=t.getComponent(c.C),o=e?e.getDisplayName():"Entity ".concat(t.id);console.log("\uD83D\uDCA5 Bone Arrow hit ".concat(o," for ").concat(i.damage," damage (").concat(s.currentHealth,"/").concat(s.maxHealth," HP)"))}}i.explosionRadius>0&&this.handleExplosion(e,i)}handleExplosion(e,t){let i=e.getComponent(a.w).position;for(let e of(this.world.emitEvent("explosion",{position:i.clone(),color:new s.Color("#00ff44"),size:t.explosionRadius,duration:.5}),this.world.queryEntities([a.w,r.S]))){if(e.id===t.owner)continue;let s=e.getComponent(a.w),o=e.getComponent(r.S),n=i.distanceTo(s.position);if(n<=t.explosionRadius){let i=1-n/t.explosionRadius,s=Math.floor(t.damage*i);if(s>0){let t=Date.now()/1e3;o.takeDamage(s,t,e),console.log("\uD83D\uDCA5 Explosion hit target ".concat(e.id," for ").concat(s," damage"))}}}}checkWorldBounds(e,t){let i=t.position;if(i.lengthSq()>1600){this.projectilesToDestroy.push(e.id);return}i.y<-10&&this.projectilesToDestroy.push(e.id)}createChargedArrowProjectile(e,t,i,o,r){let c=e.createEntity(),d=e.createComponent(a.w);d.position.copy(t),c.addComponent(d);let u=e.createComponent(n.W);u.speed=(null==r?void 0:r.speed)||35,u.damage=(null==r?void 0:r.damage)||25,u.maxLifetime=(null==r?void 0:r.lifetime)||5,u.owner=o,u.setDirection(i),(null==r?void 0:r.piercing)&&u.setPiercing(!0),(null==r?void 0:r.explosive)&&(null==r?void 0:r.explosionRadius)&&u.setExplosive(r.explosionRadius),c.addComponent(u);let g=e.createComponent(l.T),m=new s.SphereGeometry(.15,8,8),p=new s.MeshStandardMaterial({color:"#ffaa00",emissive:"#ffaa00",emissiveIntensity:3,transparent:!0,opacity:.1}),y=new s.Mesh(m,p);y.userData.isChargedArrow=!0,y.userData.direction=i.clone(),y.userData.subclass=null==r?void 0:r.subclass,y.userData.level=null==r?void 0:r.level,y.userData.opacity=(null==r?void 0:r.opacity)||1,g.mesh=y,c.addComponent(g);let D=e.createComponent(h.YM);return D.radius=.15,D.layer=h.aB.PROJECTILE,c.addComponent(D),c}createCrossentropyBoltProjectile(e,t,i,o,r){let h=e.createEntity(),c=e.createComponent(a.w);c.position.copy(t),h.addComponent(c);let d=e.createComponent(n.W);d.speed=(null==r?void 0:r.speed)||15,d.damage=(null==r?void 0:r.damage)||30,d.maxLifetime=(null==r?void 0:r.lifetime)||1.75,d.owner=o,d.setDirection(i),(null==r?void 0:r.piercing)&&d.setPiercing(!0),(null==r?void 0:r.explosive)&&(null==r?void 0:r.explosionRadius)&&d.setExplosive(r.explosionRadius),h.addComponent(d);let u=e.createComponent(l.T),g=new s.SphereGeometry(.28,8,8),m=new s.MeshStandardMaterial({color:"#00ff44",emissive:"#00ff44",emissiveIntensity:0,transparent:!0,opacity:0}),p=new s.Mesh(g,m);return p.userData.isCrossentropyBolt=!0,p.userData.projectileEntity=h,p.userData.direction=i.clone(),u.mesh=p,"function"==typeof u.setCastShadow?u.setCastShadow(!1):console.warn("⚠️ Renderer component missing setCastShadow method:",u),h.addComponent(u),console.log("⚔️ Created CrossentropyBolt projectile ".concat(h.id," at"),t,"moving",i),console.log("\uD83D\uDCCA Active projectiles: ".concat(this.world.queryEntities([a.w,n.W]).length)),this.world.notifyEntityAdded(h),h}createEntropicBoltProjectile(e,t,i,o,r){let h=e.createEntity(),c=e.createComponent(a.w);c.position.copy(t),h.addComponent(c);let d=e.createComponent(n.W);d.speed=(null==r?void 0:r.speed)||20,d.damage=(null==r?void 0:r.damage)||20,d.maxLifetime=(null==r?void 0:r.lifetime)||1.75,d.owner=o,d.setDirection(i),(null==r?void 0:r.piercing)&&d.setPiercing(!0),(null==r?void 0:r.explosive)&&(null==r?void 0:r.explosionRadius)&&d.setExplosive(r.explosionRadius),h.addComponent(d);let u=e.createComponent(l.T),g=new s.SphereGeometry(.15,6,6),m=new s.MeshStandardMaterial({color:"#00ff44",emissive:"#00ff44",emissiveIntensity:0,transparent:!0,opacity:0}),p=new s.Mesh(g,m);return p.userData.isEntropicBolt=!0,p.userData.projectileEntity=h,p.userData.direction=i.clone(),u.mesh=p,"function"==typeof u.setCastShadow?u.setCastShadow(!1):console.warn("⚠️ Renderer component missing setCastShadow method:",u),h.addComponent(u),console.log("⚡ Created EntropicBolt projectile ".concat(h.id," at"),t,"moving",i),console.log("\uD83D\uDCCA Active projectiles: ".concat(this.world.queryEntities([a.w,n.W]).length)),this.world.notifyEntityAdded(h),h}createProjectile(e,t,i,o,r){let c=e.createEntity(),d=e.createComponent(a.w);d.position.copy(t),c.addComponent(d);let u=e.createComponent(n.W);u.speed=(null==r?void 0:r.speed)||20,u.damage=(null==r?void 0:r.damage)||5,u.maxLifetime=(null==r?void 0:r.lifetime)||2,u.owner=o,u.setDirection(i),u.setStartPosition(t),(null==r?void 0:r.maxDistance)!==void 0&&u.setMaxDistance(r.maxDistance),(null==r?void 0:r.piercing)&&u.setPiercing(!0),(null==r?void 0:r.explosive)&&(null==r?void 0:r.explosionRadius)&&u.setExplosive(r.explosionRadius),c.addComponent(u);let g=e.createComponent(l.T),m=new s.SphereGeometry(.15,8,8),p=new s.MeshStandardMaterial({color:"#ffaa00",emissive:"#ffaa00",emissiveIntensity:3,transparent:!0,opacity:.1}),y=new s.Mesh(m,p);y.userData.isRegularArrow=!0,y.userData.direction=i.clone(),y.userData.subclass=null==r?void 0:r.subclass,y.userData.level=null==r?void 0:r.level,y.userData.opacity=(null==r?void 0:r.opacity)||1,g.mesh=y,"function"==typeof g.setCastShadow?g.setCastShadow(!1):console.warn("⚠️ Renderer component missing setCastShadow method:",g),c.addComponent(g);let D=e.createComponent(h.YM);return D.radius=.15,D.layer=h.aB.PROJECTILE,c.addComponent(D),console.log("\uD83D\uDE80 Created projectile ".concat(c.id," at"),t,"moving",i,"(owner: ".concat(o,")")),console.log("\uD83D\uDCCA Active projectiles: ".concat(this.world.queryEntities([a.w,n.W]).length)),this.world.notifyEntityAdded(c),c}onEntityRemoved(e){let t=e.getComponent(n.W);t&&(console.log("\uD83D\uDCA5 Destroying projectile ".concat(e.id," (lifetime: ").concat(t.lifetime.toFixed(2),"s)")),console.log("\uD83D\uDCCA Remaining projectiles: ".concat(this.world.queryEntities([a.w,n.W]).length-1)))}getPoolStats(){return{vector3:this.vector3Pool.getPoolSize()}}onDisable(){console.log("\uD83E\uDDF9 Cleaning up ProjectileSystem pools:",this.getPoolStats()),this.vector3Pool.clear()}constructor(e){super(),this.requiredComponents=[a.w,n.W],this.combatSystem=null,this.projectilesToDestroy=[],this.tempVector=new s.Vector3,this.tempVector2=new s.Vector3,this.world=e,this.priority=20,this.vector3Pool=new d.L(()=>new s.Vector3,e=>e.set(0,0,0),100)}}},3842:function(e,t,i){i.d(t,{K:function(){return r}});var s=i(1448),o=i(9131),a=i(73),n=i(246);class r extends o.Kg{update(e,t){for(let i of e){let e=i.getComponent(a.w),s=i.getComponent(n.T);e.enabled&&s.enabled&&("function"==typeof s.updateAnimations?s.updateAnimations(t):console.warn("⚠️ Renderer component missing updateAnimations method:",s),this.updateEntityMesh(i,e,s))}}render(e,t){for(let t of e){let e=t.getComponent(a.w),i=t.getComponent(n.T);e.enabled&&i.enabled&&this.updateEntityTransform(t,e,i)}this.renderer.render(this.scene,this.camera)}updateEntityMesh(e,t,i){let s=this.meshMap.get(e.id);if(!s&&i.mesh){this.meshMap.set(e.id,i.mesh),this.scene.add(i.mesh);return}if(!s&&i.geometry&&i.material){let t=i.createMesh();t&&(this.meshMap.set(e.id,t),this.scene.add(t))}else s&&("function"==typeof i.updateMesh?i.updateMesh():console.warn("⚠️ Renderer component missing updateMesh method:",i))}updateEntityTransform(e,t,i){let o=this.meshMap.get(e.id);o&&(t.updateMatrix(),o.position.copy(t.position),o.quaternion.copy(t.quaternion),o.scale.copy(t.scale),i.isInstanced&&o instanceof s.Mesh&&i.updateInstanceMatrix(t.matrix))}onEntityAdded(e){let t=e.getComponent(n.T);if(t){if(console.log("\uD83C\uDFA8 RenderSystem: Adding entity ".concat(e.id," to scene")),t.mesh){console.log("\uD83C\uDFF9 Adding pre-built mesh/group for entity ".concat(e.id)),this.meshMap.set(e.id,t.mesh),this.scene.add(t.mesh);return}if(t.geometry&&t.material){console.log("\uD83D\uDD37 Creating mesh from geometry + material for entity ".concat(e.id));let i=t.createMesh();i&&(this.meshMap.set(e.id,i),this.scene.add(i))}else console.log("⚪ Entity ".concat(e.id," has Renderer but no geometry/material - skipping mesh creation"))}else console.log("⚠️ RenderSystem: Entity ".concat(e.id," has no Renderer component"))}onEntityRemoved(e){let t=this.meshMap.get(e.id);t&&(this.scene.remove(t),this.meshMap.delete(e.id));let i=e.getComponent(n.T);i&&"function"==typeof i.dispose&&i.dispose()}getMesh(e){return this.meshMap.get(e)}getScene(){return this.scene}getCamera(){return this.camera}getRenderer(){return this.renderer}addLight(e){this.scene.add(e)}removeLight(e){this.scene.remove(e)}addObject(e){this.scene.add(e)}removeObject(e){this.scene.remove(e)}setFog(e){this.scene.fog=e}setBackground(e){this.scene.background=e}enableShadows(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.renderer.shadowMap.enabled=e,this.renderer.shadowMap.type=s.PCFSoftShadowMap}setPixelRatio(e){this.renderer.setPixelRatio(e||window.devicePixelRatio)}setSize(e,t){this.renderer.setSize(e,t),this.camera instanceof s.PerspectiveCamera&&(this.camera.aspect=e/t,this.camera.updateProjectionMatrix())}dispose(){for(let[e,t]of Array.from(this.meshMap.entries()))this.scene.remove(t);this.meshMap.clear(),this.renderer.dispose()}constructor(e,t,i){super(),this.requiredComponents=[a.w,n.T],this.meshMap=new Map,this.scene=e,this.camera=t,this.renderer=i,this.priority=1e3}}},3021:function(e,t,i){i.d(t,{R:function(){return h}});var s=i(1448),o=i(9131),a=i(73),n=i(6862),r=i(2115),l=i(3478);class h extends o.xP{setProjectileSystem(e){this.projectileSystem=e}setTowerAttackCallback(e){this.onTowerAttackCallback=e}setPlayerMapping(e,t){this.serverPlayerEntities=e,this.localSocketId=t}update(e,t){let i=Date.now()/1e3;for(let t of e){let e=t.getComponent(a.w),s=t.getComponent(r.N),o=t.getComponent(n.S);if(e&&s&&o){if(o.isDead&&!s.isDead){s.die(i),console.log("\uD83C\uDFF0 Tower ".concat(s.getDisplayName()," has been destroyed!"));continue}if(s.isActive&&!s.isDead){if(s.canSearchForTargets(i)&&this.searchForTarget(t,e,s,i),s.currentTarget){let t=this.world.getEntity(s.currentTarget);this.isValidTarget(t||null,e,s)||s.clearTarget()}s.currentTarget&&s.canAttack(i)&&this.attackTarget(t,e,s,i)}}}}searchForTarget(e,t,i,s){i.updateTargetSearch(s);let o=this.world.queryEntities([a.w,n.S,l.YM]);console.log("\uD83D\uDD0D Tower ".concat(i.getDisplayName()," searching for targets. Found ").concat(o.length," potential entities"));let h=null,c=1/0,d=0;for(let e of o){let s=e.getComponent(l.YM),o=e.getComponent(a.w);if(s&&o){let i=t.position.distanceTo(o.position);console.log("  - Entity ".concat(e.id,": layer=").concat(s.layer,", distance=").concat(i.toFixed(2),", hasComponent(Tower)=").concat(e.hasComponent(r.N)))}if(!this.isValidTarget(e,t,i))continue;d++;let n=e.getComponent(a.w);if(!n)continue;let u=t.position.distanceTo(n.position);u<=i.targetSearchRange&&u<c&&(h=e,c=u)}console.log("\uD83D\uDD0D Tower ".concat(i.getDisplayName()," found ").concat(d," valid targets")),h?(i.setTarget(h.id),console.log("\uD83C\uDFAF Tower ".concat(i.getDisplayName()," acquired target: Entity ").concat(h.id," at distance ").concat(c.toFixed(2)))):i.currentTarget&&(i.clearTarget(),console.log("\uD83C\uDFAF Tower ".concat(i.getDisplayName()," lost target - no valid targets in range")))}isValidTarget(e,t,i){if(!e)return console.log("    ❌ Target is null"),!1;let s=e.getComponent(n.S),o=e.getComponent(a.w),h=e.getComponent(l.YM);if(!s||!o||!h||s.isDead)return console.log("    ❌ Entity ".concat(e.id,": Missing components or dead (health=").concat(!!s,", transform=").concat(!!o,", collider=").concat(!!h,", isDead=").concat(null==s?void 0:s.isDead,")")),!1;if(h.layer!==l.aB.PLAYER&&h.layer!==l.aB.ENEMY)return console.log("    ❌ Entity ".concat(e.id,": Wrong collision layer (").concat(h.layer,"), expected PLAYER(").concat(l.aB.PLAYER,") or ENEMY(").concat(l.aB.ENEMY,")")),!1;if(e.hasComponent(r.N))return console.log("    ❌ Entity ".concat(e.id,": Is a tower, skipping")),!1;if(this.localSocketId&&this.serverPlayerEntities.size>0){if(console.log("    \uD83D\uDD0D Entity ".concat(e.id,": PVP mode check (localSocketId=").concat(this.localSocketId,", playerMappings=").concat(this.serverPlayerEntities.size,")")),h.layer===l.aB.PLAYER){let t=i.ownerId!==this.localSocketId;return console.log("    ".concat(t?"✅":"❌"," Entity ").concat(e.id,": Local player, towerOwner=").concat(i.ownerId,", localPlayer=").concat(this.localSocketId,", shouldTarget=").concat(t)),t}if(h.layer===l.aB.ENEMY){let t=null;if(this.serverPlayerEntities.forEach((i,s)=>{i===e.id&&(t=s)}),t){let s=i.ownerId!==t;return console.log("    ".concat(s?"✅":"❌"," Entity ").concat(e.id,": Remote player ").concat(t,", towerOwner=").concat(i.ownerId,", shouldTarget=").concat(s)),s}return console.log("    ✅ Entity ".concat(e.id,": Remote player (unidentified), targeting by default")),!0}}return console.log("    ✅ Entity ".concat(e.id,": Fallback targeting")),!0}attackTarget(e,t,i,s){let o=this.world.getEntity(i.currentTarget);if(!o){i.clearTarget();return}let n=o.getComponent(a.w);if(!n){i.clearTarget();return}this.tempVector.copy(n.position),this.tempVector.sub(t.position);let r=this.tempVector.length();if(r>i.attackRange){i.clearTarget();return}if(this.tempVector.normalize(),this.tempVector2.copy(t.position),this.tempVector2.y+=2,this.projectileSystem){let t={speed:i.projectileSpeed,damage:i.attackDamage,lifetime:2,opacity:1},s=this.projectileSystem.createProjectile(this.world,this.tempVector2,this.tempVector,e.id,t);s.getComponent(a.w)&&(s.isTowerProjectile=!0,s.towerOwnerId=i.ownerId),console.log("\uD83C\uDFF0 Tower ".concat(i.getDisplayName()," fired at target Entity ").concat(i.currentTarget," (distance: ").concat(r.toFixed(2),")"))}if(this.onTowerAttackCallback){let e="player_".concat(i.currentTarget);this.onTowerAttackCallback(i.ownerId,e,this.tempVector2,this.tempVector)}i.performAttack(s)}getTowersByOwner(e){return this.world.queryEntities([a.w,r.N,n.S]).filter(t=>{let i=t.getComponent(r.N);return i&&i.ownerId===e})}getTowerCount(e){return this.getTowersByOwner(e).length}hasActiveTowers(e){return this.getTowersByOwner(e).some(e=>{let t=e.getComponent(r.N),i=e.getComponent(n.S);return t&&i&&t.isActive&&!t.isDead&&!i.isDead})}constructor(e){super(),this.requiredComponents=[a.w,r.N,n.S],this.projectileSystem=null,this.serverPlayerEntities=new Map,this.localSocketId=null,this.tempVector=new s.Vector3,this.tempVector2=new s.Vector3,this.world=e,this.priority=25}}}}]);