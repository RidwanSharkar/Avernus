"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[812],{4668:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),i=r(2265);function o(e){let{damageData:t,onComplete:r,camera:o,size:a,stackIndex:s}=e,[l,c]=(0,i.useState)(1),[d,u]=(0,i.useState)(0),[h,p]=(0,i.useState)(1);(0,i.useEffect)(()=>{let e=Date.now(),n=()=>{let i=Math.min((Date.now()-e)/3e3,1);u((1-Math.pow(1-i,3))*4+.8*s);let o=0===s?1.2:.9-.1*s;p(o+(.8-.1*s-o)*Math.min(2*i,1));let a=0===s?.6:.3-.1*s;if(i>a){let e=(i-a)/(1-a);c(1-e+(0===s?0:Math.max(0,.7-.2*s))*e)}else c(1-.2*s);i<1?requestAnimationFrame(n):r(t.id)};n()},[t.id,r,s]);let g=0,m=0;if(o&&a.width>0&&a.height>0&&t.position&&t.position.clone){let e=t.position.clone();e.y+=d;let r=e.clone().project(o);g=(.5*r.x+.5)*a.width,m=(-.5*r.y+.5)*a.height}else{let e=window.innerWidth/2,r=window.innerHeight/2;g=e+50*t.position.x,m=r-50*t.position.z-20*d}return(0,n.jsx)("div",{className:"absolute pointer-events-none select-none font-bold text-lg",style:{left:"".concat(g,"px"),top:"".concat(m,"px"),opacity:l,transform:"translate(-50%, -50%) scale(".concat(h,")"),textShadow:"2px 2px 4px rgba(0, 0, 0, 0.8)",zIndex:1e3-s,transition:s>0?"opacity 0.3s ease-out":"none"},children:(0,n.jsxs)("span",{className:"".concat(t.isCritical?"text-yellow-300 text-xl animate-pulse":"crossentropy"===t.damageType?"text-green-400":"healing"===t.damageType?"text-green-300":"text-red-400"),children:[t.damage,t.isCritical&&"!"]})})}function a(e){let{damageNumbers:t,onDamageNumberComplete:r,camera:i,size:a}=e,s=new Map;return t.forEach(e=>{let t="".concat(Math.round(2*e.position.x),"_").concat(Math.round(2*e.position.z));s.has(t)||s.set(t,[]),s.get(t).push(e)}),s.forEach(e=>{e.sort((e,t)=>t.timestamp-e.timestamp),e.splice(3)}),(0,n.jsx)("div",{className:"fixed inset-0 pointer-events-none",children:Array.from(s.values()).flat().map(e=>{let t="".concat(Math.round(2*e.position.x),"_").concat(Math.round(2*e.position.z)),l=s.get(t).findIndex(t=>t.id===e.id);return(0,n.jsx)(o,{damageData:e,onComplete:r,camera:i,size:a,stackIndex:l},e.id)})})}},1702:function(e,t,r){r.r(t),r.d(t,{GameScene:function(){return ex}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448),s=r(7988),l=r(45),c=r(73),d=r(7771),u=r(6862),h=r(3974),p=r(3478),g=r(3842),m=r(7223),f=r(2082),y=r(2972),x=r(5773),M=r(2158),v=r(244),j=r(4451),w=r(9667),S=r(7125),b=r(2824),C=r(8001),I=r(4842),P=r(1159);function D(e){let{collectedBones:t,isLeftWing:r}=e,o=(0,i.useRef)(null),s=(0,i.useMemo)(()=>{let e=new a.Shape;return e.moveTo(0,0),e.lineTo(.06,.8),e.lineTo(.03,1),e.lineTo(0,.95),e.lineTo(-.03,1),e.lineTo(-.06,.8),e.lineTo(0,0),e},[]),l=(0,i.useMemo)(()=>{let e=new a.Shape;return e.moveTo(0,0),e.lineTo(.05,.6),e.lineTo(.025,.8),e.lineTo(0,.75),e.lineTo(-.025,.8),e.lineTo(-.05,.6),e.lineTo(0,0),e},[]),c=(0,i.useMemo)(()=>({steps:1,depth:.02,bevelEnabled:!0,bevelThickness:.005,bevelSize:.008,bevelSegments:2,curveSegments:8}),[]),d=(0,i.useMemo)(()=>({feather:new a.MeshStandardMaterial({color:"#F5F5DC",emissive:"#2A2A1A",emissiveIntensity:.3,metalness:.1,roughness:.6,side:a.DoubleSide}),redMarking:new a.MeshStandardMaterial({color:"#FF0000",emissive:"#FF0000",emissiveIntensity:1.5,metalness:.7,roughness:.2,opacity:.9,transparent:!0,side:a.DoubleSide}),wingBone:new a.MeshStandardMaterial({color:"#E8E8E8",emissive:"#404040",emissiveIntensity:.4,metalness:.3,roughness:.4})}),[]),u=(0,i.useMemo)(()=>new a.ExtrudeGeometry(s,c),[s,c]),h=(0,i.useMemo)(()=>new a.ExtrudeGeometry(l,c),[l,c]),p=(0,i.useMemo)(()=>[{pos:new a.Vector3(r?-1:1,.3,-.15),rot:new a.Euler(0,0,r?-Math.PI/4:Math.PI/4),scale:new a.Vector3(-1.1,1.4,-1),featherLength:1.6,hasRedMarking:!0},{pos:new a.Vector3(r?-1.4:1.4,.8,-.05),rot:new a.Euler(0,0,r?-Math.PI/3:Math.PI/3),scale:new a.Vector3(-1,1.3,-1),featherLength:1.5,hasRedMarking:!0},{pos:new a.Vector3(r?-1.5:1.5,1,0),rot:new a.Euler(0,0,r?-Math.PI/2.5:Math.PI/2.5),scale:new a.Vector3(-.9,1.2,-1),featherLength:1.4,hasRedMarking:!1},{pos:new a.Vector3(r?-1.6:1.6,1.5,.05),rot:new a.Euler(0,0,r?-Math.PI/2:Math.PI/2),scale:new a.Vector3(-.8,1.3,-1),featherLength:1.3,hasRedMarking:!0},{pos:new a.Vector3(r?-.7:.7,.2,-.1),rot:new a.Euler(0,0,r?-Math.PI/8:Math.PI/8),scale:new a.Vector3(-1,1.4,-1),featherLength:1,hasRedMarking:!1},{pos:new a.Vector3(r?-.9:.9,.4,-.05),rot:new a.Euler(0,0,r?-Math.PI/5:Math.PI/5),scale:new a.Vector3(-.9,1.2,-1),featherLength:1.1,hasRedMarking:!0},{pos:new a.Vector3(r?-1.1:1.1,.6,0),rot:new a.Euler(0,0,r?-Math.PI/3.5:Math.PI/3.5),scale:new a.Vector3(-.8,1.1,-1),featherLength:1.1,hasRedMarking:!1},{pos:new a.Vector3(r?-1.8:1.8,1.1,-.05),rot:new a.Euler(0,0,r?-Math.PI/12-Math.PI/3:Math.PI/12+Math.PI/3),scale:new a.Vector3(.9,1.2,1),featherLength:1.8,hasRedMarking:!0},{pos:new a.Vector3(r?-1.6:1.6,.35,-.05),rot:new a.Euler(0,0,r?-Math.PI/12-Math.PI/5:Math.PI/12+Math.PI/5),scale:new a.Vector3(.8,1,1),featherLength:1.5,hasRedMarking:!1}],[r]),g=(e,t)=>(0,n.jsxs)("group",{position:e.pos,rotation:e.rot,scale:e.scale,children:[(0,n.jsx)("mesh",{geometry:u,material:d.feather,children:(0,n.jsx)("pointLight",{color:"#F5F5DC",intensity:.3,distance:.8,decay:2})}),e.hasRedMarking&&(0,n.jsx)("mesh",{geometry:h,material:d.redMarking,position:[0,0,.01],children:(0,n.jsx)("pointLight",{color:"#FF0000",intensity:1.2,distance:1.2,decay:2})})]},"feather-".concat(t));return(0,n.jsx)("group",{ref:o,position:new a.Vector3(0,-.2,0),rotation:new a.Euler(0,0,0),children:p.slice(0,Math.min(p.length,Math.floor(1.2*t))).map((e,t)=>g(e,t))})}let E=()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.06,.016,.016]}),(0,n.jsx)("meshStandardMaterial",{color:"#aa0000",transparent:!0,opacity:.45,emissive:"#aa0000",emissiveIntensity:.5})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#aa0000",emissive:"#aa0000",emissiveIntensity:1.1,transparent:!0,opacity:.7})]})]});function F(e){let{parentRef:t}=e,r=(0,i.useRef)([]),a=(0,i.useRef)(null);return(0,o.F)(e=>{let{clock:n}=e;if(!t.current||!a.current)return;let i=t.current.position;a.current.position.set(i.x,0,i.z),r.current.forEach((e,t)=>{if(!e)return;let r=n.getElapsedTime(),i=t/28*.75,o=t/28*Math.PI*4+1.8*r,a=.5*(1.2-1.1*i),s=Math.cos(o)*a,l=Math.sin(o)*a;e.position.set(s,i,l),e.rotation.y=o+Math.PI/2,e.rotation.x=Math.PI/5,e.rotation.z=.12*Math.sin(2.5*r+t);let c=e.children[0];c&&c.material&&(c.material.opacity=Math.max(.15,1-1.8*i))})}),(0,n.jsxs)("group",{ref:a,children:[Array.from({length:28}).map((e,t)=>(0,n.jsx)("group",{ref:e=>{e&&(r.current[t]=e)},children:E()},t)),(0,n.jsx)("pointLight",{color:"#aa0000",intensity:.8,distance:3,decay:2,position:[0,.6,0]})]})}function R(){let e={roughness:.4,metalness:.3,transparent:!0,opacity:.95};return(0,n.jsx)("group",{children:[-.89,.89].map(t=>(0,n.jsxs)("group",{position:[.56*t,.625,-.75],rotation:[-1.35,0,3.025*t],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.0125,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",...e})]}),(0,n.jsxs)("group",{position:[0,1.35,-0],scale:1.6,rotation:[-.65,0,0],children:[[-.07,-.02,.02,.07].map((t,r)=>(0,n.jsx)("group",{position:[t,.125,-.15],rotation:[2,0,0],scale:[1,1.5,1.2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.02,.075,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",...e})]})},"upper-".concat(r))),[-.08,-.015,.015,.09].map((t,r)=>(0,n.jsx)("group",{position:[t,.01075,0],rotation:[-.45,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.025*(0===r||3===r?1.3:1),.095*(0===r||3===r?1.5:1),3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",...e})]})},"lower-".concat(r)))]}),(0,n.jsxs)("group",{position:[0,.4,.2],rotation:[-.05,0,.3*t],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.008,.8,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#c4c4c4",...e})]}),[void 0,void 0,void 0,void 0,void 0].map((r,i)=>(0,n.jsx)("group",{position:[.02*t,.095*i,.07],rotation:[Math.PI/1.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.0325,.1,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#b4b4b4",...e})]})},i))]}),(0,n.jsx)("group",{position:[0,1.0225,.3],rotation:[-.925,0,.5*t],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.07,.0075,.6,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#b4b4b4",...e})]})})]},t))})}var A=e=>{let{parentRef:t}=e,r=(0,i.useRef)(null),s=(0,i.useRef)(new Float32Array(3)),l=(0,i.useRef)(new Float32Array(1)),c=(0,i.useRef)(new Float32Array(1)),d=(0,i.useRef)(0);return(0,o.F)((e,n)=>{var i;if(!(null===(i=r.current)||void 0===i?void 0:i.parent)||!t.current)return;d.current+=n;let o=t.current.position;for(let e=0;e<1;e++){let t=e/1*Math.PI*2+.8*d.current,r=.15+.12*Math.sin(1.5*d.current+.3*e);s.current[3*e]=o.x+Math.cos(t)*r,s.current[3*e+1]=o.y+2e-4*Math.sin(.8*d.current+.15*e),s.current[3*e+2]=o.z+Math.sin(t)*r,l.current[e]=.35*Math.pow(1-e/1,1.2),c.current[e]=.5*Math.pow(1-e/1,.5)}if(r.current){let e=r.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:r,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:1,array:s.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:1,array:l.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:1,array:c.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:a.AdditiveBlending,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 24.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.9, 0.0, 0.0), vec3(1.0, 0.3, 0.3), 0.5);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};let T=new a.MeshStandardMaterial({color:"#e0e0e0",roughness:.3,metalness:.4}),B=new a.MeshStandardMaterial({color:"#c8c8c8",roughness:.2,metalness:.5}),k=new a.SphereGeometry(.08,8,8),z=new a.CylinderGeometry(.08,.064,1.3,6),V=new a.ConeGeometry(.04,.2,8);function G(e){let{isRaised:t=!1}=e,r=(0,i.useRef)(null);(0,o.F)((e,n)=>{if(!r.current)return;let i=r.current.rotation.x;r.current.rotation.x=a.MathUtils.lerp(i,t?-Math.PI/2.5:0,4*n)});let s=(e,t)=>(0,n.jsx)("mesh",{geometry:z,material:T,scale:[t/.08,e/1.3,t/.08]}),l=e=>(0,n.jsx)("mesh",{geometry:k,material:T,scale:[e/.08,e/.08,e/.08]}),c=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:s(e,.08)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:s(e,.08)}),(0,n.jsx)("group",{position:[0,e/2,0],children:l(.1)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:l(.1)})]});return(0,n.jsx)("group",{ref:r,children:(0,n.jsxs)("group",{children:[c(1.3,.2),(0,n.jsxs)("group",{position:[0,-.8,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.16,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#e0e0e0",roughness:.3,metalness:.4})]}),(0,n.jsxs)("group",{position:[0,-.45,.35],rotation:[-.8,0,0],children:[c(1,.16),(0,n.jsxs)("group",{position:[0,-.6,0],rotation:[0,0,0],children:[l(.12),(0,n.jsxs)("group",{position:[0,-.12,0],scale:[1.5,1.5,1.5],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.25,.2,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e0e0e0",roughness:.3})]}),[-.1,-.05,0,.05,.1].map((e,t)=>(0,n.jsxs)("group",{position:[e,-.12,0],rotation:[0,0,(t-2)*Math.PI/8],children:[s(.6,.025),(0,n.jsx)("group",{position:[.03,-.35,0],rotation:[0,0,Math.PI/6],scale:[1.4,1.4,1.4],children:(0,n.jsx)("mesh",{geometry:V,material:B})})]},t)),t&&(0,n.jsxs)("group",{position:[0,-.06,.12],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,10,10]}),(0,n.jsx)("meshStandardMaterial",{color:"#AA0000",emissive:"#AA0000",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsx)("pointLight",{color:"#AA0000",intensity:2.5,distance:3,decay:2})]})]})]})]})]})]})})}function N(e){let{isAttacking:t,attackingHand:r=null,onLightningStart:s,health:l=1}=e,c=(0,i.useRef)(null),d=(0,i.useRef)(0);return(0,o.F)((e,n)=>{c.current&&(t&&r?(d.current+=3*n,d.current>Math.PI/4&&d.current<Math.PI/3&&s&&s(r),d.current>=Math.PI&&(d.current=0)):d.current=0)}),(0,n.jsxs)("group",{ref:c,scale:[1.275,1.275,1.275],children:[" ",(0,n.jsx)("group",{scale:[.65,.65,.65],position:[0,1.45,.2],rotation:[.5,0,0],children:(0,n.jsx)(R,{})}),(0,n.jsx)("group",{scale:[1.1,1,.9],position:[0,1.45,0],rotation:[.3,0,0],children:(0,n.jsx)(P.Z,{})}),(0,n.jsxs)("group",{scale:[1.175,1.275,-.9],position:[0,.775,0],children:[(0,n.jsx)("group",{rotation:[0,Math.PI/5,0],children:(0,n.jsx)(D,{collectedBones:15,isLeftWing:!0,parentRef:c})}),(0,n.jsx)("group",{rotation:[0,-Math.PI/5,0],children:(0,n.jsx)(D,{collectedBones:15,isLeftWing:!1,parentRef:c})})]}),(0,n.jsx)("group",{scale:[1.2,1.2,1.2],position:[0,1.35,0],children:(0,n.jsx)(I.Z,{})}),(0,n.jsx)("group",{position:[0,1,0],scale:[.25,.25,.25],children:(0,n.jsx)(A,{parentRef:c})}),(0,n.jsx)("group",{position:[0,1.5,.25],scale:[.4,.4,.4],children:(0,n.jsx)(A,{parentRef:c})}),(0,n.jsx)("group",{position:[0,1.8,.35],scale:[.4,.4,.4],children:(0,n.jsx)(A,{parentRef:c})}),(0,n.jsxs)("group",{scale:[1.45,1.9,1.45],position:[0,-.25,0],children:[(0,n.jsx)("group",{position:[0,0,.1],rotation:[0,0,0],children:(0,n.jsx)(F,{parentRef:c})}),(0,n.jsx)("group",{position:[0,0,-.1],rotation:[0,Math.PI,0],children:(0,n.jsx)(F,{parentRef:c})})]}),(0,n.jsx)("group",{position:[-.5,1.4,.1],rotation:[0,Math.PI/6,0],scale:[.35,.35,.35],children:(0,n.jsx)(G,{isRaised:t&&"left"===r})}),(0,n.jsx)("group",{position:[.5,1.4,.1],rotation:[0,-Math.PI/6,0],scale:[.45,.375,.45],children:(0,n.jsx)(G,{isRaised:t&&"right"===r})}),(0,n.jsxs)("mesh",{position:[-.5,1.7,.125],children:[(0,n.jsx)("sphereGeometry",{args:[.2,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#CC0000",emissive:"#FF0000",emissiveIntensity:.4,transparent:!0,opacity:.9,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[-.5,1.7,.125],rotation:[Math.PI/2,-Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.25,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF4444",emissive:"#FF0000",emissiveIntensity:.6,transparent:!0,opacity:.95,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{position:[.5,1.7,.125],children:[(0,n.jsx)("sphereGeometry",{args:[.2,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#CC0000",emissive:"#FF0000",emissiveIntensity:.4,transparent:!0,opacity:.9,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[.5,1.7,.125],rotation:[Math.PI/2,Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.25,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF4444",emissive:"#FF0000",emissiveIntensity:.6,transparent:!0,opacity:.95,metalness:.8,roughness:.2})]}),(0,n.jsx)("group",{position:[0,1.2,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.8,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#440000",emissive:"#660000",emissiveIntensity:.5,transparent:!0,opacity:.15,blending:a.AdditiveBlending})]})}),l<.5&&(0,n.jsx)("group",{position:[0,1.2,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.6,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF0000",emissive:"#FF0000",emissiveIntensity:1.2,transparent:!0,opacity:.25,blending:a.AdditiveBlending})]})})]})}function W(e){let{entityId:t,position:r,world:a,onMeshReady:s}=e,l=(0,i.useRef)(null),d=(0,i.useRef)(0),h=(0,i.useRef)(!1),p=(0,i.useRef)(null),g=(0,i.useRef)(1),m=(0,i.useRef)(!1);return(0,o.F)((e,r)=>{if(d.current+=r,l.current){let e=a.getEntity(t);if(e){let t=e.getComponent(c.w),r=e.getComponent(u.S),n=e.getComponent(C.C);if(t&&l.current.position.copy(t.position),r&&(g.current=r.currentHealth/r.maxHealth),n){m.current=n.isDead;let e=Date.now()/1e3-n.lastAttackTime,t=Math.sin(.3*d.current)>.8;h.current=e<1||t,h.current?p.current=Math.sin(.6*d.current)>0?"left":"right":p.current=null}}m.current?l.current.visible=!1:(l.current.visible=!0,l.current.position.y+=.15*Math.sin(1.5*d.current),h.current||(l.current.rotation.y+=.3*r))}}),(0,i.useEffect)(()=>{l.current&&s&&s(l.current)},[s]),(0,n.jsx)("group",{ref:l,children:(0,n.jsx)(N,{isAttacking:h.current,attackingHand:p.current,onLightningStart:e=>{console.log("\uD83C\uDF29️ Boss lightning attack from ".concat(e," hand!"))},health:g.current})})}var L=r(3680),O=r(6520),H=e=>{let{parentRef:t}=e,r=(0,i.useRef)(null),s=(0,i.useRef)(new Float32Array(18)),l=(0,i.useRef)(new Float32Array(6)),c=(0,i.useRef)(new Float32Array(6)),d=(0,i.useRef)(0);return(0,o.F)((e,n)=>{var i;if(!(null===(i=r.current)||void 0===i?void 0:i.parent)||!t.current)return;d.current+=n;let o=t.current.position;for(let e=0;e<6;e++){let t=Math.acos(-1+2*e/6),r=Math.sqrt(6*Math.PI)*t+d.current,n=.5+.08*Math.sin(2*d.current+.3*e);s.current[3*e]=o.x+n*Math.cos(r)*Math.sin(t),s.current[3*e+1]=o.y+n*Math.sin(r)*Math.sin(t),s.current[3*e+2]=o.z+n*Math.cos(t),l.current[e]=.25*Math.pow(1-e/6,1.2),c.current[e]=.3*Math.pow(1-e/6,.5)}if(r.current){let e=r.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:r,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:6,array:s.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:6,array:l.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:6,array:c.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:a.AdditiveBlending,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z); // Smaller point size\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.25, 0.41, 0.88), vec3(0.53, 0.81, 0.92), 0.4); // More vibrant blue glow for grunt\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};let _=new a.Matrix4,U=new a.Vector3,Z=new a.Euler,q=new a.Vector3,Y=new a.Quaternion;function Q(e,t,r,n,i){Y.setFromEuler(n),_.compose(r,Y,i),e.setMatrixAt(t,_)}let J={sphere:new a.SphereGeometry(.02,8,8),cylinder:new a.CylinderGeometry(.04,.032,1,4),cone:new a.ConeGeometry(.02,.15,4),box:new a.BoxGeometry(.2,.15,.08),vertebrae:new a.CylinderGeometry(.0225,.0225,.03,6),eye:new a.SphereGeometry(.02,8,8),eyeGlow:new a.SphereGeometry(.035,8,8),eyeOuterGlow:new a.SphereGeometry(.05,6.5,2)},K={standardBone:new a.MeshStandardMaterial({color:"#e8e8e8",roughness:.4,metalness:.3}),darkBone:new a.MeshStandardMaterial({color:"#d4d4d4",roughness:.3,metalness:.4}),eyeCore:new a.MeshStandardMaterial({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:3}),eyeGlow:new a.MeshStandardMaterial({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1,transparent:!0,opacity:.75}),eyeOuterGlow:new a.MeshStandardMaterial({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1,transparent:!0,opacity:.7})};function $(){let e=(0,i.useMemo)(()=>{let e=new a.InstancedMesh(J.vertebrae,K.standardBone,5);return e.instanceMatrix.setUsage(a.DynamicDrawUsage),e},[]);return(0,i.useEffect)(()=>{[.15,.27,.39,.51,.63].forEach((t,r)=>{U.set(0,t,0),Z.set(.1,0,0),q.set(1,1,1),Q(e,r,U,Z,q)}),e.instanceMatrix.needsUpdate=!0},[e]),(0,n.jsx)("primitive",{object:e})}function X(e){let{position:t}=e,r=(0,i.useMemo)(()=>({core:new a.InstancedMesh(J.eye,K.eyeCore,1),innerGlow:new a.InstancedMesh(J.eyeGlow,K.eyeGlow,1),outerGlow:new a.InstancedMesh(J.eyeOuterGlow,K.eyeOuterGlow,1)}),[]);return(0,i.useEffect)(()=>{U.set(...t),Z.set(0,0,0),Q(r.core,0,U,Z,q.set(1,1,1)),Q(r.innerGlow,0,U,Z,q.set(1.2,1.2,1.2)),Q(r.outerGlow,0,U,Z,q.set(1.4,1.4,1.4)),Object.values(r).forEach(e=>{e.instanceMatrix.needsUpdate=!0})},[r,t]),(0,n.jsxs)("group",{children:[(0,n.jsx)("primitive",{object:r.core}),(0,n.jsx)("primitive",{object:r.innerGlow}),(0,n.jsx)("primitive",{object:r.outerGlow}),(0,n.jsx)("pointLight",{color:"#4169E1",intensity:.5,distance:1,decay:2,position:t})]})}function ee(){let e=(e,t)=>(0,n.jsx)("mesh",{geometry:J.cylinder,material:K.standardBone,scale:[t/.04,e,t/.04]}),t=e=>(0,n.jsx)("mesh",{geometry:J.sphere,material:K.standardBone,scale:[e/.06,e/.06,e/.06]});return(0,n.jsxs)("group",{children:[t(.08),(0,n.jsxs)("group",{rotation:[.3,0,0],children:[e(.4,.07),(0,n.jsxs)("group",{position:[0,-.2,0],children:[t(.09),(0,n.jsxs)("group",{position:[0,0,-.5],children:[e(.8,.06),(0,n.jsxs)("group",{position:[0,-.4,0],children:[t(.05),(0,n.jsxs)("group",{position:[0,0,0],children:[e(.9,.04),(0,n.jsxs)("group",{position:[0,-.45,0],children:[t(.04),(0,n.jsxs)("group",{position:[0,0,0],children:[e(.7,.03),(0,n.jsx)("group",{position:[0,-.35,0],children:(0,n.jsx)("mesh",{geometry:J.cone,material:K.darkBone})})]})]})]})]})]})]})]})]})}function et(e){let{isLeftHand:t=!1}=e,r=(e,t)=>(0,n.jsx)("mesh",{geometry:J.cylinder,material:K.standardBone,scale:[t/.04,e,t/.04]}),i=e=>(0,n.jsx)("mesh",{geometry:J.sphere,material:K.standardBone,scale:[e/.06,e/.06,e/.06]}),o=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[0,e/2,0],children:i(.08)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:i(.08)})]}),s=(()=>{let e=new a.Shape;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})();return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[o(1.3,.15),(0,n.jsxs)("group",{position:[.25,-.85,.21],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[o(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[i(.09),(0,n.jsxs)("group",{position:[0,.1,0],children:[(0,n.jsxs)("group",{position:[-0,-.2,.2],rotation:[2+Math.PI/4,-1,2.675*Math.PI+.85],scale:[1.4,.55,1.4],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[s,{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16}]}),(0,n.jsx)("meshStandardMaterial",{color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:a.DoubleSide})]}),(0,n.jsx)("pointLight",{color:"#4169E1",intensity:1,distance:2,decay:2})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,n.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[r(.5,.02),(0,n.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t))]})]})]})]})]})})}function er(){let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,n.jsxs)("group",{scale:[e,e,e],position:[0,-.125,0],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.06,.115,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.1,.0275],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.03,.12,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.2,.04],rotation:[.2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.04,.175,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),[0,Math.PI/2,Math.PI,3*Math.PI/2].map((e,t)=>(0,n.jsx)("group",{rotation:[0,e,0],children:(0,n.jsxs)("mesh",{position:[.04,.05,0],children:[(0,n.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.5,metalness:.3})]})},t))]})};return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.185,.2,.225,4,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,.25,0],rotation:[2*Math.PI,Math.PI/3,0],children:[(0,n.jsx)("group",{position:[0,0,0],rotation:[0,0,0],children:e(1.5)}),(0,n.jsx)("group",{position:[0,-.05,.15],rotation:[-.2,0,0],children:e(1.1)}),(0,n.jsx)("group",{position:[0,-.05,-.15],rotation:[.2,0,0],children:e(1.1)})]})]})}function en(e){let{isLeft:t=!1}=e,r=1.2*Math.PI;return(0,n.jsx)("group",{rotation:[-.25,t?-.3:.3,t?-.4:.4],children:Array.from({length:10}).map((e,i)=>{let o=i/9,a=.15*(1-.8*o),s=1.4*Math.pow(o,1.3);return(0,n.jsxs)("group",{position:[s*(t?-.15:.15),.12*i,-(.6*s)],rotation:[-.8*o,Math.pow(o,1.2)*r,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[a,.92*a,.12,4]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*o,", ").concat(0+20*o,", ").concat(0+20*o,")"),roughness:.7,metalness:.4})]}),Array.from({length:4}).map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI*2/4,0],children:(0,n.jsxs)("mesh",{position:[.95*a,0,0],children:[(0,n.jsx)("boxGeometry",{args:[.4*a,.132,.2*a]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*o,", ").concat(20+20*o,", ").concat(20+20*o,")"),roughness:.8,metalness:.3})]})},t))]},i)})})}function ei(e){let{isAttacking:t,isWalking:r}=e,a=(0,i.useRef)(null),[s,l]=(0,i.useState)(0),[c,d]=(0,i.useState)(0),u=(0,i.useRef)(),h=[{left:"LeftFrontLeg",right:"RightFrontLeg",baseRotation:{x:.2,y:-.6,z:.6},rightBaseRotation:{x:.2,y:.6,z:-.6},phase:0},{left:"LeftMiddleFrontLeg",right:"RightMiddleFrontLeg",baseRotation:{x:.25,y:-.8,z:.7},rightBaseRotation:{x:.25,y:.8,z:-.7},phase:Math.PI},{left:"LeftMiddleBackLeg",right:"RightMiddleBackLeg",baseRotation:{x:.5,y:-1,z:.7},rightBaseRotation:{x:.5,y:1,z:-.7},phase:0},{left:"LeftBackLeg",right:"RightBackLeg",baseRotation:{x:1,y:-1.2,z:.6},rightBaseRotation:{x:1,y:1.2,z:-.6},phase:Math.PI}];return(0,o.F)((e,n)=>{if(!a.current)return;let i=a.current;if(r){let e=(s+7*n)%(2*Math.PI);l(e),["LeftFrontLeg","RightFrontLeg","LeftMiddleFrontLeg","RightMiddleFrontLeg","LeftMiddleBackLeg","RightMiddleBackLeg","LeftBackLeg","RightBackLeg"].forEach((t,r)=>{let n=i.getObjectByName(t);if(n){var o,a;t.includes("Right");let i=e+(r%2==0?0:Math.PI);n.rotation.x=.2*Math.cos(i),n.position.y=.6+.3*Math.max(0,Math.sin(i));let s=null===(o=n.children[0])||void 0===o?void 0:o.children[1],l=null==s?void 0:null===(a=s.children[1])||void 0===a?void 0:a.children[1];if(s&&l){let e=i+Math.PI/4;s.rotation.x=.4*Math.sin(e)-.2,l.rotation.x=-(.6*Math.sin(e))-.3}}})}if(t){d(e=>e+3*n);let e=[{left:"LeftLowerBackArm",right:"RightLowerBackArm",startTime:.65,rotationRange:.5*Math.PI},{left:"LeftMiddleBackArm",right:"RightMiddleBackArm",startTime:.95,rotationRange:.5*Math.PI},{left:"LeftUpperBackArm",right:"RightUpperBackArm",startTime:1.25,rotationRange:.5*Math.PI},{left:"LeftFrontArm",right:"RightFrontArm",startTime:1.55,rotationRange:.5*Math.PI}];e.forEach(e=>{let{left:t,right:r,startTime:n,rotationRange:o}=e,a=i.getObjectByName(t),s=i.getObjectByName(r);if(a&&s){let e=Math.max(0,Math.min(1,(c-n)*1)),t=Math.sin(e*Math.PI)*o,r=.5*Math.sin(e*Math.PI);a.rotation.y=4*Math.PI+t,s.rotation.y=4*Math.PI-t,a.rotation.z=r,s.rotation.z=r}}),c>2.45&&(d(0),e.forEach(e=>{let{left:t,right:r}=e,n=i.getObjectByName(t),o=i.getObjectByName(r);n&&o&&(n.rotation.z=0,o.rotation.z=0)}))}else[{left:"LeftLowerBackArm",right:"RightLowerBackArm",y:4.2*Math.PI},{left:"LeftMiddleBackArm",right:"RightMiddleBackArm",y:4.1*Math.PI},{left:"LeftUpperBackArm",right:"RightUpperBackArm",y:4*Math.PI},{left:"LeftFrontArm",right:"RightFrontArm",y:4.9*Math.PI}].forEach(e=>{let{left:t,right:r,y:n}=e,o=i.getObjectByName(t),a=i.getObjectByName(r);o&&a&&(o.rotation.y=n,a.rotation.y=-n)});t||h.forEach(t=>{let{left:r,right:n,baseRotation:o,rightBaseRotation:a,phase:s}=t,l=i.getObjectByName(r),c=i.getObjectByName(n);if(l&&c){let t=3*e.clock.getElapsedTime(),r=Math.sin(t+s),n=Math.sin(t+s+Math.PI);l.rotation.set(o.x+.15*r,o.y+.045*r,o.z+.075*r),c.rotation.set(a.x+.15*n,a.y+.045*n,a.z+.075*n)}})}),(0,i.useEffect)(()=>{let e=u.current;return()=>{e&&clearTimeout(e)}},[]),(0,n.jsxs)("group",{ref:a,scale:[1.1,1.3,1.3],children:[(0,n.jsx)("group",{position:[0,1.375,-0],children:(0,n.jsx)(H,{parentRef:a})}),(0,n.jsx)("group",{name:"Body",position:[0,1.2,-.25],scale:[1.8,1.4,1.65],rotation:[.25,0,0],children:(0,n.jsx)(P.Z,{})}),(0,n.jsx)("group",{scale:[.7,.7,.7],position:[0,1.25,-.1],rotation:[.25,0,0],children:(0,n.jsx)(R,{})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,1.3,-.3],rotation:[1,0,-4.25],children:(0,n.jsx)(en,{isLeft:!0})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,1.3,-.3],rotation:[1,0,4.25],children:(0,n.jsx)(en,{isLeft:!1})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,.7,-.6],rotation:[1,0,-4.25],children:(0,n.jsx)(en,{isLeft:!0})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,.7,-.6],rotation:[1,0,4.25],children:(0,n.jsx)(en,{isLeft:!1})}),(0,n.jsxs)("group",{name:"Head",position:[0,1.925,.2],scale:[.95,.8,.8],children:[(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[0,0,-.05],children:[(0,n.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,n.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,n.jsx)("group",{position:[0,-.15,.05],children:(0,n.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,n.jsx)("group",{position:[.025,-.25,.2175],children:[-.03,-.06,-.09,-0,.03].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.075,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))}),(0,n.jsx)("group",{position:[0,-.18,.2],children:[-.06,-.02,.02,.06].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[2.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.01,.08,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))})]}),(0,n.jsxs)("group",{position:[0,.05,.14],children:[(0,n.jsx)(X,{position:[-.07,0,0]}),(0,n.jsx)(X,{position:[.07,0,0]})]})]}),(0,n.jsx)("group",{position:[-.55,1.8,.05],rotation:[-.45,-Math.PI/1.2,-.525],children:(0,n.jsx)(er,{})}),(0,n.jsx)("group",{position:[.55,1.8,.05],rotation:[-.45,Math.PI/1.2,.525],children:(0,n.jsx)(er,{})}),(0,n.jsx)("group",{name:"LeftFrontArm",position:[-.4,1.525,.1],scale:[-.525,.425,.525],rotation:[.2,Math.PI/3,0],children:(0,n.jsx)(et,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightFrontArm",position:[.4,1.525,.1],scale:[.525,.425,.525],rotation:[.2,-Math.PI/3,0],children:(0,n.jsx)(et,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftUpperBackArm",position:[-.55,1.6,0],scale:[-1.1,.7,.9],rotation:[0,2*Math.PI,-.4],children:(0,n.jsx)(et,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightUpperBackArm",position:[.55,1.6,0],scale:[1.1,.7,.9],rotation:[0,-(2*Math.PI),.4],children:(0,n.jsx)(et,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftMiddleBackArm",position:[-.45,1.5,-.1],scale:[-.75,.75,.75],rotation:[.4,2.1*Math.PI,-.4],children:(0,n.jsx)(et,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightMiddleBackArm",position:[.45,1.5,-.1],scale:[.75,.75,.75],rotation:[.4,-(2.1*Math.PI),.4],children:(0,n.jsx)(et,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftLowerBackArm",position:[-.35,1.4,-.2],scale:[-.6,.6,.6],rotation:[.6,2.2*Math.PI,-.3],children:(0,n.jsx)(et,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightLowerBackArm",position:[.35,1.4,-.2],scale:[.6,.6,.6],rotation:[.6,-(2.2*Math.PI),.3],children:(0,n.jsx)(et,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftFrontLeg",position:[.4,.75,.4],rotation:[.2,-.6,.6],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"RightFrontLeg",position:[-.4,.75,.4],rotation:[.2,.6,-.6],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"LeftMiddleFrontLeg",position:[.6,.73,0],rotation:[.25,-.8,.7],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"RightMiddleFrontLeg",position:[-.6,.73,0],rotation:[.25,.8,-.7],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"LeftMiddleBackLeg",position:[.5,.71,-.35],rotation:[.5,-1,.7],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"RightMiddleBackLeg",position:[-.5,.71,-.35],rotation:[.5,1,-.7],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"LeftBackLeg",position:[.4,.7,-.725],rotation:[1,-1.2,.6],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"RightBackLeg",position:[-.4,.7,-.725],rotation:[1,1.2,-.6],children:(0,n.jsx)(ee,{})}),(0,n.jsxs)("group",{position:[0,1.925,.245],scale:[.405,.425,.275],children:[(0,n.jsx)("group",{position:[.2,.2,0],rotation:[-.4,.5,-.2],children:(0,n.jsx)(en,{isLeft:!0})}),(0,n.jsx)("group",{position:[-.2,.2,0],rotation:[-.3,-.5,.3],children:(0,n.jsx)(en,{isLeft:!1})})]}),(0,n.jsxs)("group",{position:[0,.5,-.25],scale:[1.9,1,1.75],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.35,.34,.27,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsx)("group",{position:[0,.15,-.16],rotation:[.1,0,0],children:(0,n.jsx)($,{})}),[-1,1].map(e=>(0,n.jsx)("group",{position:[.15*e,-.1,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]})]})}let eo=new O.L(()=>({sphere:new a.SphereGeometry(.3,12,12),cylinder:new a.CylinderGeometry(.12,.12,.8,4),cone:new a.ConeGeometry(.06,.25,4),box:new a.BoxGeometry(.15,.12,.06)}),e=>{},5),ea=new O.L(()=>({body:new a.MeshStandardMaterial({color:"#4169E1",emissive:"#1E3A8A",emissiveIntensity:.2,transparent:!0,opacity:.85,metalness:.6,roughness:.3}),bone:new a.MeshStandardMaterial({color:"#e8e8e8",emissive:"#d4d4d4",emissiveIntensity:.1,transparent:!0,opacity:.9,metalness:.3,roughness:.4}),claw:new a.MeshStandardMaterial({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.7,roughness:.2})}),e=>{Object.values(e).forEach(e=>{e.needsUpdate=!0})},5);function es(e){let{entityId:t,world:r,onMeshReady:s}=e,l=(0,i.useRef)(null),d=(0,i.useRef)(new a.Vector3),h=(0,i.useRef)(1),p=(0,i.useRef)(!1),g=(0,i.useRef)(!1),m=(0,i.useRef)(!1),f=(0,i.useRef)(0),{geometries:y,materials:x}=(0,i.useMemo)(()=>({geometries:eo.acquire(),materials:ea.acquire()}),[]);return(0,o.F)((e,n)=>{f.current+=n;let i=r.getEntity(t);if(!i)return;let o=i.getComponent(c.w),a=i.getComponent(u.S),s=i.getComponent(C.C);if(o&&l.current&&(d.current.copy(o.position),l.current.position.copy(o.position)),a&&(h.current=a.currentHealth/a.maxHealth),s){p.current=s.isDead;let e=Date.now()/1e3-s.lastAttackTime,t=Math.sin(.5*f.current)>.9;g.current=e<.8||t;let r=d.current.clone();if(o){let e=r.distanceTo(o.position);m.current=e>.01}}p.current&&l.current?l.current.visible=!1:l.current&&(l.current.visible=!0)}),(0,i.useEffect)(()=>{l.current&&s&&s(l.current)},[s]),(0,i.useEffect)(()=>()=>{eo.release(y),ea.release(x)},[y,x]),(0,i.useEffect)(()=>{let e=Math.max(.4,h.current);x.body.opacity=.85*e,x.bone.opacity=.9*e,x.claw.opacity=.9*e;let t=Math.max(.3,h.current);x.body.emissiveIntensity=.2*t,x.claw.emissiveIntensity=.8*t},[x,h.current]),(0,n.jsx)("group",{ref:l,children:(0,n.jsx)(ei,{isAttacking:g.current,isWalking:m.current,onHit:e=>{console.log("\uD83D\uDDE1️ Grunt hit for ".concat(e," damage!"))}})})}function el(e){let{world:t,maxInstances:r=200}=e,a=(0,i.useRef)({boss:[],elite:[],grunt:[]});return(0,o.F)(()=>{if(!t)return;let e=performance.now(),r=performance.now(),n=t.queryEntities([C.C,c.w]),i=[],o=[],s=[];for(let e of n){let t=e.getComponent(C.C);if(t)switch(t.type){case C.Z.BOSS:i.push(e.id);break;case C.Z.ELITE:o.push(e.id);break;case C.Z.GRUNT:s.push(e.id)}}if(a.current={boss:i,elite:o,grunt:s},Math.floor(e/16.67)%60==0){let e=performance.now()-r,t=i.length+o.length+s.length;t>0&&console.log("\uD83C\uDFAD Original Models: ".concat(t," enemies (").concat(i.length," bosses, ").concat(o.length," elites, ").concat(s.length," grunts) rendered in ").concat(e.toFixed(2),"ms"))}}),(0,n.jsxs)(n.Fragment,{children:[a.current.boss.map(e=>{let r=t.getEntity(e);if(!r)return null;let i=r.getComponent(c.w);return i?(0,n.jsx)(W,{entityId:e,position:i.position,world:t},e):null}),a.current.elite.map(e=>{let r=t.getEntity(e);if(!r)return null;let i=r.getComponent(c.w);return i?(0,n.jsx)(L.Z,{entityId:e,position:i.position,world:t},e):null}),a.current.grunt.map(e=>{let r=t.getEntity(e);return r&&r.getComponent(c.w)?(0,n.jsx)(es,{entityId:e,world:t},e):null})]})}function ec(e){let{world:t}=e;return(0,n.jsx)(el,{world:t,maxInstances:200})}var ed=r(7057),eu=r(6932),eh=r(7019),ep=r(9709),eg=r(1151),em=r(5050),ef=r(5658),ey=r(4244);function ex(){var e;let{onDamageNumbersUpdate:t,onDamageNumberComplete:r,onCameraUpdate:C,onGameStateUpdate:I,onControlSystemUpdate:P}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{scene:D,camera:E,gl:F,size:R}=(0,o.D)(),A=(0,i.useRef)(null),T=(0,i.useRef)(null),B=(0,i.useRef)(null),k=(0,i.useRef)(null),z=(0,i.useRef)(!1),[V,G]=(0,i.useState)(new a.Vector3(0,.5,0)),[N,W]=(0,i.useState)(null),[L,O]=(0,i.useState)({currentWeapon:S.v.BOW,currentSubclass:S.p.ELEMENTAL,isCharging:!1,chargeProgress:0,isSwinging:!1,isSpinning:!1,swordComboStep:1,isDivineStorming:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1}),{createPowershotEffect:H}=(0,ey.sf)();return(0,i.useEffect)(()=>{if(z.current)return;z.current=!0,(0,em.j4)(0),(0,em.Ge)(0);let e=new l.D({enableDebug:!0});A.current=e;let t=F.domElement;return e.initialize(t).then(()=>{let{player:t,controlSystem:r}=function(e,t,r,n){let i=e.getWorld(),o=e.getInputManager();n.shadowMap.enabled=!0,n.shadowMap.type=a.PCFSoftShadowMap;let s=new x.F,l=new M.s(5),S=new v.b(i),b=new g.K(t,r,n),C=new j.C(t,r),I=new y.c(i),P=new m.s(r,o,i,I),D=new f.D(r,o,{distance:8,height:2,mouseSensitivity:.005,smoothing:.15});I.setCombatSystem(S),i.addSystem(s),i.addSystem(l),i.addSystem(S),i.addSystem(b),i.addSystem(C),i.addSystem(I),i.addSystem(P),i.addSystem(D);let E=function(e){let t=e.createEntity(),r=e.createComponent(c.w);r.setPosition(0,.5,0),t.addComponent(r);let n=e.createComponent(d.i);n.maxSpeed=3.75,n.jumpForce=8,n.friction=.85,t.addComponent(n);let i=new u.S(500);i.enableRegeneration(1,5),t.addComponent(i);let o=new h.W(200,20,5);t.addComponent(o);let a=e.createComponent(p.YM);return a.type=p.F5.SPHERE,a.radius=1,a.layer=p.aB.PLAYER,a.setOffset(0,.5,0),t.addComponent(a),t}(i);P.setPlayer(E),D.setTarget(E),D.snapToTarget();let F=new w.R(i,{enableObjectPooling:!0,enableHealthBars:!0,healthBarConfig:{showWhenFull:!0,fadeDistance:20}});return F.createTrainingDummy(new a.Vector3(5,0,5)),F.createElite(new a.Vector3(-8,0,8),2),F.createElite(new a.Vector3(8,0,3),2),{player:E,controlSystem:P}}(e,D,E,F);W(t),T.current=t.id,B.current=r,P&&P(r),r.setBowReleaseCallback((t,n)=>{if(n){let t=e.getWorld().getEntity(T.current);if(t){let e=t.getComponent(c.w);if(e){let t=new a.Vector3;E.getWorldDirection(t),t.normalize();let n=new a.Vector3;n.crossVectors(t,new a.Vector3(0,1,0)).normalize();let i=new a.Matrix4;i.makeRotationAxis(n,Math.PI/12),t.applyMatrix4(i),t.normalize(),H(e.position.clone(),t,r.getCurrentSubclass(),!0,!0)}}}}),r.setViperStingCallback((e,t)=>{}),r.setBarrageCallback((e,t)=>{}),r.setDivineStormCallback((e,t,r)=>{(0,ep.e6)(e,"local-player",r)}),r.setReanimateCallback(()=>{k.current&&k.current.triggerHealingEffect()}),r.setSkyfallCallback((e,t)=>{}),e.start()}),()=>{A.current&&A.current.destroy()}},[D,E,F]),(0,o.F)((e,r)=>{if(A.current&&A.current.isEngineRunning()){if(function(e){let t=document.getElementById("fps-counter");t&&(t.textContent="FPS: ".concat(e))}(A.current.getCurrentFPS()),N){let e=N.getComponent(c.w);e&&e.position&&G(e.position.clone())}B.current&&O({currentWeapon:B.current.getCurrentWeapon(),currentSubclass:B.current.getCurrentSubclass(),isCharging:B.current.isWeaponCharging(),chargeProgress:B.current.getChargeProgress(),isSwinging:B.current.isWeaponSwinging(),isSpinning:B.current.isWeaponCharging()&&B.current.getCurrentWeapon()===S.v.SCYTHE,swordComboStep:B.current.getSwordComboStep(),isDivineStorming:B.current.isDivineStormActive(),isSwordCharging:B.current.isChargeActive(),isDeflecting:B.current.isDeflectActive(),isViperStingCharging:B.current.isViperStingChargingActive(),viperStingChargeProgress:B.current.getViperStingChargeProgress(),isBarrageCharging:B.current.isBarrageChargingActive(),barrageChargeProgress:B.current.getBarrageChargeProgress(),isCobraShotCharging:B.current.isCobraShotChargingActive(),cobraShotChargeProgress:B.current.getCobraShotChargeProgress(),isSkyfalling:B.current.isSkyfallActive(),isBackstabbing:B.current.isBackstabActive()});let e=A.current.getWorld().getSystem(v.b);if(e&&t&&t(e.getDamageNumbers()),C&&C(E,R),I&&N&&B.current){let e=N.getComponent(u.S),t=N.getComponent(h.W);e&&I({playerHealth:e.currentHealth,maxHealth:e.maxHealth,playerShield:t?t.currentShield:0,maxShield:t?t.maxShield:0,currentWeapon:B.current.getCurrentWeapon(),currentSubclass:B.current.getCurrentSubclass()})}}}),i.useEffect(()=>{r&&(window.handleDamageNumberComplete=e=>{var t;let r=null===(t=A.current)||void 0===t?void 0:t.getWorld().getSystem(v.b);r&&r.removeDamageNumber(e)})},[r]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ef.Z,{level:1,world:null===(e=A.current)||void 0===e?void 0:e.getWorld()}),(0,n.jsx)("ambientLight",{intensity:.225}),(0,n.jsx)("directionalLight",{position:[10,10,5],intensity:.5,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),(0,n.jsxs)("mesh",{receiveShadow:!0,position:[0,-.5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[29,29,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#2d5a2d"})]}),(0,n.jsxs)("mesh",{position:[0,.01,0],children:[(0,n.jsx)("ringGeometry",{args:[28.5,29,64]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6b6b",transparent:!0,opacity:.3})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[5,1,5],children:[(0,n.jsx)("boxGeometry",{args:[2,2,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#8b4513"})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[-5,1,-5],children:[(0,n.jsx)("boxGeometry",{args:[2,2,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#8b4513"})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[0,1,-10],children:[(0,n.jsx)("boxGeometry",{args:[4,2,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#696969"})]}),N&&A.current&&(0,n.jsx)(s.Z,{entityId:N.id,position:V,world:A.current.getWorld(),currentWeapon:L.currentWeapon,currentSubclass:L.currentSubclass,isCharging:L.isCharging,chargeProgress:L.chargeProgress,isSwinging:L.isSwinging,isSpinning:L.isSpinning,swordComboStep:L.swordComboStep,isDivineStorming:L.isDivineStorming,isSwordCharging:L.isSwordCharging,isDeflecting:L.isDeflecting,isViperStingCharging:L.isViperStingCharging,viperStingChargeProgress:L.viperStingChargeProgress,isBarrageCharging:L.isBarrageCharging,barrageChargeProgress:L.barrageChargeProgress,isCobraShotCharging:L.isCobraShotCharging,cobraShotChargeProgress:L.cobraShotChargeProgress,isSkyfalling:L.isSkyfalling,isBackstabbing:L.isBackstabbing,reanimateRef:k,onBowRelease:()=>{},onScytheSwingComplete:()=>{},onSwordSwingComplete:()=>{var e;null===(e=B.current)||void 0===e||e.onSwordSwingComplete()},onSabresSwingComplete:()=>{var e;null===(e=B.current)||void 0===e||e.onSabresSwingComplete()},onChargeComplete:()=>{var e;null===(e=B.current)||void 0===e||e.onChargeComplete()},onDeflectComplete:()=>{var e;null===(e=B.current)||void 0===e||e.onDeflectComplete()}}),A.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b.Z,{world:A.current.getWorld()}),(0,n.jsx)(ec,{world:A.current.getWorld()}),(0,n.jsx)(ed.Z,{}),(0,n.jsx)(eu.default,{world:A.current.getWorld()}),(0,n.jsx)(eh.default,{world:A.current.getWorld()}),(0,n.jsx)(ep.ZP,{enemyData:[]}),(0,n.jsx)(eg.ZP,{})]})]})}},8026:function(e,t,r){r.r(t),r.d(t,{default:function(){return a}});var n=r(7437),i=r(2265);let o=(0,r(166).default)(()=>Promise.all([r.e(841),r.e(893),r.e(812),r.e(736),r.e(983)]).then(r.bind(r,1702)).then(e=>({default:e.GameScene})),{loadableGenerated:{webpack:()=>[1702]},ssr:!1,loading:()=>null});function a(e){return(0,n.jsx)(i.Suspense,{fallback:null,children:(0,n.jsx)(o,{...e})})}},888:function(e,t,r){r.r(t),r.d(t,{MultiplayerGameScene:function(){return k}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448),s=r(7988),l=r(946),c=r(45),d=r(4058),u=r(73),h=r(7771),p=r(6862),g=r(3974),m=r(8001),f=r(3478),y=r(6776),x=r(3842),M=r(7223),v=r(2082),j=r(2972),w=r(5773),S=r(2158),b=r(244),C=r(4451),I=r(7125),P=r(2824),D=r(7057),E=r(6932),F=r(7019),R=r(5050),A=r(5658),T=r(4244),B=r(3680);function k(){var e;let{onDamageNumbersUpdate:t,onDamageNumberComplete:r,onCameraUpdate:k,onGameStateUpdate:z,onControlSystemUpdate:V}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{scene:G,camera:N,gl:W,size:L}=(0,o.D)(),{players:O,enemies:H,killCount:_,gameStarted:U,updatePlayerPosition:Z,updatePlayerWeapon:q,updatePlayerHealth:Y,broadcastPlayerAttack:Q,broadcastPlayerAbility:J,broadcastPlayerAnimationState:K,damageEnemy:$,socket:X}=(0,l.p)(),ee=(0,i.useRef)(null),et=(0,i.useRef)(null),er=(0,i.useRef)(null),en=(0,i.useRef)(null),ei=(0,i.useRef)(!1),eo=(0,i.useRef)(0),[ea,es]=(0,i.useState)(new a.Vector3(0,.5,0)),[el,ec]=(0,i.useState)(null),ed=(0,i.useRef)(new Map),[eu,eh]=(0,i.useState)({currentWeapon:I.v.BOW,currentSubclass:I.p.ELEMENTAL,isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1}),ep=(0,i.useRef)({weapon:I.v.BOW,subclass:I.p.ELEMENTAL}),[eg,em]=(0,i.useState)(new Map),{createPowershotEffect:ef}=(0,T.sf)();return((0,i.useEffect)(()=>{if(!X)return;let e=e=>{if(console.log("⚔️ Received player attack:",e),e.playerId!==X.id&&ee.current){var t;if("bow_release"===e.attackType&&(null===(t=e.animationData)||void 0===t?void 0:t.isPerfectShot)){console.log("\uD83C\uDF1F Creating perfect shot beam effect for other player!");let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=O.get(e.playerId);ef(t,r,(null==n?void 0:n.subclass)||I.p.ELEMENTAL,!0,!0)}if(["regular_arrow","charged_arrow","entropic_bolt","crossentropy_bolt","perfect_shot"].includes(e.attackType)){console.log("\uD83C\uDFF9 Creating multiplayer projectile:",e.attackType);let t=ee.current.getWorld().getSystem(j.c);if(t){let r=new a.Vector3(e.position.x,e.position.y,e.position.z),n=new a.Vector3(e.direction.x,e.direction.y,e.direction.z);switch(e.attackType){case"regular_arrow":t.createProjectile(ee.current.getWorld(),r,n,-1,{speed:25,damage:0,lifetime:3,opacity:.8});break;case"charged_arrow":t.createChargedArrowProjectile(ee.current.getWorld(),r,n,-1,{speed:35,damage:0,lifetime:5,piercing:!0,opacity:.8});break;case"entropic_bolt":t.createEntropicBoltProjectile(ee.current.getWorld(),r,n,-1,{speed:20,damage:0,lifetime:8,piercing:!0,opacity:.8});break;case"crossentropy_bolt":t.createCrossentropyBoltProjectile(ee.current.getWorld(),r,n,-1,{speed:15,damage:0,lifetime:10,piercing:!0,opacity:.8});break;case"perfect_shot":t.createChargedArrowProjectile(ee.current.getWorld(),r,n,-1,{speed:40,damage:0,lifetime:6,piercing:!0,opacity:1})}}}em(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1},i=e.animationData||{},o=Date.now();return r.set(e.playerId,{...n,isSwinging:e.attackType.includes("swing")||e.attackType.includes("sword"),isCharging:e.attackType.includes("bow")&&e.attackType.includes("charge"),isSpinning:e.attackType.includes("scythe")||i.isSpinning||!1,swordComboStep:i.comboStep||n.swordComboStep,chargeProgress:i.chargeProgress||0,lastAttackType:e.attackType,lastAttackTime:o,lastAnimationUpdate:o}),setTimeout(()=>{em(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&n.lastAnimationUpdate===o&&r.set(e.playerId,{...n,isSwinging:!1,isCharging:!1,isSpinning:!1}),r})},e.attackType.includes("scythe")?2e3:e.attackType.includes("sword")?800:e.attackType.includes("bow")?500:1e3),r})}},t=e=>{console.log("✨ Received player ability:",e),e.playerId!==X.id&&"divine_storm"===e.abilityType&&em(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1};return r.set(e.playerId,{...n,isDivineStorming:!0,isSpinning:!0}),setTimeout(()=>{em(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isDivineStorming:!1,isSpinning:!1}),r})},3e3),r})},r=e=>{console.log("\uD83D\uDCAB Received player effect:",e)},n=e=>{console.log("\uD83C\uDFAD Received player animation state:",e),e.playerId!==X.id&&em(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1};return r.set(e.playerId,{...n,...e.animationState,lastAnimationUpdate:Date.now()}),r})};return X.on("player-attacked",e),X.on("player-used-ability",t),X.on("player-effect",r),X.on("player-animation-state",n),()=>{X.off("player-attacked",e),X.off("player-used-ability",t),X.off("player-effect",r),X.off("player-animation-state",n)}},[X]),(0,i.useEffect)(()=>{let e=setInterval(()=>{em(e=>{let t=new Map(e),r=Date.now(),n=!1;return t.forEach((e,i)=>{e.lastAnimationUpdate&&r-e.lastAnimationUpdate>3e3&&(e.isSwinging||e.isCharging||e.isSpinning)&&(console.log("\uD83D\uDD27 Force resetting stuck animation for player ".concat(i)),t.set(i,{...e,isSwinging:!1,isCharging:!1,isSpinning:!1}),n=!0)}),n?t:e})},1e3);return()=>clearInterval(e)},[]),(0,i.useEffect)(()=>{if(!ee.current||!U)return;let e=ee.current.getWorld();H.forEach((t,r)=>{if(ed.current.has(r)){let n=ed.current.get(r),i=e.getEntity(n);if(i){let e=i.getComponent(u.w);e&&e.setPosition(t.position.x,t.position.y,t.position.z);let r=i.getComponent(p.S);r&&(r.maxHealth=t.maxHealth,r.currentHealth=t.health,t.isDying&&!r.isDead&&(r.currentHealth=0))}}else{let n=e.createEntity(),i=e.createComponent(u.w);i.setPosition(t.position.x,t.position.y,t.position.z),n.addComponent(i);let o=e.createComponent(m.C);o.type="elite"===t.type?m.Z.ELITE:m.Z.GRUNT,o.level=1,n.addComponent(o);let s=e.createComponent(p.S);s.maxHealth=t.maxHealth,s.currentHealth=t.health,n.addComponent(s);let l=e.createComponent(f.YM);l.type=f.F5.SPHERE,l.radius=2,l.layer=f.aB.ENEMY,l.setOffset(0,1,0),n.addComponent(l);let c=e.createComponent(y.T),d={width:1.2,height:.1,offset:new a.Vector3(0,2.5,0),showWhenFull:!1,fadeDistance:20,healthColor:new a.Color(65280),lowHealthColor:new a.Color(16776960),criticalHealthColor:new a.Color(16711680)};c.width=d.width,c.height=d.height,c.offset.copy(d.offset),c.showWhenFull=d.showWhenFull,c.fadeDistance=d.fadeDistance,c.healthColor.copy(d.healthColor),c.lowHealthColor.copy(d.lowHealthColor),c.criticalHealthColor.copy(d.criticalHealthColor),n.addComponent(c),e.notifyEntityAdded(n),ed.current.set(r,n.id),console.log("\uD83D\uDD17 Created local ECS entity ".concat(n.id," for server enemy ").concat(r," (").concat(t.type,") with health bar"))}});let t=new Set(H.keys()),r=[];ed.current.forEach((n,i)=>{if(!t.has(i)){let t=e.getEntity(n);if(t){let e=t.getComponent(p.S);e&&(e.currentHealth=0,e.isDead=!0),console.log("\uD83D\uDC80 Marked local ECS entity ".concat(n," as dead for deleted server enemy ").concat(i))}r.push(i)}}),r.forEach(e=>{ed.current.delete(e)})},[H,U]),(0,i.useEffect)(()=>{if(ei.current||!U)return;ei.current=!0,(0,R.j4)(0),(0,R.Ge)(0);let e=new c.D({enableDebug:!0});ee.current=e;let t=W.domElement;return e.initialize(t).then(()=>{let{player:t,controlSystem:r}=function(e,t,r,n,i){let o=e.getWorld(),s=e.getInputManager();n.shadowMap.enabled=!0,n.shadowMap.type=a.PCFSoftShadowMap;let l=new w.F,c=new S.s(5),d=new b.b(o),m=new x.K(t,r,n),f=new C.C(t,r),y=new j.c(o),I=new M.s(r,s,o,y),P=new v.D(r,s,{distance:8,height:2,mouseSensitivity:.005,smoothing:.15});y.setCombatSystem(d),d.setEnemyDamageCallback(i),o.addSystem(l),o.addSystem(c),o.addSystem(d),o.addSystem(m),o.addSystem(f),o.addSystem(y),o.addSystem(I),o.addSystem(P);let D=function(e){let t=e.createEntity(),r=e.createComponent(u.w);r.setPosition(0,.5,0),t.addComponent(r);let n=e.createComponent(h.i);n.maxSpeed=3.75,n.jumpForce=8,n.friction=.85,t.addComponent(n);let i=e.createComponent(p.S);i.maxHealth=200,i.enableRegeneration(2,5),t.addComponent(i);let o=new g.W(100,20,5);return t.addComponent(o),console.log("\uD83D\uDC64 Multiplayer player entity created with components:",{transform:!!t.getComponent(u.w),movement:!!t.getComponent(h.i),health:!!t.getComponent(p.S),shield:!!t.getComponent(g.W)}),t}(o);return I.setPlayer(D),P.setTarget(D),P.snapToTarget(),console.log("\uD83C\uDF0D Total entities in world:",o.getAllEntities().length),console.log("✅ Multiplayer game setup complete!"),console.log("\uD83D\uDC64 Player entity created with ID: ".concat(D.id)),console.log("\uD83C\uDF10 Multiplayer enemies and players will be synchronized from server"),{player:D,controlSystem:I}}(e,G,N,W,(e,t)=>{let r=parseInt(e),n=null;ed.current.forEach((e,t)=>{e===r&&(n=t)}),n?(console.log("\uD83C\uDFAF Mapping local entity ".concat(e," to server enemy ").concat(n," for ").concat(t," damage")),$(n,t)):console.warn("⚠️ Could not find server enemy ID for local entity ".concat(e))});ec(t),et.current=t.id,er.current=r,V&&V(r),r.setBowReleaseCallback((t,n)=>{if(console.log("\uD83C\uDFF9 Bow released with charge:",t,n?"✨ PERFECT SHOT!":""),el){let e=el.getComponent(u.w);if(e){let r=new a.Vector3;N.getWorldDirection(r),r.normalize(),Q("bow_release",e.position,r,{chargeProgress:t,isPerfectShot:n})}}if(n){console.log("\uD83C\uDF1F Creating perfect shot visual effect!");let t=e.getWorld().getEntity(et.current);if(t){let e=t.getComponent(u.w);if(e){let t=new a.Vector3;N.getWorldDirection(t),t.normalize();let n=new a.Vector3;n.crossVectors(t,new a.Vector3(0,1,0)).normalize();let i=new a.Matrix4;i.makeRotationAxis(n,Math.PI/12),t.applyMatrix4(i),t.normalize(),console.log("\uD83C\uDF1F Perfect shot effect created with ID:",ef(e.position.clone(),t,r.getCurrentSubclass(),!0,!0))}}}}),r.setDivineStormCallback((e,t)=>{console.log("⚡ Divine Storm activated - broadcasting to other players"),J("divine_storm",e,t)}),r.setProjectileCreatedCallback((e,t,n,i)=>{console.log("\uD83C\uDFF9 Projectile created - broadcasting to other players:",e);let o={};(e.includes("arrow")||e.includes("bolt"))&&(o.chargeProgress=r.getChargeProgress()),Q(e,t,n,o)}),r.setReanimateCallback(()=>{console.log("\uD83C\uDF3F Multiplayer Reanimate healing effect triggered"),en.current&&en.current.triggerHealingEffect()}),e.start()}),()=>{ee.current&&ee.current.destroy()}},[G,N,W,U]),(0,o.F)((e,r)=>{if(ee.current&&ee.current.isEngineRunning()&&U){if(el){let e=el.getComponent(u.w);e&&(es(e.position.clone()),Z(e.position,{x:0,y:0,z:0}))}if(er.current){let e={currentWeapon:er.current.getCurrentWeapon(),currentSubclass:er.current.getCurrentSubclass(),isCharging:er.current.isWeaponCharging(),chargeProgress:er.current.getChargeProgress(),isSwinging:er.current.isWeaponSwinging(),swordComboStep:er.current.getSwordComboStep(),isDivineStorming:er.current.isDivineStormActive()},t=ep.current;(e.currentWeapon!==t.weapon||e.currentSubclass!==t.subclass)&&(console.log("\uD83D\uDD04 Weapon changed:",e.currentWeapon,e.currentSubclass),q(e.currentWeapon,e.currentSubclass),ep.current={weapon:e.currentWeapon,subclass:e.currentSubclass}),eh(e);let r=Date.now();if(r-eo.current>100){let t=e.currentWeapon===I.v.SCYTHE&&e.isCharging,n=e.isDivineStorming;K({isCharging:e.isCharging,chargeProgress:e.chargeProgress,isSwinging:e.isSwinging,swordComboStep:e.swordComboStep,isDivineStorming:e.isDivineStorming,isSpinning:t||n}),eo.current=r}}let e=ee.current.getWorld().getSystem(b.b);if(e&&t&&t(e.getDamageNumbers()),k&&k(N,L),z&&el&&er.current){let e=el.getComponent(p.S),t=el.getComponent(g.W);e&&(z({playerHealth:e.currentHealth,maxHealth:e.maxHealth,playerShield:t?t.currentShield:0,maxShield:t?t.maxShield:0,currentWeapon:er.current.getCurrentWeapon(),currentSubclass:er.current.getCurrentSubclass()}),Y(e.currentHealth,e.maxHealth))}}}),i.useEffect(()=>{r&&(window.handleDamageNumberComplete=e=>{var t;let r=null===(t=ee.current)||void 0===t?void 0:t.getWorld().getSystem(b.b);r&&r.removeDamageNumber(e)})},[r]),U)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(A.Z,{level:Math.min(5,Math.floor(_/10)+1),world:null===(e=ee.current)||void 0===e?void 0:e.getWorld()}),(0,n.jsx)("ambientLight",{intensity:.3}),(0,n.jsx)("directionalLight",{position:[10,10,5],intensity:.5,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),(0,n.jsxs)("mesh",{receiveShadow:!0,position:[0,-.5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[29,29,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#2d5a2d"})]}),(0,n.jsxs)("mesh",{position:[0,.01,0],children:[(0,n.jsx)("ringGeometry",{args:[28.5,29,64]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6b6b",transparent:!0,opacity:.3})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[5,1,5],children:[(0,n.jsx)("boxGeometry",{args:[2,2,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#8b4513"})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[-5,1,-5],children:[(0,n.jsx)("boxGeometry",{args:[2,2,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#8b4513"})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[0,1,-10],children:[(0,n.jsx)("boxGeometry",{args:[4,2,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#696969"})]}),el&&ee.current&&X&&(0,n.jsx)(s.Z,{entityId:el.id,position:ea,world:ee.current.getWorld(),currentWeapon:eu.currentWeapon,currentSubclass:eu.currentSubclass,isCharging:eu.isCharging,chargeProgress:eu.chargeProgress,isSwinging:eu.isSwinging,swordComboStep:eu.swordComboStep,isDivineStorming:eu.isDivineStorming,reanimateRef:en,onBowRelease:()=>{},onScytheSwingComplete:()=>{console.log("⚔️ Scythe swing completed");let e=new a.Vector3;N.getWorldDirection(e),e.normalize(),Q("scythe_swing",ea,e,{isSpinning:!0})},onSwordSwingComplete:()=>{var e;console.log("\uD83D\uDDE1️ Sword swing completed - notifying control system"),null===(e=er.current)||void 0===e||e.onSwordSwingComplete();let t=new a.Vector3;N.getWorldDirection(t),t.normalize(),Q("sword_swing",ea,t,{comboStep:eu.swordComboStep})},onChargeComplete:()=>{var e;console.log("⚔️ Charge completed - notifying control system"),null===(e=er.current)||void 0===e||e.onChargeComplete()},onDeflectComplete:()=>{var e;console.log("\uD83D\uDEE1️ Deflect completed - notifying control system"),null===(e=er.current)||void 0===e||e.onDeflectComplete()}}),Array.from(O.values()).map(e=>{var t;if(e.id===(null==X?void 0:X.id))return null;let r=eg.get(e.id)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1};return(0,n.jsx)(s.Z,{entityId:parseInt(e.id.replace(/\D/g,"0")),position:new a.Vector3(e.position.x,e.position.y,e.position.z),world:(null===(t=ee.current)||void 0===t?void 0:t.getWorld())||new d.q,currentWeapon:e.weapon,currentSubclass:e.subclass,isCharging:r.isCharging,chargeProgress:r.chargeProgress,isSwinging:r.isSwinging,isSpinning:r.isSpinning,swordComboStep:r.swordComboStep,isDivineStorming:r.isDivineStorming,onBowRelease:()=>{},onScytheSwingComplete:()=>{},onSwordSwingComplete:()=>{}},e.id)}),ee.current&&(()=>{let e=ee.current.getWorld().getAllEntities(),t=e.filter(e=>e.hasComponent(m.C));return console.log("\uD83D\uDD0D All entities:",e.length,"Enemy entities:",t.length),t})().map(e=>{let t=e.getComponent(m.C),r=e.getComponent(u.w);if(!t||!r)return null;switch(t.type){case m.Z.ELITE:return(0,n.jsx)(B.Z,{entityId:e.id,position:r.position.clone(),world:ee.current.getWorld()},e.id);case m.Z.GRUNT:case m.Z.BOSS:default:return null}}),ee.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(P.Z,{world:ee.current.getWorld()}),(0,n.jsx)(D.Z,{}),(0,n.jsx)(E.default,{world:ee.current.getWorld()}),(0,n.jsx)(F.default,{world:ee.current.getWorld()})]})]}):null}},9078:function(e,t,r){r.r(t),r.d(t,{PVPGameScene:function(){return J}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448),s=r(7988),l=r(946),c=r(45),d=r(4058),u=r(73),h=r(7771),p=r(6862),g=r(3974),m=r(246),f=r(3478),y=r(2115),x=r(3842),M=r(7223),v=r(2082),j=r(2972),w=r(5773),S=r(2158),b=r(244),C=r(3021),I=r(7125),P=r(2824),D=r(7057),E=r(6932),F=r(6923),R=r(7019),A=r(319),T=r(3351);function B(e){let{position:t,debuffType:r,duration:a=5e3,startTime:s=Date.now(),onComplete:l}=e,c=(0,i.useRef)(null),[d,u]=(0,i.useState)(1),[h,p]=(0,i.useState)(1),g=(0,i.useRef)(.02*Math.random()+.01);(0,i.useEffect)(()=>{let e=setTimeout(()=>{console.log("\uD83C\uDFAF Debuff indicator (".concat(r,") completed after"),a,"ms"),l&&l()},a);return()=>{clearTimeout(e)}},[a,l,r]),(0,o.F)(()=>{if(!c.current)return;let e=Date.now()-s,t=Math.min(e/a,1);if(t>=1&&l){console.log("\uD83C\uDFAF Debuff indicator (".concat(r,") exceeded duration, forcing completion")),l();return}t>.8?p(1-(t-.8)/.19999999999999996):p(1),u((.6+.4*Math.sin(.008*e))*h),c.current.rotation.y+=g.current,c.current.rotation.z=.1*Math.sin(.003*e)});let m=(()=>{switch(r){case"frozen":return{color:"#4FC3F7",emissive:"#29B6F6",symbol:"❄️"};case"slowed":return{color:"#FFA726",emissive:"#FF9800",symbol:"\uD83D\uDC0C"};default:return{color:"#9E9E9E",emissive:"#757575",symbol:"?"}}})();return(0,n.jsxs)("group",{ref:c,position:[t.x,t.y+2.5,t.z],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("circleGeometry",{args:[.4,16]}),(0,n.jsx)("meshStandardMaterial",{color:m.color,emissive:m.emissive,emissiveIntensity:.3*d,transparent:!0,opacity:.6*h,roughness:.1,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,0,-.01],rotation:[0,0,0],children:[(0,n.jsx)("ringGeometry",{args:[.35,.45,16]}),(0,n.jsx)("meshStandardMaterial",{color:m.color,emissive:m.emissive,emissiveIntensity:.5*d,transparent:!0,opacity:.8*h,roughness:.05,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,0,.01],children:[(0,n.jsx)("circleGeometry",{args:[.25,12]}),(0,n.jsx)("meshStandardMaterial",{color:m.emissive,emissive:m.emissive,emissiveIntensity:.8*d,transparent:!0,opacity:.4*h})]}),[...Array(6)].map((e,t)=>{let r=t*Math.PI*2/6,i=.6+.1*Math.sin(.003*Date.now()+t);return(0,n.jsxs)("mesh",{position:[Math.cos(r)*i,Math.sin(r)*i*.3,0],children:[(0,n.jsx)("sphereGeometry",{args:[.03,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:m.color,emissive:m.emissive,emissiveIntensity:.9*d,transparent:!0,opacity:.7*h})]},t)}),(0,n.jsx)("pointLight",{color:m.color,intensity:1.5*d*h,distance:3,position:[0,0,.2]})]})}var k=r(8787),z=r(1168),V=r(4817);function G(e){let{world:t,players:n,onPlayerHit:a,onPlayerVenomed:s,serverPlayerEntities:l,localSocketId:c}=e;return(0,i.useRef)(new Set),(0,o.F)(()=>{V.u.resetFrameTemporaries();let{getGlobalCobraShotProjectiles:e}=r(7019);e().forEach(e=>{if(!e.active)return;let t=e.position;n.forEach(r=>{if(r.id===c)return;let n=V.u.getTempVector3(r.position.x,r.position.y,r.position.z);if(1.5>=t.distanceTo(n)){let t=parseInt(r.id)||r.id.length;if(!e.hitEnemies.has(t)){e.hitEnemies.add(t),a(r.id,29);let n=V.u.acquireVector3(r.position.x,r.position.y,r.position.z);console.log("\uD83D\uDC0D Cobra Shot projectile ".concat(e.id," hit player ").concat(r.id,", applying venom effect at target position:"),n.toArray()),s(r.id,n),V.u.releaseVector3(n),e.active=!1,e.fadeStartTime=Date.now()}}})})}),null}function N(e){let{world:t,players:r,onPlayerHit:n,onPlayerSlowed:a,serverPlayerEntities:s,localSocketId:l}=e,c=(0,i.useRef)(new Set);return(0,o.F)(()=>{t&&(V.u.resetFrameTemporaries(),t.getAllEntities().filter(e=>e.hasComponent(z.W)&&e.hasComponent(u.w)&&e.hasComponent(m.T)).forEach(e=>{var t,i;let o=e.getComponent(m.T),d=e.getComponent(u.w),h=e.getComponent(z.W);if(!(null==o?void 0:null===(i=o.mesh)||void 0===i?void 0:null===(t=i.userData)||void 0===t?void 0:t.isBarrageArrow)||!d||!h)return;let p=d.position;r.forEach(t=>{if(t.id===l)return;let r=V.u.getTempVector3(t.position.x,t.position.y,t.position.z);if(1.25>=p.distanceTo(r)){let r=V.u.createHitKey(e.id,t.id),i=s.current.get(t.id);if(i&&!h.hasHitTarget(i)&&!c.current.has(r)){h.addHitTarget(i),c.current.add(r),n(t.id,30);let o=V.u.acquireVector3(t.position.x,t.position.y,t.position.z);console.log("\uD83C\uDFF9 Barrage projectile ".concat(e.id," hit player ").concat(t.id,", applying slow effect at target position:"),o.toArray()),a(t.id,o),V.u.releaseVector3(o),setTimeout(()=>{c.current.delete(r)},1e4)}}})}))}),null}function W(e){let{world:t,players:n,onPlayerHit:a,onPlayerFrozen:s,serverPlayerEntities:l,localSocketId:c}=e,d=(0,i.useRef)(new Set),u=(0,i.useRef)(0);return(0,o.F)(()=>{if(!t)return;let e=Date.now();if(e-u.current<50)return;u.current=e,V.u.resetFrameTemporaries();let{getActiveFrostNovas:i}=r(6932);(i?i():[]).forEach(e=>{n.forEach(t=>{if(t.id===c)return;let r=V.u.getTempVector3(t.position.x,t.position.y,t.position.z);if(6>=e.position.distanceTo(r)){let r=V.u.createHitKey(e.id,t.id);if(!d.current.has(r)){d.current.add(r),a(t.id,50);let n=V.u.acquireVector3(t.position.x,t.position.y,t.position.z);console.log("❄️ FrostNova ".concat(e.id," hit player ").concat(t.id,", applying freeze effect at target position:"),n.toArray()),s(t.id,n),V.u.releaseVector3(n),setTimeout(()=>{d.current.delete(r)},7e3)}}})})}),null}var L=r(3841),O=r(9709),H=r(1151);function _(e){let{playerId:t,playerName:r,position:s,health:l,maxHealth:c,shield:d=0,maxShield:u=200,camera:h,showDistance:p=25}=e,g=(0,i.useRef)(null),m=(0,i.useRef)({healthBar:null,shieldBar:null,background:null,shieldBackground:null}),[f,y]=(0,i.useState)(!1),x=new a.Vector3(0,3,0);return(0,i.useEffect)(()=>{if(!g.current)return;let e=new a.PlaneGeometry(2,.15),t=new a.MeshBasicMaterial({color:new a.Color(3355443),transparent:!0,opacity:.8,depthWrite:!1}),r=new a.Mesh(e,t);r.position.set(0,0,.001),m.current.background&&g.current.remove(m.current.background),m.current.background=r,g.current.add(r);let n=new a.PlaneGeometry(2,.15),i=new a.MeshBasicMaterial({color:new a.Color(65280),transparent:!0,opacity:.9,depthWrite:!1}),o=new a.Mesh(n,i);o.position.set(0,0,.002),m.current.healthBar&&g.current.remove(m.current.healthBar),m.current.healthBar=o,g.current.add(o);let s=new a.PlaneGeometry(2,.105),l=new a.MeshBasicMaterial({color:new a.Color(1712946),transparent:!0,opacity:.8,depthWrite:!1}),c=new a.Mesh(s,l);c.position.set(0,.2,.001),m.current.shieldBackground&&g.current.remove(m.current.shieldBackground),m.current.shieldBackground=c,g.current.add(c);let d=new a.PlaneGeometry(2,.105),u=new a.MeshBasicMaterial({color:new a.Color(4886754),transparent:!0,opacity:.9,depthWrite:!1}),h=new a.Mesh(d,u);return h.position.set(0,.2,.002),m.current.shieldBar&&g.current.remove(m.current.shieldBar),m.current.shieldBar=h,g.current.add(h),()=>{e.dispose(),t.dispose(),n.dispose(),i.dispose(),s.dispose(),l.dispose(),d.dispose(),u.dispose()}},[]),(0,o.F)(()=>{if(!g.current||!h)return;let e=s.clone().add(x),t=h.position.distanceTo(e),r=t<=p&&(l<c||d<u);if(r!==f&&y(r),!r){g.current.visible=!1;return}if(g.current.visible=!0,g.current.position.copy(e),g.current.lookAt(h.position),m.current.healthBar){let e=Math.max(0,Math.min(1,l/c));m.current.healthBar.scale.x=e,m.current.healthBar.position.x=-(2*(1-e))/2;let t=m.current.healthBar.material;e>.6?t.color.setHex(65280):e>.3?t.color.setHex(16776960):t.color.setHex(16711680)}if(m.current.shieldBar&&u>0){let e=Math.max(0,Math.min(1,d/u));m.current.shieldBar.scale.x=e,m.current.shieldBar.position.x=-(2*(1-e))/2}let n=.8*p,i=t>n?Math.max(.3,1-(t-n)/(p-n)):1;[m.current.background,m.current.healthBar,m.current.shieldBackground,m.current.shieldBar].forEach(e=>{if(e){let t=e.material;t.opacity=t.userData.baseOpacity*i}})}),(0,i.useEffect)(()=>{[{mesh:m.current.background,opacity:.8},{mesh:m.current.healthBar,opacity:.9},{mesh:m.current.shieldBackground,opacity:.8},{mesh:m.current.shieldBar,opacity:.9}].forEach(e=>{let{mesh:t,opacity:r}=e;t&&(t.material.userData.baseOpacity=r)})},[]),(0,n.jsx)("group",{ref:g})}function U(e){let{entityId:t,world:r,position:s,ownerId:l,towerIndex:c,health:d,maxHealth:h,isDead:p=!1,color:g}=e,m=(0,i.useRef)(null),f=(0,i.useRef)(null),x=(0,i.useMemo)(()=>[new a.Color(4886754),new a.Color(16739125),new a.Color(5294200),new a.Color(10181046),new a.Color(15965202)],[]),M=g||x[c%x.length],v=Math.max(0,d/h),j=p?.3:Math.max(.5,v),w=p?new a.Color(6710886):M.clone().lerp(new a.Color(16711680),1-v);return(0,o.F)(()=>{if(!r||p)return;let e=r.getEntity(t);if(!e)return;let n=e.getComponent(y.N);if(!n||!n.currentTarget)return;let i=r.getEntity(n.currentTarget);if(!i)return;let o=i.getComponent(u.w);if(!o)return;let l=new a.Vector3;if(l.copy(o.position),l.sub(s),l.y=0,l.normalize(),f.current){let e=Math.atan2(l.x,l.z);f.current.rotation.y=e}}),(0,n.jsxs)("group",{ref:m,position:[s.x,s.y,s.z],children:[(0,n.jsxs)("mesh",{position:[0,2,0],castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("cylinderGeometry",{args:[1,1.5,4,8]}),(0,n.jsx)("meshStandardMaterial",{color:w,metalness:.3,roughness:.7,transparent:!0,opacity:j})]}),(0,n.jsxs)("mesh",{position:[0,4.25,0],castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("cylinderGeometry",{args:[.8,.8,.5,8]}),(0,n.jsx)("meshStandardMaterial",{color:w.clone().multiplyScalar(1.2),metalness:.5,roughness:.5,transparent:!0,opacity:j})]}),(0,n.jsx)("mesh",{ref:f,position:[0,4.25,0],castShadow:!0,children:(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{position:[.5,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("cylinderGeometry",{args:[.1,.1,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:2899536,metalness:.8,roughness:.2,transparent:!0,opacity:j})]})})}),[0,1,2,3].map(e=>{let t=e/4*Math.PI*2,r=1.35*Math.cos(t),i=1.35*Math.sin(t);return(0,n.jsxs)("mesh",{position:[r,1.2,i],castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[.2,.3,.2]}),(0,n.jsx)("meshStandardMaterial",{color:w.clone().multiplyScalar(.8),metalness:.4,roughness:.8,transparent:!0,opacity:j})]},e)}),!p&&(0,n.jsxs)("group",{position:[0,5.5,0],children:[(0,n.jsxs)("mesh",{position:[0,0,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("planeGeometry",{args:[3,.3]}),(0,n.jsx)("meshBasicMaterial",{color:3355443,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{position:[-(3*(1-v))/2,.01,0],rotation:[-Math.PI/2,0,0],scale:[v,1,1],children:[(0,n.jsx)("planeGeometry",{args:[3,.25]}),(0,n.jsx)("meshBasicMaterial",{color:v>.5?65280:v>.25?16776960:16711680,transparent:!0,opacity:.9})]}),(0,n.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("planeGeometry",{args:[4,.5]}),(0,n.jsx)("meshBasicMaterial",{color:0,transparent:!0,opacity:.7})]})]}),p&&(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("sphereGeometry",{args:[2,8,8]}),(0,n.jsx)("meshBasicMaterial",{color:6710886,transparent:!0,opacity:.1,wireframe:!0})]})})]})}var Z=r(5050),q=r(5658),Y=r(4244);r(6374);let Q=i.memo(e=>{let{position:t,onComplete:r}=e,[a,s]=(0,i.useState)(0);(0,o.F)((e,t)=>{s(e=>{let n=e+t;return n>=1.5&&r(),n})});let l=a/1.5,c=Math.sin(l*Math.PI),d=1+2*l;return(0,n.jsxs)("group",{position:t.toArray(),children:[[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,2*l+.5*t,0],rotation:[Math.PI/2,0,2*a],children:[(0,n.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:1.5,transparent:!0,opacity:c*(1-.2*t)})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{scale:[d,d,d],children:[(0,n.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2,transparent:!0,opacity:.3*c})]}),[...Array(12)].map((e,t)=>{let r=t/12*Math.PI*2,i=.75+l;return(0,n.jsxs)("mesh",{position:[Math.cos(r+2*a)*i/1.1,2*l+.5*Math.sin(3*a+t),Math.sin(r+2*a)*i/1.1],children:[(0,n.jsx)("sphereGeometry",{args:[.095,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2.5,transparent:!0,opacity:.8*c})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#60FF38",intensity:2*c,distance:5,decay:2})]})});function J(){var e;let{onDamageNumbersUpdate:t,onDamageNumberComplete:z,onCameraUpdate:J,onGameStateUpdate:K,onControlSystemUpdate:$}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{scene:X,camera:ee,gl:et,size:er}=(0,o.D)(),{players:en,towers:ei,gameStarted:eo,updatePlayerPosition:ea,updatePlayerWeapon:es,updatePlayerHealth:el,broadcastPlayerAttack:ec,broadcastPlayerAbility:ed,broadcastPlayerAnimationState:eu,broadcastPlayerDamage:eh,broadcastPlayerEffect:ep,broadcastPlayerDebuff:eg,damageTower:em,socket:ef}=(0,l.p)(),ey=(0,i.useRef)(null),ex=(0,i.useRef)(null),eM=(0,i.useRef)(null),ev=(0,i.useRef)(null),ej=(0,i.useRef)(null),ew=(0,i.useRef)(!1),eS=(0,i.useRef)(0),[eb,eC]=(0,i.useState)(new a.Vector3(0,.5,0)),[eI,eP]=(0,i.useState)(null),eD=(0,i.useRef)({position:new a.Vector3(0,.5,0),quaternion:{x:0,y:0,z:0,w:1}}),eE=(0,i.useRef)(new Map),eF=(0,i.useRef)(new Map),[eR,eA]=(0,i.useState)([]),eT=(0,i.useRef)(0),[eB,ek]=(0,i.useState)([]),ez=(0,i.useRef)(0),[eV,eG]=(0,i.useState)([]),eN=(0,i.useRef)(0),[eW,eL]=(0,i.useState)([]),eO=(0,i.useRef)(0),eH=(0,i.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,i=e===(null==ef?void 0:ef.id),o={id:eN.current++,playerId:e,debuffType:t,position:r.clone(),startTime:Date.now(),duration:n};if(L.VO.batchEffectUpdates([{type:"add",effectType:"debuff",setter:eG,data:o}]),i&&eI){let e=eI.getComponent(h.i);e&&("frozen"===t?e.freeze(n):"slowed"===t&&e.slow(n,.5))}setTimeout(()=>{L.VO.batchEffectUpdates([{type:"remove",effectType:"debuff",setter:eG,filterId:o.id}])},o.duration)},[null==ef?void 0:ef.id,eI]),e_=(0,i.useCallback)((e,t)=>{null==ef||ef.id,eH(e,"frozen",t,5e3),eg&&eg(e,"frozen",5e3,{position:{x:t.x,y:t.y,z:t.z}})},[eH,eg]),eU=(0,i.useCallback)((e,t)=>{let r={id:eT.current++,playerId:e,position:t.clone(),startTime:Date.now(),duration:1500};L.VO.batchEffectUpdates([{type:"add",effectType:"reanimate",setter:eA,data:r}]),setTimeout(()=>{L.VO.batchEffectUpdates([{type:"remove",effectType:"reanimate",setter:eA,filterId:r.id}])},r.duration)},[]),eZ=(0,i.useCallback)((e,t)=>{let r={id:eO.current++,playerId:e,position:t.clone(),startTime:Date.now(),duration:1200};L.VO.batchEffectUpdates([{type:"add",effectType:"frostNova",setter:eL,data:r}]),setTimeout(()=>{L.VO.batchEffectUpdates([{type:"remove",effectType:"frostNova",setter:eL,filterId:r.id}])},r.duration)},[]),eq=(0,i.useCallback)((e,t)=>{if(e===(null==ef?void 0:ef.id))return;let r={id:ez.current++,playerId:e,position:t.clone(),startTime:Date.now(),duration:6e3};L.VO.batchEffectUpdates([{type:"add",effectType:"venom",setter:ek,data:r}]);let n=0,i=setInterval(()=>{if(++n>6){clearInterval(i);return}eh&&eh(e,17)},1e3);setTimeout(()=>{L.VO.batchEffectUpdates([{type:"remove",effectType:"venom",setter:ek,filterId:r.id}])},r.duration)},[null==ef?void 0:ef.id,eh]),[eY,eQ]=(0,i.useState)({currentWeapon:I.v.BOW,currentSubclass:I.p.ELEMENTAL,isCharging:!1,chargeProgress:0,isSwinging:!1,isSpinning:!1,swordComboStep:1,isDivineStorming:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1}),eJ=(0,i.useRef)({weapon:I.v.BOW,subclass:I.p.ELEMENTAL}),[eK,e$]=(0,i.useState)(new Map),{createPowershotEffect:eX}=(0,Y.sf)(),{createOptimizedVenomEffect:e0,createOptimizedDebuffEffect:e1,getPoolStats:e2}={createOptimizedVenomEffect:(0,i.useCallback)(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e3,n=V.u.acquireEffectData();return n.id=Date.now(),n.playerId=e,n.position.copy(t),n.startTime=Date.now(),n.duration=r,()=>{V.u.releaseEffectData(n)}},[]),createOptimizedDebuffEffect:(0,i.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,i=V.u.acquireEffectData();return i.id=Date.now(),i.playerId=e,i.debuffType=t,i.position.copy(r),i.startTime=Date.now(),i.duration=n,()=>{V.u.releaseEffectData(i)}},[]),getPoolStats:()=>V.u.getStats()};return((0,i.useEffect)(()=>{if(!ef)return;let e=e=>{if(e.playerId!==ef.id&&ey.current){var t;if("bow_release"===e.attackType&&(null===(t=e.animationData)||void 0===t?void 0:t.isPerfectShot)){let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=en.get(e.playerId);eX(t,r,(null==n?void 0:n.subclass)||I.p.ELEMENTAL,!0,!0)}if("viper_sting_projectile"===e.attackType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z),n=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),i=ey.current.getWorld().getSystem(j.c);if(i){let r=eE.current.get(e.playerId)||-Math.abs(1e3*e.playerId.length+Date.now()%1e3);i.createProjectile(ey.current.getWorld(),t,n,r,{speed:16,damage:61,lifetime:5,piercing:!0,opacity:.8})}let{triggerGlobalViperSting:o}=r(319),s=eD.current.position.clone(),l={...eD.current.quaternion};eD.current.position.copy(t);let c=Math.atan2(n.x,n.z);eD.current.quaternion={x:0,y:Math.sin(c/2),z:0,w:Math.cos(c/2)},o(),setTimeout(()=>{eD.current.position.copy(s),eD.current.quaternion=l},100);return}if("cobra_shot_projectile"===e.attackType){let{triggerGlobalCobraShot:t}=r(7019);t(new a.Vector3(e.position.x,e.position.y,e.position.z),new a.Vector3(e.direction.x,e.direction.y,e.direction.z));return}if("sword_charge_hit"===e.attackType){if(!e.animationData||"number"!=typeof e.animationData.damage||"number"!=typeof e.animationData.targetId)return;eE.current.get((null==ef?void 0:ef.id)||"")===e.animationData.targetId&&eI&&eh&&(null==ef?void 0:ef.id)&&eI.getComponent(p.S)&&eh(ef.id,e.animationData.damage);return}if(["regular_arrow","charged_arrow","entropic_bolt","crossentropy_bolt","perfect_shot","barrage_projectile"].includes(e.attackType)){let t=ey.current.getWorld().getSystem(j.c);if(t){let r=V.u.acquireVector3(e.position.x,e.position.y,e.position.z),n=V.u.acquireVector3(e.direction.x,e.direction.y,e.direction.z),i=eE.current.get(e.playerId)||-Math.abs(1e3*e.playerId.length+Date.now()%1e3);switch(e.attackType){case"regular_arrow":t.createProjectile(ey.current.getWorld(),r,n,i,{speed:25,damage:10,lifetime:3,maxDistance:25,opacity:.8});break;case"charged_arrow":t.createChargedArrowProjectile(ey.current.getWorld(),r,n,i,{speed:35,damage:50,lifetime:3,piercing:!0,opacity:.8});break;case"entropic_bolt":t.createEntropicBoltProjectile(ey.current.getWorld(),r,n,i,{speed:20,damage:20,lifetime:1.75,piercing:!1,opacity:.8});break;case"crossentropy_bolt":t.createCrossentropyBoltProjectile(ey.current.getWorld(),r,n,i,{speed:15,damage:90,lifetime:2.5,piercing:!1,opacity:.8});break;case"perfect_shot":t.createChargedArrowProjectile(ey.current.getWorld(),r,n,i,{speed:40,damage:75,lifetime:3,piercing:!0,opacity:1});break;case"barrage_projectile":let o=t.createProjectile(ey.current.getWorld(),r,n,i,{speed:22,damage:30,lifetime:3,maxDistance:25,piercing:!1,opacity:.8}).getComponent(m.T);(null==o?void 0:o.mesh)&&(o.mesh.userData.isBarrageArrow=!0,o.mesh.userData.isRegularArrow=!1)}V.u.releaseVector3(r),V.u.releaseVector3(n)}}let n=e.animationData||{},i=Date.now();L.VO.batchPlayerStateUpdates(e$,[{playerId:e.playerId,stateUpdate:{isSwinging:e.attackType.includes("swing")||e.attackType.includes("sword")&&!e.attackType.includes("charge"),isCharging:e.attackType.includes("bow")&&e.attackType.includes("charge"),isSpinning:e.attackType.includes("scythe")||e.attackType.includes("entropic_bolt")||e.attackType.includes("crossentropy_bolt")||e.attackType.includes("sword_charge_spin")||n.isSpinning||!1,isSwordCharging:"sword_charge_spin"===e.attackType||"sword_charge_start"===e.attackType||n.isSpinning||n.isSwordCharging||!1,swordComboStep:n.comboStep||1,chargeProgress:n.chargeProgress||0,lastAttackType:e.attackType,lastAttackTime:i,lastAnimationUpdate:i}}]);let o=en.get(e.playerId),s=(null==o?void 0:o.weapon)||I.v.BOW,l=null==o?void 0:o.subclass,c=100;if("sword_charge_spin"===e.attackType)c=50;else if("sword_charge_start"===e.attackType)c=450;else switch(s){case I.v.SCYTHE:c=l===I.p.ABYSSAL?350:167.5;break;case I.v.SWORD:c=80;break;case I.v.SABRES:c=275;break;case I.v.SPEAR:c=l===I.p.STORM?275:200;break;case I.v.BOW:c=300;break;default:c=100}setTimeout(()=>{L.VO.batchPlayerStateUpdates(e$,[{playerId:e.playerId,stateUpdate:{isSwinging:!1,isCharging:!1,isSpinning:!1,isSwordCharging:!1}}])},c)}},t=e=>{if(e.playerId!==ef.id){if("divine_storm"===e.abilityType){let t=V.u.acquireVector3(e.position.x,e.position.y,e.position.z);(0,O.e6)(t,e.playerId),V.u.releaseVector3(t),L.VO.batchPlayerStateUpdates(e$,[{playerId:e.playerId,stateUpdate:{isDivineStorming:!0,isSpinning:!0,isSwordCharging:!1}}]),setTimeout(()=>{L.VO.batchPlayerStateUpdates(e$,[{playerId:e.playerId,stateUpdate:{isDivineStorming:!1,isSpinning:!1}}])},4e3)}else if("viper_sting"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=eD.current.position.clone(),i={...eD.current.quaternion};eD.current.position.copy(t);let o=Math.atan2(r.x,r.z);eD.current.quaternion={x:0,y:Math.sin(o/2),z:0,w:Math.cos(o/2)},(0,A.triggerGlobalViperSting)(),setTimeout(()=>{eD.current.position.copy(n),eD.current.quaternion=i},100),e$(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isViperStingCharging:!0,viperStingChargeProgress:1}),setTimeout(()=>{e$(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isViperStingCharging:!1,viperStingChargeProgress:0}),r})},2e3),r})}else if("barrage"===e.abilityType)new a.Vector3(e.position.x,e.position.y,e.position.z),new a.Vector3(e.direction.x,e.direction.y,e.direction.z),e$(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isBarrageCharging:!0,barrageChargeProgress:1}),setTimeout(()=>{e$(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isBarrageCharging:!1,barrageChargeProgress:0}),r})},1500),r});else if("frost_nova"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z);eZ(e.playerId,t)}else if("reanimate"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z);eU(e.playerId,t)}else if("charge"===e.abilityType)e$(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isSwordCharging:!0}),setTimeout(()=>{e$(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isSwordCharging:!1}),r})},2e3),r});else if("deflect"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=new a.Vector3(0,Math.atan2(r.x,r.z),0);(0,H.Z0)(t,n,e.playerId),e$(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isDeflecting:!0}),setTimeout(()=>{e$(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isDeflecting:!1}),r})},3e3),r})}else if("skyfall"===e.abilityType)e$(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isSkyfalling:!0}),setTimeout(()=>{e$(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isSkyfalling:!1}),r})},1750),r});else if("backstab"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z);if(e$(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isDeflecting:!1,isSwordCharging:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isBackstabbing:!0}),setTimeout(()=>{e$(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isBackstabbing:!1}),r})},1e3),r}),en.get(e.playerId)){let n=en.get((null==ef?void 0:ef.id)||"");if(n&&(null==ef?void 0:ef.id)!==e.playerId){let e=new a.Vector3(n.position.x,n.position.y,n.position.z);if(2.5>=t.distanceTo(e)){let i=new a.Vector3().subVectors(e,t).normalize();if(r.dot(i)>=Math.cos(Math.PI/3)){let r=75,i=new a.Vector3(Math.sin(n.rotation.y),0,Math.cos(n.rotation.y)).normalize(),o=new a.Vector3().subVectors(t,e).normalize();-.3>i.dot(o)&&(r=150),eh&&(null==ef?void 0:ef.id)&&eh(ef.id,r,"backstab")}}}}e$(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isSwinging:!0}),setTimeout(()=>{e$(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isSwinging:!1}),r})},300),r})}}},n=e=>{if(e.targetPlayerId===ef.id&&eI){let t=eI.getComponent(p.S);eI.getComponent(g.W),t&&t.takeDamage(e.damage,Date.now()/1e3,eI)}},i=e=>{e.playerId!==ef.id&&e$(t=>{let r=new Map(t),n={...r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:3,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isBackstabbing:!1},...e.animationState,lastAnimationUpdate:Date.now()};return r.set(e.playerId,n),r})},o=e=>{var t;if((null===(t=e.effect)||void 0===t?void 0:t.type)==="venom"){let{targetPlayerId:t,position:r,duration:n}=e.effect;t&&r&&eq(t,new a.Vector3(r.x,r.y,r.z))}},s=e=>{console.log("\uD83C\uDFAF Received PVP player debuff:",e),console.log('\uD83D\uDD0D Debug: My socket ID is "'.concat(null==ef?void 0:ef.id,'", target is "').concat(e.targetPlayerId,'", am I the target? ').concat((null==ef?void 0:ef.id)===e.targetPlayerId));let{targetPlayerId:t,debuffType:r,duration:n,effectData:i}=e;if(t&&r&&n){let e;if(t===(null==ef?void 0:ef.id)&&eI){let t=eI.getComponent(u.w);e=t?t.position.clone():eb.clone()}else{let r=en.get(t);e=r?new a.Vector3(r.position.x,r.position.y,r.position.z):(null==i?void 0:i.position)?new a.Vector3(i.position.x,i.position.y,i.position.z):new a.Vector3(0,0,0)}eH(t,r,e,n)}};return ef.on("player-attacked",e),ef.on("player-used-ability",t),ef.on("player-damaged",n),ef.on("player-animation-state",i),ef.on("player-effect",o),ef.on("player-debuff",s),()=>{ef.off("player-attacked",e),ef.off("player-used-ability",t),ef.off("player-damaged",n),ef.off("player-animation-state",i),ef.off("player-effect",o),ef.off("player-debuff",s)}},[ef,eI,en]),(0,i.useEffect)(()=>{let e=setInterval(()=>{e$(e=>{let t=new Map(e),r=Date.now(),n=!1;return t.forEach((e,i)=>{e.lastAnimationUpdate&&r-e.lastAnimationUpdate>3e3&&(e.isSwinging||e.isCharging||e.isSpinning)&&(console.log("\uD83D\uDD27 Force resetting stuck animation for player ".concat(i)),t.set(i,{...e,isSwinging:!1,isCharging:!1,isSpinning:!1}),n=!0)}),n?t:e})},1e3);return()=>clearInterval(e)},[]),(0,i.useEffect)(()=>{if(!ey.current||!eo)return;let e=ey.current.getWorld();en.forEach((t,r)=>{if(r!==(null==ef?void 0:ef.id)){if(eE.current.has(r)){let n=eE.current.get(r),i=e.getEntity(n);if(i){let e=i.getComponent(u.w);e&&(e.position.clone(),e.setPosition(t.position.x,t.position.y,t.position.z));let r=i.getComponent(h.i);r&&(r.velocity.set(0,0,0),r.acceleration.set(0,0,0));let n=i.getComponent(p.S);n&&(n.maxHealth=t.maxHealth,n.currentHealth=t.health)}else console.warn("⚠️ Could not find local ECS entity ".concat(n," for PVP player ").concat(r))}else{let n=e.createEntity(),i=e.createComponent(u.w);i.setPosition(t.position.x,t.position.y,t.position.z),n.addComponent(i);let o=new p.S(t.maxHealth);o.currentHealth=t.health,n.addComponent(o);let a=new g.W(100,20,5);n.addComponent(a);let s=e.createComponent(h.i);s.maxSpeed=3.75,s.jumpForce=8,s.friction=.85,s.canMove=!1,n.addComponent(s);let l=e.createComponent(f.YM);l.type=f.F5.SPHERE,l.radius=.9,l.layer=f.aB.ENEMY,l.setMask(f.aB.ENVIRONMENT),l.setOffset(0,.25,0),n.addComponent(l),e.notifyEntityAdded(n),eE.current.set(r,n.id)}}});let t=new Set(en.keys()),r=[];eE.current.forEach((n,i)=>{if(!t.has(i)||i===(null==ef?void 0:ef.id)){let t=e.getEntity(n);if(t){let e=t.getComponent(p.S);e&&(e.currentHealth=0,e.isDead=!0),console.log("\uD83D\uDC80 Marked local ECS entity ".concat(n," as dead for disconnected player ").concat(i))}r.push(i)}}),r.forEach(e=>{eE.current.delete(e)}),ei.forEach((t,r)=>{if(eF.current.has(r)){let n=eF.current.get(r),i=e.getEntity(n);if(i){let e=i.getComponent(p.S);e&&(e.maxHealth=t.maxHealth,e.currentHealth=t.health,t.isDead&&!e.isDead&&(e.currentHealth=0,e.isDead=!0));let r=i.getComponent(y.N);r&&t.isDead&&!r.isDead&&r.die(Date.now()/1e3)}else console.warn("⚠️ Could not find local ECS entity ".concat(n," for tower ").concat(r))}else{let n=e.createEntity(),i=e.createComponent(u.w);i.setPosition(t.position.x,t.position.y,t.position.z),n.addComponent(i);let o=e.createComponent(y.N);o.ownerId=t.ownerId,o.towerIndex=t.towerIndex,n.addComponent(o);let a=new p.S(t.maxHealth);a.currentHealth=t.health,n.addComponent(a);let s=e.createComponent(f.YM);s.type=f.F5.CYLINDER,s.radius=1.5,s.height=4,s.layer=f.aB.ENEMY,s.setMask(f.aB.ENVIRONMENT|f.aB.PLAYER),s.setOffset(0,2,0),n.addComponent(s),e.notifyEntityAdded(n),eF.current.set(r,n.id)}});let n=new Set(ei.keys()),i=[];eF.current.forEach((t,r)=>{if(!n.has(r)){let n=e.getEntity(t);if(n){let e=n.getComponent(p.S),i=n.getComponent(y.N);e&&i&&(e.currentHealth=0,e.isDead=!0,i.die(Date.now()/1e3)),console.log("\uD83D\uDC80 Marked local ECS entity ".concat(t," as dead for removed tower ").concat(r))}i.push(r)}}),i.forEach(e=>{eF.current.delete(e)})},[en,ei,eo,null==ef?void 0:ef.id]),(0,i.useEffect)(()=>{ev.current&&(null==ef?void 0:ef.id)&&ev.current.setPlayerMapping(eE.current,ef.id)},[en,null==ef?void 0:ef.id]),(0,i.useEffect)(()=>{if(ew.current||!eo)return;ew.current=!0,(0,Z.j4)(0),(0,Z.Ge)(0);let e=new c.D({enableDebug:!0});ey.current=e;let t=et.domElement;return e.initialize(t).then(()=>{let{player:t,controlSystem:r,towerSystem:n}=function(e,t,r,n,i,o){let s=e.getWorld(),l=e.getInputManager();n.shadowMap.enabled=!0,n.shadowMap.type=a.PCFSoftShadowMap;let c=new w.F,d=new S.s(5),m=new b.b(s),y=new x.K(t,r,n),I=new j.c(s),P=new C.R(s),D=new M.s(r,l,s,I),E=new v.D(r,l,{distance:8,height:2,mouseSensitivity:.005,smoothing:.15});I.setCombatSystem(m),P.setProjectileSystem(I),m.setPlayerDamageCallback(i),s.addSystem(c),s.addSystem(d),s.addSystem(m),s.addSystem(y),s.addSystem(I),s.addSystem(P),s.addSystem(D),s.addSystem(E);let F=function(e){let t=e.createEntity(),r=e.createComponent(u.w);r.setPosition(0,.5,0),t.addComponent(r);let n=e.createComponent(h.i);n.maxSpeed=3.75,n.jumpForce=8,n.friction=.85,t.addComponent(n);let i=new p.S(500);i.enableRegeneration(2,10),t.addComponent(i);let o=new g.W(200,20,5);t.addComponent(o);let a=e.createComponent(f.YM);return a.type=f.F5.SPHERE,a.radius=.9,a.layer=f.aB.PLAYER,a.setMask(f.aB.ENVIRONMENT),a.setOffset(0,.5,0),t.addComponent(a),console.log("\uD83D\uDC64 PVP player entity created with components:",{transform:!!t.getComponent(u.w),movement:!!t.getComponent(h.i),health:!!t.getComponent(p.S),shield:!!t.getComponent(g.W),collider:!!t.getComponent(f.YM)}),t.getComponent(f.YM),t}(s);return D.setPlayer(F),E.setTarget(F),E.snapToTarget(),console.log("\uD83C\uDF0D Total entities in PVP world:",s.getAllEntities().length),console.log("\uD83D\uDC64 Player entity created with ID: ".concat(F.id)),{player:F,controlSystem:D,towerSystem:P}}(e,X,ee,et,(e,t)=>{let r=parseInt(e),n=null;eE.current.forEach((e,t)=>{e===r&&(n=t)}),n?(console.log("\uD83C\uDFAF Mapping local entity ".concat(e," to server player ").concat(n," for ").concat(t," PVP damage")),eh(n,t)):console.warn("⚠️ Could not find server player ID for local entity ".concat(e))},0);console.log("\uD83C\uDFAE PVP Player entity created:",t,"ID:",t.id),eP(t),ex.current=t.id,eM.current=r,ev.current=n,n&&(null==ef?void 0:ef.id)&&n.setPlayerMapping(eE.current,ef.id),$&&$(r),r.setBowReleaseCallback((t,n)=>{if(eI){let e=eI.getComponent(u.w);if(e){let r=new a.Vector3;ee.getWorldDirection(r),r.normalize(),ec("bow_release",e.position,r,{chargeProgress:t,isPerfectShot:n})}}if(n){let t=e.getWorld().getEntity(ex.current);if(t){let e=t.getComponent(u.w);if(e){let t=new a.Vector3;ee.getWorldDirection(t),t.normalize();let n=new a.Vector3;n.crossVectors(t,new a.Vector3(0,1,0)).normalize();let i=new a.Matrix4;i.makeRotationAxis(n,Math.PI/12),t.applyMatrix4(i),t.normalize(),eX(e.position.clone(),t,r.getCurrentSubclass(),!0,!0)}}}}),r.setDivineStormCallback((e,t,r)=>{console.log("⚡ PVP Divine Storm activated - broadcasting to other players"),(0,O.e6)(e,null==ef?void 0:ef.id,r),ed("divine_storm",e,t)}),r.setViperStingCallback((e,t)=>{ed("viper_sting",e,t)}),r.setBarrageCallback((e,t)=>{ed("barrage",e,t)}),r.setFrostNovaCallback((e,t)=>{ed("frost_nova",e,t)}),r.setCobraShotCallback((e,t)=>{}),r.setChargeCallback((e,t)=>{ed("charge",e,t),ec("sword_charge_start",e,t,{isSwordCharging:!0})}),r.setSkyfallCallback((e,t)=>{console.log("\uD83C\uDF1F PVP Skyfall triggered - broadcasting to other players"),ed("skyfall",e,t)}),r.setBackstabCallback((e,t,r,n)=>{console.log("\uD83D\uDDE1️ PVP Backstab triggered - broadcasting to other players (damage: ".concat(r,", backstab: ").concat(n,")")),ed("backstab",e,t)}),console.log("\uD83D\uDD27 Debug: Setting up debuff callback for ControlSystem"),r.setDebuffCallback((e,t,r,n)=>{console.log("\uD83C\uDFAF PVP Debuff callback triggered - ".concat(t," effect on entity ").concat(e));let i=null;eE.current.forEach((t,r)=>{t===e&&(i=r)}),i&&eg?(console.log("\uD83C\uDFAF Broadcasting ".concat(t," effect to player ").concat(i)),eg(i,t,r,{position:{x:n.x,y:n.y,z:n.z}})):console.warn("⚠️ Could not find server player ID for local entity ".concat(e))}),r.setProjectileCreatedCallback((e,t,n,i)=>{let o={};(e.includes("arrow")||e.includes("bolt"))&&(o.chargeProgress=r.getChargeProgress()),ec(e,t,n,o)}),r.setReanimateCallback(()=>{if(ej.current&&ej.current.triggerHealingEffect(),t){let e=t.getComponent(u.w);if(e){let t=new a.Vector3;ee.getWorldDirection(t),t.normalize(),ed("reanimate",e.position,t)}}}),e.start()}),()=>{ey.current&&ey.current.destroy(),L.$h.clear()}},[X,ee,et,eo]),(0,i.useEffect)(()=>{window.pvpPlayers=en,window.localSocketId=null==ef?void 0:ef.id},[en,null==ef?void 0:ef.id]),(0,o.F)((e,r)=>{if(ey.current&&ey.current.isEngineRunning()&&eo){V.u.resetFrameTemporaries();let e=[];if(eI){let t=eI.getComponent(u.w);if(t&&t.position){let r=t.position.clone();e.push({setter:eC,value:r}),eD.current.position.copy(r);let n=new a.Vector3;ee.getWorldDirection(n);let i=Math.atan2(n.x,n.z);eD.current.quaternion={x:0,y:Math.sin(i/2),z:0,w:Math.cos(i/2)},ea(t.position,{x:0,y:i,z:0})}}if(eM.current){let t={currentWeapon:eM.current.getCurrentWeapon(),currentSubclass:eM.current.getCurrentSubclass(),isCharging:eM.current.isWeaponCharging(),chargeProgress:eM.current.getChargeProgress(),isSwinging:eM.current.isWeaponSwinging(),isSpinning:eM.current.isWeaponCharging()&&eM.current.getCurrentWeapon()===I.v.SCYTHE,swordComboStep:eM.current.getSwordComboStep(),isDivineStorming:eM.current.isDivineStormActive(),isSwordCharging:eM.current.isChargeActive(),isDeflecting:eM.current.isDeflectActive(),isViperStingCharging:eM.current.isViperStingChargingActive(),viperStingChargeProgress:eM.current.getViperStingChargeProgress(),isBarrageCharging:eM.current.isBarrageChargingActive(),barrageChargeProgress:eM.current.getBarrageChargeProgress(),isCobraShotCharging:eM.current.isCobraShotChargingActive(),cobraShotChargeProgress:eM.current.getCobraShotChargeProgress(),isSkyfalling:eM.current.isSkyfallActive(),isBackstabbing:eM.current.isBackstabActive()},r=eJ.current;(t.currentWeapon!==r.weapon||t.currentSubclass!==r.subclass)&&(es(t.currentWeapon,t.currentSubclass),eJ.current={weapon:t.currentWeapon,subclass:t.currentSubclass}),e.push({setter:eQ,value:t});let n=Date.now();if(n-eS.current>100){let e=t.currentWeapon===I.v.SCYTHE&&t.isCharging,r=t.isDivineStorming||t.isSwordCharging;eu({isCharging:t.isCharging,chargeProgress:t.chargeProgress,isSwinging:t.isSwinging,swordComboStep:t.swordComboStep,isDivineStorming:t.isDivineStorming,isSpinning:e||r,isDeflecting:t.isDeflecting,isSwordCharging:t.isSwordCharging,isViperStingCharging:t.isViperStingCharging,viperStingChargeProgress:t.viperStingChargeProgress,isBarrageCharging:t.isBarrageCharging,barrageChargeProgress:t.barrageChargeProgress,isBackstabbing:t.isBackstabbing}),eS.current=n}}let r=ey.current.getWorld().getSystem(b.b);if(r&&t&&t(r.getDamageNumbers()),J&&J(ee,er),Date.now()%1e4<16&&console.log("\uD83D\uDD27 PVP Performance Stats:",{objectPool:e2(),stateBatcher:L.$h.getStats()}),K&&eI&&eM.current){let e=eI.getComponent(p.S),t=eI.getComponent(g.W);e&&(K({playerHealth:e.currentHealth,maxHealth:e.maxHealth,playerShield:t?t.currentShield:0,maxShield:t?t.maxShield:0,currentWeapon:eM.current.getCurrentWeapon(),currentSubclass:eM.current.getCurrentSubclass()}),el(e.currentHealth,e.maxHealth))}e.length>0&&L.VO.batchGameStateUpdates(e)}}),i.useEffect(()=>{z&&(window.handleDamageNumberComplete=e=>{var t;let r=null===(t=ey.current)||void 0===t?void 0:t.getWorld().getSystem(b.b);r&&r.removeDamageNumber(e)})},[z]),eo)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(q.Z,{level:1,world:null===(e=ey.current)||void 0===e?void 0:e.getWorld()}),(0,n.jsx)("ambientLight",{intensity:.3}),(0,n.jsx)("directionalLight",{position:[10,10,5],intensity:.5,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),(0,n.jsxs)("mesh",{receiveShadow:!0,position:[0,-.5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[29,29,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#2d5a2d"})]}),(0,n.jsxs)("mesh",{position:[0,.01,0],scale:[2.5,2.5,2.5],children:[(0,n.jsx)("ringGeometry",{args:[25,29,64]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6b6b",transparent:!0,opacity:.3})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[0,1,-10],children:[(0,n.jsx)("boxGeometry",{args:[4,2,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#696969"})]}),eI&&ey.current&&ef&&(0,n.jsx)(s.Z,{entityId:eI.id,position:eb,world:ey.current.getWorld(),currentWeapon:eY.currentWeapon,currentSubclass:eY.currentSubclass,isCharging:eY.isCharging,chargeProgress:eY.chargeProgress,isSwinging:eY.isSwinging,isSpinning:eY.isSpinning,swordComboStep:eY.swordComboStep,isDivineStorming:eY.isDivineStorming,isSwordCharging:eY.isSwordCharging,isDeflecting:eY.isDeflecting,isViperStingCharging:eY.isViperStingCharging,viperStingChargeProgress:eY.viperStingChargeProgress,isBarrageCharging:eY.isBarrageCharging,barrageChargeProgress:eY.barrageChargeProgress,isCobraShotCharging:eY.isCobraShotCharging,cobraShotChargeProgress:eY.cobraShotChargeProgress,isSkyfalling:eY.isSkyfalling,isBackstabbing:eY.isBackstabbing,reanimateRef:ej,isLocalPlayer:!0,onBowRelease:()=>{},onScytheSwingComplete:()=>{let e=new a.Vector3;ee.getWorldDirection(e),e.normalize(),ec("scythe_swing",eb,e,{isSpinning:!0})},onSwordSwingComplete:()=>{var e;null===(e=eM.current)||void 0===e||e.onSwordSwingComplete();let t=new a.Vector3;ee.getWorldDirection(t),t.normalize(),ec("sword_swing",eb,t,{comboStep:eY.swordComboStep})},onSabresSwingComplete:()=>{var e;null===(e=eM.current)||void 0===e||e.onSabresSwingComplete();let t=new a.Vector3;ee.getWorldDirection(t),t.normalize(),ec("sabres_swing",eb,t)},onChargeComplete:()=>{var e;null===(e=eM.current)||void 0===e||e.onChargeComplete();let t=new a.Vector3;ee.getWorldDirection(t),t.normalize(),ec("sword_charge_spin",eb,t,{isSpinning:!0})},onDeflectComplete:()=>{var e;null===(e=eM.current)||void 0===e||e.onDeflectComplete()}}),Array.from(en.values()).map(e=>{var t;if(e.id===(null==ef?void 0:ef.id))return null;let r=eK.get(e.id)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return(0,n.jsx)(s.Z,{entityId:parseInt(e.id.replace(/\D/g,"0")),position:new a.Vector3(e.position.x,e.position.y,e.position.z),world:(null===(t=ey.current)||void 0===t?void 0:t.getWorld())||new d.q,currentWeapon:e.weapon,currentSubclass:e.subclass,isCharging:r.isCharging,chargeProgress:r.chargeProgress,isSwinging:r.isSwinging,isSpinning:r.isSpinning,swordComboStep:r.swordComboStep,isDivineStorming:r.isDivineStorming,isSwordCharging:r.isSwordCharging,isDeflecting:r.isDeflecting,isViperStingCharging:r.isViperStingCharging,viperStingChargeProgress:r.viperStingChargeProgress,isBarrageCharging:r.isBarrageCharging,barrageChargeProgress:r.barrageChargeProgress,isCobraShotCharging:r.isCobraShotCharging,cobraShotChargeProgress:r.cobraShotChargeProgress,isSkyfalling:r.isSkyfalling,isBackstabbing:r.isBackstabbing,rotation:e.rotation,isLocalPlayer:!1,onBowRelease:()=>{},onScytheSwingComplete:()=>{},onSwordSwingComplete:()=>{}},e.id)}),Array.from(ei.values()).map(e=>{var t;return(0,n.jsx)(U,{entityId:parseInt(e.id.replace(/\D/g,"0")),world:(null===(t=ey.current)||void 0===t?void 0:t.getWorld())||new d.q,position:new a.Vector3(e.position.x,e.position.y,e.position.z),ownerId:e.ownerId,towerIndex:e.towerIndex,health:e.health,maxHealth:e.maxHealth,isDead:e.isDead},e.id)}),Array.from(en.values()).map(e=>{if(e.id===(null==ef?void 0:ef.id))return null;let t=eE.current.get(e.id),r=0,i=200;if(t&&ey.current){let e=ey.current.getWorld().getEntity(t);if(e){let t=e.getComponent(g.W);t&&(r=t.currentShield,i=t.maxShield)}}return(0,n.jsx)(_,{playerId:e.id,playerName:e.name,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,maxHealth:e.maxHealth,shield:r,maxShield:i,camera:ee,showDistance:35},"healthbar-".concat(e.id))}),ey.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(P.Z,{world:ey.current.getWorld()}),(0,n.jsx)(D.Z,{}),(0,n.jsx)(E.default,{world:ey.current.getWorld()}),(0,n.jsx)(R.default,{world:ey.current.getWorld()}),(0,n.jsx)(O.ZP,{enemyData:Array.from(en.values()).filter(e=>e.id!==(null==ef?void 0:ef.id)).map(e=>({id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health})),onHitTarget:(e,t)=>{eh&&eh(e,t)}}),(0,n.jsx)(H.ZP,{}),(0,n.jsx)(G,{world:ey.current.getWorld(),players:Array.from(en.values()),serverPlayerEntities:eE,localSocketId:null==ef?void 0:ef.id,onPlayerHit:(e,t)=>{eh&&eh(e,t)},onPlayerVenomed:(e,t)=>{let r=t.clone();eq(e,r),ep&&ep({type:"venom",targetPlayerId:e,position:{x:r.x,y:r.y,z:r.z},duration:6e3})}}),(0,n.jsx)(N,{world:ey.current.getWorld(),players:Array.from(en.values()),serverPlayerEntities:eE,localSocketId:null==ef?void 0:ef.id,onPlayerHit:(e,t)=>{eh&&eh(e,t)},onPlayerSlowed:(e,t)=>{let r=t.clone();eH(e,"slowed",r,5e3),eg&&eg(e,"slowed",5e3,{position:{x:r.x,y:r.y,z:r.z},speedMultiplier:.5})}}),(0,n.jsx)(W,{world:ey.current.getWorld(),players:Array.from(en.values()),serverPlayerEntities:eE,localSocketId:null==ef?void 0:ef.id,onPlayerHit:(e,t)=>{eh&&eh(e,t)},onPlayerFrozen:(e,t)=>{e_(e,t.clone())}}),(0,n.jsx)(A.default,{parentRef:eD,enemyData:Array.from(en.values()).filter(e=>e.id!==(null==ef?void 0:ef.id)).map(e=>({id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,isDying:!1})),onHit:(e,t)=>{eh&&eh(e,t)},setDamageNumbers:()=>{},nextDamageNumberId:{current:Date.now()},charges:[{id:1,available:!0,cooldownStartTime:null},{id:2,available:!0,cooldownStartTime:null},{id:3,available:!0,cooldownStartTime:null}],setCharges:()=>{}}),eR.map(e=>{let t=en.get(e.playerId),r=t?new a.Vector3(t.position.x,t.position.y,t.position.z):e.position;return(0,n.jsx)(Q,{position:r,onComplete:()=>{eA(t=>t.filter(t=>t.id!==e.id))}},e.id)}),eW.map(e=>{let t=en.get(e.playerId),r=t?new a.Vector3(t.position.x,t.position.y,t.position.z):e.position;return(0,n.jsx)(F.Z,{position:r,duration:e.duration,startTime:e.startTime,onComplete:()=>{eL(t=>t.filter(t=>t.id!==e.id))}},e.id)}),eB.map(e=>{let t=en.get(e.playerId),r=t?new a.Vector3(t.position.x,t.position.y,t.position.z):e.position;return(0,n.jsx)(T.Z,{position:r,duration:e.duration,startTime:e.startTime,enemyId:e.playerId,enemyData:Array.from(en.values()).filter(e=>e.id!==(null==ef?void 0:ef.id)).map(e=>({id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,isDying:!1})),onComplete:()=>{ek(t=>t.filter(t=>t.id!==e.id))}},e.id)}),eV.map(e=>{let t;let r=en.get(e.playerId);if(e.playerId===(null==ef?void 0:ef.id)&&eI){let e=eI.getComponent(u.w);t=e?new a.Vector3(e.position.x,e.position.y+.5,e.position.z):new a.Vector3(eb.x,eb.y+.5,eb.z)}else t=r?new a.Vector3(r.position.x,r.position.y+.5,r.position.z):new a.Vector3(e.position.x,e.position.y+.5,e.position.z);return"frozen"===e.debuffType?(0,n.jsx)(k.Z,{position:t,duration:e.duration,startTime:e.startTime,enemyId:e.playerId,enemyData:Array.from(en.values()).map(e=>{if(e.id!==(null==ef?void 0:ef.id)||!eI)return{id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,isDying:!1};{let t=eI.getComponent(u.w),r=t?t.position:eb;return{id:e.id,position:r.clone(),health:e.health,isDying:!1}}}),onComplete:()=>{eG(t=>t.filter(t=>t.id!==e.id))}},e.id):(0,n.jsx)(B,{position:t,debuffType:e.debuffType,duration:e.duration,startTime:e.startTime,onComplete:()=>{eG(t=>t.filter(t=>t.id!==e.id))}},e.id)})]})]}):null}Q.displayName="PVPReanimateEffect"},1159:function(e,t,r){var n=r(7437),i=r(2265);let o=i.memo(()=>{let e=(0,i.useRef)(null),t=(0,i.useMemo)(()=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,n.jsxs)("group",{position:[0,e,0],scale:t,children:[(0,n.jsxs)("group",{rotation:[0,0,-Math.PI/3],children:[(0,n.jsxs)("mesh",{position:[.085,.05,.08],rotation:[.3,Math.PI/2,-.5],children:[(0,n.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,0,-.1],children:[(0,n.jsx)("sphereGeometry",{args:[.0375,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("group",{rotation:[0,0,Math.PI/3],children:[(0,n.jsxs)("mesh",{position:[-.085,.05,.08],rotation:[.3,-Math.PI/2,0],children:[(0,n.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.3,-.15,0],children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.05,.075,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]})},[]),r=(0,i.useMemo)(()=>()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.9,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.3,-.15,0,.15,.3].map((e,t)=>(0,n.jsxs)("group",{position:[0,e,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.06,.04,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,0,-.125],children:[(0,n.jsx)("boxGeometry",{args:[.0175,.06,.075]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]},t))]}),[]);return(0,n.jsx)("group",{ref:e,position:[0,.04,-0],rotation:[.25,Math.PI+Math.PI,0],children:(0,n.jsxs)("group",{children:[r(),(0,n.jsxs)("group",{position:[0,0,0],children:[t(.45,.7),t(.3,.8),t(.15,.9),t(0,1),t(-.15,.9),t(-.3,.8),t(-.45,.7)]})]})})});o.displayName="BonePlate",t.Z=o},4842:function(e,t,r){var n=r(7437),i=r(2265),o=r(1448),a=r(1276);t.Z=e=>{let{movementDirection:t=new o.Vector3}=e,r=(0,i.useRef)(null),[s,l]=(0,i.useState)({x:0,y:0});(0,a.F)(e=>{let{clock:n}=e;if(!r.current)return;let i=n.getElapsedTime(),o=1.2*t.length(),a=-(.45*t.z)*o,s=-(.125*t.x)*o,c=Math.min(1.5*o,1),d=.035*Math.sin(.7*i)*(1-c)+a*c,u=.175*Math.sin(.5*i)*(1-c)+s*c;l({x:d,y:u}),r.current.rotation.x=.1+d,r.current.rotation.y=u});let c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,r=1.8*Math.pow(t/20,5),i=Math.max(0,1-t/15),o=s.x*i,a=s.y*Math.pow(i,1.2);return(0,n.jsxs)("group",{position:[0,-r+.325,-(.2*t)*(1-t/40-.1)],scale:e,rotation:[-(Math.atan2(.8*Math.pow((t+1)/15,2.2)-r,.4*(1-t/20))+(0===t?Math.PI:0)+o*(1-t/15))+.85*o,a*(1-t/2),0],children:[(0,n.jsxs)("mesh",{rotation:[-(Math.PI/4),0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.055,.125,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("group",{rotation:[Math.PI/2,0,Math.PI/2],children:[(0,n.jsxs)("mesh",{position:[0,.08,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.08,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.015,.25,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,-(Math.PI/2)],children:[(0,n.jsx)("coneGeometry",{args:[.015,.2,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]}),(0,n.jsxs)("group",{rotation:[Math.PI/24,0,-Math.PI/2],children:[(0,n.jsxs)("mesh",{position:[0,.08,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.05,0,0],rotation:[0,0,2*Math.PI],children:[(0,n.jsx)("coneGeometry",{args:[.0125,.04,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.015,.04,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]}),(0,n.jsxs)("mesh",{position:[0,.025,.06],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("sphereGeometry",{args:[.025,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]})};return(0,n.jsx)("group",{ref:r,position:[0,-.7,-.25],rotation:[-.1,0,0],children:[...Array(15)].map((e,t)=>(0,n.jsx)(i.Fragment,{children:c(1-.04*t,t)},t))})}},7988:function(e,t,r){r.d(t,{Z:function(){return T}});var n=r(7437),i=r(2265),o=r(1448),a=r(1276),s=r(1159),l=r(4842);let c=i.memo(e=>{let{isLeftWing:t,isDashing:r}=e,s=(0,i.useRef)(null),[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(0),h=(0,i.useRef)([]),p=(0,i.useMemo)(()=>[{pos:new o.Vector3(t?-.3:.3,.275,0),rot:new o.Euler(0,0,t?-Math.PI/5:Math.PI/5),scale:1.2},{pos:new o.Vector3(t?-.5:.5,.45,0),rot:new o.Euler(0,0,t?-Math.PI/3.5:Math.PI/3.5),scale:1.4},{pos:new o.Vector3(t?-.65:.65,.6,0),rot:new o.Euler(0,0,t?-Math.PI/2.5:Math.PI/2.5),scale:1},{pos:new o.Vector3(t?-.85:.85,.72,.1),rot:new o.Euler(.1,0,t?-Math.PI/2.2:Math.PI/2.2),scale:1},{pos:new o.Vector3(t?-1.05:1.05,.8,.2),rot:new o.Euler(.2,0,t?-Math.PI/2:Math.PI/2),scale:.9},{pos:new o.Vector3(t?-1.2:1.2,.9,.2),rot:new o.Euler(.2,0,t?-Math.PI/1.8:Math.PI/1.8),scale:.8},{pos:new o.Vector3(t?-1.3:1.3,.75,.2),rot:new o.Euler(.05,0,t?-(-Math.PI/.475):-(Math.PI/.475)),scale:1},{pos:new o.Vector3(t?.05:-.05,-.5,-0),rot:new o.Euler(.05,0,t?-(-Math.PI/.475):-(Math.PI/.475)),scale:.8}],[t]),g=(0,i.useMemo)(()=>[-1,-1,-1,-1,-1,-1,-1,6],[]),m=(0,i.useMemo)(()=>p.map(e=>e.rot.clone()),[p]);(0,i.useEffect)(()=>{r&&!l&&(c(!0),u(Date.now()/1e3))},[r,l]),(0,a.F)(()=>{if(l&&h.current.length>0){let e=Math.min((Date.now()/1e3-d)/.45,1);if(e>=1)c(!1),h.current.forEach((e,t)=>{e&&m[t]&&e.rotation.copy(m[t])});else{let r=.3*Math.sin(e*Math.PI*2),n=.5*Math.sin(e*Math.PI);h.current.forEach((e,i)=>{if(e&&m[i]){let o=m[i],a=r*(1-.1*i);e.rotation.x=o.x,e.rotation.y=o.y,e.rotation.z=o.z+(t?-a-n:a+n)}})}}});let f=(0,i.useMemo)(()=>()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.023,.0175,.32,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:new o.Vector3(0,.2,0),children:[(0,n.jsx)("sphereGeometry",{args:[.035,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.4,metalness:.3})]})]}),[]),y=e=>{if(e>=p.length)return null;let t=p[e],r=g.map((t,r)=>t===e?r:-1).filter(e=>-1!==e);return(0,n.jsxs)("group",{ref:t=>{h.current[e]=t},position:t.pos,rotation:t.rot,scale:t.scale,children:[f(),r.map(e=>(0,n.jsx)("group",{position:new o.Vector3(0,.16,0),children:y(e)},"child-".concat(e)))]},"bone-".concat(e))};return(0,n.jsx)("group",{ref:s,rotation:new o.Euler(0,Math.PI,0),position:new o.Vector3(0,-.3,0),children:g.map((e,t)=>-1===e?y(t):null)})});c.displayName="BoneWings";let d=i.memo(e=>{let{isLeft:t=!1}=e,r=1.75*Math.PI;return(0,n.jsx)("group",{rotation:[-.45,t?-.7:.7,t?-.15:.15],children:Array.from({length:18}).map((e,i)=>{let o=i/19,a=.075*(1-.725*o),s=3.25*Math.pow(o,2.7);return(0,n.jsxs)("group",{position:[s*(t?-.15:.15),.0675*i,-(.725*s)],rotation:[-1.5*o,Math.pow(o,.2)*r,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[a,1.5*a,.0675,10]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*o,", ").concat(0+20*o,", ").concat(0+20*o,")"),roughness:.7,metalness:.4})]}),Array.from({length:6}).map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI/2,0],children:(0,n.jsxs)("mesh",{position:[.95*a,0,0],children:[(0,n.jsx)("boxGeometry",{args:[.3*a,.259375,1.5*a]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*o,", ").concat(20+20*o,", ").concat(20+20*o,")"),roughness:.8,metalness:.3})]})},t))]},i)})})});d.displayName="DragonHorns";var u=r(7125);let h=i.memo(e=>{let{parentRef:t,dashCharges:r,weaponType:s,weaponSubclass:l}=e,c=(0,i.useRef)(null),d=()=>{if(l)switch(l){case u.p.CHAOS:return"#00FF37";case u.p.ABYSSAL:return"#17CE54";case u.p.DIVINITY:return"#87CEEB";case u.p.VENGEANCE:return"#4682B4";case u.p.FROST:case u.p.ASSASSIN:case u.p.PYRO:return"#FF544E";case u.p.STORM:return"#C6C6C6";case u.p.ELEMENTAL:return"#3EB0FC";case u.p.VENOM:return"#17CC93"}switch(s){case u.v.SCYTHE:return"#17CE54";case u.v.SWORD:return"#87CEEB";case u.v.SABRES:return"#FF544E";case u.v.SPEAR:return"#C6C6C6";case u.v.BOW:return"#3A905E"}};return(0,a.F)(e=>{let{clock:n}=e;if(!c.current||!t.current)return;let i=n.getElapsedTime();c.current.children.forEach((e,t)=>{let n=t/r.length*Math.PI*2+.5*i,o=.1+Math.sin(2*i+t);e.position.set(Math.cos(n)*o,.1*Math.sin(1.5*i+.5*t),Math.sin(n)*o),e.rotation.x=2*i+t,e.rotation.y=1.5*i+.7*t}),c.current.position.copy(t.current.position)}),(0,n.jsx)("group",{ref:c,children:r.map((e,t)=>{let r=e.isAvailable,i=d(),a="#333333";return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.115,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(r?i:a),emissive:new o.Color(r?i:a),emissiveIntensity:r?.3:.1,transparent:!0,opacity:r?.8:.4})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.115*1.225,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:r?i:"#333333",emissive:r?i:"#333333",emissiveIntensity:r?.5:.1,transparent:!0,opacity:r?.4:.15,depthWrite:!1,side:o.DoubleSide,blending:o.AdditiveBlending})]})]},t)})})});h.displayName="ChargedOrbitals";let p=()=>(0,n.jsxs)("group",{rotation:[Math.PI/4,0,0],position:[0,-.125,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.0175,.0175,.175,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:new o.Vector3(0,.1,0),rotation:new o.Euler(0,0,Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:new o.Vector3(0,-.1,0),rotation:new o.Euler(0,0,-Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.0325,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#a4a4a4",roughness:.5,metalness:.2})]})]});function g(e){let{parentRef:t}=e,r=(0,i.useRef)([]),o=(0,i.useRef)(null);return(0,a.F)(()=>{if(!t.current||!o.current)return;let e=t.current.position;o.current.position.set(e.x,0,e.z),r.current.forEach((e,t)=>{let r=t/16*Math.PI*2+.001*Date.now(),n=-(.4675*Math.cos(r)),i=.4675*Math.sin(r),o=.02*Math.sin(.002*Date.now()+t);e.position.set(n,o-.5,i),e.rotation.y=r+Math.PI/3})}),(0,n.jsx)("group",{ref:o,children:Array.from({length:16}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(r.current[t]=e)},children:p()},t))})}function m(e){let{chargeProgress:t,isCharging:r,onRelease:s,currentSubclass:l,hasInstantPowershot:c=!1,isAbilityBowAnimation:d=!1,isViperStingCharging:h=!1,viperStingChargeProgress:p=0,isBarrageCharging:g=!1,barrageChargeProgress:m=0,isCobraShotCharging:f=!1,cobraShotChargeProgress:y=0}=e,x=(0,i.useRef)(null),M=(0,i.useRef)(r),v=t>=.8&&t<=.98;(0,a.F)(()=>{let e=r&&!d&&!h&&!g&&!f;if(M.current&&!e&&!h&&!g&&!f){let e=t>=.8&&t<=.98;s(t,e)}M.current=e});let j=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e},w={steps:1,depth:.03,bevelEnabled:!1};return(0,n.jsx)("group",{position:[.6,.65,.875],rotation:[-Math.PI/2,-Math.PI/2,-Math.PI/2],scale:[.875,.8,.8],children:(0,n.jsxs)("group",{ref:x,position:[-.9,.075,.75],rotation:[Math.PI,Math.PI/2,0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("tubeGeometry",{args:[new o.CatmullRomCurve3([new o.Vector3(-.875,0,0),new o.Vector3(-.85,.2,0),new o.Vector3(-.25,.5,0),new o.Vector3(-.4,.35,0),new o.Vector3(.4,.35,0),new o.Vector3(.25,.5,0),new o.Vector3(.85,.2,0),new o.Vector3(.875,0,0)]),64,.035,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:v?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:v?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:v?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*p:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("tubeGeometry",{args:[(e=>{let t=1.35*e;return new o.CubicBezierCurve3(new o.Vector3(-.8,0,0),new o.Vector3(0,0,-t),new o.Vector3(0,0,-t),new o.Vector3(.8,0,0))})(f?y:g?m:h?p:t),16,.02,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:1,transparent:!0,opacity:.6})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[-.4,0,.475],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,n.jsx)("meshStandardMaterial",{color:v?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:v?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:v?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*p:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{position:[.4,0,.475],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,n.jsx)("meshStandardMaterial",{color:v?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:v?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:v?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*p:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,transparent:!0,opacity:.8})]})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[-1,0,-.2],rotation:[Math.PI/2,0,Math.PI/2],scale:[.4,-.4,.4],children:[(0,n.jsx)("extrudeGeometry",{args:[j(),w]}),(0,n.jsx)("meshStandardMaterial",{color:v?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:v?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:v?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*p:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,metalness:.8,roughness:.1,transparent:!0,opacity:.8,side:o.DoubleSide})]}),(0,n.jsxs)("mesh",{position:[1,0,-.2],rotation:[Math.PI/2,0,Math.PI/2],scale:[.4,.4,.4],children:[(0,n.jsx)("extrudeGeometry",{args:[j(),w]}),(0,n.jsx)("meshStandardMaterial",{color:v?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:v?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:v?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*p:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,metalness:.8,roughness:.1,transparent:!0,opacity:.8,side:o.DoubleSide})]})]}),(r||h||g||f)&&(0,n.jsxs)("group",{position:[0,0,.8-(f?y:g?m:h?p:t)*1.35],rotation:[Math.PI/2,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.9,8]}),(0,n.jsx)("meshStandardMaterial",{color:f?"#00ff40":g?"#ff8800":h?"#A855C7":"#00ffff",emissive:f?"#00ff40":g?"#ff8800":h?"#A855C7":"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsxs)("mesh",{position:[0,.35,0],children:[(0,n.jsx)("coneGeometry",{args:[.03,.175,8]}),(0,n.jsx)("meshStandardMaterial",{color:f?"#00ff40":g?"#ff8800":h?"#A855C7":"#00ffff",emissive:f?"#00ff40":g?"#ff8800":h?"#A855C7":"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]})]})]})})}function f(e){let{scytheRef:t,basePosition:r,isEmpowered:i=!1}=e,s=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e},l={steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16};return(0,n.jsxs)("group",{ref:t,position:[r[0],r[1],r[2]],rotation:[0,0,Math.PI],scale:[.65,.75,.65],children:[(0,n.jsxs)("group",{position:[0,-0,0],rotation:[0,0,Math.PI+.3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,1.5,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#a86432",roughness:.7})]}),[...Array(7)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.6-.2*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.07,.01,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#a86432",metalness:.3,roughness:.7})]},t))]}),(0,n.jsxs)("group",{position:[-0,0,0],rotation:[Math.PI/1,0,Math.PI-.3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>2*e.clock.getElapsedTime()),children:(0,n.jsxs)("mesh",{"position-y":.55,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.14,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.55,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.14,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.4,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.2,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.2,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.4,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#8A2BE2":"#17CE54",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,n.jsx)("group",{position:[.375,.45,.65],rotation:[.2,-Math.PI/3.6,Math.PI-.4],scale:[.8,.45,.8],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[s(),{...l,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#8A2BE2":"#17CE54",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:o.DoubleSide})]})}),(0,n.jsx)("group",{position:[-.375,-.45,-.65],rotation:[.2,Math.PI/14-1.1,-.4],scale:[.8,.45,.8],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[s(),{...l,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#8A2BE2":"#17CE54",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:o.DoubleSide})]})})]})}function y(e){let{currentSubclass:t=u.p.CHAOS,level:r=1,isEmpowered:o=!1,isSpinning:s=!1}=e;(0,i.useEffect)(()=>{o&&console.log("[Scythe] Legion empowerment activated - showing green trails")},[o]),(0,i.useEffect)(()=>{s&&console.log("[Scythe] Spinning animation started")},[s]);let l=(0,i.useRef)(null),c=(0,i.useRef)(0),d=[-1.175,.65,.3];return(0,a.F)((e,t)=>{if(l.current){if(s){c.current+=t;let e=15*c.current;l.current.position.set(0,.5,1.2),l.current.rotation.set(Math.PI/8,0,e)}else c.current=0,l.current.rotation.x*=.85,l.current.rotation.y*=.85,l.current.rotation.z*=.85,l.current.position.x+=(d[0]-l.current.position.x)*.14,l.current.position.y+=(d[1]-l.current.position.y)*.14,l.current.position.z+=(d[2]-l.current.position.z)*.025}}),(0,n.jsx)(f,{scytheRef:l,basePosition:d,isEmpowered:o})}var x=r(6663);function M(e){let{isSwinging:t,isSmiting:r,isOathstriking:s,isDivineStorming:l=!1,isColossusStriking:c=!1,isCharging:d=!1,isDeflecting:u=!1,chargeDirectionProp:h,onSwingComplete:p,onSmiteComplete:g,onOathstrikeComplete:m,onDivineStormComplete:f,onColossusStrikeComplete:y,onChargeComplete:M,onDeflectComplete:v,hasChainLightning:j=!1,comboStep:w=1,currentSubclass:S,enemyData:b=[],onHit:C,setDamageNumbers:I,nextDamageNumberId:P,setActiveEffects:D,playerPosition:E,playerRotation:F,dragonGroupRef:R}=e,A=(0,i.useRef)(null),T=(0,i.useRef)(0),B=(0,i.useRef)(0),k=(0,i.useRef)(0),z=(0,i.useRef)(0);(0,i.useRef)(0);let V=(0,i.useRef)(null),G=(0,i.useRef)(new o.Vector3),N=(0,i.useRef)(null),W=(0,i.useRef)(new Set),L=(0,i.useRef)([]);(0,i.useRef)(1);let O=(0,i.useRef)(0),H=(0,i.useRef)(null),_=(0,i.useRef)(!1),U=(0,i.useRef)(!1),Z=[-1.18,.225,.3],q=(0,i.useRef)([]),Y=(0,i.useRef)({}),Q=(0,i.useRef)({}),J=(0,i.useRef)(!1),K=(0,i.useRef)(w),$=(0,i.useRef)(!1),X=(0,i.useRef)(0),ee=(0,i.useRef)(w),et=(0,i.useRef)([...Z]),er=(0,i.useRef)([0,0,0]);(0,i.useEffect)(()=>{K.current!==w&&(K.current=w)},[w]),(0,a.F)((e,n)=>{if(A.current){if(Date.now(),!t&&!r&&!c&&!l&&!s&&!d&&!u&&$.current){if(X.current,X.current+=7*n,X.current>=1){if($.current=!1,X.current=0,w!==ee.current){let e=en(w);et.current=e.position,er.current=e.rotation}else et.current=[...Z],er.current=[0,0,0];A.current.position.set(...et.current),A.current.rotation.set(...er.current)}else{let e;let t=1-Math.pow(1-X.current,3),r=A.current.position,n=A.current.rotation;e=w!==ee.current?en(w):{position:[...Z],rotation:[0,0,0]};let i=Math.sin(X.current*Math.PI),o=r.x+(e.position[0]-r.x)*t,a=r.y+(e.position[1]-r.y)*t+.15*i,s=r.z+(e.position[2]-r.z)*t;A.current.position.set(o,a,s);let l=n.x+(e.rotation[0]-n.x)*t,c=n.y+(e.rotation[1]-n.y)*t,d=n.z+(e.rotation[2]-n.z)*t;A.current.rotation.set(l,c,d)}return}if(l){if(z.current+=22.5*n,z.current>=1*Math.PI*4){z.current=0,Y.current={},A.current.position.set(...Z),A.current.rotation.set(0,0,0),null==f||f();return}let e=z.current,t=1.75*Math.cos(e),r=1.75*Math.sin(e);A.current.rotation.set(Math.PI/3,-e+Math.PI,1),A.current.rotateY(-e+Math.PI),A.current.position.set(t,.65,r);let i=Date.now();b.forEach(e=>{e.health&&!(e.health<=0)&&!(i-(Y.current[e.id]||0)<200)&&5>=(E||new o.Vector3(0,0,0)).distanceTo(e.position)&&(Y.current[e.id]=i,null==C||C(e.id,40),I&&P&&I(t=>[...t,{id:P.current++,damage:40,position:e.position.clone(),isCritical:!1,isDivineStorm:!0}]))});return}if(_.current){if(O.current+=27.5*n,O.current>=1*Math.PI*2){O.current=0,H.current=null,_.current=!1,A.current.position.set(...Z),A.current.rotation.set(0,0,0),null==M||M();return}let e=O.current,t=1.6*Math.cos(e),r=1.6*Math.sin(e);A.current.position.set(t,.65,r),A.current.rotation.set(Math.PI/3,-e+Math.PI,1),A.current.rotateY(-e+Math.PI);return}if(d){if(!N.current){N.current=Date.now(),V.current=(null==E?void 0:E.clone())||new o.Vector3(0,0,0),W.current.clear(),h?G.current=h.clone().normalize():G.current=new o.Vector3(0,0,-1).normalize();let e=window.gameUI;e&&(e.getCurrentRage&&e.getCurrentRage(),e.gainRage(0),e.getCurrentRage&&e.getCurrentRage())}let e=(Date.now()-N.current)/1e3;if(e<.1){let t=e/.1,r=t<.5?2*t*t:1-Math.pow(-2*t+2,3)/2;A.current.rotation.set(Math.PI/2*r,0,0),Z[2];let n=Z[2]+1.5*r;A.current.position.set(Z[0],Z[1]+.2,n);return}let t=Math.min((e-.1)/.45,1);if(!V.current||!G.current||!E){N.current=null,V.current=null,null==M||M();return}let r=G.current.clone().multiplyScalar(9.5*(1-Math.pow(1-t,2)));if(V.current.clone().add(r).length()>25){N.current=null,V.current=null,null==M||M();return}if(b&&b.length>0&&C&&t>0&&E)for(let e of b)!W.current.has(e.id)&&!(e.health<=0)&&2.5>=E.distanceTo(e.position)&&(W.current.add(e.id),C(e.id,40),I&&P&&I(t=>[...t,{id:P.current++,damage:40,position:e.position.clone(),isCritical:!1,isBreach:!0}]));A.current.rotation.set(Math.PI/2,0,-.175),A.current.position.set(Z[0],Z[1]+.2,Z[2]+1.5);return}if(!d&&null!==N.current&&!_.current&&!U.current&&(U.current=!0,b&&b.length>0&&C&&E))for(let e of b)!(e.health<=0)&&4>=E.distanceTo(e.position)&&(C(e.id,15),I&&P&&I(t=>[...t,{id:P.current++,damage:15,position:e.position.clone(),isCritical:!1,isFireball:!0}]));if(U.current&&!_.current&&(N.current=null,V.current=null,W.current.clear(),L.current=[],U.current=!1,_.current=!0,O.current=0,H.current=Date.now()),d||null===N.current||U.current||_.current||(N.current=null,V.current=null,W.current.clear(),L.current=[],U.current=!1,A.current.rotation.set(0,0,0),A.current.position.set(...Z)),d&&!N.current&&(U.current=!1,_.current=!1,O.current=0),r){let e,t,r,i,o;B.current+=n*(B.current<Math.PI/2?3:6);let a=Math.min(B.current/Math.PI,1);if(a<.5){let n=.45*a;e=-Math.PI/3-n*Math.PI/3,t=n*Math.PI/4,r=Z[0]+1.5*n,i=Z[1]+1.5*n,o=Z[2]-1.5*n}else{let n=(a-.5)*2;e=-2*Math.PI/3+3*n*Math.PI/2,t=Math.PI/4*(1-n),r=Z[0]+1.5*(1-n),i=Z[1]+(1.5-2*n),o=Z[2]-(1.5-3*n)}A.current.position.set(r,i,o),A.current.rotation.set(e,t,0),B.current>=Math.PI&&(B.current=0,A.current.rotation.set(0,0,0),A.current.position.set(...Z),null==g||g());return}if(c){let e,t,r,i,o;k.current+=n*(k.current<Math.PI/2?3:6);let a=Math.min(k.current/Math.PI,1);if(a<.5){let n=.45*a;e=-Math.PI/3-n*Math.PI/3,t=n*Math.PI/4,r=Z[0]+1.5*n,i=Z[1]+1.5*n,o=Z[2]-1.5*n}else{let n=(a-.5)*2;e=-2*Math.PI/3+3*n*Math.PI/2,t=Math.PI/4*(1-n),r=Z[0]+1.5*(1-n),i=Z[1]+(1.5-2*n),o=Z[2]-(1.5-3*n)}A.current.position.set(r,i,o),A.current.rotation.set(e,t,0),k.current>=Math.PI&&(k.current=0,A.current.rotation.set(0,0,0),A.current.position.set(...Z),null==y||y());return}if(t){K.current!==w&&(K.current=w),0===T.current&&(J.current=!1),T.current+=8*n;let e=Math.min(T.current/Math.PI/1.5,1),t=K.current,r=3===t?.9*Math.PI:.55*Math.PI;if((3===t?e>=.25&&e<=.75:e>=.15&&e<=.65)&&!J.current&&(ei(t),J.current=!0),T.current>=r){T.current=0,J.current=!1,Q.current={},ee.current=t,2===t?$.current=!1:($.current=!0,X.current=0),null==p||p();return}if(1===t){let t=e<=.25?2*e:.725-(e-.115)*1.1,r=Z[0]+2*Math.sin(t*Math.PI),n=Z[1]+-2*Math.sin(t*Math.PI),i=Z[2]+1*Math.cos(t*Math.PI);A.current.position.set(r,n,i),A.current.rotation.set(-.75*Math.sin(t*Math.PI)+1.25,Math.sin(t*Math.PI)*Math.PI/1.125,Math.PI/3*Math.sin(t*Math.PI))}else if(2===t){let t=e<=.275?2*e:.625-(e-.075)*1.2,r=Z[0]+2.5-2.5*Math.sin(t*Math.PI),n=Z[1]+-.2*Math.sin(t*Math.PI),i=Z[2]+1.1*Math.cos(t*Math.PI);A.current.position.set(r,n,i),A.current.rotation.set(-.75*Math.sin(t*Math.PI)+1.5,-Math.sin(t*Math.PI)*Math.PI,-(Math.PI/1.75*Math.sin(t*Math.PI)))}else if(3===t){var i,a;let t,r,o,s,l;if(T.current<=3*n){let e=A.current.position,t=A.current.rotation;A.current.userData={startPos:[e.x,e.y,e.z],startRot:[t.x,t.y,t.z]}}let c=(null===(i=A.current.userData)||void 0===i?void 0:i.startPos)||Z,d=(null===(a=A.current.userData)||void 0===a?void 0:a.startRot)||[0,0,0];if(e<.2){let n=5*e,i=Z[0]+1.5,a=Z[1]+1.5,u=Z[2]-1.5;o=c[0]+(i-c[0])*n,s=c[1]+(a-c[1])*n,l=c[2]+(u-c[2])*n,t=d[0]+(-Math.PI/3-Math.PI/3-d[0])*n,r=d[1]+(Math.PI/4-d[1])*n}else{let n=(e-.2)*2;t=-2*Math.PI/3+3*n*Math.PI/2,r=Math.PI/4*(1-n),o=Z[0]+1.5*(1-n),s=Z[1]+(2-5*n),l=Z[2]-(1.5-3.5*n)}A.current.position.set(o,s,l),A.current.rotation.set(t,r,0)}}else t||r||c||l||s||d||u||$.current||2===ee.current&&3===w||(A.current.rotation.x*=.85,A.current.rotation.y*=.85,A.current.rotation.z*=.85,A.current.position.x+=(Z[0]-A.current.position.x)*.14,A.current.position.y+=(Z[1]-A.current.position.y)*.14,A.current.position.z+=(Z[2]-A.current.position.z)*.14);if(j&&A.current){if(.8>Math.random())for(let e=0;e<3;e++){let e=2.2*Math.random(),t=new o.Vector3((Math.random()-.5)*.4,e,(Math.random()-.5)*.4);q.current.push({position:t,velocity:new o.Vector3((Math.random()-.5)*4,(Math.random()-.2)*4,(Math.random()-.5)*4).multiplyScalar(.8),life:1,scale:.02*Math.random()+.005})}q.current.forEach(e=>{e.velocity.x+=Math.sin(.01*Date.now())*n*.5,e.velocity.z+=Math.cos(.01*Date.now())*n*.5,e.position.add(e.velocity.clone().multiplyScalar(n)),e.life-=1.5*n,e.velocity.y+=.5*n}),q.current.length>120&&(q.current=q.current.slice(-120)),q.current=q.current.filter(e=>e.life>0)}}});let en=e=>{switch(e){case 1:return{position:[Z[0]+.3,Z[1]+.2,Z[2]+.1],rotation:[.2,.3,.1]};case 2:return{position:[Z[0]-.3,Z[1]-.1,Z[2]+.1],rotation:[.2,-.3,-.1]};case 3:return{position:[Z[0],Z[1]-.15,Z[2]-.2],rotation:[-.5,0,0]};default:return{position:[...Z],rotation:[0,0,0]}}},ei=e=>{if(!E||!b.length)return;let t=Date.now(),r={1:25,2:30,3:40}[e],n=0;if(b.forEach(i=>{i.health&&!(i.health<=0)&&!(t-(Q.current[i.id]||0)<100)&&5>=E.distanceTo(i.position)&&(3===e||i.position.clone().sub(E).normalize().dot(new o.Vector3(0,0,-1))>-.5)&&(Q.current[i.id]=t,null==C||C(i.id,r),n++,I&&P&&I(e=>[...e,{id:P.current++,damage:r,position:i.position.clone(),isCritical:!1}]))}),n>0){let e=window.gameUI;if(e){e.getCurrentRage&&e.getCurrentRage();let t=Math.min(5*n,5);e.gainRage(t),e.getCurrentRage&&e.getCurrentRage()}}},eo=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(-.25,.25),e.lineTo(-.15,-.15),e.lineTo(0,0),e.lineTo(.25,.25),e.lineTo(.15,-.15),e.lineTo(0,0),e.lineTo(0,.08),e.lineTo(.2,.2),e.quadraticCurveTo(.8,.15,1.5,.18),e.quadraticCurveTo(2,.1,2.2,0),e.quadraticCurveTo(2,-.1,1.5,-.18),e.quadraticCurveTo(.8,-.15,.2,-.2),e.lineTo(0,-.08),e.lineTo(0,0),e},ea={steps:2,depth:.05,bevelEnabled:!0,bevelThickness:.014,bevelSize:.02,bevelOffset:.04,bevelSegments:2},es={...ea,depth:.06,bevelThickness:.02,bevelSize:.02,bevelOffset:0,bevelSegments:6};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{rotation:[-.65,0,.2],scale:[.8,.9,.65],children:[(0,n.jsxs)("group",{ref:A,position:[Z[0],Z[1],Z[2]],rotation:[0,0,Math.PI],scale:[.75,.8,.65],children:[(0,n.jsxs)("group",{position:[.25,-.55,.35],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.04,.9,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.35-.11*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.045,.016,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[.25,.225,.35],rotation:[Math.PI,1.5,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.26,.07,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.25*Math.cos(t*Math.PI/4),.25*Math.sin(t*Math.PI/4),0],rotation:[0,0,t*Math.PI/4-Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.07,.55,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]},"spike-".concat(t))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.155,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(11907088),emissive:new o.Color(11907088),emissiveIntensity:3,transparent:!0,opacity:1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(1087413),emissive:new o.Color(1087413),emissiveIntensity:40,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.145,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(1087413),emissive:new o.Color(1087413),emissiveIntensity:35,transparent:!0,opacity:.6})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.175,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(1087413),emissive:new o.Color(1087413),emissiveIntensity:30,transparent:!0,opacity:.4})]}),(0,n.jsx)("pointLight",{color:new o.Color(1160495),intensity:2,distance:1,decay:2})]}),(0,n.jsxs)("group",{position:[.25,.5,.35],rotation:[0,-Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[eo(),ea]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(1087413),emissive:new o.Color(1087413),emissiveIntensity:1.5,metalness:.3,roughness:.1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(0,.06),e.lineTo(.15,.15),e.quadraticCurveTo(1.2,.12,1.5,.15),e.quadraticCurveTo(2,.08,2.15,0),e.quadraticCurveTo(2,-.08,1.5,-.15),e.quadraticCurveTo(1.2,-.12,.15,-.15),e.lineTo(0,-.05),e.lineTo(0,0),e})(),es]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(1087413),emissive:new o.Color(1087413),emissiveIntensity:3,metalness:.2,roughness:.1,opacity:.8,transparent:!0})]})]}),(0,n.jsx)("group",{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("group",{position:[.25,.7,.35],rotation:[0,-Math.PI/2,Math.PI/2],scale:[.95,1.1,.95],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[eo(),{...ea,depth:.07}]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(8900331),emissive:new o.Color(4620980),emissiveIntensity:1.5,transparent:!0,opacity:.3,blending:o.AdditiveBlending})]})}),q.current.map((e,t)=>(0,n.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],children:[(0,n.jsx)("sphereGeometry",{args:[1.25,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(8900331),emissive:new o.Color(4620980),emissiveIntensity:3*e.life,transparent:!0,opacity:.6*e.life,blending:o.AdditiveBlending})]},t))]})})]}),d&&L.current.map(e=>(0,n.jsxs)("mesh",{position:[e.position.x,e.position.y,e.position.z],scale:[.2*e.life,.2*e.life,.2*e.life],children:[(0,n.jsx)("sphereGeometry",{args:[.5,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(11907088),emissive:new o.Color(11907088),emissiveIntensity:3*e.life,transparent:!0,opacity:.9*e.life,blending:o.AdditiveBlending})]},e.id)),l&&(0,n.jsx)("group",{children:(0,n.jsx)("pointLight",{color:new o.Color(11907088),intensity:1,distance:8,decay:1})})]}),(0,n.jsx)(x.Z,{isActive:u,duration:3,onComplete:v,playerPosition:E,playerRotation:F,dragonGroupRef:R})]})}let v=(e,t,r)=>e*(1-r)+t*r;function j(e){let{isSwinging:t,onSwingComplete:r,onLeftSwingStart:s,onRightSwingStart:l,isCharging:c=!1,isSkyfalling:d=!1,isBackstabbing:u=!1,onBackstabComplete:h=()=>{},subclass:p="FROST"}=e;i.useEffect(()=>{},[u]);let g=(0,i.useRef)(null),m=(0,i.useRef)(0),f=(0,i.useRef)(null),y=(0,i.useRef)(0),x=[-.8,.75,.65],M=[.8,.75,.65],j=(0,i.useRef)(0),w=(0,i.useRef)(!1),S=(0,i.useRef)(0),b=(0,i.useRef)(0),C=(0,i.useRef)("none"),I=(0,i.useRef)(!1),P=(0,i.useRef)({left:{x:0,y:0,z:0},right:{x:0,y:0,z:0}}),D=(0,i.useRef)(!1);(0,i.useEffect)(()=>{u||(I.current=!1,C.current="none",b.current=0)},[u]),(0,i.useEffect)(()=>{d||(D.current=!1)},[d]),(0,a.F)((e,n)=>{if(g.current&&f.current){if(d&&!D.current)g.current.position.x+=(-.8-g.current.position.x)*.3,g.current.position.y+=(-.2-g.current.position.y)*.3,g.current.position.z+=(.5-g.current.position.z)*.3,f.current.position.x+=(.8-f.current.position.x)*.3,f.current.position.y+=(-.2-f.current.position.y)*.3,f.current.position.z+=(.5-f.current.position.z)*.3,g.current.rotation.x=v(1.05*g.current.rotation.x,.37*Math.PI,.3),g.current.rotation.z=v(g.current.rotation.z,1.65*Math.PI,.2),f.current.rotation.x=v(1.05*f.current.rotation.x,.37*Math.PI,.3),f.current.rotation.z=v(f.current.rotation.z,-(1.65*Math.PI),.2),m.current=0,y.current=0,S.current=0,j.current=0,w.current=!1,b.current=0,C.current="none";else if(u&&!I.current){if("none"===C.current){C.current="windup",b.current=0;let e=x[0]+14695761589768238e-32-.45,t=x[1]+-.25*Math.sin(2*Math.PI),r=x[2]+13471114790620887e-32,n=M[0]-14695761589768238e-32+.45,i=M[1]+-.25*Math.sin(2*Math.PI),o=M[2]+13471114790620887e-32;g.current.position.set(e,t,r),f.current.position.set(n,i,o),g.current.rotation.set(.5*Math.PI*Math.sin(.95*Math.PI),.5*Math.PI*Math.sin(.95*Math.PI),-.1*Math.PI*Math.sin(.95*Math.PI)),f.current.rotation.set(.5*Math.PI*Math.sin(.95*Math.PI),-(.5*Math.PI*Math.sin(.95*Math.PI)),.1*Math.PI*Math.sin(.95*Math.PI))}if(b.current+=1*n,"windup"===C.current){let e=Math.min(b.current/.125,1),t=.125*Math.sin(e*Math.PI*.15);g.current.position.z=g.current.position.z-t,f.current.position.z=f.current.position.z-t;let r=Math.sin(.225*Math.PI)*(.5*Math.PI+Math.PI/4),n=.3*Math.PI*Math.sin(.225*Math.PI)-Math.PI/1.75,i=-.1*Math.PI*Math.sin(.225*Math.PI),o=Math.sin(.225*Math.PI)*(.5*Math.PI+Math.PI/4),a=-(.3*Math.PI*Math.sin(.225*Math.PI))+Math.PI/1.75,s=.1*Math.PI*Math.sin(.225*Math.PI);g.current.rotation.x=r,g.current.rotation.y=n,g.current.rotation.z=i,f.current.rotation.x=o,f.current.rotation.y=a,f.current.rotation.z=s,P.current={left:{x:r,y:n,z:i},right:{x:o,y:a,z:s}},e>=1&&(C.current="thrust",b.current=0)}else if("thrust"===C.current){let e=Math.min(b.current/.15,1),t=Math.sin(e*Math.PI*.175);g.current.position.z+=t,f.current.position.z+=t;let r=.325*t;g.current.position.x+=r,f.current.position.x-=r,g.current.rotation.x=P.current.left.x,g.current.rotation.y=P.current.left.y,g.current.rotation.z=P.current.left.z,f.current.rotation.x=P.current.right.x,f.current.rotation.y=P.current.right.y,f.current.rotation.z=P.current.right.z,e>=.85&&(C.current="recover",b.current=0)}else if("recover"===C.current){let e=Math.min(b.current/.2,1),t=1-Math.pow(1-e,.175);g.current.position.x=v(g.current.position.x,x[0],t),g.current.position.y=v(g.current.position.y,x[1],t),g.current.position.z=v(g.current.position.z,x[2],t),f.current.position.x=v(f.current.position.x,M[0],t),f.current.position.y=v(f.current.position.y,M[1],t),f.current.position.z=v(f.current.position.z,M[2],t),g.current.rotation.x=v(g.current.rotation.x,0,t),g.current.rotation.y=v(g.current.rotation.y,0,t),g.current.rotation.z=v(g.current.rotation.z,0,t),f.current.rotation.x=v(f.current.rotation.x,0,t),f.current.rotation.y=v(f.current.rotation.y,0,t),f.current.rotation.z=v(f.current.rotation.z,0,t),e>=1&&(C.current="none",b.current=0,I.current=!0,h())}}else if(t){if(0===m.current&&0===y.current&&(w.current=!1),g.current){if(S.current<.115)S.current+=n;else{0===m.current&&s(),m.current+=12*n;let e=Math.min(m.current/Math.PI,1),t=x[0]+1.2*Math.sin(e*Math.PI)-.45,r=x[1]+-.25*Math.sin(e*Math.PI*2),i=x[2]+1.75*Math.sin(e*Math.PI);g.current.position.set(t,r,i),g.current.rotation.set(.65*Math.PI*Math.sin(e*Math.PI),.3*Math.PI*Math.sin(e*Math.PI),-.1*Math.PI*Math.sin(e*Math.PI)),m.current>=Math.PI&&(m.current=0,S.current=0,g.current.rotation.set(0,0,0),g.current.position.set(...x))}}if(f.current){0===y.current&&l(),y.current+=12*n;let e=Math.min(y.current/Math.PI,1),t=M[0]-1.2*Math.sin(e*Math.PI)+.45,i=M[1]+-.25*Math.sin(e*Math.PI*2),o=M[2]+1.75*Math.sin(e*Math.PI);f.current.position.set(t,i,o),f.current.rotation.set(.5*Math.PI*Math.sin(e*Math.PI),-(.3*Math.PI*Math.sin(e*Math.PI)),.2*Math.PI*Math.sin(e*Math.PI)),y.current>=Math.PI&&(y.current=0,j.current=0,f.current.rotation.set(0,0,0),f.current.position.set(...M),w.current=!0,r())}}else g.current.position.x+=(x[0]-g.current.position.x)*.2,g.current.position.y+=(x[1]-g.current.position.y)*.2,g.current.position.z+=(x[2]-g.current.position.z)*.2,f.current.position.x+=(M[0]-f.current.position.x)*.2,f.current.position.y+=(M[1]-f.current.position.y)*.2,f.current.position.z+=(M[2]-f.current.position.z)*.2,g.current.rotation.x*=.85,g.current.rotation.y*=.85,g.current.rotation.z*=.85,f.current.rotation.x*=.85,f.current.rotation.y*=.85,f.current.rotation.z*=.85,t||(m.current=0,y.current=0,S.current=0,j.current=0,w.current=!1),u||(b.current=0,C.current="none")}});let E=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(-.15,.1),e.lineTo(-.2,0),e.lineTo(-.2,-.05),e.lineTo(0,0),e.lineTo(.15,.1),e.lineTo(.2,0),e.lineTo(.3,0),e.lineTo(0,0),e.lineTo(0,.05),e.quadraticCurveTo(.3,.15,.5,.2),e.quadraticCurveTo(.7,.25,.9,.15),e.quadraticCurveTo(1,.1,1.1,0),e.quadraticCurveTo(1,-.05,.8,-.1),e.lineTo(.7,-.15),e.lineTo(.65,-.1),e.quadraticCurveTo(.4,-.08,.2,-.05),e.quadraticCurveTo(.1,-.02,0,0),e},F=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(-.13,.08),e.lineTo(-.18,0),e.lineTo(-.08,-.04),e.lineTo(0,0),e.lineTo(.13,.08),e.lineTo(.18,0),e.lineTo(.08,-.04),e.lineTo(0,0),e.lineTo(0,.04),e.quadraticCurveTo(.28,.13,.48,.18),e.quadraticCurveTo(.68,.23,.88,.13),e.quadraticCurveTo(.98,.08,1.08,0),e.quadraticCurveTo(.98,-.04,.78,-.08),e.lineTo(.68,-.13),e.lineTo(.63,-.08),e.quadraticCurveTo(.38,-.06,.18,-.04),e.quadraticCurveTo(.08,-.02,0,0),e},R={steps:2,depth:.02,bevelEnabled:!0,bevelThickness:.004,bevelSize:.01,bevelSegments:3},A={...R,depth:.025,bevelThickness:.003,bevelSize:.004,bevelOffset:0},T=(()=>{switch(p){case"FROST":default:return{primary:"#ff0000",emissive:"#ff2200",secondary:"#cc0000",secondaryEmissive:"#ff0000"};case"ASSASSIN":return{primary:"#8b0000",emissive:"#ff0000",secondary:"#4b0000",secondaryEmissive:"#cc0000"}}})();return(0,n.jsxs)("group",{position:[0,-.6,.5],rotation:[-.55,0,0],scale:[.775,.775,.775],children:[(0,n.jsxs)("group",{ref:g,position:[x[0],x[1],x[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,n.jsxs)("group",{position:[.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,n.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[E(),R]}),(0,n.jsx)("meshStandardMaterial",{color:T.primary,emissive:T.emissive,emissiveIntensity:3,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[0,0,-.02],children:[(0,n.jsx)("extrudeGeometry",{args:[F(),{...A,depth:.06}]}),(0,n.jsx)("meshStandardMaterial",{color:T.secondary,emissive:T.secondaryEmissive,emissiveIntensity:8,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,n.jsx)("pointLight",{color:T.emissive,intensity:5,distance:2,decay:2})]})]}),(0,n.jsxs)("group",{ref:f,position:[M[0],M[1],M[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,n.jsxs)("group",{position:[-.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,n.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[-.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[E(),R]}),(0,n.jsx)("meshStandardMaterial",{color:T.primary,emissive:T.emissive,emissiveIntensity:2,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[0,0,-.02],children:[(0,n.jsx)("extrudeGeometry",{args:[F(),{...A,depth:.06}]}),(0,n.jsx)("meshStandardMaterial",{color:T.secondary,emissive:T.secondaryEmissive,emissiveIntensity:3.5,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,n.jsx)("pointLight",{color:T.emissive,intensity:1.5,distance:2,decay:2})]})]})]})}var w=r(4937);let S=i.memo(e=>{let{position:t,onComplete:r}=e,[o,s]=(0,i.useState)(0),l=(0,i.useCallback)((e,t)=>{s(e=>{let n=e+t;return n>=1.5&&r(),n})},[1.5,r]);(0,a.F)(l);let c=o/1.5,d=Math.sin(c*Math.PI),u=1+2*c,h=(0,i.useMemo)(()=>({color:"#60FF38",emissive:"#60FF38",emissiveIntensity:1.5,transparent:!0}),[]),p=(0,i.useMemo)(()=>({color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2.5,transparent:!0}),[]),g=(0,i.useMemo)(()=>[void 0,void 0,void 0],[]),m=(0,i.useMemo)(()=>[...Array(12)],[]);return(0,n.jsxs)("group",{position:t.toArray(),children:[g.map((e,t)=>(0,n.jsxs)("mesh",{position:[0,2*c+.5*t,0],rotation:[Math.PI/2,0,2*o],children:[(0,n.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,n.jsx)("meshStandardMaterial",{...h,opacity:d*(1-.2*t)})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{scale:[u,u,u],children:[(0,n.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2,transparent:!0,opacity:.3*d})]}),m.map((e,t)=>{let r=t/12*Math.PI*2,i=.75+c;return(0,n.jsxs)("mesh",{position:[Math.cos(r+2*o)*i/1.1,2*c+.5*Math.sin(3*o+t),Math.sin(r+2*o)*i/1.1],children:[(0,n.jsx)("sphereGeometry",{args:[.095,8,8]}),(0,n.jsx)("meshStandardMaterial",{...p,opacity:.8*d})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#60FF38",intensity:2*d,distance:5,decay:2})]})});S.displayName="HealingEffect";let b=(0,i.forwardRef)((e,t)=>{let{parentRef:r}=e,[a,s]=(0,i.useState)(!1),l=(0,i.useCallback)(()=>{s(!0)},[]);return(0,i.useImperativeHandle)(t,()=>({triggerHealingEffect:l})),a&&r.current?(0,n.jsx)(S,{position:r.current.position.clone().add(new o.Vector3(0,0,0)),onComplete:()=>s(!1)}):null});function C(e){let{position:t=new o.Vector3(0,0,0),movementDirection:r=new o.Vector3(0,0,0),isDashing:a=!1,dashCharges:p=[{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0}],chargeDirection:f,currentWeapon:x=u.v.BOW,currentSubclass:v=u.p.ELEMENTAL,isCharging:S=!1,chargeProgress:C=0,isSwinging:I=!1,isSpinning:P=!1,onBowRelease:D=()=>{},onScytheSwingComplete:E=()=>{},onSwordSwingComplete:F=()=>{},onSabresSwingComplete:R=()=>{},onSabresLeftSwingStart:A=()=>{},onSabresRightSwingStart:T=()=>{},onBackstabComplete:B=()=>{},swordComboStep:k=1,isSkyfalling:z=!1,isBackstabbing:V=!1,isDivineStorming:G=!1,isSwordCharging:N=!1,isDeflecting:W=!1,onChargeComplete:L=()=>{},onDeflectComplete:O=()=>{},enemyData:H=[],onHit:_=()=>{},setDamageNumbers:U=()=>{},nextDamageNumberId:Z={current:0},playerPosition:q,playerRotation:Y=new o.Vector3(0,0,0),isViperStingCharging:Q=!1,viperStingChargeProgress:J=0,isBarrageCharging:K=!1,barrageChargeProgress:$=0,isCobraShotCharging:X=!1,cobraShotChargeProgress:ee=0,reanimateRef:et,setActiveEffects:er=()=>{}}=e,en=(0,i.useRef)(null),ei=(0,i.useMemo)(()=>(0,n.jsx)("group",{scale:[.8,.55,.8],position:[0,.04,-.015],rotation:[.4,0,0],children:(0,n.jsx)(s.Z,{})}),[]),eo=(0,i.useMemo)(()=>(0,n.jsx)("group",{scale:[.85,.85,.85],position:[0,.05,.1],children:(0,n.jsx)(l.Z,{movementDirection:r})}),[r]),ea=(0,i.useMemo)(()=>(0,n.jsx)("group",{scale:[.235,.335,.235],position:[-.05,.215,.35],rotation:[.15,0,-5],children:(0,n.jsx)(d,{isLeft:!0})}),[]),es=(0,i.useMemo)(()=>(0,n.jsx)("group",{scale:[.235,.335,.235],position:[.05,.215,.35],rotation:[.15,0,5],children:(0,n.jsx)(d,{isLeft:!1})}),[]),el=(0,i.useMemo)(()=>(0,n.jsxs)("group",{position:[0,.2,-.15],children:[(0,n.jsx)("group",{rotation:[0,Math.PI/5.5,0],children:(0,n.jsx)(c,{isLeftWing:!0,parentRef:en,isDashing:a})}),(0,n.jsx)("group",{rotation:[0,-Math.PI/5.5,0],children:(0,n.jsx)(c,{isLeftWing:!1,parentRef:en,isDashing:a})})]}),[a]);return(0,n.jsxs)("group",{ref:en,position:[t.x,t.y+.2,t.z],children:[ea,es,ei,eo,el,(0,n.jsx)(h,{parentRef:en,dashCharges:p,weaponType:x,weaponSubclass:v}),(0,n.jsx)(g,{parentRef:en}),x===u.v.BOW?(0,n.jsx)(m,{position:t,direction:r,chargeProgress:C,isCharging:S,onRelease:D,currentSubclass:v,hasInstantPowershot:!1,isAbilityBowAnimation:!1,isViperStingCharging:Q,viperStingChargeProgress:J,isBarrageCharging:K,barrageChargeProgress:$,isCobraShotCharging:X,cobraShotChargeProgress:ee}):x===u.v.SCYTHE?(0,n.jsx)(y,{parentRef:en,currentSubclass:v,level:1,isEmpowered:!1,isSpinning:P}):x===u.v.SWORD?(0,n.jsx)(M,{isSwinging:I,isSmiting:!1,isOathstriking:!1,isDivineStorming:G,isColossusStriking:!1,isCharging:N,isDeflecting:W,chargeDirectionProp:f,onSwingComplete:F,onSmiteComplete:()=>{},onOathstrikeComplete:()=>{},onDivineStormComplete:()=>{},onColossusStrikeComplete:()=>{},onChargeComplete:L,onDeflectComplete:O,hasChainLightning:!1,comboStep:k,currentSubclass:v,enemyData:H,onHit:_,setDamageNumbers:U,nextDamageNumberId:Z,setActiveEffects:er,playerPosition:q,playerRotation:Y,dragonGroupRef:en}):x===u.v.SABRES?(0,n.jsx)(j,{isSwinging:I,onSwingComplete:R||(()=>{}),onLeftSwingStart:A||(()=>{}),onRightSwingStart:T||(()=>{}),isCharging:S,isSkyfalling:z,isBackstabbing:V,onBackstabComplete:B,subclass:v}):null,G&&x===u.v.SWORD&&(0,n.jsx)(w.Z,{position:t,onComplete:()=>{},parentRef:en,isActive:G,enemyData:H,onHitTarget:(e,t,r,n,i)=>{null==_||_(e,t),U&&Z&&U(e=>[...e,{id:Z.current++,damage:t,position:n.clone(),isCritical:r,isDivineStorm:i}])}}),x===u.v.SCYTHE&&(0,n.jsx)(b,{parentRef:en,ref:et})]})}b.displayName="Reanimate";var I=r(319);let P=i.memo(e=>{let{parentRef:t,weaponType:r,weaponSubclass:s,targetPosition:l}=e,c=(0,i.useRef)([]),d=(0,i.useRef)([]),[h,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e;l?(e=l.clone(),d.current=Array(30).fill(0).map(()=>e.clone()),p(!0)):t.current&&(e=t.current.position.clone(),d.current=Array(30).fill(0).map(()=>e.clone()),p(!0))},[t,l,30]);let g=()=>{if(s)switch(s){case u.p.CHAOS:case u.p.ABYSSAL:return"#17CE54";case u.p.DIVINITY:return"#87CEEB";case u.p.VENGEANCE:return"#4682B4";case u.p.FROST:case u.p.ASSASSIN:case u.p.PYRO:case u.p.STORM:return"#FF544E";case u.p.ELEMENTAL:return"#3EB0FC";case u.p.VENOM:return"#17CC93"}switch(r){case u.v.SCYTHE:return"#17CE54";case u.v.SWORD:return"#6DFF9E";case u.v.SABRES:return"#FF544E";case u.v.SPEAR:return"#C6C6C6";case u.v.BOW:return"#3A905E"}};return((0,a.F)(()=>{let e;if(h){if(l&&l.clone)e=l.clone();else{if(!t.current||!t.current.position||!t.current.position.clone)return;e=t.current.position.clone()}e.y+=.3,d.current.unshift(e),d.current=d.current.slice(0,30),c.current.forEach((e,t)=>{e&&d.current[t]&&(e.position.copy(d.current[t]),e.scale.setScalar(1-t/30*.6),e.material&&e.material instanceof o.MeshBasicMaterial&&(e.material.opacity=(1-t/30)*.2))})}}),h)?(0,n.jsx)(n.Fragment,{children:Array.from({length:30}).map((e,t)=>(0,n.jsxs)("mesh",{ref:e=>{e&&(c.current[t]=e)},children:[(0,n.jsx)("sphereGeometry",{args:[.43,32,32]}),(0,n.jsx)("meshBasicMaterial",{color:new o.Color(g()),transparent:!0,opacity:.3,depthWrite:!1})]},t))}):null});P.displayName="GhostTrail";var D=r(7771),E=r(73),F=r(6862),R=r(8001),A=r(244);function T(e){let{entityId:t,position:r,world:s,onMeshReady:l,currentWeapon:c=u.v.BOW,currentSubclass:d=u.p.ELEMENTAL,isCharging:h=!1,chargeProgress:p=0,isSwinging:g=!1,isSpinning:m=!1,isDeflecting:f=!1,onBowRelease:y=()=>{},onScytheSwingComplete:x=()=>{},onSwordSwingComplete:M=()=>{},onSabresSwingComplete:v=()=>{},onBackstabComplete:j=()=>{},swordComboStep:w=1,isSkyfalling:S=!1,isBackstabbing:b=!1,isDivineStorming:T=!1,isSwordCharging:B=!1,onChargeComplete:k=()=>{},onDeflectComplete:z=()=>{},rotation:V,isLocalPlayer:G=!0,isViperStingCharging:N=!1,viperStingChargeProgress:W=0,isBarrageCharging:L=!1,barrageChargeProgress:O=0,isCobraShotCharging:H=!1,cobraShotChargeProgress:_=0,reanimateRef:U}=e,Z=(0,i.useRef)(!1);Z.current||(Z.current=!0);let{camera:q}=(0,a.D)(),Y=(0,i.useRef)(null),Q=(0,i.useRef)(new o.Vector3(0,0,0)),J=(0,i.useRef)(r?r.clone():new o.Vector3(0,.5,0)),K=(0,i.useRef)(!1),[$,X]=(0,i.useState)(new o.Vector3(0,0,0)),ee=(0,i.useRef)(new o.Vector3(0,0,-1)),[et,er]=(0,i.useState)([]),[en,ei]=(0,i.useState)([{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0}]),[eo,ea]=(0,i.useState)(void 0),[es,el]=(0,i.useState)([]),ec=(0,i.useRef)(0),ed=(0,i.useRef)(!1),[eu,eh]=(0,i.useState)([]);(0,a.F)(()=>{if(Y.current){if(B&&!ed.current){let e=new o.Vector3;q.getWorldDirection(e),e.y=0,e.normalize(),ea(e)}ed.current=B;let e=Date.now();eh(t=>t.filter(t=>!t.startTime||!t.duration||e-t.startTime<1e3*t.duration)),r&&Y.current.position.copy(r);let n=s.getEntity(t);if(n){.01>Math.random()&&(n.getAllComponents(),n.getComponentNames());let e=n.getComponent(D.i);e&&("function"==typeof e.getDashChargeStatus||"Movement"===e.componentType||"Movement"===e.constructor.name)&&(K.current=e.isDashing,"function"==typeof e.getDashChargeStatus&&ei(e.getDashChargeStatus()),e.isCharging?ea(e.chargeDirection.clone()):ea(void 0))}if(r){let e=r.clone().sub(J.current);e.length()>.001?Q.current.copy(e.normalize()):Q.current.set(0,0,0),J.current.copy(r)}if(G&&q){let e=new o.Vector3;q.getWorldDirection(e);let r=Math.atan2(e.x,e.z);Y.current.rotation.y=r;let n=s.getEntity(t),i=new o.Vector3(0,r,0);if(n){let e=n.getComponent(D.i);if(e&&e.inputStrength>.1){let t=e.moveDirection;if(t.length()>.1){let e=Math.atan2(t.x,t.z);i=new o.Vector3(0,e,0),ee.current.set(t.x,0,t.z).normalize()}}else{let e=Math.atan2(ee.current.x,ee.current.z);i=new o.Vector3(0,e,0)}}X(i)}else!G&&V&&(Y.current.rotation.set(V.x,V.y,V.z),X(new o.Vector3(V.x,V.y,V.z)));if(c===u.v.SWORD){let e=s.queryEntities([E.w,F.S,R.C]).map(e=>{let t=e.getComponent(E.w),r=e.getComponent(F.S);return{id:e.id.toString(),position:t.getWorldPosition(),health:r.currentHealth}}).filter(e=>e.health>0);er(e),g&&e.length}}}),(0,i.useEffect)(()=>{Y.current&&l&&l(Y.current)},[l]);let ep=(e,r)=>{let n=s.getEntity(parseInt(e)),i=s.getEntity(t);if(n&&i){let e=s.getSystem(A.b);e&&e.queueDamage(n,r,i,"sword")}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("group",{ref:Y,children:(0,n.jsx)(C,{position:new o.Vector3(0,0,0),movementDirection:Q.current,isDashing:K.current,dashCharges:en,chargeDirection:eo,currentWeapon:c,currentSubclass:d,isCharging:h,chargeProgress:p,isSwinging:g,isSpinning:m,onBowRelease:y,onScytheSwingComplete:x,onSwordSwingComplete:M,onSabresSwingComplete:v,onBackstabComplete:j,swordComboStep:w,isSkyfalling:S,isBackstabbing:b,isDivineStorming:T,isSwordCharging:B,isDeflecting:f,onChargeComplete:k,onDeflectComplete:z,enemyData:et,onHit:ep,setDamageNumbers:el,nextDamageNumberId:ec,playerPosition:r,playerRotation:$,isViperStingCharging:N,viperStingChargeProgress:W,isBarrageCharging:L,barrageChargeProgress:O,isCobraShotCharging:H,cobraShotChargeProgress:_,reanimateRef:U,setActiveEffects:eh})}),(0,n.jsx)(P,{parentRef:Y,weaponType:c,weaponSubclass:d}),G&&c===u.v.BOW&&(0,n.jsx)(I.default,{parentRef:Y,enemyData:et,onHit:ep,setDamageNumbers:el,nextDamageNumberId:ec,onHealthChange:e=>{},charges:en.map((e,t)=>({id:t+1,available:e.isAvailable,cooldownStartTime:e.cooldownRemaining>0?Date.now()-(15e3-1e3*e.cooldownRemaining):null})),setCharges:e=>{"function"==typeof e?ei(t=>e(t.map((e,t)=>({id:t+1,available:e.isAvailable,cooldownStartTime:e.cooldownRemaining>0?Date.now()-(15e3-1e3*e.cooldownRemaining):null}))).map((e,t)=>({isAvailable:e.available,cooldownRemaining:e.cooldownStartTime?Math.max(0,(15e3-(Date.now()-e.cooldownStartTime))/1e3):0}))):ei(e.map(e=>({isAvailable:e.available,cooldownRemaining:e.cooldownStartTime?Math.max(0,(15e3-(Date.now()-e.cooldownStartTime))/1e3):0})))}})]})}},7125:function(e,t,r){var n,i,o,a;r.d(t,{p:function(){return i},v:function(){return n}}),(o=n||(n={})).SCYTHE="SCYTHE",o.SWORD="SWORD",o.SABRES="SABRES",o.SPEAR="SPEAR",o.BOW="BOW",(a=i||(i={})).CHAOS="CHAOS",a.ABYSSAL="ABYSSAL",a.DIVINITY="DIVINITY",a.VENGEANCE="VENGEANCE",a.FROST="FROST",a.ASSASSIN="ASSASSIN",a.PYRO="PYRO",a.STORM="STORM",a.ELEMENTAL="ELEMENTAL",a.VENOM="VENOM"},3680:function(e,t,r){r.d(t,{Z:function(){return d}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448),s=r(8001);let l=()=>(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.15,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#4FC3F7",emissiveIntensity:.8,transparent:!0,opacity:.7,blending:a.AdditiveBlending,depthWrite:!1})]})});var c=function(e){let{parentRef:t}=e,r=(0,i.useRef)([]),a=(0,i.useRef)(null);return(0,o.F)(e=>{let{clock:t}=e;a.current&&r.current.forEach((e,r)=>{if(!e)return;let n=t.getElapsedTime(),i=r/40*1.25-.175,o=r/40*Math.PI*6+1.5*n,a=1*(.8-.4*i)+.2*Math.sin(2*n+.5*r),s=Math.cos(o)*a,l=Math.sin(o)*a;e.position.set(s,i+.3*Math.sin(2*n+r)+.2,l),e.rotation.y=o+Math.PI/2,e.rotation.x=.2*Math.sin(n+r),e.rotation.z=.2*Math.cos(.8*n+r);let c=e.children[0];if(c&&c.material){let t=c.material,r=i/1.5;t.opacity=Math.max(.2,.8*(1-r)),e.scale.setScalar(1-.3*r)}})}),(0,n.jsxs)("group",{ref:a,children:[Array.from({length:40}).map((e,t)=>(0,n.jsx)("group",{ref:e=>{e&&(r.current[t]=e)},children:l()},t)),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:12,distance:12,decay:1.2,position:[0,.5,0]})]})};function d(e){let{entityId:t,position:r,world:l,onMeshReady:d}=e,u=(0,i.useRef)(null),h=(0,i.useRef)(0),p=(0,i.useRef)(!1);return(0,o.F)((e,n)=>{if(h.current+=n,u.current){u.current.position.copy(r);let e=l.getEntity(t);if(e){let t=e.getComponent(s.C);if(t){let e=Date.now()/1e3-t.lastAttackTime,r=Math.sin(.5*h.current)>.7;p.current=e<.5||r}}u.current.position.y+=.1*Math.sin(2*h.current),p.current||(u.current.rotation.y+=.5*n);let i=u.current.getObjectByName("LeftArm");if(i){if(p.current){let e=i.rotation.x,t=8*n;i.rotation.x=a.MathUtils.lerp(e,-Math.PI/3,t),i.rotation.z=a.MathUtils.lerp(i.rotation.z,.2,t)}else{let e=i.rotation.x,t=i.rotation.z,r=6*n;i.rotation.x=a.MathUtils.lerp(e,0,r),i.rotation.z=a.MathUtils.lerp(t,0,r)}}}}),(0,i.useEffect)(()=>{u.current&&d&&d(u.current)},[d]),(0,n.jsxs)("group",{ref:u,children:[(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.8,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#29B6F6",emissiveIntensity:.3,transparent:!0,opacity:.9,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{position:[0,2.7,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.4,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#81D4FA",emissive:"#4FC3F7",emissiveIntensity:.4,transparent:!0,opacity:.85,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[-.7,2.35,0],children:[(0,n.jsx)("sphereGeometry",{args:[.325,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#81D4FA",emissive:"#4FC3F7",emissiveIntensity:.3,transparent:!0,opacity:.85,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[-.7,2.35,0],rotation:[Math.PI/2,-Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.4,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#B3E5FC",emissiveIntensity:.5,transparent:!0,opacity:.9,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{name:"LeftArm",position:[-.7,2,.2],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#29B6F6",emissiveIntensity:.2,transparent:!0,opacity:.675,metalness:.6,roughness:.4})]}),(0,n.jsxs)("mesh",{position:[.7,2.35,0],children:[(0,n.jsx)("sphereGeometry",{args:[.325,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#81D4FA",emissive:"#4FC3F7",emissiveIntensity:.3,transparent:!0,opacity:.85,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[.7,2.35,0],rotation:[Math.PI/2,Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.4,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#B3E5FC",emissiveIntensity:.5,transparent:!0,opacity:.9,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{position:[.7,2,0],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#29B6F6",emissiveIntensity:.2,transparent:!0,opacity:.675,metalness:.6,roughness:.4})]}),(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("sphereGeometry",{args:[1.35,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#29B6F6",emissive:"#0277BD",emissiveIntensity:.1,transparent:!0,opacity:.4,depthWrite:!1,blending:a.AdditiveBlending})]}),(0,n.jsx)(c,{parentRef:u}),p.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,2.2,1.5],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.1,.8,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#81D4FA",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]}),(0,n.jsxs)("mesh",{position:[.5,2.2,1.3],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,n.jsx)("coneGeometry",{args:[.08,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#81D4FA",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]}),(0,n.jsxs)("mesh",{position:[-.5,2.2,1.3],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,n.jsx)("coneGeometry",{args:[.08,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#81D4FA",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]})]}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2+1.2*h.current,i=.8*Math.cos(r),o=2.5+.8*Math.sin(r),a=.2*Math.cos(1.5*h.current+t);return(0,n.jsx)("group",{position:[i,o,a],rotation:[Math.PI/2,r+Math.PI,-Math.PI/2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.075,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#CCFFFF",emissive:"#CCFFFF",emissiveIntensity:.8,transparent:!0,opacity:1})]})},"horizontal-".concat(t))}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2+1.2*h.current+Math.PI/8,i=.8*Math.cos(r),o=2.5+.8*Math.sin(r),a=.2*Math.cos(1.5*h.current+t);return(0,n.jsx)("group",{position:[i,o,a],rotation:[Math.PI/2,r,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.075,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#AAEEFF",emissive:"#AAEEFF",emissiveIntensity:.8,transparent:!0,opacity:1})]})},"vertical-".concat(t))}),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:.5,distance:3,decay:2})]})}},5658:function(e,t,r){r.d(t,{Z:function(){return x}});var n=r(7437),i=r(2265),o=r(1448);let a=e=>{switch(e){case 1:case 5:return{color:"#ff0000",emissive:"#600000"};case 2:return{color:"#ffa500",emissive:"#cc8400"};case 3:return{color:"#87ceeb",emissive:"#4682b4"};case 4:return{color:"#dda0dd",emissive:"#9370db"};default:return{color:"#00ff00",emissive:"#006600"}}},s=e=>{let t=a(e),r=new o.Color(t.color);return{uniforms:{topColor:{value:r.clone().multiplyScalar(.5)},middleColor:{value:r.clone().multiplyScalar(.85)},bottomColor:{value:r.clone().lerp(new o.Color("#87CEEB"),.6)},offset:{value:33},exponent:{value:.6}},vertexShader:"\n      varying vec3 vWorldPosition;\n      \n      void main() {\n        vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n        vWorldPosition = worldPosition.xyz;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n    ",fragmentShader:"\n      uniform vec3 topColor;\n      uniform vec3 middleColor;\n      uniform vec3 bottomColor;\n      uniform float offset;\n      uniform float exponent;\n      \n      varying vec3 vWorldPosition;\n      \n      void main() {\n        float h = normalize(vWorldPosition + vec3(0.0, offset, 0.0)).y;\n        float mixStrength = max(pow(max(h, 0.0), exponent), 0.0);\n        vec3 color = mix(middleColor, topColor, mixStrength);\n        color = mix(bottomColor, color, smoothstep(0.0, 1.0, h));\n        gl_FragColor = vec4(color, 1.0);\n      }\n    "}};var l=e=>{let{level:t=1}=e,r=(0,i.useMemo)(()=>{let e=s(t);return{uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:o.BackSide}},[t]),a=(0,i.useMemo)(()=>new o.SphereGeometry(500,32,32),[]);return(0,n.jsx)("mesh",{geometry:a,children:(0,n.jsx)("shaderMaterial",{attach:"material",args:[r]})})},c=r(1276),d=()=>{let e=(0,i.useRef)(null),t=(0,i.useRef)(null),r=(0,i.useMemo)(()=>new o.SphereGeometry(1,24,24),[]),a=(0,i.useMemo)(()=>new o.RingGeometry(1.4,2.1,48),[]),s=(0,i.useMemo)(()=>new o.MeshStandardMaterial({color:"#B8E0D2",roughness:.7,metalness:.2,emissive:"#B8E0D2",emissiveIntensity:.675}),[]),l=(0,i.useMemo)(()=>new o.MeshBasicMaterial({color:"#4dff90",transparent:!0,opacity:.5}),[]),d=(0,i.useMemo)(()=>new o.MeshBasicMaterial({color:"#4dff90",transparent:!0,opacity:.2,side:o.BackSide}),[]),u=(0,i.useMemo)(()=>{let e=document.createElement("canvas");e.width=256,e.height=256;let t=e.getContext("2d"),r=t.createRadialGradient(128,128,50,128,128,128);r.addColorStop(0,"rgba(255, 255, 255, 0)"),r.addColorStop(.3,"rgba(255, 255, 255, 0.8)"),r.addColorStop(.5,"rgba(255, 255, 255, 1)"),r.addColorStop(.7,"rgba(255, 255, 255, 0.6)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=r,t.fillRect(0,0,256,256);let n=new o.CanvasTexture(e);return n.minFilter=o.LinearFilter,n.magFilter=o.LinearFilter,n.generateMipmaps=!1,n},[]),h=(0,i.useMemo)(()=>new o.MeshStandardMaterial({map:u,color:"#A8DBFF",transparent:!0,opacity:1,side:o.DoubleSide,alphaMap:u,roughness:.7,metalness:.2,emissive:"#77FFC0",emissiveIntensity:1.1}),[u]),p=(0,i.useMemo)(()=>new o.Frustum,[]),g=(0,i.useMemo)(()=>new o.Matrix4,[]),m=(0,i.useMemo)(()=>new o.Sphere(new o.Vector3,24*Math.sqrt(3)),[]);return(0,c.F)((r,n)=>{e.current&&(e.current.rotation.z+=.006*n),t.current&&(g.multiplyMatrices(r.camera.projectionMatrix,r.camera.matrixWorldInverse),p.setFromProjectionMatrix(g),m.center.copy(t.current.position),t.current.visible=p.intersectsSphere(m))}),(0,n.jsxs)("group",{ref:t,position:[100,80,-150],scale:[24,24,24],rotation:[1,.1,.1],children:[(0,n.jsx)("mesh",{geometry:r,material:s}),(0,n.jsx)("mesh",{ref:e,rotation:[Math.PI/2.8,0,0],geometry:a,material:h}),(0,n.jsx)("mesh",{scale:[1.05,1.05,1.05],geometry:r,material:l}),(0,n.jsx)("mesh",{scale:[1.1,1.1,1.1],geometry:r,material:d})]})},u=r(6018),h=e=>{let{mountains:t}=e,r=(0,i.useRef)(null),a=(0,i.useRef)(null),s=(0,i.useMemo)(()=>t.map((e,t)=>(0,u.C)(t)),[t]),l=(0,i.useMemo)(()=>new o.MeshStandardMaterial({color:"#8B7355",roughness:.8,metalness:.1}),[]),c=(0,i.useMemo)(()=>new o.MeshStandardMaterial({color:"#6B5B47",roughness:.9,metalness:.05}),[]),d=(0,i.useMemo)(()=>new o.MeshStandardMaterial({color:"#f0f0f0",roughness:.3,metalness:0}),[]),h=(0,i.useMemo)(()=>new o.ConeGeometry(23,34.5,24,6),[]),p=(0,i.useMemo)(()=>new o.ConeGeometry(24,29,25,5),[]);return(0,i.useEffect)(()=>{if(!r.current||!a.current)return;let e=new o.Matrix4;t.forEach((t,n)=>{var i;e.makeTranslation(t.position.x,t.position.y,t.position.z);let a=new o.Matrix4().makeScale(t.scale,t.scale,t.scale);e.multiply(a),null===(i=r.current)||void 0===i||i.setMatrixAt(n,e)}),t.forEach((t,r)=>{var n;let i=new o.Matrix4().makeRotationFromEuler(new o.Euler(0,.5,.1)),s=-4*t.scale,l=-5*t.scale,c=-2*t.scale;e.makeTranslation(t.position.x+s,t.position.y+l,t.position.z+c);let d=new o.Matrix4().makeScale(t.scale,t.scale,t.scale);e.multiply(i).multiply(d),null===(n=a.current)||void 0===n||n.setMatrixAt(r,e)}),r.current.instanceMatrix.needsUpdate=!0,a.current.instanceMatrix.needsUpdate=!0},[t]),(0,n.jsxs)("group",{children:[(0,n.jsx)("instancedMesh",{args:[h,l,t.length],ref:r,castShadow:!0,receiveShadow:!0}),(0,n.jsx)("instancedMesh",{args:[p,c,t.length],ref:a,castShadow:!0}),t.map((e,t)=>(0,n.jsx)("mesh",{geometry:s[t],material:d,position:[e.position.x,e.position.y+14*e.scale,e.position.z],scale:[.9*e.scale,e.scale,.9*e.scale],castShadow:!0},"peak-".concat(t)))]})},p=i.memo(e=>{let{position:t=[0,0,0],level:r=1}=e,a=e=>{switch(e){case 1:return{color:"#FF6E6E",emissive:"#FF6E6E"};case 2:return{color:"#ffa500",emissive:"#cc8400"};case 3:return{color:"#87ceeb",emissive:"#4682b4"};case 4:return{color:"#dda0dd",emissive:"#9370db"};case 5:return{color:"#ff0000",emissive:"#600000"};default:return{color:"#00ff00",emissive:"#006600"}}},{pillarGeometries:s,materials:l}=(0,i.useMemo)(()=>{let e=new o.CylinderGeometry(2,2.2,1,8),t=new o.CylinderGeometry(1.5,1.5,8,8),n=new o.CylinderGeometry(2.2,2,1,8),i=new o.MeshStandardMaterial({color:"#ffffff",roughness:.7,metalness:.2}),s=new o.SphereGeometry(1,32,32),l=a(r);return{pillarGeometries:{base:e,column:t,top:n,orb:s},materials:{stone:i,orb:new o.MeshStandardMaterial({color:l.color,emissive:l.emissive,metalness:1,roughness:.2})}}},[r]),[c,d]=i.useState(0);i.useEffect(()=>{let e;let t=()=>{d(e=>(e+.02)%(2*Math.PI)),e=requestAnimationFrame(t)};return t(),()=>{cancelAnimationFrame(e)}},[]),i.useEffect(()=>()=>{Object.values(s).forEach(e=>e.dispose()),Object.values(l).forEach(e=>e.dispose())},[s,l]);let u=a(r);return(0,n.jsxs)("group",{position:t,scale:[.35,.35,.35],children:[(0,n.jsx)("mesh",{geometry:s.base,material:l.stone,position:[0,0,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.column,material:l.stone,position:[0,.25,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.top,material:l.stone,position:[0,3,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.orb,material:l.orb,position:[0,5,0],rotation:[c,c,0],children:(0,n.jsx)("pointLight",{color:u.color,intensity:.5,distance:5})})]})}),g=i.memo(e=>{let{position:t=[0,0,0],scale:r=1,level:a=1}=e,{pedestalGeometry:s,material:l}=(0,i.useMemo)(()=>({pedestalGeometry:{base:new o.CylinderGeometry(4,4.5,2.5,12),topRing:new o.CylinderGeometry(4.2,4.2,.3,12)},material:new o.MeshStandardMaterial({color:"#e8e8e8",roughness:.8,metalness:.1})}),[]);return i.useEffect(()=>()=>{Object.values(s).forEach(e=>e.dispose()),l.dispose()},[s,l]),(0,n.jsxs)("group",{position:t,scale:[r/1.25,r/1.25,r/1.25],children:[(0,n.jsx)("mesh",{geometry:s.base,material:l,position:[0,0,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.topRing,material:l,position:[0,.6,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("pointLight",{position:[0,2.5,0],color:(e=>{switch(e){case 1:return{color:"#FF6E6E",emissive:"#FF6E6E"};case 2:return{color:"#ffa500",emissive:"#cc8400"};case 3:return{color:"#87ceeb",emissive:"#4682b4"};case 4:return{color:"#dda0dd",emissive:"#9370db"};case 5:return{color:"#ff0000",emissive:"#600000"};default:return{color:"#00ff00",emissive:"#006600"}}})(a).color,intensity:.8,distance:8,decay:2})]})}),m=r(73),f=r(3478),y=e=>{let{world:t,positions:r}=e,n=(0,i.useRef)([]);return(0,i.useEffect)(()=>{let e=[];return r.forEach(r=>{let n=t.createEntity(),i=t.createComponent(m.w);i.setPosition(r[0],r[1]+1,r[2]),n.addComponent(i);let o=t.createComponent(f.YM);o.type=f.F5.CYLINDER,o.radius=.7,o.height=3,o.layer=f.aB.ENVIRONMENT,o.isStatic=!0,o.isTrigger=!1,o.setOffset(0,0,0),n.addComponent(o),t.notifyEntityAdded(n),e.push(n),console.log("\uD83C\uDFDB️ Created pillar collision entity at position [".concat(r.join(", "),"] with radius ").concat(o.radius))}),n.current=e,()=>{e.forEach(e=>{t.getEntity(e.id)&&t.destroyEntity(e.id)}),n.current=[]}},[t,r]),null},x=e=>{let{level:t=1,enableMountains:r=!0,enablePlanet:o=!0,enableSky:a=!0,world:s}=e,c=(0,i.useMemo)(()=>(0,u.m)(),[]),m=(0,i.useMemo)(()=>[[0,0,-5],[-4.25,0,2.5],[4.25,0,2.5]],[]),f=(0,i.useMemo)(()=>[0,0,0],[]);return(0,n.jsxs)("group",{name:"environment",children:[a&&(0,n.jsx)(l,{level:t}),o&&(0,n.jsx)(d,{}),r&&(0,n.jsx)(h,{mountains:c}),(0,n.jsx)(g,{position:f,scale:.4,level:t}),(0,n.jsx)(p,{position:m[0],level:t}),(0,n.jsx)(p,{position:m[1],level:t}),(0,n.jsx)(p,{position:m[2],level:t}),s&&(0,n.jsx)(y,{world:s,positions:m})]})}},2824:function(e,t,r){r.d(t,{Z:function(){return S}});var n=r(7437),i=r(2265),o=r(1276),a=r(73),s=r(1168),l=r(246),c=r(8001),d=r(6862),u=r(1448),h=e=>{let{color:t,size:r,mesh1Ref:a,mesh2Ref:s,opacity:l=1}=e,c=(0,i.useRef)(null),d=(0,i.useRef)(null),h=(0,i.useRef)(new Float32Array(135)),p=(0,i.useRef)(new Float32Array(135)),g=(0,i.useRef)(new Float32Array(45)),m=(0,i.useRef)(new Float32Array(45)),f=(0,i.useRef)(new Float32Array(45)),y=(0,i.useRef)(new Float32Array(45)),x=(0,i.useRef)(!1),M=(0,i.useRef)(new u.Vector3),v=(0,i.useRef)(new u.Vector3),j=(0,i.useRef)(0);return(0,i.useEffect)(()=>{if(a.current&&s.current&&!x.current){let{x:e,y:t,z:r}=a.current.position,{x:n,y:i,z:o}=s.current.position;M.current.set(e,t,r),v.current.set(n,i,o);for(let a=0;a<45;a++)h.current[3*a]=e,h.current[3*a+1]=t,h.current[3*a+2]=r,p.current[3*a]=n,p.current[3*a+1]=i,p.current[3*a+2]=o,g.current[a]=0,m.current[a]=0,f.current[a]=0,y.current[a]=0;x.current=!0}},[a,s]),(0,o.F)((e,t)=>{var n,i;if(!(null===(n=c.current)||void 0===n?void 0:n.parent)||!(null===(i=d.current)||void 0===i?void 0:i.parent)||!a.current||!s.current||!x.current||(j.current+=t,j.current<.016))return;j.current=0;let o=a.current.position,u=s.current.position,w=o.distanceTo(M.current),S=u.distanceTo(v.current);if(w>.05||S>.05){M.current.copy(o),v.current.copy(u);for(let e=44;e>0;e--)h.current[3*e]=h.current[(e-1)*3],h.current[3*e+1]=h.current[(e-1)*3+1],h.current[3*e+2]=h.current[(e-1)*3+2],p.current[3*e]=p.current[(e-1)*3],p.current[3*e+1]=p.current[(e-1)*3+1],p.current[3*e+2]=p.current[(e-1)*3+2];if(h.current[0]=o.x,h.current[1]=o.y,h.current[2]=o.z,p.current[0]=u.x,p.current[1]=u.y,p.current[2]=u.z,c.current&&d.current){let e=c.current.geometry,t=d.current.geometry;e.attributes.position.needsUpdate=!0,t.attributes.position.needsUpdate=!0}}for(let e=0;e<45;e++)g.current[e]=.6*Math.pow(1-e/45,2)*l,m.current[e]=.6*Math.pow(1-e/45,2)*l,f.current[e]=.5*r*Math.pow(1-e/45,.5),y.current[e]=.5*r*Math.pow(1-e/45,.5);if(c.current&&d.current){let e=c.current.geometry,t=d.current.geometry;e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0,t.attributes.opacity.needsUpdate=!0,t.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("points",{ref:c,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:45,array:h.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:45,array:g.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:45,array:f.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:u.AdditiveBlending,vertexShader:"\n            attribute float opacity;\n            attribute float scale;\n            varying float vOpacity;\n            void main() {\n              vOpacity = opacity;\n              vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n              gl_Position = projectionMatrix * mvPosition;\n              gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n            }\n          ",fragmentShader:"\n            varying float vOpacity;\n            uniform vec3 uColor;\n            void main() {\n              float d = length(gl_PointCoord - vec2(0.5));\n              float strength = smoothstep(0.5, 0.1, d);\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n              gl_FragColor = vec4(glowColor, vOpacity * strength);\n            }\n          ",uniforms:{uColor:{value:t}}})]}),(0,n.jsxs)("points",{ref:d,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:45,array:p.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:45,array:m.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:45,array:y.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:u.AdditiveBlending,vertexShader:"\n            attribute float opacity;\n            attribute float scale;\n            varying float vOpacity;\n            void main() {\n              vOpacity = opacity;\n              vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n              gl_Position = projectionMatrix * mvPosition;\n              gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n            }\n          ",fragmentShader:"\n            varying float vOpacity;\n            uniform vec3 uColor;\n            void main() {\n              float d = length(gl_PointCoord - vec2(0.5));\n              float strength = smoothstep(0.5, 0.1, d);\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n              gl_FragColor = vec4(glowColor, vOpacity * strength);\n            }\n          ",uniforms:{uColor:{value:t}}})]})]})};function p(e){let{id:t,position:r,direction:a,onImpact:s,checkCollisions:l}=e,c=(0,i.useRef)(null),d=(0,i.useRef)(null),p=(0,i.useRef)(new u.Clock),g=(0,i.useRef)(r.clone()),m=(0,i.useRef)(r.clone()),f=(0,i.useRef)(!1),y=(0,i.useRef)(null),[x,M]=(0,i.useState)(1),{scene:v}=(0,o.D)(),j=new u.Color("#8B00FF"),w=(0,i.useRef)(0);return(0,o.F)((e,r)=>{if(!c.current||!d.current)return;let n=Date.now();if(null!==y.current){let e=Math.min((n-y.current)/500,1);if(M(1-e),e>=1){c.current.removeFromParent(),d.current.removeFromParent(),s&&s();return}}if(f.current)return;if(p.current.getElapsedTime()>5){f.current=!0,y.current=n;return}w.current+=r;let i=a.clone().multiplyScalar(.25*r*60);if(g.current.add(i),g.current.distanceTo(m.current)>=20){f.current=!0,y.current=n,s&&s(g.current.clone());return}if(l){let e=g.current.clone();if(l(t,e)){f.current=!0,y.current=n,s&&s(e);return}}let o=3.5*w.current*Math.PI*2,h=new u.Vector3(.375*Math.cos(o),.375*Math.sin(.5*o)*.3,0),x=new u.Vector3(.375*Math.cos(o+Math.PI),.375*Math.sin((o+Math.PI)*.5)*.3,0),v=new u.Vector3,j=new u.Vector3(0,1,0);v.crossVectors(a,j).normalize(),j.crossVectors(v,a).normalize();let S=v.clone().multiplyScalar(h.x).add(j.clone().multiplyScalar(h.y)),b=v.clone().multiplyScalar(x.x).add(j.clone().multiplyScalar(x.y));c.current.position.copy(g.current.clone().add(S)),d.current.position.copy(g.current.clone().add(b))}),(0,n.jsxs)("group",{name:"crossentropy-bolt-group",children:[(0,n.jsxs)("mesh",{ref:c,position:g.current,children:[(0,n.jsx)("sphereGeometry",{args:[.25,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#A020F0",emissiveIntensity:2*x,transparent:!0,opacity:.9*x,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1}),(0,n.jsx)("pointLight",{color:j,intensity:5*x,distance:12})]}),(0,n.jsxs)("mesh",{ref:d,position:g.current,children:[(0,n.jsx)("sphereGeometry",{args:[.25,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#A020F0",emissiveIntensity:2*x,transparent:!0,opacity:.9*x,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1}),(0,n.jsx)("pointLight",{color:j,intensity:5*x,distance:12})]}),(0,n.jsx)(h,{color:j,size:.225,mesh1Ref:c,mesh2Ref:d,opacity:x}),(0,n.jsx)("pointLight",{color:j,intensity:8*x,distance:4,decay:2})]})}var g=e=>{let{color:t,size:r,meshRef:a,opacity:s=1}=e,l=(0,i.useRef)(null),c=(0,i.useRef)(new Float32Array(66)),d=(0,i.useRef)(new Float32Array(22)),h=(0,i.useRef)(new Float32Array(22)),p=(0,i.useRef)(!1),g=(0,i.useRef)(new u.Vector3),m=(0,i.useRef)(0);return(0,i.useEffect)(()=>{if(a.current&&!p.current){let e=new u.Vector3;a.current.getWorldPosition(e);let{x:t,y:r,z:n}=e;g.current.set(t,r,n);for(let e=0;e<22;e++)c.current[3*e]=t,c.current[3*e+1]=r,c.current[3*e+2]=n,d.current[e]=0,h.current[e]=0;p.current=!0}},[a]),(0,o.F)((e,t)=>{var n;if(!(null===(n=l.current)||void 0===n?void 0:n.parent)||!a.current||!p.current||(m.current+=t,m.current<.02))return;m.current=0;let i=new u.Vector3;if(a.current.getWorldPosition(i),i.distanceTo(g.current)>.08){g.current.copy(i);for(let e=21;e>0;e--)c.current[3*e]=c.current[(e-1)*3],c.current[3*e+1]=c.current[(e-1)*3+1],c.current[3*e+2]=c.current[(e-1)*3+2];c.current[0]=i.x,c.current[1]=i.y,c.current[2]=i.z,l.current&&(l.current.geometry.attributes.position.needsUpdate=!0)}for(let e=0;e<22;e++)d.current[e]=.7*Math.pow(1-e/22,2)*s,h.current[e]=.6*r*Math.pow(1-e/22,.6);if(l.current){let e=l.current.geometry;e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:l,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:22,array:c.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:22,array:d.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:22,array:h.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:u.AdditiveBlending,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 18.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            // Entropic effect with green energy glow\n            vec3 glowColor = mix(uColor, vec3(0.4, 1.0, 0.6), 0.3);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})};function m(e){let{id:t,position:r,direction:a,onImpact:s,checkCollisions:l}=e,c=(0,i.useRef)(null);(0,i.useRef)(null);let d=(0,i.useRef)(r.clone()),h=(0,i.useRef)(!1),[p,m]=(0,i.useState)(!1),[y,x]=(0,i.useState)(null),M=(0,i.useRef)(r.clone().add(a.clone().multiplyScalar(25))),v=(0,i.useRef)(0),j=(0,i.useRef)(1e3*Math.random()),w=(0,i.useRef)(new u.Vector3);return(0,i.useEffect)(()=>{c.current&&c.current.position.copy(r)},[r]),(0,o.F)((e,r)=>{if(!c.current||h.current)return;v.current+=r;let n=Math.min(1.6666666666666667*v.current,1),i=d.current.clone().lerp(M.current,n),o=v.current,a=j.current,u=(1-n)*.15;w.current.set(.3*Math.sin(8*o+a)*Math.sin(3*o+.5*a)*2.5+(Math.random()-.5)*u,.4*Math.cos(6*o+1.5*a)*Math.sin(4*o+.8*a)*2.6+(Math.random()-.5)*u,.25*Math.sin(7*o+2*a)*Math.cos(5*o+1.2*a)*2.4+(Math.random()-.5)*u);let p=i.clone().add(w.current);if(c.current.position.copy(p),l){let e=c.current.position.clone();if(l(t,e)){h.current=!0,x(e),m(!0),s&&s(e);return}}n>=1&&!h.current&&(h.current=!0,x(M.current.clone()),m(!0),s&&s(M.current.clone()))}),(0,n.jsxs)("group",{children:[!h.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g,{color:new u.Color("#00ff44"),size:.225,meshRef:c,opacity:1}),(0,n.jsx)("group",{ref:c,position:r.toArray(),children:(0,n.jsx)("group",{rotation:[0,Math.atan2(a.x,a.z),0],children:(0,n.jsx)("pointLight",{color:"#00ff44",intensity:3,distance:4,decay:2})})})]}),p&&y&&(0,n.jsx)(f,{position:y,onComplete:()=>{setTimeout(()=>{s&&s()},200)}})]})}function f(e){let{position:t,onComplete:r}=e,o=(0,i.useRef)(Date.now()),[,a]=(0,i.useState)({});(0,i.useEffect)(()=>{let e=setInterval(()=>{a({}),(Date.now()-o.current)/1e3>.6&&(clearInterval(e),r&&r())},16),t=setTimeout(()=>{clearInterval(e),r&&r()},600);return()=>{clearInterval(e),clearTimeout(t)}},[r]);let s=(Date.now()-o.current)/1e3,l=Math.max(0,1-s/.6);return l<=0?null:(0,n.jsxs)("group",{position:t,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.8*(1+1.5*s),12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#00ff44",emissiveIntensity:1*l,transparent:!0,opacity:.6*l,blending:u.AdditiveBlending,depthWrite:!1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.55*(1+2*s),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#33ff66",emissive:"#33ff66",emissiveIntensity:1*l,transparent:!0,opacity:.7*l,blending:u.AdditiveBlending,depthWrite:!1})]}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2,i=1.5*(1+1.2*s);return(0,n.jsxs)("mesh",{position:[Math.sin(r)*i,Math.cos(r)*i*.2,Math.cos(r+Math.PI/3)*i*.4],rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("coneGeometry",{args:[.08,.4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#66ff88",emissiveIntensity:1.5*l,transparent:!0,opacity:.8*l})]},t)}),[void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,t*Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[1*(1+1.5*s)+.2*t,.08,6,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#00ff44",emissiveIntensity:1.5*l,transparent:!0,opacity:.5*l*(1-.3*t),blending:u.AdditiveBlending})]},"energy-ring-".concat(t))),(0,n.jsx)("pointLight",{color:"#00ff44",intensity:8*l,distance:4,decay:2})]})}var y=function(e){let{color:t,size:r,arrowHeadRef:a,arrowShaftRef:s,opacity:l=1}=e,c=(0,i.useRef)(null),d=(0,i.useRef)([]),h=(0,i.useRef)(!1),p=(0,i.useMemo)(()=>{let e=new u.BufferGeometry,t=new Float32Array(225),r=new Float32Array(225),n=[];for(let e=0;e<75;e++){t[3*e]=0,t[3*e+1]=0,t[3*e+2]=0;let n=1-e/75;r[3*e]=1,r[3*e+1]=.6*n,r[3*e+2]=0}for(let e=0;e<74;e++)n.push(e,e+1);return e.setAttribute("position",new u.BufferAttribute(t,3)),e.setAttribute("color",new u.BufferAttribute(r,3)),e.setIndex(n),e},[75]),g=(0,i.useMemo)(()=>new u.LineBasicMaterial({vertexColors:!0,transparent:!0,opacity:.8*l,blending:u.AdditiveBlending,depthWrite:!1,linewidth:3}),[l]);return(0,o.F)(()=>{if(!a.current||!c.current)return;let e=new u.Vector3;if(a.current.getWorldPosition(e),.01>e.lengthSq())return;if(!h.current){for(let t=0;t<75;t++)d.current.push(e.clone());h.current=!0;let t=p.attributes.position.array;for(let r=0;r<75;r++)t[3*r]=e.x,t[3*r+1]=e.y,t[3*r+2]=e.z;p.attributes.position.needsUpdate=!0;return}d.current.unshift(e),d.current.length>75&&d.current.pop();let t=p.attributes.position.array;for(let e=0;e<d.current.length;e++){let r=d.current[e];t[3*e]=r.x,t[3*e+1]=r.y,t[3*e+2]=r.z}p.attributes.position.needsUpdate=!0}),(0,n.jsxs)("group",{name:"charged-arrow-trail",children:[(0,n.jsx)("primitive",{ref:c,object:new u.Line(p,g)}),d.current.slice(0,5).map((e,i)=>(0,n.jsxs)("mesh",{position:e,children:[(0,n.jsx)("sphereGeometry",{args:[2*r*(.3-.05*i),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:t,emissive:t,emissiveIntensity:2-.3*i,transparent:!0,opacity:l*(1-.2*i),depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]},i)),d.current.slice(0,3).map((e,t)=>(0,n.jsx)("group",{position:e,children:[0,1,2].map(e=>(0,n.jsxs)("mesh",{position:[(Math.random()-.5)*.3,(Math.random()-.5)*.3,(Math.random()-.5)*.3],children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc00",emissive:"#ff8800",emissiveIntensity:3,transparent:!0,opacity:l*(1-.3*t),depthWrite:!1,blending:u.AdditiveBlending})]},e))},"spark-".concat(t)))]})};function x(e){let{position:t,direction:r,onImpact:a}=e,s=(0,i.useRef)(null),l="#ffaa00",c=(0,i.useRef)(null),d=(0,i.useRef)(null);return(0,o.F)((e,n)=>{if(!s.current)return;s.current.position.copy(t);let i=t.clone().add(r.clone().normalize());s.current.lookAt(i)}),(0,n.jsxs)("group",{name:"charged-arrow-group",children:[(0,n.jsxs)("group",{ref:s,position:t,children:[(0,n.jsxs)("mesh",{ref:c,position:[0,0,.2],children:[(0,n.jsx)("coneGeometry",{args:[.08,.25,8]}),(0,n.jsx)("meshStandardMaterial",{color:l,emissive:"#ff6600",emissiveIntensity:3,transparent:!0,opacity:.9,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1}),(0,n.jsx)("pointLight",{color:l,intensity:8,distance:6})]}),(0,n.jsxs)("mesh",{ref:d,children:[(0,n.jsx)("cylinderGeometry",{args:[.02,.03,.4,8]}),(0,n.jsx)("meshStandardMaterial",{color:l,emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:.8,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]}),(0,n.jsx)("group",{position:[0,0,-.15],children:[0,120,240].map((e,t)=>(0,n.jsxs)("mesh",{position:[.04*Math.cos(e*Math.PI/180),.04*Math.sin(e*Math.PI/180),0],rotation:[0,0,e*Math.PI/180],children:[(0,n.jsx)("planeGeometry",{args:[.08,.12]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc44",emissive:"#ff9900",emissiveIntensity:1.5,transparent:!0,opacity:.7,side:u.DoubleSide,depthWrite:!1,blending:u.AdditiveBlending})]},t))}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.22499999999999998,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:l,emissive:"#ffaa00",emissiveIntensity:1,transparent:!0,opacity:.3,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]}),(0,n.jsx)("pointLight",{color:l,intensity:12,distance:8,decay:2})]}),(0,n.jsx)(y,{color:l,size:.15,arrowHeadRef:c,arrowShaftRef:d,opacity:1})]})}function M(e){let{position:t,direction:r,onImpact:a,distanceTraveled:s=0,maxDistance:l=25}=e,c=(0,i.useRef)(null),d="#ffaa00",h=.7*l,p=Math.max(.1,1-Math.max(0,Math.min(1,(s-h)/(l-h))));return(0,o.F)((e,n)=>{if(!c.current)return;c.current.position.copy(t);let i=t.clone().add(r.clone().normalize());c.current.lookAt(i)}),(0,n.jsx)("group",{name:"regular-arrow-group",children:(0,n.jsxs)("group",{ref:c,position:t,children:[(0,n.jsxs)("mesh",{position:[0,0,.2],children:[(0,n.jsx)("coneGeometry",{args:[.08,.25,8]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:"#ff6600",emissiveIntensity:3*p,transparent:!0,opacity:.9*p,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.02,.03,.4,8]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:"#ff8800",emissiveIntensity:2*p,transparent:!0,opacity:.8*p,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]}),(0,n.jsx)("group",{position:[0,0,-.15],children:[0,120,240].map((e,t)=>(0,n.jsxs)("mesh",{position:[.04*Math.cos(e*Math.PI/180),.04*Math.sin(e*Math.PI/180),0],rotation:[0,0,e*Math.PI/180],children:[(0,n.jsx)("planeGeometry",{args:[.08,.12]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc44",emissive:"#ff9900",emissiveIntensity:1.5*p,transparent:!0,opacity:.7*p,side:u.DoubleSide,depthWrite:!1,blending:u.AdditiveBlending})]},t))}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.22499999999999998,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:"#ffaa00",emissiveIntensity:1*p,transparent:!0,opacity:.3*p,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]})]})})}var v=r(6374);function j(e){let{position:t,onComplete:r,color:a=new u.Color("#00ff44"),size:s=.15,duration:l=.5}=e,c=(0,i.useRef)(null),d=(0,i.useRef)(null);return(0,o.F)(e=>{if(!c.current)return;null===d.current&&(d.current=e.clock.getElapsedTime());let t=(e.clock.getElapsedTime()-d.current)/l;if(t>=1){r();return}let n=Math.max(0,1-t);if(c.current.scale.setScalar(1+3*t),c.current.material instanceof u.Material){let e=c.current.material;e.opacity=.8*n,e.emissiveIntensity=1.5*n}}),(0,n.jsxs)("mesh",{ref:c,position:t,children:[(0,n.jsx)("torusGeometry",{args:[2*s,.3*s,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:a,emissive:a,emissiveIntensity:1.5,transparent:!0,opacity:.8,depthWrite:!1,blending:u.AdditiveBlending})]})}function w(e){let{position:t,chargeTime:r=1,explosionStartTime:o,onComplete:a}=e,s=(0,i.useRef)(o||Date.now()),[,l]=(0,i.useState)({}),c=Math.min(r/4,1),d=.6+1*c,h=2.5+4*c;(0,i.useEffect)(()=>{let e=setInterval(()=>{l({}),(Date.now()-s.current)/1e3>1&&(clearInterval(e),a&&a())},16),t=setTimeout(()=>{clearInterval(e),a&&a()},1e3);return()=>{clearInterval(e),clearTimeout(t)}},[a]);let p=(Date.now()-s.current)/1e3,g=Math.max(0,1-p/1);if(g<=0)return null;let m=4+(p<.15?10:0);return(0,n.jsxs)("group",{position:t,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.4*d*(1+p*m),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#AA00FF",emissiveIntensity:h*g*.6,transparent:!0,opacity:.85*g,depthWrite:!1,blending:u.AdditiveBlending})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.5*d*(1+p*(m+1)),24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#9932CC",emissive:"#DA70D6",emissiveIntensity:.6*h*g,transparent:!0,opacity:.9*g,depthWrite:!1,blending:u.AdditiveBlending})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.6*d*(1+p*(m+2)),16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF00FF",emissive:"#FF69B4",emissiveIntensity:.4*h*g,transparent:!0,opacity:.7*g,depthWrite:!1,blending:u.AdditiveBlending})]}),[.5,.7,.85,1,1.2,1.4].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[e*d*(1+p*(m+2)),.08*d,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#AA00FF",emissiveIntensity:h*g*.4,transparent:!0,opacity:.8*g*(1-.12*t),depthWrite:!1,blending:u.AdditiveBlending})]},t)),[...Array(16)].map((e,t)=>{let r=t/16*Math.PI*2,i=d*(1+p*(m-.5))*(1+.4*Math.random());return(0,n.jsxs)("mesh",{position:[Math.sin(r)*i,Math.cos(r)*i+(Math.random()-.5)*.6,(Math.random()-.5)*.4],children:[(0,n.jsx)("sphereGeometry",{args:[.1*d,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF00FF",emissive:"#FF69B4",emissiveIntensity:1.5*h*g,transparent:!0,opacity:.95*g,depthWrite:!1,blending:u.AdditiveBlending})]},"spark-".concat(t))}),[...Array(32)].map((e,t)=>{let r=t/32*Math.PI*2+.5*Math.random(),i=.7*d*(1+p*(m+1))*(1+.3*Math.random());return(0,n.jsxs)("mesh",{position:[Math.sin(r)*i,Math.cos(r)*i+(Math.random()-.5)*.4,(Math.random()-.5)*.3],children:[(0,n.jsx)("sphereGeometry",{args:[.05*d,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#DA70D6",emissive:"#FF1493",emissiveIntensity:1.8*h*g,transparent:!0,opacity:.9*g,depthWrite:!1,blending:u.AdditiveBlending})]},"small-spark-".concat(t))}),(0,n.jsx)("pointLight",{color:"#8B00FF",intensity:4*h*g,distance:6*d,decay:1.8}),(0,n.jsx)("pointLight",{color:"#FF00FF",intensity:2*h*g,distance:9*d,decay:1.5}),p<.15&&(0,n.jsx)("pointLight",{color:"#DA70D6",intensity:8*h*(1-6.67*p),distance:4*d,decay:1}),(0,n.jsx)("pointLight",{color:"#9932CC",intensity:1.2*h*g,distance:12*d,decay:2})]})}function S(e){let{world:t}=e,[r,h]=(0,i.useState)({crossentropy:[],entropic:[],charged:[],regular:[],barrage:[]}),[g,f]=(0,i.useState)([]),y=(0,i.useRef)(0),S=(0,i.useRef)(0),b=(0,i.useRef)(0),C=(0,i.useRef)(0),I=(0,i.useRef)(0),P=(0,i.useRef)(0),D=(0,i.useRef)(0),E=(e,r)=>{if(!t)return!1;for(let e of t.getAllEntities()){let t=e.getComponent(c.C),n=e.getComponent(d.S),i=e.getComponent(a.w);if(!t||!n||!i||n.isDead)continue;let o=new u.Vector3(r.x,0,r.z),s=new u.Vector3(i.position.x,0,i.position.z);if(1.5>=o.distanceTo(s))return!0}return!1},F=(e,r)=>{if(!t)return!1;for(let e of t.getAllEntities()){let t=e.getComponent(c.C),n=e.getComponent(d.S),i=e.getComponent(a.w);if(!t||!n||!i||n.isDead)continue;let o=new u.Vector3(r.x,0,r.z),s=new u.Vector3(i.position.x,0,i.position.z);if(1.6>=o.distanceTo(s))return!0}return!1};(0,o.F)(e=>{var n,i;let o=e.clock.getElapsedTime();if(o-D.current<.016||(D.current=o,!t))return;let c=t.queryEntities([a.w,s.W,l.T]),d=[],p=[],m=[],x=[],M=[];for(let e of c){let t=e.getComponent(l.T),n=e.getComponent(a.w),i=e.getComponent(s.W);if(!(null==t?void 0:t.mesh)||!n||!i)continue;let o=t.mesh.userData,c=o.direction||i.velocity.clone().normalize();if(o.isCrossentropyBolt){let t=r.crossentropy.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),d.push(t)):d.push({id:y.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id})}else if(o.isEntropicBolt){let t=r.entropic.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),p.push(t)):p.push({id:S.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id})}else if(o.isChargedArrow){let t=r.charged.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),m.push(t)):m.push({id:b.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id,subclass:o.subclass,level:o.level,opacity:o.opacity||1})}else if(o.isBarrageArrow){let t=r.barrage.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),M.push(t)):M.push({id:I.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id,subclass:o.subclass,level:o.level,opacity:o.opacity||1})}else if(o.isRegularArrow){let t=r.regular.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),x.push(t)):x.push({id:C.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id,subclass:o.subclass,level:o.level,opacity:o.opacity||1})}}let v=(null===(n=t.getEvents)||void 0===n?void 0:n.call(t,"explosion"))||[],j=[...g];for(let e of v){let t={id:P.current++,position:e.position.clone(),color:e.color||new u.Color("#00ff44"),size:e.size||1,duration:e.duration||2};j.push(t)}v.length>0&&(null===(i=t.clearEvents)||void 0===i||i.call(t,"explosion")),(d.length!==r.crossentropy.length||p.length!==r.entropic.length||m.length!==r.charged.length||x.length!==r.regular.length||M.length!==r.barrage.length||d.some(e=>!r.crossentropy.find(t=>t.entityId===e.entityId))||p.some(e=>!r.entropic.find(t=>t.entityId===e.entityId))||m.some(e=>!r.charged.find(t=>t.entityId===e.entityId))||x.some(e=>!r.regular.find(t=>t.entityId===e.entityId))||M.some(e=>!r.barrage.find(t=>t.entityId===e.entityId)))&&h({crossentropy:d,entropic:p,charged:m,regular:x,barrage:M}),j.length!==g.length&&f(j)});let R=e=>{f(t=>t.filter(t=>t.id!==e))};return(0,n.jsxs)(n.Fragment,{children:[r.crossentropy.map(e=>(0,n.jsx)(p,{id:e.id,position:e.position,direction:e.direction,checkCollisions:F,onImpact:e=>{if(e){let t={id:P.current++,position:e.clone(),color:new u.Color("#8B00FF"),size:2.5,duration:1,type:"crossentropy",chargeTime:1};f(e=>[...e,t])}}},e.id)),r.entropic.map(e=>(0,n.jsx)(m,{id:e.id,position:e.position,direction:e.direction,checkCollisions:E,onImpact:e=>{}},e.id)),r.charged.map(e=>(0,n.jsx)(x,{position:e.position,direction:e.direction,onImpact:()=>{}},e.id)),r.regular.map(e=>{let r=null==t?void 0:t.getEntity(e.entityId),i=null==r?void 0:r.getComponent(s.W),o=(null==i?void 0:i.distanceTraveled)||0,a=(null==i?void 0:i.maxDistance)||25;return(0,n.jsx)(M,{position:e.position,direction:e.direction,distanceTraveled:o,maxDistance:a,onImpact:()=>{}},e.id)}),(0,n.jsx)(v.Z,{projectiles:r.barrage.map(e=>{let r=null==t?void 0:t.getEntity(e.entityId),n=null==r?void 0:r.getComponent(s.W),i=(null==n?void 0:n.distanceTraveled)||0,o=(null==n?void 0:n.maxDistance)||25;return{id:e.id,position:e.position,direction:e.direction,startPosition:e.position.clone(),maxDistance:o,damage:30,startTime:Date.now(),hasCollided:!1,hitEnemies:new Set,opacity:e.opacity,distanceTraveled:i}})}),g.map(e=>"crossentropy"===e.type?(0,n.jsx)(w,{position:e.position,chargeTime:e.chargeTime||.75,explosionStartTime:Date.now(),onComplete:()=>R(e.id)},e.id):(0,n.jsx)(j,{position:e.position,color:e.color,size:e.size/2,duration:e.duration,onComplete:()=>R(e.id)},e.id))]})}},6374:function(e,t,r){r.d(t,{Z:function(){return o}});var n=r(7437);r(2265);var i=r(1448);function o(e){let{projectiles:t}=e;return(0,n.jsx)(n.Fragment,{children:t.map(e=>{let t=e.distanceTraveled||e.position.distanceTo(e.startPosition),r=e.maxDistance||25,o=.7*r,a=(void 0!==e.opacity?e.opacity:1)*Math.max(.1,1-Math.max(0,Math.min(1,(t-o)/(r-o))));return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.025,.1,1.8,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#0088ff",emissive:"#0088ff",emissiveIntensity:1.2*a,transparent:!0,opacity:a})]}),[void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,0,-(.4*t)+.4],rotation:[Math.PI,0,.004*Date.now()+t*Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.1+.03*t,.04,6,10]}),(0,n.jsx)("meshStandardMaterial",{color:"#0088ff",emissive:"#0088ff",emissiveIntensity:2.5*a,transparent:!0,opacity:(.8-.1*t)*a,blending:i.AdditiveBlending})]},"barrage-ring-".concat(t))),(0,n.jsx)("pointLight",{color:"#0088ff",intensity:2.5*a,distance:4,decay:2})]})},e.id)})})}},7057:function(e,t,r){r.d(t,{Z:function(){return d}});var n=r(7437),i=r(2265),o=r(4244),a=r(1448),s=r(1276),l=r(7125),c=e=>{let{position:t,direction:r,onComplete:o,subclass:c,isElementalShotsUnlocked:d=!0,isPerfectShot:u=!1}=e,h=(0,i.useRef)(null),p=(0,i.useRef)(Date.now()),g=u?200:166,m=(0,i.useRef)(null);u&&console.log("⚡ BowPowershot: Rendering PERFECT SHOT with enhanced effects!");let f=c===l.p.VENOM?{core:"#00ff40",emissive:"#00aa20",outer:"#00ff60"}:c===l.p.ELEMENTAL?d?{core:"#ff4400",emissive:"#cc0000",outer:"#ff6600"}:{core:"#0066ff",emissive:"#0044cc",outer:"#0088ff"}:{core:"#ffffff",emissive:"#cccccc",outer:"#ffffff"};(0,s.F)(()=>{if(Date.now()-p.current>=g&&!m.current&&(m.current=Date.now()),m.current&&Date.now()-m.current>=300){o();return}});let y=m.current?Math.max(0,1-(Date.now()-m.current)/300):1;return(0,n.jsx)("group",{ref:h,position:t.toArray(),children:(0,n.jsxs)("group",{rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[u?.035:.025,u?.035:.025,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:f.core,emissive:f.emissive,emissiveIntensity:(u?15:12)*y,transparent:!0,opacity:.95*y})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[u?.08:.0625,u?.08:.0625,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:f.core,emissive:f.emissive,emissiveIntensity:(u?10:8)*y,transparent:!0,opacity:.7*y})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[u?.095:.075,u?.095:.075,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:f.outer,emissive:f.emissive,emissiveIntensity:(u?6:4)*y,transparent:!0,opacity:.5*y})]}),[...Array(u?8:6)].map((e,t)=>{let r=Math.min(1,(Date.now()-p.current)/800),i=m.current?Math.max(0,1-(Date.now()-m.current)/600):1,o=1-.1*t;return(0,n.jsxs)("group",{position:[0,0,3*t],children:[(0,n.jsxs)("mesh",{rotation:[0,.002*Date.now()+t,0],scale:[o,o,o],children:[(0,n.jsx)("torusGeometry",{args:[.4,.08,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:f.outer,emissive:f.emissive,emissiveIntensity:2*i,transparent:!0,opacity:.4*i*(1-.5*r),blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,-.003*Date.now()+t,0],scale:[.7*o,.7*o,.7*o],children:[(0,n.jsx)("torusGeometry",{args:[.3,.06,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:f.core,emissive:f.emissive,emissiveIntensity:1.5*i,transparent:!0,opacity:.3*i*(1-.3*r),blending:a.AdditiveBlending})]})]},"ring-".concat(t))}),(0,n.jsx)("pointLight",{color:f.core,intensity:(u?20:15)*y,distance:u?10:8,decay:2,position:[0,0,10]}),u&&(0,n.jsxs)(n.Fragment,{children:[[void 0,void 0,void 0,void 0].map((e,t)=>{let r=t/4*Math.PI*2;return(0,n.jsx)("group",{position:[.15*Math.sin(r+.01*Date.now()),.15*Math.cos(r+.01*Date.now()),10+2*Math.sin(.005*Date.now()+t)],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:8*y,transparent:!0,opacity:.8*y,blending:a.AdditiveBlending})]})},"lightning-".concat(t))}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.12,.12,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:2*y,transparent:!0,opacity:.3*y,blending:a.AdditiveBlending})]})]})]})})};function d(){let{activeEffects:e,removeEffect:t}=(0,o.sf)();return(0,n.jsx)(n.Fragment,{children:e.map(e=>(0,n.jsx)(c,{position:e.position,direction:e.direction,subclass:e.subclass,isElementalShotsUnlocked:e.isElementalShotsUnlocked,isPerfectShot:e.isPerfectShot,onComplete:()=>t(e.id)},e.id))})}},7019:function(e,t,r){r.r(t),r.d(t,{default:function(){return w},getGlobalCobraShotProjectiles:function(){return j},triggerGlobalCobraShot:function(){return v}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448);let s=e=>{let{projectile:t}=e,r=(0,i.useRef)(null);return((0,o.F)(()=>{if(!r.current)return;r.current.position.copy(t.position);let e=t.direction.clone().normalize(),n=Math.atan2(e.x,e.z),i=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z));r.current.rotation.set(i,n,0)}),t.active)?(0,n.jsx)("group",{ref:r,children:(0,n.jsx)("pointLight",{color:"#00ff40",intensity:2*t.opacity,distance:4,decay:2})}):null};function l(e){let{projectilePool:t}=e;return(0,n.jsx)(n.Fragment,{children:t.map(e=>(0,n.jsx)(s,{projectile:e},e.id))})}var c=e=>{let{position:t,direction:r,onComplete:a,isReturning:s=!1}=e,l=(0,i.useRef)(null),c=(0,i.useRef)(Date.now()),d=(0,i.useRef)(null),u="#00ff40",h="#00aa20",p="#00ff60";(0,o.F)(()=>{if(Date.now()-c.current>=175&&!d.current&&(d.current=Date.now()),d.current&&Date.now()-d.current>=150){a();return}});let g=d.current?Math.max(0,1-(Date.now()-d.current)/400):1;return(0,n.jsxs)("group",{ref:l,position:t.toArray(),children:[(0,n.jsxs)("group",{rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:u,emissive:h,emissiveIntensity:16*g,transparent:!0,opacity:.98*g})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:h,emissiveIntensity:12*g,transparent:!0,opacity:.8*g})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.12,.12,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:p,emissive:u,emissiveIntensity:8*g,transparent:!0,opacity:.6*g})]}),[...Array(8)].map((e,t)=>{let r=Math.min(1,(Date.now()-c.current)/140),i=.8+.3*Math.sin(r*Math.PI*4+t);return(0,n.jsxs)("mesh",{position:[0,0,20*r-10],rotation:[Math.PI/2,0,(.01*Date.now()+t)%(2*Math.PI)],scale:[i,i,1],children:[(0,n.jsx)("torusGeometry",{args:[.15,.03,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:u,emissive:u,emissiveIntensity:8*g,transparent:!0,opacity:g*(1-r)*.8,blending:2,depthWrite:!1})]},t)}),[...Array(12)].map((e,t)=>{let r=Math.min(1,(Date.now()-c.current)/157.5);return(0,n.jsxs)("mesh",{position:[.5*Math.sin(r*Math.PI*6+t),0,20*r-10],scale:[.3,.3,.3],children:[(0,n.jsx)("sphereGeometry",{args:[.08,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:p,emissive:p,emissiveIntensity:10*g,transparent:!0,opacity:g*(1-r)*.6,blending:2,depthWrite:!1})]},"particle-".concat(t))})]}),(0,n.jsx)("pointLight",{color:u,intensity:8*g,distance:8,decay:1})]})},d=r(3351),u=r(8001),h=r(73),p=r(6862);let g=null,m=(e,t)=>!!g&&!!g.addVenomousEnemy&&(g.addVenomousEnemy(e,t),!0);function f(e){let{world:t}=e,[r,a]=(0,i.useState)([]),s=(0,i.useRef)(0),l=(0,i.useRef)(0),c=(0,i.useCallback)(()=>t?t.getAllEntities().filter(e=>e.hasComponent(u.C)&&e.hasComponent(h.w)&&e.hasComponent(p.S)).map(e=>{e.getComponent(u.C);let t=e.getComponent(h.w),r=e.getComponent(p.S);return{id:e.id.toString(),position:t.position.clone(),health:r.currentHealth,isDying:r.isDead,deathStartTime:r.isDead?Date.now():void 0}}):[],[t]),m=(0,i.useCallback)((e,t)=>{let r={id:s.current++,enemyId:e,position:t.clone(),startTime:Date.now(),duration:6e3};a(e=>[...e,r]),console.log("☠️ Created venom effect for enemy:",e,"at position:",t)},[]);i.useEffect(()=>(g={addVenomousEnemy:m},()=>{g=null}),[m]),(0,o.F)(e=>{let n=e.clock.getElapsedTime();if(n-l.current<.1||(l.current=n,!t))return;let i=t.getAllEntities();i.forEach(e=>{let t=e.getComponent(u.C),n=e.getComponent(h.w);t&&n&&t.isVenomous&&!r.find(t=>t.enemyId===e.id.toString())&&m(e.id.toString(),n.position)}),a(e=>e.filter(e=>{let t=i.find(t=>t.id.toString()===e.enemyId);if(!t)return!1;let r=t.getComponent(u.C),n=t.getComponent(p.S);return!!r&&!!n&&!n.isDead&&r.isVenomous}))});let f=e=>{a(t=>t.filter(t=>t.id!==e))};return(0,n.jsx)(n.Fragment,{children:r.map(e=>(0,n.jsx)(d.Z,{position:e.position,enemyId:e.enemyId,enemyData:c(),duration:e.duration,startTime:e.startTime,onComplete:()=>f(e.id)},e.id))})}var y=r(244);let x=null,M=null;function v(e,t){console.log("\uD83D\uDC0D triggerGlobalCobraShot called!",{position:e.toArray(),direction:t.toArray()}),x?(console.log("\uD83D\uDC0D Calling globalCobraShotTrigger"),x(e,t)):console.warn("\uD83D\uDC0D globalCobraShotTrigger is null - CobraShotManager may not be mounted")}function j(){return M?M():[]}function w(e){let{world:t}=e,r=(0,i.useRef)([]),s=(0,i.useRef)([]),g=(0,i.useRef)([]);(0,i.useRef)(0),(0,i.useRef)(0);let v=(0,i.useRef)(0),j=(0,i.useRef)(0);(0,i.useEffect)(()=>{r.current=[,,,].fill(null).map((e,t)=>({id:t,position:new a.Vector3,direction:new a.Vector3,startPosition:new a.Vector3,maxDistance:25,active:!1,startTime:0,hitEnemies:new Set,opacity:1,fadeStartTime:null}))},[]);let w=(0,i.useCallback)(()=>r.current.find(e=>!e.active),[]),S=(0,i.useCallback)((e,t)=>{console.log("\uD83D\uDC0D shootCobraShot called!",{position:e.toArray(),direction:t.toArray()});let r=w();if(!r){console.log("\uD83D\uDC0D No available Cobra Shot projectiles in pool");return}let n=Date.now();r.position.copy(e),r.direction.copy(t).normalize(),r.startPosition.copy(e),r.active=!0,r.startTime=n,r.hitEnemies.clear(),r.opacity=1,r.fadeStartTime=null,console.log("\uD83D\uDC0D Cobra Shot fired!",{position:e.toArray(),direction:t.toArray(),projectileId:r.id}),I(e,t)},[w]);(0,i.useEffect)(()=>(x=S,M=()=>r.current,()=>{x=null,M=null}),[S]);let b=(0,i.useCallback)(e=>{let t={id:v.current++,position:e.clone(),startTime:Date.now()};s.current.push(t),console.log("☠️ Venom effect created at",e.toArray())},[]),C=(0,i.useCallback)(e=>{s.current=s.current.filter(t=>t.id!==e)},[]),I=(0,i.useCallback)((e,t)=>{let r={id:j.current++,position:e.clone(),direction:t.clone(),startTime:Date.now()};g.current.push(r),console.log("\uD83D\uDC0D Cobra Shot beam effect created at",e.toArray())},[]),P=(0,i.useCallback)(e=>{g.current=g.current.filter(t=>t.id!==e)},[]);return(0,o.F)(()=>{let e=Date.now();r.current.forEach(r=>{if(!r.active)return;let n=e-r.startTime,i=r.direction.clone().multiplyScalar(1);r.position.add(i);let o=r.position.distanceTo(r.startPosition);if(Math.floor(n/16)%30==0&&console.log("\uD83D\uDC0D Cobra Shot projectile ".concat(r.id," at distance ").concat(o.toFixed(2)," / ").concat(25)),o>20&&!r.fadeStartTime&&(r.fadeStartTime=e),r.fadeStartTime){let t=e-r.fadeStartTime;if(r.opacity=Math.max(0,1-t/1e3),r.opacity<=0||o>25){r.active=!1,r.opacity=1,r.fadeStartTime=null,console.log("\uD83D\uDC0D Cobra Shot projectile deactivated (max distance/fade)");return}}t.getAllEntities().forEach(e=>{if(r.hitEnemies.has(e.id))return;let n=e.getComponent(u.C),i=e.getComponent(p.S),o=e.getComponent(h.w);if(n&&i&&o&&!i.isDead&&1.25>=r.position.distanceTo(o.position)){r.hitEnemies.add(e.id);let i=t.getSystem(y.b);i&&(i.queueDamage(e,29,void 0,"cobra_shot"),console.log("\uD83D\uDC0D Cobra Shot hit ".concat(n.getDisplayName()," for ").concat(29," damage")));let a=Date.now()/1e3;n.applyVenom(6,17,a),console.log("☠️ Applied venom to ".concat(n.getDisplayName()," (").concat(17," DPS for ").concat(6,"s)")),m(e.id.toString(),o.position),b(o.position),r.active=!1,r.opacity=1,r.fadeStartTime=null,console.log("\uD83D\uDC0D Cobra Shot projectile deactivated (hit enemy)")}})});let n=t.getAllEntities(),i=t.getSystem(y.b);n.forEach(t=>{let r=t.getComponent(u.C),n=t.getComponent(p.S),o=t.getComponent(h.w);if(!r||!n||!o||n.isDead)return;let a=r.updateVenomStatus(e/1e3);a.shouldDealDamage&&i&&(i.queueDamage(t,a.damage,void 0,"venom"),console.log("☠️ Venom dealt ".concat(a.damage," damage to ").concat(r.getDisplayName())),b(o.position))})}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{projectilePool:r.current}),(0,n.jsx)(f,{world:t}),s.current.map(e=>(0,n.jsx)(d.Z,{position:e.position,onComplete:()=>C(e.id)},e.id)),g.current.map(e=>(0,n.jsx)(c,{position:e.position,direction:e.direction,onComplete:()=>P(e.id)},e.id))]})}},3351:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448);function s(e){let{position:t,onComplete:r,duration:s=1e3,startTime:l=Date.now(),enemyId:c,enemyData:d=[]}=e,u=(0,i.useRef)(null),h=(0,i.useRef)(l);(0,o.F)(()=>{if(!u.current)return;let e=Date.now()-h.current,t=Math.min(e/s,1);if(c&&d.length>0){let e=d.find(e=>e.id===c);if(e&&e.health>0&&!e.isDying&&!e.deathStartTime){let t=e.position.clone();t.y+=1,u.current.position.copy(t)}}let n=1+1.5*t;u.current.scale.set(n,n,n);let i=c?.8+.2*Math.sin(.01*e):1-t;u.current.children.forEach(e=>{if(e instanceof a.Mesh){let t=e.material;void 0!==t.opacity&&(t.opacity=i)}}),t>=1&&!c&&r()});let p=(0,i.useRef)(Math.random()*Math.PI*2);return(0,n.jsxs)("group",{ref:u,position:[t.x,t.y+1,t.z],rotation:[0,p.current,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.4,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#00FF44",emissive:"#00FF44",emissiveIntensity:1.5,transparent:!0,opacity:.8,depthWrite:!1,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.2,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#33FF33",emissive:"#33FF33",emissiveIntensity:2,transparent:!0,opacity:.9,depthWrite:!1,blending:a.AdditiveBlending})]}),[...Array(6)].map((e,t)=>{let r=t/6*Math.PI*2;return(0,n.jsxs)("mesh",{position:[Math.cos(r)*(.3+.2*Math.random()),.4*Math.random()-.2,Math.sin(r)*(.3+.2*Math.random())],children:[(0,n.jsx)("sphereGeometry",{args:[.15+.1*Math.random(),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#00BB33",emissive:"#00BB33",emissiveIntensity:1.5,transparent:!0,opacity:.7,depthWrite:!1,blending:a.AdditiveBlending})]},t)}),[...Array(10)].map((e,t)=>{let r=Math.random()*Math.PI*2,i=.5*Math.random();return(0,n.jsxs)("mesh",{position:[Math.cos(r)*i,.4*Math.random()-.2,Math.sin(r)*i],children:[(0,n.jsx)("sphereGeometry",{args:[.05+.04*Math.random(),6,6]}),(0,n.jsx)("meshStandardMaterial",{color:t%2==0?"#00FF44":"#55FF00",emissive:t%2==0?"#00FF44":"#55FF00",emissiveIntensity:2,transparent:!0,opacity:.8,depthWrite:!1,blending:a.AdditiveBlending})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#00FF44",intensity:1.5,distance:3,decay:2})]})}},319:function(e,t,r){r.r(t),r.d(t,{default:function(){return p},triggerGlobalViperSting:function(){return h}});var n=r(7437),i=r(2265),o=r(1448),a=r(1276);let s=e=>{let{projectile:t}=e,r=(0,i.useRef)(null);return((0,a.F)(()=>{if(!r.current)return;r.current.position.copy(t.position);let e=t.direction.clone().normalize(),n=Math.atan2(e.x,e.z),i=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z));r.current.rotation.set(i,n,0)}),t.active)?(0,n.jsxs)("group",{ref:r,children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.15,2.5,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B3F9B",emissive:"#5A2B5F",emissiveIntensity:1.2,transparent:!0,opacity:t.opacity})]}),(0,n.jsxs)("mesh",{position:[0,0,1.25],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.15,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#A855C7",emissive:"#7E3A9F",emissiveIntensity:1.5,transparent:!0,opacity:t.opacity})]}),[void 0,void 0].map((e,r)=>(0,n.jsx)("group",{position:[0,0,.3-.4*r],children:(0,n.jsxs)("mesh",{rotation:[0,0,.01*Date.now()+r*Math.PI/3],children:[(0,n.jsx)("torusGeometry",{args:[.15+.05*r,.02,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#A855C7",emissive:"#A855C7",emissiveIntensity:2.5,transparent:!0,opacity:.7*t.opacity,blending:o.AdditiveBlending,depthWrite:!1})]})},"ring-".concat(r))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#C084FC",emissive:"#A855C7",emissiveIntensity:3,transparent:!0,opacity:t.opacity,blending:o.AdditiveBlending,depthWrite:!1})]}),[...Array(8)].map((e,r)=>{let i=t.opacity*(1-r/8)*.6,a=1-r/8*.5;return(0,n.jsxs)("group",{position:[0,0,-(.8*(r+1))],children:[(0,n.jsxs)("mesh",{scale:[a,a,a],children:[(0,n.jsx)("sphereGeometry",{args:[.15,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#A855C7",emissive:"#A855C7",emissiveIntensity:6,transparent:!0,opacity:i,blending:o.AdditiveBlending,depthWrite:!1})]}),(0,n.jsxs)("mesh",{scale:[1.5*a,1.5*a,1.5*a],children:[(0,n.jsx)("sphereGeometry",{args:[.2,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#C084FC",emissive:"#C084FC",emissiveIntensity:3,transparent:!0,opacity:.5*i,blending:o.AdditiveBlending,depthWrite:!1})]})]},"trail-".concat(r))}),(0,n.jsx)("pointLight",{color:"#A855C7",intensity:2*t.opacity,distance:4,decay:2})]}):null};function l(e){let{projectilePool:t}=e;return(0,n.jsx)(n.Fragment,{children:t.current.filter(e=>e.active).map(e=>(0,n.jsx)(s,{projectile:e},"viper-sting-".concat(e.id)))})}var c=e=>{let{position:t,direction:r,onComplete:s,isReturning:l=!1}=e,c=(0,i.useRef)(null),d=(0,i.useRef)(Date.now()),u=(0,i.useRef)(null),h="#8B3F9B",p="#A855C7",g="#C084FC";(0,a.F)(()=>{if(Date.now()-d.current>=200&&!u.current&&(u.current=Date.now()),u.current&&Date.now()-u.current>=250){s();return}});let m=u.current?Math.max(0,1-(Date.now()-u.current)/350):1;return(0,n.jsx)("group",{ref:c,position:t.toArray(),children:(0,n.jsxs)("group",{rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.03,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:p,emissiveIntensity:14*m,transparent:!0,opacity:.95*m})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.07,.07,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:p,emissive:p,emissiveIntensity:9*m,transparent:!0,opacity:.7*m})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.09,.09,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:g,emissive:h,emissiveIntensity:5*m,transparent:!0,opacity:.5*m})]}),[...Array(7)].map((e,t)=>{let r=Math.min(1,(Date.now()-d.current)/900),i=u.current?Math.max(0,1-(Date.now()-u.current)/700):1,a=1-.08*t;return(0,n.jsxs)("group",{position:[0,0,2.8*t],children:[(0,n.jsxs)("mesh",{rotation:[0,.0025*Date.now()+t,0],scale:[a,a,a],children:[(0,n.jsx)("torusGeometry",{args:[.35,.07,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:g,emissive:p,emissiveIntensity:2.5*i,transparent:!0,opacity:.45*i*(1-.4*r),blending:o.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,-.0035*Date.now()+t,0],scale:[.75*a,.75*a,.75*a],children:[(0,n.jsx)("torusGeometry",{args:[.28,.05,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:p,emissiveIntensity:1.8*i,transparent:!0,opacity:.35*i*(1-.25*r),blending:o.AdditiveBlending})]})]},"ring-".concat(t))}),[...Array(6)].map((e,t)=>{let r=t/6*Math.PI*2,i=.05*Math.sin(.003*Date.now()+t);return(0,n.jsx)("group",{position:[.12*Math.sin(r+.002*Date.now()),.12*Math.cos(r+.002*Date.now())+i,8+3*Math.sin(.004*Date.now()+t)],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.025,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:g,emissive:g,emissiveIntensity:6*m,transparent:!0,opacity:.7*m,blending:o.AdditiveBlending})]})},"venom-particle-".concat(t))}),(0,n.jsx)("pointLight",{color:p,intensity:18*m,distance:9,decay:2,position:[0,0,10]}),l&&(0,n.jsxs)(n.Fragment,{children:[[void 0,void 0,void 0,void 0,void 0].map((e,t)=>{let r=t/5*Math.PI*2;return(0,n.jsx)("group",{position:[.18*Math.sin(r+.012*Date.now()),.18*Math.cos(r+.012*Date.now()),10+2.5*Math.sin(.006*Date.now()+t)],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#E879F9",emissive:"#E879F9",emissiveIntensity:10*m,transparent:!0,opacity:.9*m,blending:o.AdditiveBlending})]})},"soul-energy-".concat(t))}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#E879F9",emissive:"#E879F9",emissiveIntensity:3*m,transparent:!0,opacity:.4*m,blending:o.AdditiveBlending})]})]})]})})};let d=()=>{let[e,t]=(0,i.useState)([]),r=(0,i.useRef)(1);return{activeEffects:e,createBeamEffect:(0,i.useCallback)(function(e,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=r.current++,a={id:o,position:e.clone(),direction:n.clone().normalize(),isReturning:i,startTime:Date.now()};return t(e=>[...e,a]),o},[]),removeEffect:(0,i.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]),clearAllEffects:(0,i.useCallback)(()=>{t([])},[])}},u={},h=()=>!!u.shootViperSting&&u.shootViperSting();function p(e){let{parentRef:t,enemyData:r,onHit:a,setDamageNumbers:s,nextDamageNumberId:h,onHealthChange:p,charges:g,setCharges:m}=e,[f,y]=(0,i.useState)([]);(0,i.useRef)(0);let{activeEffects:x,createBeamEffect:M,removeEffect:v}=d(),{shootViperSting:j,projectilePool:w}=function(e){let{parentRef:t,onHit:r,enemyData:n,setDamageNumbers:a,nextDamageNumberId:s,onHealthChange:l,createBeamEffect:c,applyDoT:d,charges:u,setCharges:h}=e,p=(0,i.useRef)([]),g=(0,i.useRef)([]),m=(0,i.useRef)(0),f=(0,i.useRef)(0),y=(0,i.useRef)(0);(0,i.useEffect)(()=>{p.current=[,,,].fill(null).map((e,t)=>({id:t,position:new o.Vector3,direction:new o.Vector3,startPosition:new o.Vector3,maxDistance:20,active:!1,startTime:0,hitEnemies:new Set,opacity:1,fadeStartTime:null,isReturning:!1,returnHitEnemies:new Set}))},[]);let x=(0,i.useCallback)(()=>p.current.find(e=>!e.active),[]),M=(0,i.useCallback)(()=>{let e=Date.now();if(e-m.current<2e3||!t.current)return!1;let r=x();if(!r)return!1;m.current=e;let n=t.current.position.clone();n.y+=0;let i=new o.Vector3(0,0,1);return t.current.quaternion&&"number"==typeof t.current.quaternion.x?i.applyQuaternion(t.current.quaternion):i.set(0,0,1),r.position.copy(n),r.direction.copy(i),r.startPosition.copy(n),r.startTime=e,r.active=!0,r.hitEnemies.clear(),r.returnHitEnemies.clear(),r.opacity=1,r.fadeStartTime=null,r.isReturning=!1,r.id=f.current++,c&&c(n,i,!1),!0},[c,t,x,u,h]),v=(0,i.useCallback)(e=>{if(!t.current)return;let r={id:y.current++,position:e.clone(),targetPosition:t.current.position.clone(),startTime:Date.now(),duration:1250,active:!0};g.current.push(r)},[t]);return(0,i.useEffect)(()=>{let e;let i=()=>{let l=Date.now();p.current.forEach(e=>{if(e.active){if(e.fadeStartTime){let t=(l-e.fadeStartTime)/500;if(e.opacity=Math.max(0,1-t),t>=1){e.active=!1;return}}if(e.isReturning){if(!t.current)return;if(e.position.distanceTo(e.startPosition)>1.5&&!e.fadeStartTime)for(let t of(e.position.add(e.direction.clone().multiplyScalar(.75)),n)){if(t.isDying||t.health<=0||e.returnHitEnemies.has(t.id))continue;let n=new o.Vector3(e.position.x,0,e.position.z),i=new o.Vector3(t.position.x,0,t.position.z);1.3>n.distanceTo(i)&&(e.returnHitEnemies.add(t.id),r(t.id,61),d&&d(t.id),a(e=>[...e,{id:s.current++,damage:61,position:t.position.clone(),isCritical:!1,isViperSting:!0}]),v(t.position))}else e.fadeStartTime||(e.fadeStartTime=l)}else if(e.position.distanceTo(e.startPosition)<e.maxDistance&&!e.fadeStartTime)for(let t of(e.position.add(e.direction.clone().multiplyScalar(.75)),n)){if(t.isDying||t.health<=0||e.hitEnemies.has(t.id))continue;let n=new o.Vector3(e.position.x,0,e.position.z),i=new o.Vector3(t.position.x,0,t.position.z);1.3>n.distanceTo(i)&&(e.hitEnemies.add(t.id),r(t.id,61),d&&d(t.id),a(e=>[...e,{id:s.current++,damage:61,position:t.position.clone(),isCritical:!1,isViperSting:!0}]),v(t.position))}else!e.fadeStartTime&&(e.isReturning=!0,e.direction=new o.Vector3().subVectors(e.startPosition,e.position).normalize(),c&&c(e.position,e.direction,!0))}}),p.current.some(e=>e.active)&&(e=requestAnimationFrame(i))};return e=requestAnimationFrame(i),()=>{cancelAnimationFrame(e)}},[n,r,a,s,l,v,t,c,d]),{shootViperSting:M,projectilePool:p,soulStealEffects:g}}({parentRef:t,onHit:a,enemyData:r,setDamageNumbers:s,nextDamageNumberId:h,onHealthChange:p,createBeamEffect:M,applyDoT:e=>{},charges:g,setCharges:m});return(0,i.useEffect)(()=>(u.shootViperSting=j,()=>{u={}}),[j]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{projectilePool:w}),x.map(e=>(0,n.jsx)(c,{position:e.position,direction:e.direction,isReturning:e.isReturning,onComplete:()=>v(e.id)},e.id))]})}},4244:function(e,t,r){r.d(t,{sf:function(){return c}});var n=r(2265);let i=[],o=1,a=null,s=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=!(arguments.length>4)||void 0===arguments[4]||arguments[4],l=o++,c={id:l,position:e.clone(),direction:t.clone().normalize(),subclass:r,isElementalShotsUnlocked:s,isPerfectShot:n,startTime:Date.now()};return i=[...i,c],a&&a(i),l},l=e=>{i=i.filter(t=>t.id!==e),a&&a(i)},c=()=>{let[e,t]=(0,n.useState)(i);return a=t,{activeEffects:e,createPowershotEffect:(0,n.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=!(arguments.length>4)||void 0===arguments[4]||arguments[4];return s(e,t,r,n,i)},[]),removeEffect:(0,n.useCallback)(e=>{l(e)},[]),clearAllEffects:(0,n.useCallback)(()=>{i=[],t([])},[])}}},2295:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(7437),i=r(2265),o=r(7125);function a(e){let{content:t,visible:r,x:i,y:o}=e;return r?(0,n.jsxs)("div",{className:"fixed z-50 bg-gray-900 border border-gray-600 rounded-lg p-3 text-white text-sm max-w-xs pointer-events-none",style:{left:i-150,top:o-80,transform:"translateX(-50%)"},children:[(0,n.jsx)("div",{className:"font-semibold text-blue-300 mb-1",children:t.name}),(0,n.jsx)("div",{className:"text-gray-300",children:t.description})]}):null}function s(e){let{currentWeapon:t,controlSystem:r}=e,[s,l]=(0,i.useState)(null),[c,d]=(0,i.useState)({x:0,y:0}),[u,h]=(0,i.useState)({}),[p,g]=(0,i.useState)({current:0,max:5}),m=[{name:"Sword",type:o.v.SWORD,key:"1",icon:"⚔️"},{name:"Bow",type:o.v.BOW,key:"2",icon:"\uD83C\uDFF9"},{name:"Scythe",type:o.v.SCYTHE,key:"3",icon:"⚡"},{name:"Sabres",type:o.v.SABRES,key:"4",icon:"⚔️"}],f={[o.v.SWORD]:[{name:"Deflect Barrier",key:"Q",cooldown:8,currentCooldown:0,description:"Creates a protective barrier that blocks damage and reflects projectiles for 3 seconds."},{name:"Charge",key:"E",cooldown:3,currentCooldown:0,description:"Dash forward 10.5 units, gaining 20 rage. Can damage enemies in your path."},{name:"Divine Storm",key:"R",cooldown:4,currentCooldown:0,description:"Consumes all rage (min 20) to create a devastating storm. Duration: 4s + 1s per 10 rage consumed."}],[o.v.BOW]:[{name:"Barrage",key:"Q",cooldown:5,currentCooldown:0,description:"Fires 5 arrows in a spread pattern after a short charge. High damage per arrow."},{name:"Cobra Shot",key:"E",cooldown:2,currentCooldown:0,description:"Fires a venomous green arrow that applies poison damage over time to enemies."},{name:"Viper Sting",key:"R",cooldown:7,currentCooldown:0,description:"Charges for 1 second then fires a powerful piercing projectile with special effects."}],[o.v.SCYTHE]:[{name:"Reanimate",key:"Q",cooldown:1,currentCooldown:0,description:"Costs 20 mana. Heals 20 HP and creates visual healing effects around the player."},{name:"Entropic Bolt",key:"E",cooldown:.5,currentCooldown:0,description:"Fires a chaotic bolt that moves erratically and deals high damage to enemies."},{name:"Crossentropy Bolt",key:"R",cooldown:1,currentCooldown:0,description:"Costs 40 mana. Fires a slow, high-damage piercing projectile with extended range."}],[o.v.SABRES]:[{name:"Backstab",key:"Q",cooldown:2,currentCooldown:0,description:"Deals 75 damage to enemies in front (175 if attacking from behind). Costs 60 energy."},{name:"Skyfall",key:"E",cooldown:4,currentCooldown:0,description:"Leap high into the air and crash down, dealing 150 damage to enemies below. Costs 40 energy."},{name:"Not Assigned",key:"R",cooldown:0,currentCooldown:0,description:"No ability assigned to this slot yet."}],[o.v.SPEAR]:[]};(0,i.useEffect)(()=>{if(!r||!r.getAbilityCooldowns)return;let e=()=>{let e=r.getAbilityCooldowns(),t={};Object.keys(e).forEach(r=>{t[r]=e[r].current}),h(t),r.getWeaponSwitchCooldown&&g(r.getWeaponSwitchCooldown())},t=setInterval(e,100);return e(),()=>clearInterval(t)},[r,t]);let y=(e,t)=>{let r=e.currentTarget.getBoundingClientRect();l({name:t.name,description:t.description}),d({x:r.left+r.width/2,y:r.top})},x=(e,t)=>{let r=e.currentTarget.getBoundingClientRect();l({name:t.name,description:"Switch to ".concat(t.name," (").concat(t.key,")")}),d({x:r.left+r.width/2,y:r.top})},M=()=>{l(null)},v=f[t]||[];return 0===v.length?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-40",children:(0,n.jsx)("div",{className:"bg-black bg-opacity-70 backdrop-blur-sm rounded-lg p-3 border border-gray-600",children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[m.map(e=>{let r=e.type===t,i=p.current>0;return p.max>0&&(p.current,p.max),(0,n.jsxs)("div",{className:"relative w-12 h-12 rounded-lg border-2 transition-all duration-200 ".concat(r?"border-yellow-400 bg-yellow-900 bg-opacity-50":i?"border-red-500 bg-red-900 bg-opacity-30":"border-gray-400 bg-gray-900 bg-opacity-30 hover:bg-opacity-50"," cursor-pointer flex items-center justify-center"),onMouseEnter:t=>x(t,e),onMouseLeave:M,children:[(0,n.jsx)("div",{className:"absolute -top-2 -left-2 bg-gray-800 border border-gray-600 rounded text-xs text-white px-1 py-0.5 font-semibold",children:e.key}),(0,n.jsx)("div",{className:"text-2xl ".concat(r?"text-yellow-400":i?"text-red-400":"text-gray-300"),children:e.icon}),i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-60 rounded-lg"}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-white text-sm font-bold bg-black bg-opacity-60 rounded px-1",children:Math.ceil(p.current)})})]})]},e.key)}),(0,n.jsx)("div",{className:"w-px h-8 bg-gray-600"}),v.map(e=>{var i,a;let s=u[e.key]||0;e.cooldown>0&&e.cooldown;let l=s>0,c="Not Assigned"===e.name;return(0,n.jsxs)("div",{className:"relative w-12 h-12 rounded-lg border-2 transition-all duration-200 ".concat(c?"border-gray-600 bg-gray-800 opacity-50":l?"border-red-500 bg-red-900 bg-opacity-30":"border-green-400 bg-green-900 bg-opacity-30 hover:bg-opacity-50"," cursor-pointer flex items-center justify-center"),onMouseEnter:t=>y(t,e),onMouseLeave:M,children:[(0,n.jsx)("div",{className:"absolute -top-2 -left-2 bg-gray-800 border border-gray-600 rounded text-xs text-white px-1 py-0.5 font-semibold",children:e.key}),(0,n.jsx)("div",{className:"w-8 h-8 rounded flex items-center justify-center text-lg font-bold ".concat(c?"text-gray-500":l?"text-red-400":"text-green-400"),children:(i=e.key,(null===(a=({[o.v.SWORD]:{Q:"\uD83D\uDEE1️",E:"⚡",R:"\uD83C\uDF2A️"},[o.v.BOW]:{Q:"\uD83C\uDFF9",E:"\uD83D\uDC0D",R:"\uD83D\uDC0D"},[o.v.SCYTHE]:{Q:"\uD83D\uDC9A",E:"⚡",R:"⚔️"},[o.v.SABRES]:{Q:"\uD83D\uDDE1️",E:"\uD83C\uDF1F",R:"❓"},[o.v.SPEAR]:{Q:"❓",E:"❓",R:"❓"}})[t])||void 0===a?void 0:a[i])||"❓")}),l&&!c&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-white text-sm font-bold bg-black bg-opacity-60 rounded px-1",children:Math.ceil(s)})})}),(()=>{var i,a,s,l,c,d,u;if(!r||!r.getAbilityCooldowns)return null;let h=r.getAbilityCooldowns()[e.key];if(h&&h.isActive)return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-yellow-400 bg-opacity-20 border-2 border-yellow-400 animate-pulse"});if("R"===e.key&&t===o.v.BOW&&(null===(i=r.isViperStingChargingActive)||void 0===i?void 0:i.call(r))){let e=(null===(c=r.getViperStingChargeProgress)||void 0===c?void 0:c.call(r))||0;return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-purple-400 bg-opacity-20 border-2 border-purple-400",children:(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-purple-400 bg-opacity-60 transition-all duration-100",style:{height:"".concat(100*e,"%")}})})}if("Q"===e.key&&t===o.v.BOW&&(null===(a=r.isBarrageChargingActive)||void 0===a?void 0:a.call(r))){let e=(null===(d=r.getBarrageChargeProgress)||void 0===d?void 0:d.call(r))||0;return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-orange-400 bg-opacity-20 border-2 border-orange-400",children:(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-orange-400 bg-opacity-60 transition-all duration-100",style:{height:"".concat(100*e,"%")}})})}if("E"===e.key&&t===o.v.BOW&&(null===(s=r.isCobraShotChargingActive)||void 0===s?void 0:s.call(r))){let e=(null===(u=r.getCobraShotChargeProgress)||void 0===u?void 0:u.call(r))||0;return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-green-400 bg-opacity-20 border-2 border-green-400",children:(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-green-400 bg-opacity-60 transition-all duration-100",style:{height:"".concat(100*e,"%")}})})}return"E"===e.key&&t===o.v.SABRES&&(null===(l=r.isSkyfallActive)||void 0===l?void 0:l.call(r))?(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-yellow-400 bg-opacity-20 border-2 border-yellow-400 animate-pulse"}):null})()]},e.key)})]})})}),s&&(0,n.jsx)(a,{content:s,visible:!0,x:c.x,y:c.y})]})}function l(e){let{current:t,max:r,color:i,backgroundColor:o="#333"}=e,a=Math.max(0,Math.min(100,t/r*100));return(0,n.jsx)("div",{className:"w-full",children:(0,n.jsxs)("div",{className:"w-full h-6 rounded-lg border-2 border-gray-600 overflow-hidden relative",style:{backgroundColor:o},children:[(0,n.jsx)("div",{className:"h-full transition-all duration-300 ease-out rounded-sm",style:{width:"".concat(a,"%"),backgroundColor:i,boxShadow:"0 0 10px ".concat(i,"40")}}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsxs)("span",{className:"text-sm text-white font-medium drop-shadow-lg",children:[Math.round(t),"/",r]})})]})})}function c(e){let{currentWeapon:t,playerHealth:r,maxHealth:a,playerShield:c=200,maxShield:d=200,mana:u=200,maxMana:h=200,energy:p=100,maxEnergy:g=100,rage:m=0,maxRage:f=100,controlSystem:y}=e,[x,M]=(0,i.useState)(u),[v,j]=(0,i.useState)(p),[w,S]=(0,i.useState)(m),[b,C]=(0,i.useState)(Date.now());(0,i.useEffect)(()=>{if(t===o.v.SCYTHE){let e=setInterval(()=>{M(e=>Math.min(h,e+4))},500);return()=>clearInterval(e)}},[t,h]),(0,i.useEffect)(()=>{if(t===o.v.BOW||t===o.v.SABRES){let e=setInterval(()=>{j(e=>Math.min(g,e+7))},500);return()=>clearInterval(e)}},[t,g]),(0,i.useEffect)(()=>{if(t===o.v.SWORD){let e=setInterval(()=>{Date.now()-b>6e3&&S(e=>Math.max(0,e-5))},1e3);return()=>clearInterval(e)}},[t,b]),(0,i.useEffect)(()=>{t===o.v.SCYTHE?(M(h),j(g),S(0)):t===o.v.SWORD?(S(0),M(h),j(g),C(Date.now())):(t===o.v.BOW||t===o.v.SABRES)&&(j(g),M(h),S(0))},[t,h,g,f]);let I=e=>{t===o.v.SCYTHE&&M(t=>Math.max(0,t-e))},P=e=>{(t===o.v.BOW||t===o.v.SABRES)&&j(t=>Math.max(0,t-e))},D=e=>{t===o.v.SWORD&&(S(t=>Math.min(f,t+e)),C(Date.now()))},E=e=>{t===o.v.SWORD&&S(t=>Math.max(0,t-e))},F=()=>{t===o.v.SWORD&&S(0)};return(0,i.useEffect)(()=>{window.gameUI={consumeMana:I,consumeEnergy:P,gainRage:D,consumeRage:E,consumeAllRage:F,getCurrentMana:()=>x,getCurrentEnergy:()=>v,getCurrentRage:()=>w,canCastCrossentropy:()=>x>=40,canCastEntropicBolt:()=>x>=10,canCastCrossentropyBolt:()=>x>=40,canCastReanimate:()=>x>=20,canCastFrostNova:()=>x>=25,canCastDivineStorm:()=>w>=40,canCastBarrage:()=>v>=40,canCastCobraShot:()=>v>=40,canCastViperSting:()=>v>=60,canCastBackstab:()=>v>=60,canCastSkyfall:()=>v>=40}},[x,v,w,t]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed bottom-32 left-1/2 transform -translate-x-1/2 z-50",children:(0,n.jsxs)("div",{className:"bg-black bg-opacity-60 backdrop-blur-sm rounded-lg p-4 border border-gray-600 min-w-80",children:[(0,n.jsx)("div",{className:"w-full mb-2",children:(0,n.jsxs)("div",{className:"w-full h-3 rounded-lg border border-blue-500 overflow-hidden relative",style:{backgroundColor:"#1a2332"},children:[(0,n.jsx)("div",{className:"h-full transition-all duration-300 ease-out rounded-sm",style:{width:"".concat(Math.max(0,Math.min(100,c/d*100)),"%"),backgroundColor:"#4A90E2",boxShadow:"0 0 8px #4A90E240"}}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsxs)("span",{className:"text-xs text-white font-medium drop-shadow-lg",children:[Math.round(c),"/",d]})})]})}),(0,n.jsx)("div",{className:"mb-2",children:(0,n.jsx)(l,{current:r,max:a,color:"#DC2626",backgroundColor:"#331a1a"})}),(()=>{switch(t){case o.v.SCYTHE:return(0,n.jsx)(l,{current:x,max:h,color:"#4A90E2",backgroundColor:"#1a2332"});case o.v.SWORD:return(0,n.jsx)(l,{current:w,max:f,color:"#FF6B35",backgroundColor:"#332318"});case o.v.BOW:case o.v.SABRES:return(0,n.jsx)(l,{current:v,max:g,color:"#FFD700",backgroundColor:"#332b18"});default:return null}})()]})}),(0,n.jsx)(s,{currentWeapon:t,controlSystem:y})]})}},4954:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),i=r(2265),o=r(946);function a(e){let{onJoinSuccess:t,currentWeapon:r,currentSubclass:a,gameMode:s="multiplayer"}=e,{joinRoom:l,isConnected:c,isInRoom:d,connectionError:u,players:h,previewRoom:p,clearPreview:g,currentPreview:m,startGame:f,gameStarted:y}=(0,o.p)(),[x,M]=(0,i.useState)("default"),[v,j]=(0,i.useState)(""),[w,S]=(0,i.useState)(!1),[b,C]=(0,i.useState)(!1),[I,P]=(0,i.useState)(!1);(0,i.useEffect)(()=>{m&&P(!1)},[m]);let D=async()=>{if(!v.trim()){alert("Please enter a player name");return}S(!0);try{await l(x,v.trim(),r,a,s),g(),C(!1),setTimeout(()=>{S(!1)},1e3)}catch(e){console.error("Failed to join room:",e),S(!1)}},E=()=>{C(!1),g()};return d?(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/95 p-8 rounded-xl border-2 ".concat("pvp"===s?"border-red-500":"border-green-500"," text-white max-w-md w-11/12 z-50 text-center"),children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-4",children:["pvp"===s?"PVP":"Multiplayer"," Room: ",x]}),(0,n.jsxs)("p",{className:"mb-4",children:["Players connected: ",h.size,"/5"]}),(0,n.jsx)("div",{className:"flex flex-col gap-3 mb-6",children:Array.from(h.values()).map(e=>(0,n.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white/10 rounded-lg border border-gray-600",children:[(0,n.jsx)("span",{className:"font-bold text-green-500",children:e.name}),(0,n.jsxs)("span",{className:"text-orange-500 capitalize",children:["(",e.weapon,")"]}),(0,n.jsxs)("span",{className:"text-red-400 font-mono",children:[e.health,"/",e.maxHealth," HP"]})]},e.id))}),(0,n.jsx)("button",{className:"w-full px-8 py-4 text-xl ".concat("pvp"===s?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"," text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:-translate-y-1"),onClick:()=>{f(),t()},disabled:!1,children:y?"Join Game":"Start ".concat("pvp"===s?"PVP":"Game")})]}):b&&m?(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/95 p-8 rounded-xl border-2 ".concat("pvp"===s?"border-red-500":"border-green-500"," text-white max-w-2xl w-11/12 z-50"),children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-6",children:["pvp"===s?"PVP":"Multiplayer"," Room Preview: ",m.roomId]}),m.exists?(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,n.jsxs)("div",{className:"flex justify-around bg-white/5 p-4 rounded-lg mb-4",children:[(0,n.jsxs)("p",{className:"m-0 font-bold text-green-500",children:["Players: ",m.playerCount,"/",m.maxPlayers]}),"pvp"!==s&&(0,n.jsxs)("p",{className:"m-0 font-bold text-green-500",children:["Enemies: ",m.enemies.length]}),"pvp"===s&&(0,n.jsx)("p",{className:"m-0 font-bold text-red-500",children:"Mode: Player vs Player"})]}),m.playerCount>0?(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsx)("h3",{className:"text-lg font-bold",children:"Players in Room:"}),m.players.map(e=>(0,n.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white/10 rounded-lg border border-gray-600",children:[(0,n.jsx)("span",{className:"font-bold text-green-500",children:e.name}),(0,n.jsxs)("span",{className:"text-orange-500 capitalize",children:["(",e.weapon,")"]}),(0,n.jsxs)("span",{className:"text-red-400 font-mono",children:[e.health,"/",e.maxHealth," HP"]})]},e.id))]}):(0,n.jsx)("div",{className:"text-center p-8 bg-white/5 rounded-lg text-gray-300",children:(0,n.jsx)("p",{children:"This room is empty. You'll be the first player!"})}),(0,n.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-green-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-green-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:D,disabled:w||!v.trim()||m.playerCount>=m.maxPlayers,children:w?"Joining...":m.playerCount>=m.maxPlayers?"Room Full":"Join This Room"}),(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-gray-600 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-gray-500 hover:-translate-y-1 disabled:bg-gray-800 disabled:cursor-not-allowed disabled:transform-none",onClick:E,disabled:w,children:"Back"})]})]}):(0,n.jsxs)("div",{className:"text-center p-8 bg-white/5 rounded-lg text-gray-300",children:[(0,n.jsx)("p",{children:"This room doesn't exist yet. You'll create it when you join!"}),(0,n.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-green-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-green-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:D,disabled:w||!v.trim(),children:w?"Creating Room...":"Create & Join Room"}),(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-gray-600 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-gray-500 hover:-translate-y-1 disabled:bg-gray-800 disabled:cursor-not-allowed disabled:transform-none",onClick:E,disabled:w,children:"Back"})]})]})]}):(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/95 p-8 rounded-xl border-2 ".concat("pvp"===s?"border-red-500":"border-green-500"," text-white max-w-lg w-11/12 z-50"),children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-2",children:["Join ","pvp"===s?"PVP":"Multiplayer"," Game"]}),(0,n.jsx)("p",{className:"mb-6 text-gray-300",children:"pvp"===s?"Battle against other players":"Play with up to 5 players per room"}),(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("label",{htmlFor:"playerName",className:"font-bold text-green-500",children:"Your Name:"}),(0,n.jsx)("input",{id:"playerName",type:"text",value:v,onChange:e=>j(e.target.value),placeholder:"Enter your name",maxLength:20,disabled:w,className:"p-3 border-2 border-gray-600 rounded-lg bg-white/10 text-white text-base focus:outline-none focus:border-green-500 focus:bg-white/15 disabled:opacity-60 disabled:cursor-not-allowed"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("label",{htmlFor:"roomId",className:"font-bold text-green-500",children:"Room ID:"}),(0,n.jsx)("input",{id:"roomId",type:"text",value:x,onChange:e=>M(e.target.value),placeholder:"Room ID (e.g., 'default', 'room1')",maxLength:50,disabled:w,className:"p-3 border-2 border-gray-600 rounded-lg bg-white/10 text-white text-base focus:outline-none focus:border-green-500 focus:bg-white/15 disabled:opacity-60 disabled:cursor-not-allowed"})]}),u&&(0,n.jsxs)("div",{className:"bg-red-500/20 border border-red-400 text-red-400 p-4 rounded-lg text-center",children:["Error: ",u]}),(0,n.jsxs)("div",{className:"text-center p-2 rounded-lg bg-white/10 font-bold",children:["Status: ",c?"Connected":"Connecting..."]}),(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-blue-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-blue-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:()=>{if(!x.trim()){alert("Please enter a room ID");return}if(!c){alert("Not connected to server. Please wait for connection.");return}console.log("Previewing room:",x.trim()),P(!0),p(x.trim()),C(!0),setTimeout(()=>{I&&(P(!1),alert("Room preview timed out. Please try again."),C(!1))},5e3)},disabled:!c||!x.trim()||I,children:I?"Loading...":"Preview Room"}),(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-green-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-green-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:D,disabled:w||!c||!v.trim(),children:w?"Joining...":"Join Directly"})]}),(0,n.jsxs)("div",{className:"bg-white/5 p-4 rounded-lg text-sm",children:[(0,n.jsx)("p",{className:"m-0 mb-2 font-bold ".concat("pvp"===s?"text-red-500":"text-green-500"),children:"Tips:"}),(0,n.jsxs)("ul",{className:"m-0 pl-6",children:[(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Use the same Room ID to play with friends"}),(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Maximum 5 players per room"}),"pvp"===s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Fight against other players to win"}),(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"No AI enemies - only player vs player combat"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"All players fight the same enemies together"}),(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Damage and kills are shared across all players"})]})]})]})]})]})}},8815:function(e,t,r){r.d(t,{l:function(){return l}});var n=r(1448),i=r(73),o=r(3478),a=r(1168),s=r(6862);class l{updatePosition(e,t){if(!this.isActive||!this.entity)return;this.playerPosition.copy(e),this.playerRotation.copy(t);let r=new n.Vector3(Math.sin(t.y),0,-Math.cos(t.y)),o=e.clone().add(r.multiplyScalar(2.5));o.y+=.5;let a=this.entity.getComponent(i.w);a&&(a.setPosition(o.x,o.y,o.z),a.setRotation(t.x,t.y,t.z))}activate(e,t,r){if(this.isActive)return;if(this.playerPosition.copy(e),this.playerRotation.copy(t),this.playerEntity=r||null,this.isActive=!0,this.playerEntity){let e=this.playerEntity.getComponent(s.S);e&&e.setInvulnerable(3)}this.entity=this.world.createEntity();let a=new n.Vector3(Math.sin(t.y),0,-Math.cos(t.y)),l=e.clone().add(a.multiplyScalar(2.5));l.y+=.5;let c=new i.w;c.setPosition(l.x,l.y,l.z),c.setRotation(t.x,t.y,t.z),this.entity.addComponent(c);let d=new o.YM(o.F5.SPHERE,3);d.layer=o.aB.PLAYER,d.isTrigger=!0,d.onTriggerEnter=(e,t)=>{this.handleProjectileCollision(t)},this.entity.addComponent(d),console.log("\uD83D\uDEE1️ Deflect barrier activated at position:",l)}deactivate(){this.isActive&&this.entity&&(this.world.destroyEntity(this.entity.id),this.entity=null,this.isActive=!1,console.log("\uD83D\uDEE1️ Deflect barrier deactivated"))}handleProjectileCollision(e){let t=e.getComponent(a.W);if(!t)return;let r=e.getComponent(i.w);if(!r)return;console.log("\uD83D\uDEE1️ Deflect barrier hit by projectile!");let n=r.getWorldPosition(),o=this.entity.getComponent(i.w).getWorldPosition(),s=n.clone().sub(o).normalize(),l=t.velocity.clone().reflect(s);t.velocity.copy(l),t.owner=-2,t.hitTargets.clear(),t.lifetime=0,console.log("\uD83D\uDD04 Projectile reflected! New velocity:",l)}isBarrierActive(){return this.isActive}getBarrierPosition(){if(!this.entity)return null;let e=this.entity.getComponent(i.w);return e?e.getWorldPosition():null}constructor(e){this.entity=null,this.isActive=!1,this.playerEntity=null,this.world=e,this.playerPosition=new n.Vector3,this.playerRotation=new n.Vector3}}},6663:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448);function s(e){let{isActive:t,duration:r,onComplete:s,playerPosition:l=new a.Vector3(0,0,0),playerRotation:c=new a.Vector3(0,0,0),dragonGroupRef:d}=e,u=(0,i.useRef)(null),h=(0,i.useRef)(null),p=(0,i.useRef)(0);return((0,i.useEffect)(()=>{t?(h.current=Date.now(),p.current=0,console.log("\uD83D\uDEE1️ Deflect shield activated!")):(h.current=null,p.current=0)},[t]),(0,o.F)((e,n)=>{if(!u.current||!t||!h.current)return;let i=(Date.now()-h.current)/1e3,o=Math.min(i/r,1);p.current=o;let g=l,m=c;(null==d?void 0:d.current)&&(g=d.current.position,m=new a.Vector3(d.current.rotation.x,d.current.rotation.y,d.current.rotation.z));let f=new a.Vector3(Math.sin(m.y),0,Math.cos(m.y-.75)),y=g.clone().add(f.multiplyScalar(2.5));y.y+=.25,u.current.position.copy(y),u.current.rotation.set(m.x,m.y,m.z);let x=1;o<.1?x=o/.1:o>.9&&(x=1-(o-.9)/.1),u.current.scale.setScalar(.325),u.current.traverse(e=>{e.material&&(e.material.opacity=x)});let M=1+.3*Math.sin(8*i);u.current.traverse(e=>{e.material&&void 0!==e.material.emissiveIntensity&&(e.material.emissiveIntensity=M)}),o>=1&&(console.log("\uD83D\uDEE1️ Deflect shield duration complete"),null==s||s())}),t)?(0,n.jsxs)("group",{ref:u,children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[3,3,.1,32]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16766720),emissive:new a.Color(16753920),emissiveIntensity:1.5,transparent:!0,opacity:.7,side:a.DoubleSide,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[2.2,2.2,.05,32]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:2,transparent:!0,opacity:.5,side:a.DoubleSide,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[3.5,3.5,.02,32]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16753920),emissive:new a.Color(16740096),emissiveIntensity:1,transparent:!0,opacity:.3,side:a.DoubleSide,blending:a.AdditiveBlending})]}),(0,n.jsx)("group",{rotation:[Math.PI/2,0,0],children:[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[1.5*Math.cos(t*Math.PI/4),1.5*Math.sin(t*Math.PI/4),.05],rotation:[0,0,t*Math.PI/4],children:[(0,n.jsx)("boxGeometry",{args:[.8,.1,.05]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:3,transparent:!0,opacity:.8,blending:a.AdditiveBlending})]},t))}),(0,n.jsxs)("group",{rotation:[Math.PI/2,0,0],children:[(0,n.jsxs)("mesh",{position:[0,0,.1],children:[(0,n.jsx)("boxGeometry",{args:[.15,2.5,.05]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:4,transparent:!0,opacity:.9,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{position:[0,0,.1],children:[(0,n.jsx)("boxGeometry",{args:[2.5,.15,.05]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:4,transparent:!0,opacity:.9,blending:a.AdditiveBlending})]})]}),(0,n.jsx)("group",{rotation:[Math.PI/2,0,0],children:[...Array(12)].map((e,t)=>(0,n.jsxs)("mesh",{position:[Math.cos(t*Math.PI/6)*(3.8+.3*Math.sin(.005*Date.now()+t)),Math.sin(t*Math.PI/6)*(3.8+.3*Math.sin(.005*Date.now()+t)),.2*Math.sin(.003*Date.now()+t)],children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16766720),emissive:new a.Color(16753920),emissiveIntensity:2,transparent:!0,opacity:.6,blending:a.AdditiveBlending})]},"particle-".concat(t)))}),(0,n.jsx)("pointLight",{color:new a.Color(16766720),intensity:2,distance:8,decay:2})]}):null}},1151:function(e,t,r){r.d(t,{Z0:function(){return c},ZP:function(){return d}});var n=r(7437),i=r(2265),o=r(1276),a=r(6663);let s=[],l=1;function c(e,t,r){let n={id:l++,position:e.clone(),rotation:t.clone(),startTime:Date.now(),duration:3e3,playerId:r};return s.push(n),console.log("\uD83D\uDEE1️ Global Deflect Shield triggered at position:",e.toArray(),"ID:",n.id),n.id}function d(e){let{}=e,[t,r]=(0,i.useState)([]);return(0,o.F)(()=>{let e=Date.now(),t=s.filter(t=>e-t.startTime<t.duration);s=t,r(t)}),(0,n.jsx)(n.Fragment,{children:t.map(e=>(0,n.jsx)(a.Z,{isActive:!0,duration:e.duration/1e3,playerPosition:e.position,playerRotation:e.rotation,onComplete:()=>{var t;t=e.id,s=s.filter(e=>e.id!==t)}},e.id))})}},4937:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(7437),i=r(2265),o=r(1448),a=r(1276);function s(e){let{position:t,onComplete:r,parentRef:s,isActive:l=!0,enemyData:c=[],onHitTarget:d}=e,u=(0,i.useRef)(null),h=(0,i.useRef)(0),p=(0,i.useRef)([]),g=(0,i.useRef)({});return(0,a.F)((e,n)=>{var i;if(!u.current)return;let a=(null==s?void 0:null===(i=s.current)||void 0===i?void 0:i.position)||t;u.current.position.copy(a);let m=Date.now();if(!l){r();return}if(h.current+=n,u.current.rotation.y+=4*n,c.forEach(e=>{e.health&&!(e.health<=0)&&!(m-(g.current[e.id]||0)<200)&&4>=a.distanceTo(e.position)&&(g.current[e.id]=m,null==d||d(e.id,40,!1,e.position,!0))}),.6>Math.random()){let e=Math.random()*Math.PI*2,t=1.5*Math.random(),r=new o.Vector3(Math.cos(e)*t,-2+.6*Math.random(),Math.sin(e)*t);p.current.push({id:Date.now()+Math.random(),position:r,type:"orbital"})}if(.4>Math.random()){let e=Math.random()*Math.PI*2,t=1*Math.random(),r=new o.Vector3(Math.cos(e)*t,1+1.2*Math.random(),Math.sin(e)*t);p.current.push({id:Date.now()+Math.random(),position:r,type:"falling"})}p.current.length>50&&(p.current=p.current.slice(-50))}),(0,n.jsx)("group",{ref:u,children:(0,n.jsx)("pointLight",{color:new o.Color(16766720),intensity:1,distance:8,decay:1})})}},9709:function(e,t,r){r.d(t,{ZP:function(){return u},e6:function(){return d}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448),s=r(4937);let l=[],c=1;function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,n={id:c++,position:e.clone(),startTime:Date.now(),duration:r,playerId:t};return l.push(n),console.log("⚡ Global Divine Storm triggered at position:",e.toArray(),"duration:",r+"ms","ID:",n.id),n.id}function u(e){let{enemyData:t=[],onHitTarget:r}=e,[c,d]=(0,i.useState)([]),u=(0,i.useRef)(new Map);return(0,o.F)(()=>{let e=Date.now(),t=l.filter(t=>e-t.startTime<t.duration);l=t,d(t);let r=new Set(t.map(e=>e.id));u.current.forEach((e,t)=>{r.has(t)||u.current.delete(t)}),t.forEach(e=>{u.current.has(e.id)?u.current.get(e.id).position.copy(e.position):u.current.set(e.id,{position:e.position.clone()})})}),(0,n.jsx)(n.Fragment,{children:c.map(e=>{let i=u.current.get(e.id);return i||(i={position:e.position&&e.position.clone?e.position.clone():new a.Vector3(0,0,0)},u.current.set(e.id,i)),(0,n.jsx)(s.Z,{position:e.position,parentRef:{current:i},isActive:!0,enemyData:t,onHitTarget:r,onComplete:()=>{var t;t=e.id,l=l.filter(e=>e.id!==t),u.current.delete(e.id)}},e.id)})})}},6923:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),i=r(2265),o=r(1276);function a(e){let{position:t,duration:r=1500,startTime:a=Date.now(),onComplete:s}=e,l=(0,i.useRef)(null),[c,d]=(0,i.useState)(1),[u,h]=(0,i.useState)(1),[p,g]=(0,i.useState)(0),m=(0,i.useRef)(.05*Math.random()+.02);(0,i.useEffect)(()=>{let e=setTimeout(()=>{console.log("❄️ Frost Nova effect completed after",r,"ms"),s&&s()},r);return()=>{clearTimeout(e)}},[r,s]),(0,o.F)(()=>{if(!l.current)return;let e=Date.now()-a,t=Math.min(e/r,1);if(t>=1&&s){console.log("❄️ Frost Nova effect exceeded duration, forcing completion"),s();return}t<.3?g(t/.3):g(1),t>.6?h(1-(t-.6)/.4):h(1),d((.7+.3*Math.sin(.008*e))*u),l.current.rotation.y+=m.current,l.current.rotation.x=.1*Math.sin(.002*e)});let f=.1+2.5*p,y=1.15*f;return(0,n.jsxs)("group",{ref:l,position:t,children:[(0,n.jsxs)("mesh",{position:[0,.5,0],children:[(0,n.jsx)("sphereGeometry",{args:[1*f,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#4FC3F7",emissiveIntensity:.8*c,transparent:!0,opacity:.3*u,roughness:.1,metalness:.2})]}),[...Array(12)].map((e,t)=>{let r=t*Math.PI*2/12,i=.8*f;return(0,n.jsx)("group",{rotation:[0,r,0],position:[Math.cos(r)*i,0,Math.sin(r)*i],children:(0,n.jsxs)("mesh",{rotation:[Math.PI/6,0,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.4*f,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#29B6F6",emissiveIntensity:.6*c,transparent:!0,opacity:.8*u,roughness:.05,metalness:.15})]})},t)}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.1+.15*t,0],rotation:[Math.PI/2,0,t*Math.PI/6],scale:[y*(.8+.2*t),y*(.8+.2*t),1],children:[(0,n.jsx)("torusGeometry",{args:[1,.08,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#29B6F6",emissiveIntensity:.7*c,transparent:!0,opacity:.6*u*(1-.2*t),roughness:.1,metalness:.2})]},"ring-".concat(t))),[...Array(24)].map((e,t)=>{let r=t*Math.PI*2/24,i=f*(.6+.4*Math.random());return(0,n.jsxs)("mesh",{position:[Math.cos(r)*i+(Math.random()-.5)*2,2*Math.random()+.2,Math.sin(r)*i+(Math.random()-.5)*2],rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("octahedronGeometry",{args:[.08+.12*Math.random(),0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.9*c,transparent:!0,opacity:.5*u})]},"particle-".concat(t))}),(0,n.jsxs)("mesh",{position:[0,-.1,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("circleGeometry",{args:[1.1*f,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.3*c,transparent:!0,opacity:.4*u,roughness:.8,metalness:.1})]}),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:8*c*u,distance:2*f,position:[0,1,0]}),(0,n.jsx)("pointLight",{color:"#B3E5FC",intensity:3*c*u,distance:3*f,position:[0,.5,0]})]})}},6932:function(e,t,r){r.r(t),r.d(t,{addGlobalFrozenEnemy:function(){return p},default:function(){return m},getActiveFrostNovas:function(){return g},triggerGlobalFrostNova:function(){return h}});var n=r(7437),i=r(2265),o=r(1276),a=r(6923),s=r(8787),l=r(8001),c=r(73),d=r(6862);let u=null,h=e=>!!u&&(u.triggerFrostNova(e),!0),p=(e,t)=>!!u&&(u.addFrozenEnemy(e,t),!0),g=()=>u&&u.getActiveFrostNovas?u.getActiveFrostNovas():[];function m(e){let{world:t}=e,[r,h]=(0,i.useState)([]),[p,g]=(0,i.useState)([]),m=(0,i.useRef)(0),f=(0,i.useRef)(0),y=(0,i.useRef)(0),x=(0,i.useCallback)(()=>t?t.getAllEntities().filter(e=>e.hasComponent(l.C)&&e.hasComponent(c.w)&&e.hasComponent(d.S)).map(e=>{e.getComponent(l.C);let t=e.getComponent(c.w),r=e.getComponent(d.S);return{id:e.id.toString(),position:t.position.clone(),health:r.currentHealth,isDying:r.isDead,deathStartTime:r.isDead?Date.now():void 0}}):[],[t]),M=(0,i.useCallback)(e=>{let t={id:m.current++,position:e.clone(),startTime:Date.now(),duration:1200};h(e=>[...e,t]),console.log("❄️ Created Frost Nova effect at position:",e)},[]),v=(0,i.useCallback)((e,t)=>{let r={id:f.current++,enemyId:e,position:t.clone(),startTime:Date.now(),duration:5e3};g(e=>[...e,r]),console.log("❄️ Created frozen effect for enemy:",e,"at position:",t)},[]),j=(0,i.useCallback)(()=>r,[r]);i.useEffect(()=>(u={triggerFrostNova:M,addFrozenEnemy:v,getActiveFrostNovas:j},()=>{u=null}),[M,v,j]),(0,o.F)(e=>{let r=e.clock.getElapsedTime();if(r-y.current<.1||(y.current=r,!t))return;let n=Date.now(),i=t.getAllEntities();i.forEach(e=>{let t=e.getComponent(l.C),r=e.getComponent(c.w);t&&r&&t.isFrozen&&!p.find(t=>t.enemyId===e.id.toString())&&v(e.id.toString(),r.position)}),g(e=>e.filter(e=>{let t=n-e.startTime;if(t>=e.duration)return console.log("❄️ Removing expired frozen effect for enemy ".concat(e.enemyId," (duration: ").concat(t,"ms)")),!1;let r=i.find(t=>t.id.toString()===e.enemyId);if(!r)return console.log("❄️ Removing frozen effect for non-existent enemy ".concat(e.enemyId)),!1;let o=r.getComponent(l.C),a=r.getComponent(d.S);return o&&a?!a.isDead||(console.log("❄️ Removing frozen effect for dead enemy ".concat(e.enemyId)),!1):(console.log("❄️ Removing frozen effect for invalid enemy ".concat(e.enemyId)),!1)})),h(e=>e.filter(e=>{let t=n-e.startTime;return!(t>=e.duration)||(console.log("❄️ Removing expired frost nova explosion effect (duration: ".concat(t,"ms)")),!1)}))});let w=e=>{h(t=>t.filter(t=>t.id!==e))},S=e=>{g(t=>t.filter(t=>t.id!==e))},b=x();return(0,n.jsxs)(n.Fragment,{children:[r.map(e=>(0,n.jsx)(a.Z,{position:e.position,duration:e.duration,startTime:e.startTime,onComplete:()=>w(e.id)},e.id)),p.map(e=>(0,n.jsx)(s.Z,{position:e.position,duration:e.duration,startTime:e.startTime,enemyId:e.enemyId,enemyData:b,onComplete:()=>S(e.id)},e.id))]})}},8787:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),i=r(2265),o=r(1276);function a(e){let{position:t,duration:r=5e3,startTime:a=Date.now(),enemyId:s,enemyData:l=[],onComplete:c}=e,d=(0,i.useRef)(null),[u,h]=(0,i.useState)(1),[p,g]=(0,i.useState)(1),m=(0,i.useRef)(.02*Math.random()+.01);return(0,i.useEffect)(()=>{let e=setTimeout(()=>{console.log("❄️ Frozen effect completed after",r,"ms for enemy",s),c&&c()},r);return()=>{clearTimeout(e)}},[r,c,s]),(0,o.F)(()=>{if(!d.current)return;let e=Date.now()-a,t=Math.min(e/r,1);if(t>=1&&c){console.log("❄️ Frozen effect exceeded duration, forcing completion for enemy",s),c();return}if(s&&l.length>0){let e=l.find(e=>e.id===s);if(e&&e.health>0&&!e.isDying&&!e.deathStartTime){let t=e.position.clone();t.y+=.5,d.current.position.copy(t)}}t>.9?g(1-(t-.9)/.09999999999999998):g(1),h((.8+.2*Math.sin(.005*e))*p),d.current.rotation.y+=m.current,d.current.rotation.x=.1*Math.sin(.003*e)}),(0,n.jsxs)("group",{ref:d,position:t,children:[(0,n.jsxs)("mesh",{position:[0,-.6,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.8,.9,.5,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#81D4FA",emissiveIntensity:.3*u,transparent:!0,opacity:.7*p,roughness:.1,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,.95,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.9,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.5*u,transparent:!0,opacity:.8*p,roughness:.05,metalness:.1})]}),[...Array(6)].map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI/3,0],position:[.7*Math.cos(t*Math.PI/3),-.2+.3*Math.sin(t),.7*Math.sin(t*Math.PI/3)],children:(0,n.jsxs)("mesh",{rotation:[Math.PI/6,0,Math.PI/4],children:[(0,n.jsx)("octahedronGeometry",{args:[.25,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#29B6F6",emissiveIntensity:.4*u,transparent:!0,opacity:.6*p,roughness:.1,metalness:.15})]})},t)),[...Array(12)].map((e,t)=>(0,n.jsxs)("mesh",{position:[(Math.random()-.5)*2,2.5*Math.random()-.2,(Math.random()-.5)*2],rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("octahedronGeometry",{args:[.05+.1*Math.random(),0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.8*u,transparent:!0,opacity:.4*p})]},"particle-".concat(t))),[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,-0+.2*t,0],rotation:[Math.PI/2,0,t*Math.PI/4],children:[(0,n.jsx)("torusGeometry",{args:[.6+.25*t,.05,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#29B6F6",emissiveIntensity:.6*u,transparent:!0,opacity:.5*p,roughness:.1,metalness:.2})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.2*u,transparent:!0,opacity:.4*p})]}),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:3*u*p,distance:6,position:[0,1,0]})]})}}}]);