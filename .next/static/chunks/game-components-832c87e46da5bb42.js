"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[812],{4668:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),i=r(2265);function o(e){let{damageData:t,onComplete:r,camera:o,size:a,stackIndex:s}=e,[l,c]=(0,i.useState)(1),[u,d]=(0,i.useState)(0),[h,p]=(0,i.useState)(1);(0,i.useEffect)(()=>{let e=Date.now(),n=()=>{let i=Math.min((Date.now()-e)/3e3,1);d((1-Math.pow(1-i,3))*4+.8*s);let o=0===s?1.2:.9-.1*s;p(o+(.8-.1*s-o)*Math.min(2*i,1));let a=0===s?.6:.3-.1*s;if(i>a){let e=(i-a)/(1-a);c(1-e+(0===s?0:Math.max(0,.7-.2*s))*e)}else c(1-.2*s);i<1?requestAnimationFrame(n):r(t.id)};n()},[t.id,r,s]);let m=0,g=0;if(o&&a.width>0&&a.height>0&&t.position&&t.position.clone){let e=t.position.clone();e.y+=u;let r=e.clone().project(o);m=(.5*r.x+.5)*a.width,g=(-.5*r.y+.5)*a.height}else{let e=window.innerWidth/2,r=window.innerHeight/2;m=e+50*t.position.x,g=r-50*t.position.z-20*u}return(0,n.jsx)("div",{className:"absolute pointer-events-none select-none font-bold text-lg",style:{left:"".concat(m,"px"),top:"".concat(g,"px"),opacity:l,transform:"translate(-50%, -50%) scale(".concat(h,")"),textShadow:"2px 2px 4px rgba(0, 0, 0, 0.8)",zIndex:1e3-s,transition:s>0?"opacity 0.3s ease-out":"none"},children:(0,n.jsxs)("span",{className:"".concat(t.isCritical?"text-yellow-300 text-xl animate-pulse":"crossentropy"===t.damageType?"text-green-400":"healing"===t.damageType?"text-green-300":"text-red-400"),children:[t.damage,t.isCritical&&"!"]})})}function a(e){let{damageNumbers:t,onDamageNumberComplete:r,camera:i,size:a}=e,s=new Map;return t.forEach(e=>{let t="".concat(Math.round(2*e.position.x),"_").concat(Math.round(2*e.position.z));s.has(t)||s.set(t,[]),s.get(t).push(e)}),s.forEach(e=>{e.sort((e,t)=>t.timestamp-e.timestamp),e.splice(3)}),(0,n.jsx)("div",{className:"fixed inset-0 pointer-events-none",children:Array.from(s.values()).flat().map(e=>{let t="".concat(Math.round(2*e.position.x),"_").concat(Math.round(2*e.position.z)),l=s.get(t).findIndex(t=>t.id===e.id);return(0,n.jsx)(o,{damageData:e,onComplete:r,camera:i,size:a,stackIndex:l},e.id)})})}},5464:function(e,t,r){r.r(t),r.d(t,{GameScene:function(){return H}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448),s=r(3625),l=r(45),c=r(73),u=r(7771),d=r(6862),h=r(3974),p=r(3478),m=r(8001),g=r(3842),f=r(7223),y=r(2082),x=r(2972),v=r(5773),M=r(2158),S=r(244),w=r(4451),j=r(9667),C=r(7125),b=r(6534);function I(e){var t;let{startPosition:r,targetPosition:s,onComplete:l,onPullStart:c}=e,u=(0,i.useRef)(0),d=(0,i.useRef)(1),h=(0,i.useRef)(!1),p=(0,i.useMemo)(()=>({particle:new a.SphereGeometry(.15,8,8),tentacle:new a.CylinderGeometry(.05,.05,1,8),impact:new a.SphereGeometry(.2,8,8),core:new a.SphereGeometry(.18,8,8)}),[]),m=(0,i.useMemo)(()=>({spiral1:new a.MeshBasicMaterial({color:new a.Color("#6A0DAD"),transparent:!0,opacity:1,blending:a.AdditiveBlending}),spiral2:new a.MeshBasicMaterial({color:new a.Color("#9370DB"),transparent:!0,opacity:1,blending:a.AdditiveBlending}),spiral3:new a.MeshBasicMaterial({color:new a.Color("#8A2BE2"),transparent:!0,opacity:1,blending:a.AdditiveBlending}),impact:new a.MeshBasicMaterial({color:new a.Color("#6A0DAD"),transparent:!0,opacity:1,blending:a.AdditiveBlending}),core:new a.MeshBasicMaterial({color:new a.Color("#9370DB"),transparent:!0,opacity:1,blending:a.AdditiveBlending})}),[]),g=(0,i.useMemo)(()=>{let e=s.clone().sub(r),t=Math.ceil(4*e.length()),n=[[],[],[]],i=e.clone().normalize(),o=new a.Vector3(0,1,0),l=new a.Vector3().crossVectors(i,o).normalize(),c=new a.Vector3().crossVectors(l,i).normalize();for(let e=0;e<3;e++){let i=e*Math.PI*2/3;for(let o=0;o<t;o++){let a=o/t,u=r.clone().lerp(s,a),d=3*a*Math.PI*2+i,h=.15*(1-.3*a),p=l.clone().multiplyScalar(Math.cos(d)*h).add(c.clone().multiplyScalar(Math.sin(d)*h)),m=u.clone().add(p);m.x+=(Math.random()-.5)*.02,m.y+=(Math.random()-.5)*.02,m.z+=(Math.random()-.5)*.02;let g=1.2-.8*a+.1*Math.sin(a*Math.PI*6);n[e].push({position:m,scale:Math.max(.3,g)})}}return n},[r,s]);return(0,o.F)((e,t)=>{u.current=Math.min(u.current+t,1.2),d.current=.3*Math.random()+.7;let r=u.current/1.2;r>.4&&!h.current&&(h.current=!0,c());let n=r<.8?1-.6*r:.4*(1-(r-.8)/.2);m.spiral1.opacity=.9*n*d.current,m.spiral2.opacity=.85*n*(.9*d.current+.1),m.spiral3.opacity=.8*n*(.8*d.current+.2),m.impact.opacity=.7*n*d.current,m.core.opacity=1.1*n*d.current,r>=1&&l()}),(0,n.jsxs)("group",{children:[g.map((e,t)=>{let r=[m.spiral1,m.spiral2,m.spiral3][t];return(0,n.jsx)("group",{children:e.map((e,i)=>(0,n.jsx)("mesh",{position:e.position.toArray(),geometry:p.particle,material:r,scale:[e.scale,e.scale,e.scale]},"particle-".concat(t,"-").concat(i)))},"stream-".concat(t))}),(0,n.jsx)("mesh",{position:s.toArray(),geometry:p.impact,material:m.impact,scale:[1.5,1.5,1.5]}),(0,n.jsx)("mesh",{position:r.toArray(),geometry:p.core,material:m.core,scale:[1.3,1.3,1.3]}),(0,n.jsx)("mesh",{position:r.toArray(),geometry:p.particle,material:m.spiral1,scale:[2+.5*Math.sin(8*u.current),2+.5*Math.sin(8*u.current),2+.5*Math.sin(8*u.current)]}),(0,n.jsx)("pointLight",{position:r.toArray(),color:"#6A0DAD",intensity:10*(1-u.current/1.2)*d.current,distance:4,decay:2}),(0,n.jsx)("pointLight",{position:s.toArray(),color:"#9370DB",intensity:8*(1-u.current/1.2)*d.current,distance:5,decay:2}),g[0]&&g[0].length>0&&(0,n.jsx)("pointLight",{position:(null===(t=g[0][Math.floor(g[0].length/2)])||void 0===t?void 0:t.position.toArray())||[0,0,0],color:"#8A2BE2",intensity:4*(1-u.current/1.2)*d.current,distance:3,decay:2})]})}var P=r(2824);let D=()=>(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.15,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#4FC3F7",emissiveIntensity:.8,transparent:!0,opacity:.7,blending:a.AdditiveBlending,depthWrite:!1})]})});var E=function(e){let{parentRef:t}=e,r=(0,i.useRef)([]),a=(0,i.useRef)(null);return(0,o.F)(e=>{let{clock:t}=e;a.current&&r.current.forEach((e,r)=>{if(!e)return;let n=t.getElapsedTime(),i=r/40*1.25-.175,o=r/40*Math.PI*6+1.5*n,a=1*(.8-.4*i)+.2*Math.sin(2*n+.5*r),s=Math.cos(o)*a,l=Math.sin(o)*a;e.position.set(s,i+.3*Math.sin(2*n+r)+.2,l),e.rotation.y=o+Math.PI/2,e.rotation.x=.2*Math.sin(n+r),e.rotation.z=.2*Math.cos(.8*n+r);let c=e.children[0];if(c&&c.material){let t=c.material,r=i/1.5;t.opacity=Math.max(.2,.8*(1-r)),e.scale.setScalar(1-.3*r)}})}),(0,n.jsxs)("group",{ref:a,children:[Array.from({length:40}).map((e,t)=>(0,n.jsx)("group",{ref:e=>{e&&(r.current[t]=e)},children:D()},t)),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:12,distance:12,decay:1.2,position:[0,.5,0]})]})};function F(e){let{entityId:t,position:r,world:s,onMeshReady:l}=e,c=(0,i.useRef)(null),u=(0,i.useRef)(0),d=(0,i.useRef)(!1);return(0,o.F)((e,n)=>{if(u.current+=n,c.current){c.current.position.copy(r);let e=s.getEntity(t);if(e){let t=e.getComponent(m.C);if(t){let e=Date.now()/1e3-t.lastAttackTime,r=Math.sin(.5*u.current)>.7;d.current=e<.5||r}}c.current.position.y+=.1*Math.sin(2*u.current),d.current||(c.current.rotation.y+=.5*n);let i=c.current.getObjectByName("LeftArm");if(i){if(d.current){let e=i.rotation.x,t=8*n;i.rotation.x=a.MathUtils.lerp(e,-Math.PI/3,t),i.rotation.z=a.MathUtils.lerp(i.rotation.z,.2,t)}else{let e=i.rotation.x,t=i.rotation.z,r=6*n;i.rotation.x=a.MathUtils.lerp(e,0,r),i.rotation.z=a.MathUtils.lerp(t,0,r)}}}}),(0,i.useEffect)(()=>{c.current&&l&&l(c.current)},[l]),(0,n.jsxs)("group",{ref:c,children:[(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.8,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#29B6F6",emissiveIntensity:.3,transparent:!0,opacity:.9,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{position:[0,2.7,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.4,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#81D4FA",emissive:"#4FC3F7",emissiveIntensity:.4,transparent:!0,opacity:.85,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[-.7,2.35,0],children:[(0,n.jsx)("sphereGeometry",{args:[.325,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#81D4FA",emissive:"#4FC3F7",emissiveIntensity:.3,transparent:!0,opacity:.85,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[-.7,2.35,0],rotation:[Math.PI/2,-Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.4,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#B3E5FC",emissiveIntensity:.5,transparent:!0,opacity:.9,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{name:"LeftArm",position:[-.7,2,.2],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#29B6F6",emissiveIntensity:.2,transparent:!0,opacity:.675,metalness:.6,roughness:.4})]}),(0,n.jsxs)("mesh",{position:[.7,2.35,0],children:[(0,n.jsx)("sphereGeometry",{args:[.325,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#81D4FA",emissive:"#4FC3F7",emissiveIntensity:.3,transparent:!0,opacity:.85,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[.7,2.35,0],rotation:[Math.PI/2,Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.4,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#B3E5FC",emissiveIntensity:.5,transparent:!0,opacity:.9,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{position:[.7,2,0],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#29B6F6",emissiveIntensity:.2,transparent:!0,opacity:.675,metalness:.6,roughness:.4})]}),(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("sphereGeometry",{args:[1.35,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#29B6F6",emissive:"#0277BD",emissiveIntensity:.1,transparent:!0,opacity:.4,depthWrite:!1,blending:a.AdditiveBlending})]}),(0,n.jsx)(E,{parentRef:c}),d.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,2.2,1.5],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.1,.8,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#81D4FA",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]}),(0,n.jsxs)("mesh",{position:[.5,2.2,1.3],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,n.jsx)("coneGeometry",{args:[.08,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#81D4FA",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]}),(0,n.jsxs)("mesh",{position:[-.5,2.2,1.3],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,n.jsx)("coneGeometry",{args:[.08,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#81D4FA",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]})]}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2+1.2*u.current,i=.8*Math.cos(r),o=2.5+.8*Math.sin(r),a=.2*Math.cos(1.5*u.current+t);return(0,n.jsx)("group",{position:[i,o,a],rotation:[Math.PI/2,r+Math.PI,-Math.PI/2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.075,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#CCFFFF",emissive:"#CCFFFF",emissiveIntensity:.8,transparent:!0,opacity:1})]})},"horizontal-".concat(t))}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2+1.2*u.current+Math.PI/8,i=.8*Math.cos(r),o=2.5+.8*Math.sin(r),a=.2*Math.cos(1.5*u.current+t);return(0,n.jsx)("group",{position:[i,o,a],rotation:[Math.PI/2,r,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.075,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#AAEEFF",emissive:"#AAEEFF",emissiveIntensity:.8,transparent:!0,opacity:1})]})},"vertical-".concat(t))}),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:.5,distance:3,decay:2})]})}function A(e){let{world:t,maxInstances:r=200}=e,a=(0,i.useRef)({boss:[],elite:[],grunt:[]});return(0,o.F)(()=>{if(!t)return;let e=performance.now(),r=performance.now(),n=t.queryEntities([m.C,c.w]),i=[],o=[],s=[];for(let e of n){let t=e.getComponent(m.C);if(t)switch(t.type){case m.Z.BOSS:i.push(e.id);break;case m.Z.ELITE:o.push(e.id);break;case m.Z.GRUNT:s.push(e.id)}}if(a.current={boss:i,elite:o,grunt:s},Math.floor(e/16.67)%60==0){let e=performance.now()-r,t=i.length+o.length+s.length;t>0&&console.log("\uD83C\uDFAD Original Models: ".concat(t," enemies (").concat(i.length," bosses, ").concat(o.length," elites, ").concat(s.length," grunts) rendered in ").concat(e.toFixed(2),"ms"))}}),(0,n.jsx)(n.Fragment,{children:a.current.elite.map(e=>{let r=t.getEntity(e);if(!r)return null;let i=r.getComponent(c.w);return i?(0,n.jsx)(F,{entityId:e,position:i.position,world:t},e):null})})}function R(e){let{world:t}=e;return(0,n.jsx)(A,{world:t,maxInstances:200})}var T=r(7057),B=r(6932),k=r(2465),z=r(7019),V=r(9709),G=r(1151),N=r(5050),W=r(5658),L=r(4244);function H(){var e,t,r;let{onDamageNumbersUpdate:D,onDamageNumberComplete:E,onCameraUpdate:F,onGameStateUpdate:A,onControlSystemUpdate:H}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{scene:O,camera:U,gl:q,size:_}=(0,o.D)(),Z=(0,i.useRef)(null),Y=(0,i.useRef)(null),Q=(0,i.useRef)(null),J=(0,i.useRef)(null),X=(0,i.useRef)(!1),[K,$]=(0,i.useState)(new a.Vector3(0,.5,0)),[ee,et]=(0,i.useState)(null),[er,en]=(0,i.useState)([]),[ei,eo]=(0,i.useState)(null),[ea,es]=(0,i.useState)(null),el=(0,i.useRef)(0),[ec,eu]=(0,i.useState)({currentWeapon:C.v.BOW,currentSubclass:C.p.ELEMENTAL,isCharging:!1,chargeProgress:0,isSwinging:!1,isSpinning:!1,swordComboStep:1,isDivineStorming:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1,isSundering:!1}),{createPowershotEffect:ed}=(0,L.sf)();return(0,i.useEffect)(()=>{if(X.current)return;X.current=!0,(0,N.j4)(0),(0,N.Ge)(0);let e=new l.D({enableDebug:!0});Z.current=e;let t=q.domElement;return e.initialize(t).then(()=>{let{player:t,controlSystem:r}=function(e,t,r,n){let i=e.getWorld(),o=e.getInputManager();n.shadowMap.enabled=!0,n.shadowMap.type=a.PCFSoftShadowMap;let s=new v.F,l=new M.s(5),m=new S.b(i),C=new g.K(t,r,n),b=new w.C(t,r),I=new x.c(i),P=new f.s(r,o,i,I),D=new y.D(r,o,{distance:8,height:2,mouseSensitivity:.005,smoothing:.15});I.setCombatSystem(m),i.addSystem(s),i.addSystem(l),i.addSystem(m),i.addSystem(C),i.addSystem(b),i.addSystem(I),i.addSystem(P),i.addSystem(D);let E=function(e){let t=e.createEntity(),r=e.createComponent(c.w);r.setPosition(0,.5,0),t.addComponent(r);let n=e.createComponent(u.i);n.maxSpeed=3.75,n.jumpForce=8,n.friction=.85,t.addComponent(n);let i=new d.S(500);i.enableRegeneration(1,5),t.addComponent(i);let o=new h.W(200,20,5);t.addComponent(o);let a=e.createComponent(p.YM);return a.type=p.F5.SPHERE,a.radius=1,a.layer=p.aB.PLAYER,a.setOffset(0,.5,0),t.addComponent(a),t}(i);P.setPlayer(E),D.setTarget(E),D.snapToTarget();let F=new j.R(i,{enableObjectPooling:!0,enableHealthBars:!0,healthBarConfig:{showWhenFull:!0,fadeDistance:20}});return F.createElite(new a.Vector3(-8,0,8),2),F.createElite(new a.Vector3(8,0,3),2),{player:E,controlSystem:P}}(e,O,U,q);et(t),Y.current=t.id,Q.current=r,H&&H(r),r.setBowReleaseCallback((t,n)=>{if(n){let t=e.getWorld().getEntity(Y.current);if(t){let e=t.getComponent(c.w);if(e){let t=new a.Vector3;U.getWorldDirection(t),t.normalize();let n=new a.Vector3;n.crossVectors(t,new a.Vector3(0,1,0)).normalize();let i=new a.Matrix4;i.makeRotationAxis(n,Math.PI/12),t.applyMatrix4(i),t.normalize(),ed(e.position.clone(),t,r.getCurrentSubclass(),!0,!0)}}}}),r.setViperStingCallback((e,t)=>{}),r.setBarrageCallback((e,t)=>{}),r.setDivineStormCallback((e,t,r)=>{(0,V.e6)(e,"local-player",r)}),r.setReanimateCallback(()=>{J.current&&J.current.triggerHealingEffect()}),r.setSkyfallCallback((e,t)=>{}),r.setBackstabCallback((e,t,r,n)=>{}),r.setSunderCallback((e,t,r,n)=>{}),r.setSmiteCallback((e,t,r)=>{eo({id:el.current++,position:e.clone(),startTime:Date.now(),onDamageDealt:r}),setTimeout(()=>{eo(null)},900),console.log("⚡ Single Player Smite triggered at:",e)}),r.setDeathGraspCallback((e,t)=>{let r=e.clone().add(t.clone().multiplyScalar(8));es({id:el.current++,startPosition:e.clone(),targetPosition:r,startTime:Date.now()}),setTimeout(()=>{es(null)},1200),console.log("⛓️ Single Player Death Grasp triggered from:",e,"to:",r)}),e.start()}),()=>{Z.current&&Z.current.destroy()}},[O,U,q]),(0,o.F)((e,t)=>{if(Z.current&&Z.current.isEngineRunning()){if(function(e){let t=document.getElementById("fps-counter");t&&(t.textContent="FPS: ".concat(e))}(Z.current.getCurrentFPS()),ee){let e=ee.getComponent(c.w);e&&e.position&&$(e.position.clone())}en(Z.current.getWorld().getAllEntities().filter(e=>{let t=e.getComponent(m.C),r=e.getComponent(d.S),n=e.getComponent(c.w);return t&&r&&n&&!r.isDead}).map(e=>{let t=e.getComponent(d.S),r=e.getComponent(c.w);return t&&r?{id:e.id.toString(),position:r.position.clone(),health:t.currentHealth}:null}).filter(e=>null!==e)),Q.current&&eu({currentWeapon:Q.current.getCurrentWeapon(),currentSubclass:Q.current.getCurrentSubclass(),isCharging:Q.current.isWeaponCharging(),chargeProgress:Q.current.getChargeProgress(),isSwinging:Q.current.isWeaponSwinging(),isSpinning:Q.current.isWeaponCharging()&&Q.current.getCurrentWeapon()===C.v.SCYTHE,swordComboStep:Q.current.getSwordComboStep(),isDivineStorming:Q.current.isDivineStormActive(),isSwordCharging:Q.current.isChargeActive(),isDeflecting:Q.current.isDeflectActive(),isViperStingCharging:Q.current.isViperStingChargingActive(),viperStingChargeProgress:Q.current.getViperStingChargeProgress(),isBarrageCharging:Q.current.isBarrageChargingActive(),barrageChargeProgress:Q.current.getBarrageChargeProgress(),isCobraShotCharging:Q.current.isCobraShotChargingActive(),cobraShotChargeProgress:Q.current.getCobraShotChargeProgress(),isSkyfalling:Q.current.isSkyfallActive(),isBackstabbing:Q.current.isBackstabActive(),isSundering:Q.current.isSunderActive()});let e=Z.current.getWorld().getSystem(S.b);if(e&&D&&D(e.getDamageNumbers()),F&&F(U,_),A&&ee&&Q.current){let e=ee.getComponent(d.S),t=ee.getComponent(h.W);e&&A({playerHealth:e.currentHealth,maxHealth:e.maxHealth,playerShield:t?t.currentShield:0,maxShield:t?t.maxShield:0,currentWeapon:Q.current.getCurrentWeapon(),currentSubclass:Q.current.getCurrentSubclass()})}}}),i.useEffect(()=>{E&&(window.handleDamageNumberComplete=e=>{var t;let r=null===(t=Z.current)||void 0===t?void 0:t.getWorld().getSystem(S.b);r&&r.removeDamageNumber(e)})},[E]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(W.Z,{level:1,world:null===(e=Z.current)||void 0===e?void 0:e.getWorld()}),(0,n.jsx)("ambientLight",{intensity:.225}),(0,n.jsx)("directionalLight",{position:[10,10,5],intensity:.5,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),(0,n.jsxs)("mesh",{receiveShadow:!0,position:[0,-.5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[29,29,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#2d5a2d"})]}),(0,n.jsxs)("mesh",{position:[0,.01,0],children:[(0,n.jsx)("ringGeometry",{args:[28.5,29,64]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6b6b",transparent:!0,opacity:.3})]}),ee&&Z.current&&(0,n.jsx)(s.Z,{entityId:ee.id,position:K,world:Z.current.getWorld(),currentWeapon:ec.currentWeapon,currentSubclass:ec.currentSubclass,isCharging:ec.isCharging,chargeProgress:ec.chargeProgress,isSwinging:ec.isSwinging,isSpinning:ec.isSpinning,swordComboStep:ec.swordComboStep,isDivineStorming:ec.isDivineStorming,isSwordCharging:ec.isSwordCharging,isDeflecting:ec.isDeflecting,isViperStingCharging:ec.isViperStingCharging,viperStingChargeProgress:ec.viperStingChargeProgress,isBarrageCharging:ec.isBarrageCharging,barrageChargeProgress:ec.barrageChargeProgress,isCobraShotCharging:ec.isCobraShotCharging,cobraShotChargeProgress:ec.cobraShotChargeProgress,isSkyfalling:ec.isSkyfalling,isBackstabbing:ec.isBackstabbing,isSundering:ec.isSundering,isSmiting:(null===(t=Q.current)||void 0===t?void 0:t.isSmiteActive())||!1,isDeathGrasping:(null===(r=Q.current)||void 0===r?void 0:r.isDeathGraspActive())||!1,reanimateRef:J,onBowRelease:()=>{},onScytheSwingComplete:()=>{},onSwordSwingComplete:()=>{var e;null===(e=Q.current)||void 0===e||e.onSwordSwingComplete()},onSabresSwingComplete:()=>{var e;null===(e=Q.current)||void 0===e||e.onSabresSwingComplete()},onChargeComplete:()=>{var e;null===(e=Q.current)||void 0===e||e.onChargeComplete()},onDeflectComplete:()=>{var e;null===(e=Q.current)||void 0===e||e.onDeflectComplete()},onBackstabComplete:()=>{},onSunderComplete:()=>{},onSmiteComplete:()=>{var e;null===(e=Q.current)||void 0===e||e.onSmiteComplete()},onDeathGraspComplete:()=>{var e;null===(e=Q.current)||void 0===e||e.onDeathGraspComplete()}}),ei&&(0,n.jsx)(b.Z,{weaponType:C.v.RUNEBLADE,position:ei.position,onComplete:()=>{},onHit:(e,t)=>{var r;let n=null===(r=Z.current)||void 0===r?void 0:r.getWorld();if(n&&ee){let r=n.getEntity(parseInt(e));if(r){let e=n.getSystem(S.b);e&&e.queueDamage(r,t,ee,"smite")}}},enemyData:er,onDamageDealt:ei.onDamageDealt||(e=>{if(e&&ee){let e=ee.getComponent(d.S);if(e){let t=e.currentHealth;e.heal(20)&&console.log("⚡ Smite (visual fallback) healed player for 20 HP! Health: ".concat(t," -> ").concat(e.currentHealth,"/").concat(e.maxHealth))}}})},"smite-".concat(ei.id)),ea&&(0,n.jsx)(I,{startPosition:ea.startPosition,targetPosition:ea.targetPosition,onComplete:()=>{},onPullStart:()=>{}},"deathgrasp-".concat(ea.id)),Z.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(P.Z,{world:Z.current.getWorld()}),(0,n.jsx)(R,{world:Z.current.getWorld()}),(0,n.jsx)(T.Z,{}),(0,n.jsx)(B.default,{world:Z.current.getWorld()}),(0,n.jsx)(k.ZP,{world:Z.current.getWorld()}),(0,n.jsx)(z.default,{world:Z.current.getWorld()}),(0,n.jsx)(V.ZP,{enemyData:[],playerId:"local-player"}),(0,n.jsx)(G.ZP,{})]})]})}},8026:function(e,t,r){r.r(t),r.d(t,{default:function(){return a}});var n=r(7437),i=r(2265);let o=(0,r(166).default)(()=>Promise.all([r.e(841),r.e(893),r.e(812),r.e(736),r.e(983)]).then(r.bind(r,5464)).then(e=>({default:e.GameScene})),{loadableGenerated:{webpack:()=>[5464]},ssr:!1,loading:()=>null});function a(e){return(0,n.jsx)(i.Suspense,{fallback:null,children:(0,n.jsx)(o,{...e})})}},7809:function(e,t,r){r.r(t),r.d(t,{PVPGameScene:function(){return el}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448),s=r(3625),l=r(946),c=r(45),u=r(4058),d=r(73),h=r(7771),p=r(6862),m=r(3974),g=r(246),f=r(3478),y=r(2115),x=r(2487),v=r(2762),M=r(3842),S=r(7223),w=r(2082),j=r(2972),C=r(5773),b=r(2158),I=r(244),P=r(3021),D=r(967),E=r(8079),F=r(7125),A=r(6534);function R(e){var t;let{startPosition:r,direction:s,casterId:l,onHit:c,onComplete:u,playerEntities:d,enemyData:h=[],players:p,localSocketId:m}=e,g=(0,i.useRef)(0),f=(0,i.useRef)(1),y=(0,i.useRef)(new Set),x=(0,i.useRef)(!1),v=(0,i.useMemo)(()=>{let e=s.clone();return e.y=Math.max(.3*e.y,.1),e.normalize(),e},[s]),M=(0,i.useMemo)(()=>r.clone().add(v.clone().multiplyScalar(18)),[r,v,18]),S=(0,i.useMemo)(()=>({particle:new a.SphereGeometry(.15,8,8),impact:new a.SphereGeometry(.2,8,8),core:new a.SphereGeometry(.18,8,8)}),[]),w=(0,i.useMemo)(()=>({spiral1:new a.MeshBasicMaterial({color:new a.Color("#6A0DAD"),transparent:!0,opacity:1,blending:a.AdditiveBlending}),spiral2:new a.MeshBasicMaterial({color:new a.Color("#9370DB"),transparent:!0,opacity:1,blending:a.AdditiveBlending}),spiral3:new a.MeshBasicMaterial({color:new a.Color("#8A2BE2"),transparent:!0,opacity:1,blending:a.AdditiveBlending}),impact:new a.MeshBasicMaterial({color:new a.Color("#6A0DAD"),transparent:!0,opacity:1,blending:a.AdditiveBlending}),core:new a.MeshBasicMaterial({color:new a.Color("#9370DB"),transparent:!0,opacity:1,blending:a.AdditiveBlending})}),[]),j=(0,i.useMemo)(()=>{let e=v.clone(),t=Math.ceil(36),n=[[],[],[]],i=new a.Vector3(0,1,0),o=new a.Vector3().crossVectors(e,i).normalize(),s=new a.Vector3().crossVectors(o,e).normalize();for(let i=0;i<3;i++){let a=i*Math.PI*2/3;for(let l=0;l<t;l++){let c=l/t,u=18*c,d=r.clone().add(e.clone().multiplyScalar(u)),h=4*c*Math.PI*2+a,p=.2*(1-.3*c),m=o.clone().multiplyScalar(Math.cos(h)*p).add(s.clone().multiplyScalar(Math.sin(h)*p)),g=d.clone().add(m),f=1.2-.8*c+.1*Math.sin(c*Math.PI*6);n[i].push({position:g,scale:Math.max(.3,f)})}}return n},[r,v,18]);return(0,o.F)((e,t)=>{g.current=Math.min(g.current+t,1.2),f.current=.3*Math.random()+.7;let n=g.current/1.2,i=r.clone().add(v.clone().multiplyScalar(18*n));if(n<.8&&!x.current){if(h&&h.length>0)for(let e of h){if(y.current.has(e.id)||e.health<=0)continue;let t=i.distanceTo(e.position);if(t<=3){console.log("\uD83C\uDFAF DeathGraspProjectile: Hit enemy ".concat(e.id," at distance ").concat(t.toFixed(2))),y.current.add(e.id),x.current=!0,null==c||c(e.id,e.position.clone());break}}p&&m&&!x.current&&p.forEach((e,t)=>{if(t===m||y.current.has(t)||e.health<=0)return;let r=new a.Vector3(e.position.x,e.position.y,e.position.z),n=i.distanceTo(r);n<=3&&(console.log("\uD83C\uDFAF DeathGraspProjectile: Hit player ".concat(t," at distance ").concat(n.toFixed(2))),y.current.add(t),x.current=!0,null==c||c(t,r.clone()))})}let o=n<.8?1-.6*n:.4*(1-(n-.8)/.2);w.spiral1.opacity=.9*o*f.current,w.spiral2.opacity=.85*o*(.9*f.current+.1),w.spiral3.opacity=.8*o*(.8*f.current+.2),w.impact.opacity=.7*o*f.current,w.core.opacity=1.1*o*f.current,n>=1&&(null==u||u())}),(0,n.jsxs)("group",{children:[j.map((e,t)=>{let r=[w.spiral1,w.spiral2,w.spiral3][t];return(0,n.jsx)("group",{children:e.map((e,i)=>(0,n.jsx)("mesh",{position:e.position.toArray(),geometry:S.particle,material:r,scale:[e.scale,e.scale,e.scale]},"particle-".concat(t,"-").concat(i)))},"stream-".concat(t))}),(0,n.jsx)("mesh",{position:M.toArray(),geometry:S.impact,material:w.impact,scale:[1.5,1.5,1.5]}),(0,n.jsx)("mesh",{position:r.toArray(),geometry:S.core,material:w.core,scale:[1.3,1.3,1.3]}),(0,n.jsx)("mesh",{position:r.toArray(),geometry:S.particle,material:w.spiral1,scale:[2+.5*Math.sin(8*g.current),2+.5*Math.sin(8*g.current),2+.5*Math.sin(8*g.current)]}),(0,n.jsx)("pointLight",{position:r.toArray(),color:"#6A0DAD",intensity:10*(1-g.current/1.2)*f.current,distance:4,decay:2}),(0,n.jsx)("pointLight",{position:M.toArray(),color:"#9370DB",intensity:8*(1-g.current/1.2)*f.current,distance:5,decay:2}),j[0]&&j[0].length>0&&(0,n.jsx)("pointLight",{position:(null===(t=j[0][Math.floor(j[0].length/2)])||void 0===t?void 0:t.position.toArray())||[0,0,0],color:"#8A2BE2",intensity:4*(1-g.current/1.2)*f.current,distance:3,decay:2})]})}function T(e){let{targetPlayerId:t,casterPosition:r,isActive:n,onComplete:s,playerEntities:l,getEntityPosition:c,updateEntityPosition:u}=e,d=(0,i.useRef)(null),h=(0,i.useRef)(null),p=(0,i.useRef)(null),m=(0,i.useRef)(null);return(0,o.F)(()=>{if(!n)return;if(!m.current&&(m.current=l.current.get(t)||null,!m.current)){console.log("❌ DeathGraspPull: No entity ID found for player ".concat(t,", cancelling pull")),s();return}if(!h.current&&m.current){if(h.current=Date.now(),d.current=c(m.current),!d.current){console.log("❌ DeathGraspPull: Failed to get start position for entity ".concat(m.current)),s();return}let e=d.current;console.log("\uD83C\uDFA3 DeathGraspPull: Initializing pull for entity ".concat(m.current," from [").concat(e.x.toFixed(1),", ").concat(e.z.toFixed(1),"] to caster at [").concat(r.x.toFixed(1),", ").concat(r.z.toFixed(1),"]"));let t=e.clone();t.y=0;let n=r.clone();n.y=0;let i=n.clone().sub(t).normalize();p.current=t.clone().add(i.multiplyScalar(20));let o=t.distanceTo(n);if(20>=.8*o){let e=n.clone().sub(t).normalize();p.current=t.clone().add(e.multiplyScalar(.6*o))}p.current.y=0;return}let e=Math.min((Date.now()-h.current)/1e3/.6,1);if(!d.current||!p.current||!m.current){s(),h.current=null,d.current=null,p.current=null,m.current=null;return}let i=d.current.clone();i.y=0;let o=p.current.clone().sub(i).multiplyScalar(1-Math.pow(1-e,2)),g=i.clone().add(o);if(g.y=0,Math.sqrt(g.x*g.x+g.z*g.z)>25){s(),h.current=null,d.current=null,p.current=null,m.current=null;return}let f=c(m.current);if(f){let r=f.y,n=new a.Vector3(g.x,r,g.z);if(Math.floor(60*e)%10==0&&console.log("\uD83C\uDFA3 DeathGraspPull: Moving entity ".concat(m.current," to [").concat(n.x.toFixed(1),", ").concat(n.z.toFixed(1),"] (").concat((100*e).toFixed(0),"% complete)")),u(m.current,n),window.multiplayer){let e=window.multiplayer;e.broadcastPlayerEffect?(e.broadcastPlayerEffect({type:"deathgrasp_pull",targetPlayerId:t,position:n,casterId:window.localSocketId}),console.log("\uD83C\uDFA3 DeathGraspPull: Broadcasting position update via multiplayer effect for target ".concat(t," to position [").concat(n.x.toFixed(2),", ").concat(n.y.toFixed(2),", ").concat(n.z.toFixed(2),"]"))):console.log("❌ DeathGraspPull: broadcastPlayerEffect not available")}}else console.log("❌ DeathGraspPull: Could not get current position for entity ".concat(m.current));1===e&&(s(),h.current=null,d.current=null,p.current=null,m.current=null)}),null}var B=r(2824),k=r(7057),z=r(6932),V=r(2465),G=r(6923),N=r(7019),W=r(3351);function L(e){let{position:t,debuffType:r,duration:a=5e3,startTime:s=Date.now(),onComplete:l}=e,c=(0,i.useRef)(null),[u,d]=(0,i.useState)(1),[h,p]=(0,i.useState)(1),m=(0,i.useRef)(.02*Math.random()+.01);(0,i.useEffect)(()=>{let e=setTimeout(()=>{l&&l()},a);return()=>{clearTimeout(e)}},[a,l,r]),(0,o.F)(()=>{if(!c.current)return;let e=Date.now()-s,t=Math.min(e/a,1);if(t>=1&&l){l();return}t>.8?p(1-(t-.8)/.19999999999999996):p(1),d((.6+.4*Math.sin(.008*e))*h),c.current.rotation.y+=m.current,c.current.rotation.z=.1*Math.sin(.003*e)});let g=(()=>{switch(r){case"frozen":return{color:"#4FC3F7",emissive:"#29B6F6",symbol:"❄️"};case"slowed":return{color:"#FFA726",emissive:"#FF9800",symbol:"\uD83D\uDC0C"};default:return{color:"#9E9E9E",emissive:"#757575",symbol:"?"}}})();return(0,n.jsxs)("group",{ref:c,position:[t.x,t.y+2.5,t.z],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("circleGeometry",{args:[.4,16]}),(0,n.jsx)("meshStandardMaterial",{color:g.color,emissive:g.emissive,emissiveIntensity:.3*u,transparent:!0,opacity:.6*h,roughness:.1,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,0,-.01],rotation:[0,0,0],children:[(0,n.jsx)("ringGeometry",{args:[.35,.45,16]}),(0,n.jsx)("meshStandardMaterial",{color:g.color,emissive:g.emissive,emissiveIntensity:.5*u,transparent:!0,opacity:.8*h,roughness:.05,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,0,.01],children:[(0,n.jsx)("circleGeometry",{args:[.25,12]}),(0,n.jsx)("meshStandardMaterial",{color:g.emissive,emissive:g.emissive,emissiveIntensity:.8*u,transparent:!0,opacity:.4*h})]}),[...Array(6)].map((e,t)=>{let r=t*Math.PI*2/6,i=.6+.1*Math.sin(.003*Date.now()+t);return(0,n.jsxs)("mesh",{position:[Math.cos(r)*i,Math.sin(r)*i*.3,0],children:[(0,n.jsx)("sphereGeometry",{args:[.03,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:g.color,emissive:g.emissive,emissiveIntensity:.9*u,transparent:!0,opacity:.7*h})]},t)}),(0,n.jsx)("pointLight",{color:g.color,intensity:1.5*u*h,distance:3,position:[0,0,.2]})]})}var H=r(8787),O=r(5113),U=r(1168),q=r(4817);function _(e){let{world:t,players:n,onPlayerHit:a,onPlayerVenomed:s,serverPlayerEntities:l,localSocketId:c}=e;return(0,i.useRef)(new Set),(0,o.F)(()=>{q.u.resetFrameTemporaries();let{getGlobalCobraShotProjectiles:e}=r(7019);e().forEach(e=>{if(!e.active)return;let t=e.position;n.forEach(r=>{if(r.id===c)return;let n=q.u.getTempVector3(r.position.x,r.position.y,r.position.z);if(1.5>=t.distanceTo(n)){let t=parseInt(r.id)||r.id.length;if(!e.hitEnemies.has(t)){e.hitEnemies.add(t),a(r.id,29);let n=q.u.acquireVector3(r.position.x,r.position.y,r.position.z);s(r.id,n),q.u.releaseVector3(n),e.active=!1,e.fadeStartTime=Date.now()}}})})}),null}function Z(e){let{world:t,players:r,onPlayerHit:n,onPlayerSlowed:a,serverPlayerEntities:s,localSocketId:l}=e,c=(0,i.useRef)(new Set);return(0,o.F)(()=>{t&&(q.u.resetFrameTemporaries(),t.getAllEntities().filter(e=>e.hasComponent(U.W)&&e.hasComponent(d.w)&&e.hasComponent(g.T)).forEach(e=>{var t,i;let o=e.getComponent(g.T),u=e.getComponent(d.w),h=e.getComponent(U.W);if(!(null==o?void 0:null===(i=o.mesh)||void 0===i?void 0:null===(t=i.userData)||void 0===t?void 0:t.isBarrageArrow)||!u||!h)return;let p=u.position;r.forEach(t=>{if(t.id===l)return;let r=s.current.get(t.id);if(r&&r===h.owner)return;let i=q.u.getTempVector3(t.position.x,t.position.y,t.position.z);if(1.25>=p.distanceTo(i)){let i=q.u.createHitKey(e.id,t.id);if(r&&!h.hasHitTarget(r)&&!c.current.has(i)){h.addHitTarget(r),c.current.add(i),n(t.id,30);let e=q.u.acquireVector3(t.position.x,t.position.y,t.position.z);a(t.id,e),q.u.releaseVector3(e),setTimeout(()=>{c.current.delete(i)},1e4)}}})}))}),null}function Y(e){let{world:t,players:n,onPlayerHit:a,onPlayerFrozen:s,serverPlayerEntities:l,localSocketId:c}=e,u=(0,i.useRef)(new Set),d=(0,i.useRef)(0);return(0,o.F)(()=>{if(!t)return;let e=Date.now();if(e-d.current<50)return;d.current=e,q.u.resetFrameTemporaries();let{getActiveFrostNovas:i}=r(6932);(i?i():[]).forEach(e=>{n.forEach(t=>{if(t.id===c)return;let r=q.u.getTempVector3(t.position.x,t.position.y,t.position.z);if(6>=e.position.distanceTo(r)){let r=q.u.createHitKey(e.id,t.id);if(!u.current.has(r)){u.current.add(r),a(t.id,50);let e=q.u.acquireVector3(t.position.x,t.position.y,t.position.z);s(t.id,e),q.u.releaseVector3(e),setTimeout(()=>{u.current.delete(r)},7e3)}}})})}),null}function Q(e){let{world:t,players:n,onPlayerHit:a,onPlayerVenomed:s,serverPlayerEntities:l,localSocketId:c}=e,u=(0,i.useRef)(new Set);return(0,o.F)(()=>{q.u.resetFrameTemporaries();let{getGlobalViperStingProjectiles:e}=r(319);e().forEach(e=>{if(!e.active)return;let t=e.position;n.forEach(r=>{if(r.id===c)return;let n=q.u.getTempVector3(r.position.x,r.position.y,r.position.z);if(1.4>=t.distanceTo(n)){let t=e.isReturning?e.returnHitEnemies:e.hitEnemies;t.has(r.id)||(t.add(r.id),a(r.id,61))}})}),u.current.clear()}),null}var J=r(3841),X=r(9709),K=r(1151);function $(e){let{playerId:t,playerName:r,position:s,health:l,maxHealth:c,shield:u=0,maxShield:d=200,camera:h,showDistance:p=25}=e,m=(0,i.useRef)(null),g=(0,i.useRef)({healthBar:null,shieldBar:null,background:null,shieldBackground:null}),[f,y]=(0,i.useState)(!1),x=new a.Vector3(0,3,0);return(0,i.useEffect)(()=>{if(!m.current)return;let e=new a.PlaneGeometry(2,.15),t=new a.MeshBasicMaterial({color:new a.Color(3355443),transparent:!0,opacity:.8,depthWrite:!1}),r=new a.Mesh(e,t);r.position.set(0,0,.001),g.current.background&&m.current.remove(g.current.background),g.current.background=r,m.current.add(r);let n=new a.PlaneGeometry(2,.15),i=new a.MeshBasicMaterial({color:new a.Color(65280),transparent:!0,opacity:.9,depthWrite:!1}),o=new a.Mesh(n,i);o.position.set(0,0,.002),g.current.healthBar&&m.current.remove(g.current.healthBar),g.current.healthBar=o,m.current.add(o);let s=new a.PlaneGeometry(2,.105),l=new a.MeshBasicMaterial({color:new a.Color(1712946),transparent:!0,opacity:.8,depthWrite:!1}),c=new a.Mesh(s,l);c.position.set(0,.2,.001),g.current.shieldBackground&&m.current.remove(g.current.shieldBackground),g.current.shieldBackground=c,m.current.add(c);let u=new a.PlaneGeometry(2,.105),d=new a.MeshBasicMaterial({color:new a.Color(4886754),transparent:!0,opacity:.9,depthWrite:!1}),h=new a.Mesh(u,d);return h.position.set(0,.2,.002),g.current.shieldBar&&m.current.remove(g.current.shieldBar),g.current.shieldBar=h,m.current.add(h),()=>{e.dispose(),t.dispose(),n.dispose(),i.dispose(),s.dispose(),l.dispose(),u.dispose(),d.dispose()}},[]),(0,o.F)(()=>{if(!m.current||!h)return;let e=s.clone().add(x),t=h.position.distanceTo(e),r=t<=p&&(l<c||u<d);if(r!==f&&y(r),!r){m.current.visible=!1;return}if(m.current.visible=!0,m.current.position.copy(e),m.current.lookAt(h.position),g.current.healthBar){let e=Math.max(0,Math.min(1,l/c));g.current.healthBar.scale.x=e,g.current.healthBar.position.x=-(2*(1-e))/2;let t=g.current.healthBar.material;e>.6?t.color.setHex(65280):e>.3?t.color.setHex(16776960):t.color.setHex(16711680)}if(g.current.shieldBar&&d>0){let e=Math.max(0,Math.min(1,u/d));g.current.shieldBar.scale.x=e,g.current.shieldBar.position.x=-(2*(1-e))/2}let n=.8*p,i=t>n?Math.max(.3,1-(t-n)/(p-n)):1;[g.current.background,g.current.healthBar,g.current.shieldBackground,g.current.shieldBar].forEach(e=>{if(e){let t=e.material;t.opacity=t.userData.baseOpacity*i}})}),(0,i.useEffect)(()=>{[{mesh:g.current.background,opacity:.8},{mesh:g.current.healthBar,opacity:.9},{mesh:g.current.shieldBackground,opacity:.8},{mesh:g.current.shieldBar,opacity:.9}].forEach(e=>{let{mesh:t,opacity:r}=e;t&&(t.material.userData.baseOpacity=r)})},[]),(0,n.jsx)("group",{ref:m})}function ee(e){let{entityId:t,world:r,position:s,ownerId:l,towerIndex:c,health:u,maxHealth:h,isDead:p=!1,color:m,camera:g}=e,f=(0,i.useRef)(null),x=(0,i.useRef)(null),v=(0,i.useRef)(0),M=(0,i.useRef)(!1),S=(0,i.useMemo)(()=>[new a.Color(4886754),new a.Color(16739125),new a.Color(5294200),new a.Color(10181046),new a.Color(15965202)],[]),w=m||S[c%S.length],j=p?.3:Math.max(.5,Math.max(0,u/h)),C=w.getHex(),b=w.clone().multiplyScalar(.3).getHex();return(0,o.F)((e,n)=>{if(v.current+=n,f.current){f.current.position.copy(s);let e=r.getEntity(t);if(e){let t=e.getComponent(y.N);if(t&&t.currentTarget){let e=Date.now()/1e3-t.lastAttackTime;M.current=e<.5}else M.current=!1}if(M.current&&e){let t=e.getComponent(y.N);if(t&&t.currentTarget){let e=r.getEntity(t.currentTarget);if(e){let t=e.getComponent(d.w);if(t){let e=new a.Vector3;e.copy(t.position),e.sub(s),e.y=0,e.normalize();let r=Math.atan2(e.x,e.z);f.current.rotation.y=r}}}}f.current.position.y+=.1*Math.sin(2*v.current),M.current||(f.current.rotation.y+=.5*n),x.current&&g&&x.current.lookAt(g.position);let i=f.current.getObjectByName("LeftArm");if(i){if(M.current){let e=i.rotation.x,t=8*n;i.rotation.x=a.MathUtils.lerp(e,-Math.PI/3,t),i.rotation.z=a.MathUtils.lerp(i.rotation.z,.2,t)}else{let e=i.rotation.x,t=i.rotation.z,r=6*n;i.rotation.x=a.MathUtils.lerp(e,0,r),i.rotation.z=a.MathUtils.lerp(t,0,r)}}}}),(0,n.jsxs)("group",{ref:f,children:[(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.8,0]}),(0,n.jsx)("meshStandardMaterial",{color:C,emissive:b,emissiveIntensity:.3,transparent:!0,opacity:.9*j,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{position:[0,2.7,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.4,0]}),(0,n.jsx)("meshStandardMaterial",{color:C,emissive:b,emissiveIntensity:.4,transparent:!0,opacity:.85*j,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[-.7,2.35,0],children:[(0,n.jsx)("sphereGeometry",{args:[.325,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:C,emissive:b,emissiveIntensity:.3,transparent:!0,opacity:.85*j,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[-.7,2.35,0],rotation:[Math.PI/2,-Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.4,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:w.clone().multiplyScalar(1.2).getHex(),emissive:w.clone().multiplyScalar(.6).getHex(),emissiveIntensity:.5,transparent:!0,opacity:.9*j,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{name:"LeftArm",position:[-.7,2,.2],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:C,emissive:b,emissiveIntensity:.2,transparent:!0,opacity:.675*j,metalness:.6,roughness:.4})]}),(0,n.jsxs)("mesh",{position:[.7,2.35,0],children:[(0,n.jsx)("sphereGeometry",{args:[.325,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:C,emissive:b,emissiveIntensity:.3,transparent:!0,opacity:.85*j,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[.7,2.35,0],rotation:[Math.PI/2,Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.4,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:w.clone().multiplyScalar(1.2).getHex(),emissive:w.clone().multiplyScalar(.6).getHex(),emissiveIntensity:.5,transparent:!0,opacity:.9*j,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{position:[.7,2,0],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:C,emissive:b,emissiveIntensity:.2,transparent:!0,opacity:.675*j,metalness:.6,roughness:.4})]}),(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("sphereGeometry",{args:[1.35,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:C,emissive:b,emissiveIntensity:.1,transparent:!0,opacity:.4*j,depthWrite:!1,blending:a.AdditiveBlending})]}),M.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,2.2,1.5],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.1,.8,6]}),(0,n.jsx)("meshStandardMaterial",{color:w.clone().multiplyScalar(1.5).getHex(),emissive:w.clone().multiplyScalar(.8).getHex(),emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]}),(0,n.jsxs)("mesh",{position:[.5,2.2,1.3],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,n.jsx)("coneGeometry",{args:[.08,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:w.clone().multiplyScalar(1.5).getHex(),emissive:w.clone().multiplyScalar(.8).getHex(),emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]}),(0,n.jsxs)("mesh",{position:[-.5,2.2,1.3],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,n.jsx)("coneGeometry",{args:[.08,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:w.clone().multiplyScalar(1.5).getHex(),emissive:w.clone().multiplyScalar(.8).getHex(),emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]})]}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2+1.2*v.current,i=.8*Math.cos(r),o=2.5+.8*Math.sin(r),a=.2*Math.cos(1.5*v.current+t);return(0,n.jsx)("group",{position:[i,o,a],rotation:[Math.PI/2,r+Math.PI,-Math.PI/2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.075,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:C,emissive:b,emissiveIntensity:.8,transparent:!0,opacity:j})]})},"horizontal-".concat(t))}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2+1.2*v.current+Math.PI/8,i=.8*Math.cos(r),o=2.5+.8*Math.sin(r),a=.2*Math.cos(1.5*v.current+t);return(0,n.jsx)("group",{position:[i,o,a],rotation:[Math.PI/2,r,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.075,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:w.clone().multiplyScalar(.8).getHex(),emissive:w.clone().multiplyScalar(.4).getHex(),emissiveIntensity:.8,transparent:!0,opacity:j})]})},"vertical-".concat(t))}),(0,n.jsx)("pointLight",{color:C,intensity:.5,distance:3,decay:2}),p&&(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("sphereGeometry",{args:[2,8,8]}),(0,n.jsx)("meshBasicMaterial",{color:6710886,transparent:!0,opacity:.1,wireframe:!0})]})})]})}function et(e){let{entityId:t,world:r,position:s,ownerId:l,health:c,maxHealth:u,isDead:d=!1,color:h}=e,p=(0,i.useRef)(null),m=(0,i.useRef)(null),g=(0,i.useRef)(null),f=(0,i.useMemo)(()=>[new a.Color(4886754),new a.Color(16739125),new a.Color(5294200),new a.Color(10181046),new a.Color(15965202)],[]),y=(0,i.useMemo)(()=>{let e=0;for(let t=0;t<l.length;t++)e=(e<<5)-e+l.charCodeAt(t),e&=e;let t=Math.abs(e)%f.length;return f[t]},[l,f]),x=h||y,v=Math.max(0,c/u),M=d?.3:Math.max(.5,v),S=d?new a.Color(6710886):x.clone().lerp(new a.Color(16711680),1-v);return(0,o.F)(e=>{if(!p.current||d)return;let t=e.clock.elapsedTime;p.current.position.y=s.y+.05*Math.sin(2*t);let r=Math.max(0,Math.min(1,c/u));m.current&&(m.current.scale.x=r,m.current.position.x=-(1.5*(1-r))/2),g.current&&(r>.5?g.current.color.setHex(65280):r>.25?g.current.color.setHex(16776960):g.current.color.setHex(16711680))}),(0,n.jsxs)("group",{ref:p,position:[s.x,s.y,s.z],children:[(0,n.jsxs)("mesh",{position:[0,.48,0],castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("cylinderGeometry",{args:[.3,.36,.72,6]}),(0,n.jsx)("meshStandardMaterial",{color:S,metalness:.2,roughness:.8,transparent:!0,opacity:M})]}),(0,n.jsxs)("mesh",{position:[0,.96,0],castShadow:!0,children:[(0,n.jsx)("sphereGeometry",{args:[.24,8,6]}),(0,n.jsx)("meshStandardMaterial",{color:S.clone().multiplyScalar(1.1),metalness:.1,roughness:.9,transparent:!0,opacity:M})]}),[-1,1].map(e=>(0,n.jsxs)("mesh",{position:[.36*e,.72,0],rotation:[0,0,.3*e],castShadow:!0,children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.06,.48,4]}),(0,n.jsx)("meshStandardMaterial",{color:S.clone().multiplyScalar(.9),metalness:.1,roughness:.9,transparent:!0,opacity:M})]},"arm-".concat(e))),[-1,1].map(e=>(0,n.jsxs)("mesh",{position:[.18*e,.12,0],castShadow:!0,children:[(0,n.jsx)("cylinderGeometry",{args:[.075,.075,.24,4]}),(0,n.jsx)("meshStandardMaterial",{color:S.clone().multiplyScalar(.8),metalness:.1,roughness:1,transparent:!0,opacity:M})]},"leg-".concat(e))),(0,n.jsxs)("mesh",{position:[.44999999999999996,.72,0],rotation:[0,0,.2],castShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[.09,.36,.03]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(3355443),metalness:.8,roughness:.2,transparent:!0,opacity:M})]}),!d&&(0,n.jsxs)("group",{position:[0,2,0],children:[(0,n.jsxs)("mesh",{position:[0,0,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("planeGeometry",{args:[1.5,.15]}),(0,n.jsx)("meshBasicMaterial",{color:3355443,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{ref:m,position:[-(1.5*(1-v))/2,.01,0],rotation:[-Math.PI/2,0,0],scale:[v,1,1],children:[(0,n.jsx)("planeGeometry",{args:[1.5,.12]}),(0,n.jsx)("meshBasicMaterial",{ref:g,color:v>.5?65280:v>.25?16776960:16711680,transparent:!0,opacity:.9})]})]}),d&&(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{position:[0,.48,0],children:[(0,n.jsx)("sphereGeometry",{args:[1,6,4]}),(0,n.jsx)("meshBasicMaterial",{color:6710886,transparent:!0,opacity:.1,wireframe:!0})]})}),(0,n.jsxs)("mesh",{position:[0,.48,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.44999999999999996,.44999999999999996,.05,8]}),(0,n.jsx)("meshBasicMaterial",{color:x,transparent:!0,opacity:.2})]})]})}var er=r(5050),en=r(5658),ei=r(4244),eo=r(319);r(6374);var ea=r(1766);let es=i.memo(e=>{let{position:t,onComplete:r}=e,[a,s]=(0,i.useState)(0);(0,o.F)((e,t)=>{s(e=>{let n=e+t;return n>=1.5&&r(),n})});let l=a/1.5,c=Math.sin(l*Math.PI),u=1+2*l;return(0,n.jsxs)("group",{position:t.toArray(),children:[[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,2*l+.5*t,0],rotation:[Math.PI/2,0,2*a],children:[(0,n.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:1.5,transparent:!0,opacity:c*(1-.2*t)})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{scale:[u,u,u],children:[(0,n.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2,transparent:!0,opacity:.3*c})]}),[...Array(12)].map((e,t)=>{let r=t/12*Math.PI*2,i=.75+l;return(0,n.jsxs)("mesh",{position:[Math.cos(r+2*a)*i/1.1,2*l+.5*Math.sin(3*a+t),Math.sin(r+2*a)*i/1.1],children:[(0,n.jsx)("sphereGeometry",{args:[.095,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2.5,transparent:!0,opacity:.8*c})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#60FF38",intensity:2*c,distance:5,decay:2})]})});function el(){var e,t,U;let{onDamageNumbersUpdate:el,onDamageNumberComplete:ec,onCameraUpdate:eu,onGameStateUpdate:ed,onControlSystemUpdate:eh,onExperienceUpdate:ep}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{scene:em,camera:eg,gl:ef,size:ey}=(0,o.D)(),{players:ex,towers:ev,gameStarted:eM,isInRoom:eS,updatePlayerPosition:ew,updatePlayerWeapon:ej,updatePlayerHealth:eC,broadcastPlayerAttack:eb,broadcastPlayerAbility:eI,broadcastPlayerAnimationState:eP,broadcastPlayerDamage:eD,broadcastPlayerEffect:eE,broadcastPlayerDebuff:eF,damageTower:eA,socket:eR}=(0,l.p)(),eT=(0,i.useRef)(null),eB=(0,i.useRef)(null),ek=(0,i.useRef)(null),ez=(0,i.useRef)(null),eV=(0,i.useRef)(null),eG=(0,i.useRef)(null),eN=(0,i.useRef)(!1),eW=(0,i.useRef)(0),[eL,eH]=(0,i.useState)(new a.Vector3(0,.5,0)),[eO,eU]=(0,i.useState)(null),eq=(0,i.useRef)({position:new a.Vector3(0,.5,0),quaternion:{x:0,y:0,z:0,w:1}}),e_=(0,i.useRef)(new Map),eZ=(0,i.useRef)(new Map);(0,i.useRef)(new Map);let[eY,eQ]=(0,i.useState)(0),[eJ,eX]=(0,i.useState)(1),[eK,e$]=(0,i.useState)(150),[e0,e1]=(0,i.useState)(F.v.BOW),[e2,e5]=(0,i.useState)([]),e3=(0,i.useRef)(0),[e8,e4]=(0,i.useState)([]),e6=(0,i.useRef)(0),[e7,e9]=(0,i.useState)([]),te=(0,i.useRef)(0),[tt,tr]=(0,i.useState)([]),tn=(0,i.useRef)(0),[ti,to]=(0,i.useState)([]),ta=(0,i.useRef)(0),[ts,tl]=(0,i.useState)([]),tc=(0,i.useRef)(0),[tu,td]=(0,i.useState)([]),th=(0,i.useRef)(0),tp=(0,i.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,i=e===(null==eR?void 0:eR.id),o={id:tc.current++,playerId:e,debuffType:t,position:r.clone(),startTime:Date.now(),duration:n};if(J.VO.batchEffectUpdates([{type:"add",effectType:"debuff",setter:tl,data:o}]),i&&eO){let e=eO.getComponent(h.i);e&&("frozen"===t?e.freeze(n):"slowed"===t?e.slow(n,.5):"stunned"===t&&e.freeze(n))}setTimeout(()=>{J.VO.batchEffectUpdates([{type:"remove",effectType:"debuff",setter:tl,filterId:o.id}])},o.duration)},[null==eR?void 0:eR.id,eO]),tm=(0,i.useCallback)((e,t)=>{null==eR||eR.id,tp(e,"frozen",t,5e3),eF&&eF(e,"frozen",5e3,{position:{x:t.x,y:t.y,z:t.z}})},[tp,eF]),tg=(0,i.useCallback)((e,t)=>{let r={id:e3.current++,playerId:e,position:t.clone(),startTime:Date.now(),duration:1500};J.VO.batchEffectUpdates([{type:"add",effectType:"reanimate",setter:e5,data:r}]),setTimeout(()=>{J.VO.batchEffectUpdates([{type:"remove",effectType:"reanimate",setter:e5,filterId:r.id}])},r.duration)},[]),tf=(0,i.useCallback)((e,t,r)=>{let n={id:e6.current++,playerId:e,position:t.clone(),startTime:Date.now(),duration:900,onDamageDealt:r};J.VO.batchEffectUpdates([{type:"add",effectType:"smite",setter:e4,data:n}]),setTimeout(()=>{J.VO.batchEffectUpdates([{type:"remove",effectType:"smite",setter:e4,filterId:n.id}])},n.duration)},[]),ty=(0,i.useCallback)((e,t,r)=>{let n={id:te.current++,playerId:e,startPosition:t.clone(),direction:r.clone(),startTime:Date.now(),duration:1200,pullTriggered:!1};J.VO.batchEffectUpdates([{type:"add",effectType:"deathgrasp",setter:e9,data:n}]),setTimeout(()=>{J.VO.batchEffectUpdates([{type:"remove",effectType:"deathgrasp",setter:e9,filterId:n.id}])},n.duration)},[]),tx=(0,i.useCallback)((e,t)=>{console.log("\uD83C\uDFA3 Creating DeathGraspPull effect for target ".concat(e," from position:"),t);let r={id:tn.current++,targetPlayerId:e,casterPosition:t.clone(),startTime:Date.now(),duration:600,isActive:!0};console.log("\uD83C\uDFA3 DeathGraspPull created with ID ".concat(r.id)),J.VO.batchEffectUpdates([{type:"add",effectType:"deathgrasp",setter:tr,data:r}]),setTimeout(()=>{J.VO.batchEffectUpdates([{type:"remove",effectType:"deathgrasp",setter:tr,filterId:r.id}])},r.duration)},[]),tv=(0,i.useCallback)((e,t)=>{let r={id:th.current++,playerId:e,position:t.clone(),startTime:Date.now(),duration:1200};J.VO.batchEffectUpdates([{type:"add",effectType:"frostNova",setter:td,data:r}]),setTimeout(()=>{J.VO.batchEffectUpdates([{type:"remove",effectType:"frostNova",setter:td,filterId:r.id}])},r.duration)},[]),tM=(0,i.useCallback)((e,t)=>{if(e===(null==eR?void 0:eR.id))return;let r={id:ta.current++,playerId:e,position:t.clone(),startTime:Date.now(),duration:6e3};J.VO.batchEffectUpdates([{type:"add",effectType:"venom",setter:to,data:r}]);let n=0,i=setInterval(()=>{if(++n>6){clearInterval(i);return}eD&&eD(e,17)},1e3);setTimeout(()=>{J.VO.batchEffectUpdates([{type:"remove",effectType:"venom",setter:to,filterId:r.id}])},r.duration)},[null==eR?void 0:eR.id,eD]),tS=(0,i.useCallback)(()=>{console.log("\uD83C\uDF0A Wave completed! Awarding 10 EXP to both players"),Array.from(ex.keys()).forEach(e=>{e===(null==eR?void 0:eR.id)?eQ(t=>{let r=t+10,n=ea.a.getLevelFromExperience(r);if(n>eJ&&(eX(n),console.log("\uD83C\uDF89 Level up! Player reached level ".concat(n)),eO)){let e=eO.getComponent(p.S);if(e){let t=ea.a.getMaxHealthForLevel(n),r=e.maxHealth;e.setMaxHealth(t),eC(e.currentHealth,e.maxHealth),console.log("\uD83D\uDC9A Health updated: ".concat(r," -> ").concat(t," HP (current: ").concat(e.currentHealth,"/").concat(e.maxHealth,")"))}}return console.log("\uD83C\uDFAF Local player ".concat(e," gained 10 EXP from wave completion (total: ").concat(r,")")),r}):console.log("\uD83C\uDFAF Opponent ".concat(e," gained 10 EXP from wave completion"))})},[null==eR?void 0:eR.id,eJ,eO,ex]);i.useEffect(()=>{ep&&ep(eY,eJ)},[eY,eJ,ep]);let[tw,tj]=(0,i.useState)({currentWeapon:F.v.BOW,currentSubclass:F.p.ELEMENTAL,isCharging:!1,chargeProgress:0,isSwinging:!1,isSpinning:!1,swordComboStep:1,isDivineStorming:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1,isSundering:!1}),tC=(0,i.useRef)({weapon:F.v.BOW,subclass:F.p.ELEMENTAL}),[tb,tI]=(0,i.useState)(new Map),{createPowershotEffect:tP}=(0,ei.sf)(),{createOptimizedVenomEffect:tD,createOptimizedDebuffEffect:tE,getPoolStats:tF}={createOptimizedVenomEffect:(0,i.useCallback)(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e3,n=q.u.acquireEffectData();return n.id=Date.now(),n.playerId=e,n.position.copy(t),n.startTime=Date.now(),n.duration=r,()=>{q.u.releaseEffectData(n)}},[]),createOptimizedDebuffEffect:(0,i.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,i=q.u.acquireEffectData();return i.id=Date.now(),i.playerId=e,i.debuffType=t,i.position.copy(r),i.startTime=Date.now(),i.duration=n,()=>{q.u.releaseEffectData(i)}},[]),getPoolStats:()=>q.u.getStats()};(0,i.useEffect)(()=>{if(e0===F.v.RUNEBLADE){let e=setInterval(()=>{e$(e=>Math.min(150,e+4))},500);return()=>clearInterval(e)}},[e0,150]),(0,i.useEffect)(()=>{e1(tw.currentWeapon)},[tw.currentWeapon]),(0,i.useEffect)(()=>{e0===F.v.RUNEBLADE&&e$(150)},[e0,150]);let tA=(0,i.useCallback)(e=>{console.log("\uD83D\uDD0D DEBUG: consumeMana called - currentWeapon:",e0,"amount:",e),e0===F.v.RUNEBLADE&&e$(t=>{let r=Math.max(0,t-e);return console.log("\uD83D\uDD0D DEBUG: consumeMana - old mana:",t,"new mana:",r),r})},[e0]),tR=(0,i.useCallback)(e=>{console.log("\uD83D\uDD0D DEBUG: hasMana called - currentMana:",eK,"amount:",e);let t=eK>=e;return console.log("\uD83D\uDD0D DEBUG: hasMana result:",t),t},[eK]);return(0,i.useEffect)(()=>{if(!eR)return;let e=e=>{if(e.playerId!==eR.id&&eT.current){var t;if("bow_release"===e.attackType&&(null===(t=e.animationData)||void 0===t?void 0:t.isPerfectShot)){let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=ex.get(e.playerId);tP(t,r,(null==n?void 0:n.subclass)||F.p.ELEMENTAL,!0,!0)}if("viper_sting_projectile"===e.attackType){if(e.playerId===eR.id)return;let t=new a.Vector3(e.position.x,e.position.y,e.position.z),n=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),i=eT.current.getWorld().getSystem(j.c);if(i){let r=e_.current.get(e.playerId)||-Math.abs(1e3*e.playerId.length+Date.now()%1e3);i.createProjectile(eT.current.getWorld(),t,n,r,{speed:16,damage:61,lifetime:5,piercing:!0,opacity:.8,projectileType:"viper_sting"})}let{triggerGlobalViperSting:o}=r(319),s=eq.current.position.clone(),l={...eq.current.quaternion};eq.current.position.copy(t);let c=Math.atan2(n.x,n.z);eq.current.quaternion={x:0,y:Math.sin(c/2),z:0,w:Math.cos(c/2)},o(),setTimeout(()=>{eq.current.position.copy(s),eq.current.quaternion=l},100);return}if("cobra_shot_projectile"===e.attackType){let{triggerGlobalCobraShot:t}=r(7019);t(new a.Vector3(e.position.x,e.position.y,e.position.z),new a.Vector3(e.direction.x,e.direction.y,e.direction.z));return}if("sword_charge_hit"===e.attackType){if(!e.animationData||"number"!=typeof e.animationData.damage||"number"!=typeof e.animationData.targetId)return;e_.current.get((null==eR?void 0:eR.id)||"")===e.animationData.targetId&&eO&&eD&&(null==eR?void 0:eR.id)&&eO.getComponent(p.S)&&eD(eR.id,e.animationData.damage);return}if(["regular_arrow","charged_arrow","entropic_bolt","crossentropy_bolt","perfect_shot","barrage_projectile"].includes(e.attackType)){let t=eT.current.getWorld().getSystem(j.c);if(t){let r=q.u.acquireVector3(e.position.x,e.position.y,e.position.z),n=q.u.acquireVector3(e.direction.x,e.direction.y,e.direction.z),i=e_.current.get(e.playerId)||-Math.abs(1e3*e.playerId.length+Date.now()%1e3);switch(e.attackType){case"regular_arrow":t.createProjectile(eT.current.getWorld(),r,n,i,{speed:25,damage:10,lifetime:3,maxDistance:25,opacity:.8});break;case"charged_arrow":t.createChargedArrowProjectile(eT.current.getWorld(),r,n,i,{speed:35,damage:50,lifetime:3,piercing:!0,opacity:.8});break;case"entropic_bolt":t.createEntropicBoltProjectile(eT.current.getWorld(),r,n,i,{speed:20,damage:20,lifetime:1.75,piercing:!1,opacity:.8});break;case"crossentropy_bolt":t.createCrossentropyBoltProjectile(eT.current.getWorld(),r,n,i,{speed:15,damage:90,lifetime:2.5,piercing:!1,opacity:.8});break;case"perfect_shot":t.createChargedArrowProjectile(eT.current.getWorld(),r,n,i,{speed:40,damage:75,lifetime:3,piercing:!0,opacity:1});break;case"barrage_projectile":let o=t.createProjectile(eT.current.getWorld(),r,n,i,{speed:22,damage:30,lifetime:3,maxDistance:25,piercing:!1,opacity:.8}).getComponent(g.T);(null==o?void 0:o.mesh)&&(o.mesh.userData.isBarrageArrow=!0,o.mesh.userData.isRegularArrow=!1)}q.u.releaseVector3(r),q.u.releaseVector3(n)}}let n=e.animationData||{},i=Date.now();J.VO.batchPlayerStateUpdates(tI,[{playerId:e.playerId,stateUpdate:{isSwinging:e.attackType.includes("swing")||e.attackType.includes("sword")&&!e.attackType.includes("charge"),isCharging:e.attackType.includes("bow")&&e.attackType.includes("charge"),isSpinning:e.attackType.includes("scythe")||e.attackType.includes("entropic_bolt")||e.attackType.includes("crossentropy_bolt")||e.attackType.includes("sword_charge_spin")||n.isSpinning||!1,isSwordCharging:"sword_charge_spin"===e.attackType||"sword_charge_start"===e.attackType||n.isSpinning||n.isSwordCharging||!1,swordComboStep:n.comboStep||1,chargeProgress:n.chargeProgress||0,lastAttackType:e.attackType,lastAttackTime:i,lastAnimationUpdate:i}}]);let o=ex.get(e.playerId),s=(null==o?void 0:o.weapon)||F.v.BOW,l=null==o?void 0:o.subclass,c=100;if("sword_charge_spin"===e.attackType)c=50;else if("sword_charge_start"===e.attackType)c=450;else switch(s){case F.v.SCYTHE:c=l===F.p.ABYSSAL?350:167.5;break;case F.v.SWORD:c=80;break;case F.v.SABRES:c=275;break;case F.v.RUNEBLADE:c=80;break;case F.v.BOW:c=300;break;default:c=100}setTimeout(()=>{J.VO.batchPlayerStateUpdates(tI,[{playerId:e.playerId,stateUpdate:{isSwinging:!1,isCharging:!1,isSpinning:!1,isSwordCharging:!1}}])},c)}},t=e=>{if(e.playerId!==eR.id){if("divine_storm"===e.abilityType){let t=q.u.acquireVector3(e.position.x,e.position.y,e.position.z);(0,X.e6)(t,e.playerId),q.u.releaseVector3(t),J.VO.batchPlayerStateUpdates(tI,[{playerId:e.playerId,stateUpdate:{isDivineStorming:!0,isSpinning:!0,isSwordCharging:!1}}]),setTimeout(()=>{J.VO.batchPlayerStateUpdates(tI,[{playerId:e.playerId,stateUpdate:{isDivineStorming:!1,isSpinning:!1}}])},4e3)}else if("viper_sting"===e.abilityType){if(e.playerId===eR.id)return;let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=eq.current.position.clone(),i={...eq.current.quaternion};eq.current.position.copy(t);let o=Math.atan2(r.x,r.z);eq.current.quaternion={x:0,y:Math.sin(o/2),z:0,w:Math.cos(o/2)},(0,eo.triggerGlobalViperSting)(),setTimeout(()=>{eq.current.position.copy(n),eq.current.quaternion=i},100),tI(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isViperStingCharging:!0,viperStingChargeProgress:1}),setTimeout(()=>{tI(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isViperStingCharging:!1,viperStingChargeProgress:0}),r})},2e3),r})}else if("barrage"===e.abilityType){if(e.playerId===eR.id)return;new a.Vector3(e.position.x,e.position.y,e.position.z),new a.Vector3(e.direction.x,e.direction.y,e.direction.z),tI(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isBarrageCharging:!0,barrageChargeProgress:1}),setTimeout(()=>{tI(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isBarrageCharging:!1,barrageChargeProgress:0}),r})},1500),r})}else if("frost_nova"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z);tv(e.playerId,t)}else if("reanimate"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z);tg(e.playerId,t)}else if("smite"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z);tf(e.playerId,t,void 0)}else if("deathgrasp"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z);t.clone().add(r.clone().multiplyScalar(8)),ty(e.playerId,t,r);let n=null;ex.forEach(i=>{if(i.id===e.playerId)return;let o=new a.Vector3(i.position.x,i.position.y,i.position.z),s=t.distanceTo(o),l=o.clone().sub(t).normalize();r.dot(l)>.5&&s<=8&&(!n||s<n.distance)&&(n={id:i.id,distance:s})}),null!=n&&tx(n.id,t)}else if("charge"===e.abilityType)tI(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isSwordCharging:!0}),setTimeout(()=>{tI(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isSwordCharging:!1}),r})},2e3),r});else if("deflect"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=new a.Vector3(0,Math.atan2(r.x,r.z),0);(0,K.Z0)(t,n,e.playerId),tI(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isDeflecting:!0}),setTimeout(()=>{tI(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isDeflecting:!1}),r})},3e3),r})}else if("skyfall"===e.abilityType)tI(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isSkyfalling:!0}),setTimeout(()=>{tI(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isSkyfalling:!1}),r})},1750),r});else if("backstab"===e.abilityType){let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z);if(tI(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isDeflecting:!1,isSwordCharging:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isBackstabbing:!0}),setTimeout(()=>{tI(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isBackstabbing:!1}),r})},1e3),r}),ex.get(e.playerId)){let n=ex.get((null==eR?void 0:eR.id)||"");if(n&&(null==eR?void 0:eR.id)!==e.playerId){let e=new a.Vector3(n.position.x,n.position.y,n.position.z);if(2.5>=t.distanceTo(e)){let i=new a.Vector3().subVectors(e,t).normalize();if(r.dot(i)>=Math.cos(Math.PI/3)){let r=75,i=new a.Vector3(Math.sin(n.rotation.y),0,Math.cos(n.rotation.y)).normalize(),o=new a.Vector3().subVectors(t,e).normalize();-.3>i.dot(o)&&(r=150),eD&&(null==eR?void 0:eR.id)&&eD(eR.id,r,"backstab")}}}}tI(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isSwinging:!0}),setTimeout(()=>{tI(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isSwinging:!1}),r})},300),r})}}},n=e=>{if(e.targetPlayerId===eR.id&&eO){let t=eO.getComponent(p.S);eO.getComponent(m.W),t&&t.takeDamage(e.damage,Date.now()/1e3,eO)}},i=e=>{e.playerId!==eR.id&&tI(t=>{let r=new Map(t),n={...r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:3,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isBackstabbing:!1},...e.animationState,lastAnimationUpdate:Date.now()};return r.set(e.playerId,n),r})},o=e=>{var t,r;if((null===(t=e.effect)||void 0===t?void 0:t.type)==="venom"){let{targetPlayerId:t,position:r,duration:n}=e.effect;t&&r&&tM(t,new a.Vector3(r.x,r.y,r.z))}if((null===(r=e.effect)||void 0===r?void 0:r.type)==="deathgrasp_pull"){let{targetPlayerId:t,position:r,casterId:n}=e.effect;if(console.log("\uD83C\uDFA3 Received DeathGrasp pull effect for target ".concat(t," from caster ").concat(n)),t===(null==eR?void 0:eR.id)&&r){let e=new a.Vector3(r.x,r.y,r.z);if(console.log("\uD83C\uDFA3 Applying DeathGrasp pull to local player, moving to:",e),eO){let t=eO.getComponent(d.w);t&&(t.setPosition(e.x,e.y,e.z),console.log("\uD83C\uDFA3 Local player position updated via DeathGrasp pull"))}}}},s=e=>{console.log("\uD83C\uDFAF Received PVP player debuff:",e),console.log('\uD83D\uDD0D Debug: My socket ID is "'.concat(null==eR?void 0:eR.id,'", target is "').concat(e.targetPlayerId,'", am I the target? ').concat((null==eR?void 0:eR.id)===e.targetPlayerId));let{targetPlayerId:t,debuffType:r,duration:n,effectData:i}=e;if(t&&r&&n){let e;if(t===(null==eR?void 0:eR.id)&&eO){let t=eO.getComponent(d.w);e=t?t.position.clone():eL.clone()}else{let r=ex.get(t);e=r?new a.Vector3(r.position.x,r.position.y,r.position.z):(null==i?void 0:i.position)?new a.Vector3(i.position.x,i.position.y,i.position.z):new a.Vector3(0,0,0)}tp(t,r,e,n)}};return eR.on("player-attacked",e),eR.on("player-used-ability",t),eR.on("player-damaged",n),eR.on("player-animation-state",i),eR.on("player-effect",o),eR.on("player-debuff",s),()=>{eR.off("player-attacked",e),eR.off("player-used-ability",t),eR.off("player-damaged",n),eR.off("player-animation-state",i),eR.off("player-effect",o),eR.off("player-debuff",s)}},[eR,eO]),(0,i.useEffect)(()=>{let e=setInterval(()=>{tI(e=>{let t=new Map(e),r=Date.now(),n=!1;return t.forEach((e,i)=>{e.lastAnimationUpdate&&r-e.lastAnimationUpdate>3e3&&(e.isSwinging||e.isCharging||e.isSpinning)&&(console.log("\uD83D\uDD27 Force resetting stuck animation for player ".concat(i)),t.set(i,{...e,isSwinging:!1,isCharging:!1,isSpinning:!1}),n=!0)}),n?t:e})},1e3);return()=>clearInterval(e)},[]),(0,i.useEffect)(()=>{if(!eT.current||!eM)return;let e=eT.current.getWorld();ex.forEach((t,r)=>{if(r!==(null==eR?void 0:eR.id)){if(e_.current.has(r)){let n=e_.current.get(r),i=e.getEntity(n);if(i){let e=i.getComponent(d.w),r=i.getComponent(v.K);if(e&&r){let e=new a.Quaternion;e.setFromEuler(new a.Euler(t.rotation.x,t.rotation.y,t.rotation.z));let n=new a.Vector3(t.position.x,t.position.y,t.position.z);r.addServerState(n,e)}else e&&e.setPosition(t.position.x,t.position.y,t.position.z);let n=i.getComponent(h.i);n&&(n.velocity.set(0,0,0),n.acceleration.set(0,0,0));let o=i.getComponent(p.S);o&&(o.maxHealth=t.maxHealth,o.currentHealth=t.health)}else console.warn("⚠️ Could not find local ECS entity ".concat(n," for PVP player ").concat(r))}else{let n=e.createEntity(),i=e.createComponent(d.w);i.setPosition(t.position.x,t.position.y,t.position.z),n.addComponent(i);let o=e.createComponent(v.K);n.addComponent(o);let a=new p.S(t.maxHealth);a.currentHealth=t.health,n.addComponent(a);let s=new m.W(100,20,5);n.addComponent(s);let l=e.createComponent(h.i);l.maxSpeed=3.75,l.jumpForce=8,l.friction=.85,l.canMove=!1,n.addComponent(l);let c=e.createComponent(f.YM);c.type=f.F5.SPHERE,c.radius=.9,c.layer=f.aB.ENEMY,c.setMask(f.aB.ENVIRONMENT),c.setOffset(0,.25,0),n.addComponent(c),e.notifyEntityAdded(n),e_.current.set(r,n.id)}}});let t=new Set(ex.keys()),r=[];e_.current.forEach((n,i)=>{if(!t.has(i)||i===(null==eR?void 0:eR.id)){let t=e.getEntity(n);if(t){let e=t.getComponent(p.S);e&&(e.currentHealth=0,e.isDead=!0),console.log("\uD83D\uDC80 Marked local ECS entity ".concat(n," as dead for disconnected player ").concat(i))}r.push(i)}}),r.forEach(e=>{e_.current.delete(e)}),ev.forEach((t,r)=>{if(eZ.current.has(r)){let n=eZ.current.get(r),i=e.getEntity(n);if(i){let e=i.getComponent(p.S);e&&(e.maxHealth=t.maxHealth,e.currentHealth=t.health,t.isDead&&!e.isDead&&(e.currentHealth=0,e.isDead=!0));let r=i.getComponent(y.N);r&&t.isDead&&!r.isDead&&r.die(Date.now()/1e3)}else console.warn("⚠️ Could not find local ECS entity ".concat(n," for tower ").concat(r))}else{let n=e.createEntity(),i=e.createComponent(d.w);i.setPosition(t.position.x,t.position.y,t.position.z),n.addComponent(i);let o=e.createComponent(y.N);o.ownerId=t.ownerId,o.towerIndex=t.towerIndex,n.addComponent(o);let a=new p.S(t.maxHealth);a.currentHealth=t.health,n.addComponent(a);let s=e.createComponent(f.YM);s.type=f.F5.CYLINDER,s.radius=1.5,s.height=4,s.layer=f.aB.ENEMY,s.setMask(f.aB.ENVIRONMENT|f.aB.PLAYER),s.setOffset(0,2,0),n.addComponent(s),e.notifyEntityAdded(n),eZ.current.set(r,n.id)}});let n=new Set(ev.keys()),i=[];eZ.current.forEach((t,r)=>{if(!n.has(r)){let n=e.getEntity(t);if(n){let e=n.getComponent(p.S),i=n.getComponent(y.N);e&&i&&(e.currentHealth=0,e.isDead=!0,i.die(Date.now()/1e3)),console.log("\uD83D\uDC80 Marked local ECS entity ".concat(t," as dead for removed tower ").concat(r))}i.push(r)}}),i.forEach(e=>{eZ.current.delete(e)})},[ex,ev,eM,null==eR?void 0:eR.id]),(0,i.useEffect)(()=>{ez.current&&(null==eR?void 0:eR.id)&&ez.current.setPlayerMapping(e_.current,eR.id)},[ex,null==eR?void 0:eR.id]),(0,i.useEffect)(()=>{if(eN.current||!eM)return;eN.current=!0,(0,er.j4)(0),(0,er.Ge)(0);let e=new c.D({enableDebug:!0});eT.current=e;let t=ef.domElement;return e.initialize(t).then(()=>{let{player:t,controlSystem:r,towerSystem:n,summonedUnitSystem:i}=function(e,t,r,n,i,o){let s=e.getWorld(),l=e.getInputManager();n.shadowMap.enabled=!0,n.shadowMap.type=a.PCFSoftShadowMap;let c=new C.F,u=new b.s(5),g=new I.b(s),y=new M.K(t,r,n),x=new j.c(s),v=new P.R(s),F=new D.J(s),A=new S.s(r,l,s,x),R=new w.D(r,l,{distance:8,height:2,mouseSensitivity:.005,smoothing:.15}),T=new E.Z;x.setCombatSystem(g),v.setProjectileSystem(x),F.setCombatSystem(g),g.setPlayerDamageCallback(i),s.addSystem(c),s.addSystem(u),s.addSystem(g),s.addSystem(T),s.addSystem(y),s.addSystem(x),s.addSystem(v),s.addSystem(F),s.addSystem(A),s.addSystem(R);let B=function(e){let t=e.createEntity(),r=e.createComponent(d.w);r.setPosition(0,.5,0),t.addComponent(r);let n=e.createComponent(h.i);n.maxSpeed=3.75,n.jumpForce=8,n.friction=.85,t.addComponent(n);let i=ea.a.getMaxHealthForLevel(1),o=new p.S(i);o.enableRegeneration(2,5),t.addComponent(o);let a=new m.W(250,20,2);t.addComponent(a);let s=e.createComponent(f.YM);return s.type=f.F5.SPHERE,s.radius=1.2,s.layer=f.aB.PLAYER,s.setMask(f.aB.ENVIRONMENT),s.setOffset(0,.5,0),t.addComponent(s),console.log("\uD83D\uDC64 PVP player entity created with components:",{transform:!!t.getComponent(d.w),movement:!!t.getComponent(h.i),health:!!t.getComponent(p.S),shield:!!t.getComponent(m.W),collider:!!t.getComponent(f.YM)}),t.getComponent(f.YM),t}(s);return A.setPlayer(B),R.setTarget(B),R.snapToTarget(),console.log("\uD83C\uDF0D Total entities in PVP world:",s.getAllEntities().length),console.log("\uD83D\uDC64 Player entity created with ID: ".concat(B.id)),{player:B,controlSystem:A,towerSystem:v,summonedUnitSystem:F}}(e,em,eg,ef,(e,t)=>{let r=parseInt(e),n=null;e_.current.forEach((e,t)=>{e===r&&(n=t)}),n?(console.log("\uD83C\uDFAF Mapping local entity ".concat(e," to server player ").concat(n," for ").concat(t," PVP damage")),eD(n,t)):console.warn("⚠️ Could not find server player ID for local entity ".concat(e))},0);console.log("\uD83C\uDFAE PVP Player entity created:",t,"ID:",t.id),eU(t),eB.current=t.id,ek.current=r,ez.current=n,eV.current=i,n&&(null==eR?void 0:eR.id)&&n.setPlayerMapping(e_.current,eR.id),i&&i.setWaveCompleteCallback(tS),eh&&eh(r),r.setBowReleaseCallback((t,n)=>{if(eO){let e=eO.getComponent(d.w);if(e){let r=new a.Vector3;eg.getWorldDirection(r),r.normalize(),eb("bow_release",e.position,r,{chargeProgress:t,isPerfectShot:n})}}if(n){let t=e.getWorld().getEntity(eB.current);if(t){let e=t.getComponent(d.w);if(e){let t=new a.Vector3;eg.getWorldDirection(t),t.normalize();let n=new a.Vector3;n.crossVectors(t,new a.Vector3(0,1,0)).normalize();let i=new a.Matrix4;i.makeRotationAxis(n,Math.PI/12),t.applyMatrix4(i),t.normalize(),tP(e.position.clone(),t,r.getCurrentSubclass(),!0,!0)}}}}),r.setDivineStormCallback((e,t,r)=>{console.log("⚡ PVP Divine Storm activated - broadcasting to other players"),(0,X.e6)(e,null==eR?void 0:eR.id,r),eI("divine_storm",e,t)}),r.setViperStingCallback((e,t)=>{eI("viper_sting",e,t)}),r.setBarrageCallback((e,t)=>{eI("barrage",e,t)}),r.setFrostNovaCallback((e,t)=>{eI("frost_nova",e,t)}),r.setCobraShotCallback((e,t)=>{}),r.setChargeCallback((e,t)=>{eI("charge",e,t),eb("sword_charge_start",e,t,{isSwordCharging:!0})}),r.setSkyfallCallback((e,t)=>{console.log("\uD83C\uDF1F PVP Skyfall triggered - broadcasting to other players"),eI("skyfall",e,t)}),r.setBackstabCallback((e,t,r,n)=>{console.log("\uD83D\uDDE1️ PVP Backstab triggered - broadcasting to other players (damage: ".concat(r,", backstab: ").concat(n,")")),eI("backstab",e,t)}),r.setSunderCallback((e,t,r,n)=>{console.log("⚔️ PVP Sunder triggered - broadcasting to other players (damage: ".concat(r,", stacks: ").concat(n,")")),eI("sunder",e,t)}),console.log("\uD83D\uDD27 Debug: Setting up debuff callback for ControlSystem"),r.setDebuffCallback((e,t,r,n)=>{console.log("\uD83C\uDFAF PVP Debuff callback triggered - ".concat(t," effect on entity ").concat(e));let i=null;e_.current.forEach((t,r)=>{t===e&&(i=r)}),i&&eF?(console.log("\uD83C\uDFAF Broadcasting ".concat(t," effect to player ").concat(i)),eF(i,t,r,{position:{x:n.x,y:n.y,z:n.z}})):console.warn("⚠️ Could not find server player ID for local entity ".concat(e))}),r.setProjectileCreatedCallback((e,t,n,i)=>{let o={};(e.includes("arrow")||e.includes("bolt"))&&(o.chargeProgress=r.getChargeProgress()),eb(e,t,n,o)}),r.setReanimateCallback(()=>{if(eG.current&&eG.current.triggerHealingEffect(),t){let e=t.getComponent(d.w);if(e){let t=new a.Vector3;eg.getWorldDirection(t),t.normalize(),eI("reanimate",e.position,t)}}}),r.setSmiteCallback((e,t,r)=>{console.log("\uD83D\uDD0D DEBUG: Smite callback triggered in PVP mode"),tf((null==eR?void 0:eR.id)||"",e,r),eI("smite",e,t)}),r.setDeathGraspCallback((e,t)=>{console.log("\uD83D\uDD0D DEBUG: DeathGrasp callback triggered in PVP mode"),ty((null==eR?void 0:eR.id)||"",e,t),eI("deathgrasp",e,t)}),r.setConsumeManaCallback(tA),r.setCheckManaCallback(tR),e.start()}),()=>{eT.current&&eT.current.destroy(),J.$h.clear()}},[em,eg,ef,eM]),(0,i.useEffect)(()=>{window.pvpPlayers=ex,window.localSocketId=null==eR?void 0:eR.id,window.serverPlayerEntities=e_,window.multiplayer={broadcastPlayerEffect:eE},window.getInterpolationStats=()=>{if(!eT.current)return{error:"Engine not initialized"};let e=eT.current.getWorld(),t=e.getSystem(E.Z);if(!t)return{error:"InterpolationSystem not found"};let r={};return e_.current.forEach((n,i)=>{let o=e.getEntity(n);o&&(r[i]=t.getInterpolationStats(o))}),r},window.testInterpolationMethods=()=>(console.log("\uD83E\uDDEE Available Interpolation Methods:"),console.log("1. Linear Interpolation (LERP) - Currently used"),console.log("2. Hermite Spline - Smoother curves with velocity"),console.log("3. Catmull-Rom Spline - Smooth curves through waypoints"),console.log("4. Cubic Bezier - Custom control point curves"),console.log("5. Smooth Step - Easing functions"),console.log("6. Smoother Step - Even smoother easing"),console.log("\n\uD83D\uDCCA Current Interpolation Stats:"),console.log(window.getInterpolationStats()),"Interpolation methods available in InterpolationSystem class")},[ex,null==eR?void 0:eR.id]),(0,o.F)((e,t)=>{if(eT.current&&eT.current.isEngineRunning()&&eM){(function(e){let t=document.getElementById("fps-counter");t&&(t.textContent="FPS: ".concat(e))})(eT.current.getCurrentFPS()),q.u.resetFrameTemporaries();let e=[];if(eO){let t=eO.getComponent(d.w);if(t&&t.position){let r=t.position.clone();e.push({setter:eH,value:r}),eq.current.position.copy(r);let n=new a.Vector3;eg.getWorldDirection(n);let i=Math.atan2(n.x,n.z);eq.current.quaternion={x:0,y:Math.sin(i/2),z:0,w:Math.cos(i/2)},ew(t.position,{x:0,y:i,z:0})}}if(ek.current){let t={currentWeapon:ek.current.getCurrentWeapon(),currentSubclass:ek.current.getCurrentSubclass(),isCharging:ek.current.isWeaponCharging(),chargeProgress:ek.current.getChargeProgress(),isSwinging:ek.current.isWeaponSwinging(),isSpinning:ek.current.isWeaponCharging()&&ek.current.getCurrentWeapon()===F.v.SCYTHE,swordComboStep:ek.current.getSwordComboStep(),isDivineStorming:ek.current.isDivineStormActive(),isSwordCharging:ek.current.isChargeActive(),isDeflecting:ek.current.isDeflectActive(),isViperStingCharging:ek.current.isViperStingChargingActive(),viperStingChargeProgress:ek.current.getViperStingChargeProgress(),isBarrageCharging:ek.current.isBarrageChargingActive(),barrageChargeProgress:ek.current.getBarrageChargeProgress(),isCobraShotCharging:ek.current.isCobraShotChargingActive(),cobraShotChargeProgress:ek.current.getCobraShotChargeProgress(),isSkyfalling:ek.current.isSkyfallActive(),isBackstabbing:ek.current.isBackstabActive(),isSundering:ek.current.isSunderActive()},r=tC.current;(t.currentWeapon!==r.weapon||t.currentSubclass!==r.subclass)&&(ej(t.currentWeapon,t.currentSubclass),tC.current={weapon:t.currentWeapon,subclass:t.currentSubclass}),e.push({setter:tj,value:t});let n=Date.now();if(n-eW.current>100){let e=t.currentWeapon===F.v.SCYTHE&&t.isCharging,r=t.isDivineStorming||t.isSwordCharging;eP({isCharging:t.isCharging,chargeProgress:t.chargeProgress,isSwinging:t.isSwinging,swordComboStep:t.swordComboStep,isDivineStorming:t.isDivineStorming,isSpinning:e||r,isDeflecting:t.isDeflecting,isSwordCharging:t.isSwordCharging,isViperStingCharging:t.isViperStingCharging,viperStingChargeProgress:t.viperStingChargeProgress,isBarrageCharging:t.isBarrageCharging,barrageChargeProgress:t.barrageChargeProgress,isBackstabbing:t.isBackstabbing}),eW.current=n}}let t=eT.current.getWorld().getSystem(I.b);if(t&&el&&el(t.getDamageNumbers()),eu&&eu(eg,ey),Date.now()%1e4<16&&console.log("\uD83D\uDD27 PVP Performance Stats:",{objectPool:tF(),stateBatcher:J.$h.getStats()}),ed&&eO&&ek.current){let e=eO.getComponent(p.S),t=eO.getComponent(m.W);e&&(ed({playerHealth:e.currentHealth,maxHealth:e.maxHealth,playerShield:t?t.currentShield:0,maxShield:t?t.maxShield:0,currentWeapon:ek.current.getCurrentWeapon(),currentSubclass:ek.current.getCurrentSubclass(),mana:e0===F.v.RUNEBLADE?eK:150,maxMana:(F.v.RUNEBLADE,150)}),eC(e.currentHealth,e.maxHealth))}e.length>0&&J.VO.batchGameStateUpdates(e)}}),i.useEffect(()=>{ec&&(window.handleDamageNumberComplete=e=>{var t;let r=null===(t=eT.current)||void 0===t?void 0:t.getWorld().getSystem(I.b);r&&r.removeDamageNumber(e)})},[ec]),(0,n.jsx)(n.Fragment,{children:eM?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(en.Z,{level:1,world:null===(e=eT.current)||void 0===e?void 0:e.getWorld()}),(0,n.jsx)("ambientLight",{intensity:.3}),(0,n.jsx)("directionalLight",{position:[10,10,5],intensity:.5,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),(0,n.jsxs)("mesh",{receiveShadow:!0,position:[0,-.5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[29,29,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#2d5a2d"})]}),(0,n.jsxs)("mesh",{position:[0,.01,0],scale:[2.5,2.5,2.5],children:[(0,n.jsx)("ringGeometry",{args:[25,29,64]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6b6b",transparent:!0,opacity:.3})]}),eO&&eT.current&&eR&&(0,n.jsx)(s.Z,{entityId:eO.id,position:eL,world:eT.current.getWorld(),currentWeapon:tw.currentWeapon,currentSubclass:tw.currentSubclass,isCharging:tw.isCharging,chargeProgress:tw.chargeProgress,isSwinging:tw.isSwinging,isSpinning:tw.isSpinning,swordComboStep:tw.swordComboStep,isDivineStorming:tw.isDivineStorming,isSwordCharging:tw.isSwordCharging,isDeflecting:tw.isDeflecting,isViperStingCharging:tw.isViperStingCharging,viperStingChargeProgress:tw.viperStingChargeProgress,isBarrageCharging:tw.isBarrageCharging,barrageChargeProgress:tw.barrageChargeProgress,isCobraShotCharging:tw.isCobraShotCharging,cobraShotChargeProgress:tw.cobraShotChargeProgress,isSkyfalling:tw.isSkyfalling,isBackstabbing:tw.isBackstabbing,isSundering:tw.isSundering,isSmiting:(null===(t=ek.current)||void 0===t?void 0:t.isSmiteActive())||!1,isDeathGrasping:(null===(U=ek.current)||void 0===U?void 0:U.isDeathGraspActive())||!1,reanimateRef:eG,isLocalPlayer:!0,onBowRelease:()=>{},onScytheSwingComplete:()=>{let e=new a.Vector3;eg.getWorldDirection(e),e.normalize(),eb("scythe_swing",eL,e,{isSpinning:!0})},onSwordSwingComplete:()=>{var e;null===(e=ek.current)||void 0===e||e.onSwordSwingComplete();let t=new a.Vector3;eg.getWorldDirection(t),t.normalize(),eb("sword_swing",eL,t,{comboStep:tw.swordComboStep})},onSabresSwingComplete:()=>{var e;null===(e=ek.current)||void 0===e||e.onSabresSwingComplete();let t=new a.Vector3;eg.getWorldDirection(t),t.normalize(),eb("sabres_swing",eL,t)},onChargeComplete:()=>{var e;null===(e=ek.current)||void 0===e||e.onChargeComplete();let t=new a.Vector3;eg.getWorldDirection(t),t.normalize(),eb("sword_charge_spin",eL,t,{isSpinning:!0})},onDeflectComplete:()=>{var e;null===(e=ek.current)||void 0===e||e.onDeflectComplete()},onBackstabComplete:()=>{},onSunderComplete:()=>{},onSmiteComplete:()=>{var e;null===(e=ek.current)||void 0===e||e.onSmiteComplete()},onDeathGraspComplete:()=>{var e;null===(e=ek.current)||void 0===e||e.onDeathGraspComplete()}}),Array.from(ex.values()).map(e=>{var t;if(e.id===(null==eR?void 0:eR.id))return null;let r=tb.get(e.id)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return(0,n.jsx)(s.Z,{entityId:parseInt(e.id.replace(/\D/g,"0")),position:new a.Vector3(e.position.x,e.position.y,e.position.z),world:(null===(t=eT.current)||void 0===t?void 0:t.getWorld())||new u.q,currentWeapon:e.weapon,currentSubclass:e.subclass,isCharging:r.isCharging,chargeProgress:r.chargeProgress,isSwinging:r.isSwinging,isSpinning:r.isSpinning,swordComboStep:r.swordComboStep,isDivineStorming:r.isDivineStorming,isSwordCharging:r.isSwordCharging,isDeflecting:r.isDeflecting,isViperStingCharging:r.isViperStingCharging,viperStingChargeProgress:r.viperStingChargeProgress,isBarrageCharging:r.isBarrageCharging,barrageChargeProgress:r.barrageChargeProgress,isCobraShotCharging:r.isCobraShotCharging,cobraShotChargeProgress:r.cobraShotChargeProgress,isSkyfalling:r.isSkyfalling,isBackstabbing:r.isBackstabbing,rotation:e.rotation,isLocalPlayer:!1,onBowRelease:()=>{},onScytheSwingComplete:()=>{},onSwordSwingComplete:()=>{}},e.id)}),Array.from(ev.values()).map(e=>{var t;return(0,n.jsx)(ee,{entityId:parseInt(e.id.replace(/\D/g,"0")),world:(null===(t=eT.current)||void 0===t?void 0:t.getWorld())||new u.q,position:new a.Vector3(e.position.x,e.position.y,e.position.z),ownerId:e.ownerId,towerIndex:e.towerIndex,health:e.health,maxHealth:e.maxHealth,isDead:e.isDead,camera:eg},e.id)}),eT.current&&(()=>{let e=eT.current.getWorld();return e.queryEntities([d.w,x.a,p.S]).map(t=>{let r=t.getComponent(d.w),i=t.getComponent(x.a),o=t.getComponent(p.S);return r&&i&&o&&!i.isDead&&!o.isDead?(0,n.jsx)(et,{entityId:t.id,world:e,position:r.position,ownerId:i.ownerId,health:o.currentHealth,maxHealth:i.maxHealth,isDead:i.isDead},i.unitId):null}).filter(Boolean)})(),Array.from(ex.values()).map(e=>{if(e.id===(null==eR?void 0:eR.id))return null;let t=e_.current.get(e.id),r=0,i=200;if(t&&eT.current){let e=eT.current.getWorld().getEntity(t);if(e){let t=e.getComponent(m.W);t&&(r=t.currentShield,i=t.maxShield)}}return(0,n.jsx)($,{playerId:e.id,playerName:e.name,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,maxHealth:e.maxHealth,shield:r,maxShield:i,camera:eg,showDistance:35},"healthbar-".concat(e.id))}),eT.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(B.Z,{world:eT.current.getWorld()}),(0,n.jsx)(k.Z,{}),(0,n.jsx)(z.default,{world:eT.current.getWorld()}),(0,n.jsx)(V.ZP,{world:eT.current.getWorld()}),(0,n.jsx)(N.default,{world:eT.current.getWorld()}),(0,n.jsx)(X.ZP,{enemyData:Array.from(ex.values()).filter(e=>e.id!==(null==eR?void 0:eR.id)).map(e=>({id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health})),onHitTarget:(e,t)=>{eD&&eD(e,t)},playerId:null==eR?void 0:eR.id}),(0,n.jsx)(K.ZP,{}),(0,n.jsx)(_,{world:eT.current.getWorld(),players:Array.from(ex.values()),serverPlayerEntities:e_,localSocketId:null==eR?void 0:eR.id,onPlayerHit:(e,t)=>{if(e===(null==eR?void 0:eR.id)){console.log("⚠️ Skipping Cobra Shot damage to local player ".concat(null==eR?void 0:eR.id));return}eD&&(console.log("\uD83C\uDFAF Broadcasting Cobra Shot damage to player ".concat(e," (NOT local player ").concat(null==eR?void 0:eR.id,")")),eD(e,t))},onPlayerVenomed:(e,t)=>{if(e===(null==eR?void 0:eR.id)){console.log("⚠️ Skipping Cobra Shot venom effect on local player ".concat(null==eR?void 0:eR.id));return}let r=t.clone();tM(e,r),eE&&(console.log("\uD83C\uDFAF Broadcasting Cobra Shot venom effect to player ".concat(e," (NOT local player ").concat(null==eR?void 0:eR.id,")")),eE({type:"venom",targetPlayerId:e,position:{x:r.x,y:r.y,z:r.z},duration:6e3}))}}),(0,n.jsx)(Z,{world:eT.current.getWorld(),players:Array.from(ex.values()),serverPlayerEntities:e_,localSocketId:null==eR?void 0:eR.id,onPlayerHit:(e,t)=>{if(e===(null==eR?void 0:eR.id)){console.log("⚠️ Skipping Barrage damage to local player ".concat(null==eR?void 0:eR.id));return}eD&&(console.log("\uD83C\uDFAF Broadcasting Barrage damage to player ".concat(e," (NOT local player ").concat(null==eR?void 0:eR.id,")")),eD(e,t))},onPlayerSlowed:(e,t)=>{if(e===(null==eR?void 0:eR.id)){console.log("⚠️ Skipping Barrage slow effect on local player ".concat(null==eR?void 0:eR.id));return}let r=t.clone();tp(e,"slowed",r,5e3),eF&&(console.log("\uD83C\uDFAF Broadcasting Barrage slow effect to player ".concat(e," (NOT local player ").concat(null==eR?void 0:eR.id,")")),eF(e,"slowed",5e3,{position:{x:r.x,y:r.y,z:r.z},speedMultiplier:.5}))}}),(0,n.jsx)(Y,{world:eT.current.getWorld(),players:Array.from(ex.values()),serverPlayerEntities:e_,localSocketId:null==eR?void 0:eR.id,onPlayerHit:(e,t)=>{if(e===(null==eR?void 0:eR.id)){console.log("⚠️ Skipping Frost Nova damage to local player ".concat(null==eR?void 0:eR.id));return}eD&&(console.log("\uD83C\uDFAF Broadcasting Frost Nova damage to player ".concat(e," (NOT local player ").concat(null==eR?void 0:eR.id,")")),eD(e,t))},onPlayerFrozen:(e,t)=>{if(e===(null==eR?void 0:eR.id)){console.log("⚠️ Skipping Frost Nova frozen effect on local player ".concat(null==eR?void 0:eR.id));return}tm(e,t.clone())}}),(0,n.jsx)(Q,{world:eT.current.getWorld(),players:Array.from(ex.values()),serverPlayerEntities:e_,localSocketId:null==eR?void 0:eR.id,onPlayerHit:(e,t)=>{if(e===(null==eR?void 0:eR.id)){console.log("⚠️ Skipping Viper Sting damage to local player ".concat(null==eR?void 0:eR.id));return}eD&&(console.log("\uD83C\uDFAF Broadcasting Viper Sting damage to player ".concat(e," (NOT local player ").concat(null==eR?void 0:eR.id,")")),eD(e,t))},onPlayerVenomed:(e,t)=>{if(e===(null==eR?void 0:eR.id)){console.log("⚠️ Skipping Viper Sting venom effect on local player ".concat(null==eR?void 0:eR.id));return}tM(e,t.clone())}}),e2.map(e=>{let t=ex.get(e.playerId),r=t?new a.Vector3(t.position.x,t.position.y,t.position.z):e.position;return(0,n.jsx)(es,{position:r,onComplete:()=>{e5(t=>t.filter(t=>t.id!==e.id))}},e.id)}),e8.map(e=>{let t=Array.from(ex.entries()).filter(t=>{let[r]=t;return r!==e.playerId}).map(e=>{let[t,r]=e;return{id:t,position:new a.Vector3(r.position.x,r.position.y,r.position.z),health:r.health}});return(0,n.jsx)(A.Z,{weaponType:F.v.RUNEBLADE,position:e.position,onComplete:()=>{e4(t=>t.filter(t=>t.id!==e.id))},onHit:(e,t)=>{eD(e,t,"smite")},enemyData:t,onDamageDealt:e.onDamageDealt||(e=>{if(e&&eO){let e=eO.getComponent(p.S);if(e){let t=e.currentHealth;e.heal(20)&&console.log("⚡ Smite (PVP visual fallback) healed player for 20 HP! Health: ".concat(t," -> ").concat(e.currentHealth,"/").concat(e.maxHealth))}}})},e.id)}),e7.map(e=>{let t;if(e.playerId===(null==eR?void 0:eR.id)&&eO){let r=eO.getComponent(d.w);if(r)t=r.position.clone();else{let r=ex.get(e.playerId);t=r?new a.Vector3(r.position.x,r.position.y,r.position.z):e.startPosition}}else{let r=ex.get(e.playerId);t=r?new a.Vector3(r.position.x,r.position.y,r.position.z):e.startPosition}return(0,n.jsx)(R,{startPosition:t,direction:e.direction,casterId:e.playerId,onHit:(e,r)=>{console.log("\uD83C\uDFAF DeathGrasp hit target: ".concat(e," at position:"),r),console.log("\uD83C\uDFAF DeathGrasp caster position:",t),console.log("\uD83C\uDFAF DeathGrasp creating pull effect for target ".concat(e)),tx(e,t)},onComplete:()=>{e9(t=>t.filter(t=>t.id!==e.id))},players:ex,localSocketId:null==eR?void 0:eR.id},e.id)}),tt.map(e=>e.isActive?(0,n.jsx)(T,{targetPlayerId:e.targetPlayerId,casterPosition:e.casterPosition,isActive:e.isActive,onComplete:()=>{tr(t=>t.map(t=>t.id===e.id?{...t,isActive:!1}:t))},playerEntities:e_,getEntityPosition:e=>{var t;let r=null===(t=eT.current)||void 0===t?void 0:t.getWorld();if(!r)return null;let n=r.getEntity(e);if(!n)return null;let i=n.getComponent(d.w);return i?i.position:null},updateEntityPosition:(e,t)=>{var r;let n=null===(r=eT.current)||void 0===r?void 0:r.getWorld();if(!n)return;let i=n.getEntity(e);if(!i)return;let o=i.getComponent(d.w);o&&o.setPosition(t.x,t.y,t.z)}},e.id):null),tu.map(e=>{let t=ex.get(e.playerId),r=t?new a.Vector3(t.position.x,t.position.y,t.position.z):e.position;return(0,n.jsx)(G.Z,{position:r,duration:e.duration,startTime:e.startTime,onComplete:()=>{td(t=>t.filter(t=>t.id!==e.id))}},e.id)}),ti.map(e=>{let t=ex.get(e.playerId),r=t?new a.Vector3(t.position.x,t.position.y,t.position.z):e.position;return(0,n.jsx)(W.Z,{position:r,duration:e.duration,startTime:e.startTime,enemyId:e.playerId,enemyData:Array.from(ex.values()).filter(e=>e.id!==(null==eR?void 0:eR.id)).map(e=>({id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,isDying:!1})),onComplete:()=>{to(t=>t.filter(t=>t.id!==e.id))}},e.id)}),ts.map(e=>{let t;let r=ex.get(e.playerId);if(e.playerId===(null==eR?void 0:eR.id)&&eO){let e=eO.getComponent(d.w);t=e?new a.Vector3(e.position.x,e.position.y+.5,e.position.z):new a.Vector3(eL.x,eL.y+.5,eL.z)}else t=r?new a.Vector3(r.position.x,r.position.y+.5,r.position.z):new a.Vector3(e.position.x,e.position.y+.5,e.position.z);return"frozen"===e.debuffType?(0,n.jsx)(H.Z,{position:t,duration:e.duration,startTime:e.startTime,enemyId:e.playerId,enemyData:Array.from(ex.values()).filter(e=>e.id!==(null==eR?void 0:eR.id)).map(e=>{if(e.id!==(null==eR?void 0:eR.id)||!eO)return{id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,isDying:!1};{let t=eO.getComponent(d.w),r=t?t.position:eL;return{id:e.id,position:r.clone(),health:e.health,isDying:!1}}}),onComplete:()=>{tl(t=>t.filter(t=>t.id!==e.id))}},e.id):"stunned"===e.debuffType?(0,n.jsx)(O.Z,{position:t,duration:e.duration,startTime:e.startTime,enemyId:e.playerId,enemyData:Array.from(ex.values()).filter(e=>e.id!==(null==eR?void 0:eR.id)).map(e=>{if(e.id!==(null==eR?void 0:eR.id)||!eO)return{id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,isDying:!1};{let t=eO.getComponent(d.w),r=t?t.position:eL;return{id:e.id,position:r.clone(),health:e.health,isDying:!1}}}),onComplete:()=>{tl(t=>t.filter(t=>t.id!==e.id))}},e.id):(0,n.jsx)(L,{position:t,debuffType:e.debuffType,duration:e.duration,startTime:e.startTime,onComplete:()=>{tl(t=>t.filter(t=>t.id!==e.id))}},e.id)})]})]}):null})}es.displayName="PVPReanimateEffect"},3625:function(e,t,r){r.d(t,{Z:function(){return B}});var n=r(7437),i=r(2265),o=r(1448),a=r(1276);let s=i.memo(()=>{let e=(0,i.useRef)(null),t=(0,i.useMemo)(()=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,n.jsxs)("group",{position:[0,e,0],scale:t,children:[(0,n.jsxs)("group",{rotation:[0,0,-Math.PI/3],children:[(0,n.jsxs)("mesh",{position:[.085,.05,.08],rotation:[.3,Math.PI/2,-.5],children:[(0,n.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,0,-.1],children:[(0,n.jsx)("sphereGeometry",{args:[.0375,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("group",{rotation:[0,0,Math.PI/3],children:[(0,n.jsxs)("mesh",{position:[-.085,.05,.08],rotation:[.3,-Math.PI/2,0],children:[(0,n.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.3,-.15,0],children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.05,.075,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]})},[]),r=(0,i.useMemo)(()=>()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.9,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.3,-.15,0,.15,.3].map((e,t)=>(0,n.jsxs)("group",{position:[0,e,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.06,.04,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,0,-.125],children:[(0,n.jsx)("boxGeometry",{args:[.0175,.06,.075]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]},t))]}),[]);return(0,n.jsx)("group",{ref:e,position:[0,.04,-0],rotation:[.25,Math.PI+Math.PI,0],children:(0,n.jsxs)("group",{children:[r(),(0,n.jsxs)("group",{position:[0,0,0],children:[t(.45,.7),t(.3,.8),t(.15,.9),t(0,1),t(-.15,.9),t(-.3,.8),t(-.45,.7)]})]})})});s.displayName="BonePlate";let l=i.memo(e=>{let{isLeftWing:t,isDashing:r}=e,s=(0,i.useRef)(null),[l,c]=(0,i.useState)(!1),[u,d]=(0,i.useState)(0),h=(0,i.useRef)([]),p=(0,i.useMemo)(()=>[{pos:new o.Vector3(t?-.3:.3,.275,0),rot:new o.Euler(0,0,t?-Math.PI/5:Math.PI/5),scale:1.2},{pos:new o.Vector3(t?-.5:.5,.45,0),rot:new o.Euler(0,0,t?-Math.PI/3.5:Math.PI/3.5),scale:1.4},{pos:new o.Vector3(t?-.65:.65,.6,0),rot:new o.Euler(0,0,t?-Math.PI/2.5:Math.PI/2.5),scale:1},{pos:new o.Vector3(t?-.85:.85,.72,.1),rot:new o.Euler(.1,0,t?-Math.PI/2.2:Math.PI/2.2),scale:1},{pos:new o.Vector3(t?-1.05:1.05,.8,.2),rot:new o.Euler(.2,0,t?-Math.PI/2:Math.PI/2),scale:.9},{pos:new o.Vector3(t?-1.2:1.2,.9,.2),rot:new o.Euler(.2,0,t?-Math.PI/1.8:Math.PI/1.8),scale:.8},{pos:new o.Vector3(t?-1.3:1.3,.75,.2),rot:new o.Euler(.05,0,t?-(-Math.PI/.475):-(Math.PI/.475)),scale:1},{pos:new o.Vector3(t?.05:-.05,-.5,-0),rot:new o.Euler(.05,0,t?-(-Math.PI/.475):-(Math.PI/.475)),scale:.8}],[t]),m=(0,i.useMemo)(()=>[-1,-1,-1,-1,-1,-1,-1,6],[]),g=(0,i.useMemo)(()=>p.map(e=>e.rot.clone()),[p]);(0,i.useEffect)(()=>{r&&!l&&(c(!0),d(Date.now()/1e3))},[r,l]),(0,a.F)(()=>{if(l&&h.current.length>0){let e=Math.min((Date.now()/1e3-u)/.45,1);if(e>=1)c(!1),h.current.forEach((e,t)=>{e&&g[t]&&e.rotation.copy(g[t])});else{let r=.3*Math.sin(e*Math.PI*2),n=.5*Math.sin(e*Math.PI);h.current.forEach((e,i)=>{if(e&&g[i]){let o=g[i],a=r*(1-.1*i);e.rotation.x=o.x,e.rotation.y=o.y,e.rotation.z=o.z+(t?-a-n:a+n)}})}}});let f=(0,i.useMemo)(()=>()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.023,.0175,.32,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:new o.Vector3(0,.2,0),children:[(0,n.jsx)("sphereGeometry",{args:[.035,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.4,metalness:.3})]})]}),[]),y=e=>{if(e>=p.length)return null;let t=p[e],r=m.map((t,r)=>t===e?r:-1).filter(e=>-1!==e);return(0,n.jsxs)("group",{ref:t=>{h.current[e]=t},position:t.pos,rotation:t.rot,scale:t.scale,children:[f(),r.map(e=>(0,n.jsx)("group",{position:new o.Vector3(0,.16,0),children:y(e)},"child-".concat(e)))]},"bone-".concat(e))};return(0,n.jsx)("group",{ref:s,rotation:new o.Euler(0,Math.PI,0),position:new o.Vector3(0,-.3,0),children:m.map((e,t)=>-1===e?y(t):null)})});l.displayName="BoneWings";let c=i.memo(e=>{let{isLeft:t=!1}=e,r=1.75*Math.PI;return(0,n.jsx)("group",{rotation:[-.45,t?-.7:.7,t?-.15:.15],children:Array.from({length:18}).map((e,i)=>{let o=i/19,a=.075*(1-.725*o),s=3.25*Math.pow(o,2.7);return(0,n.jsxs)("group",{position:[s*(t?-.15:.15),.0675*i,-(.725*s)],rotation:[-1.5*o,Math.pow(o,.2)*r,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[a,1.5*a,.0675,10]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*o,", ").concat(0+20*o,", ").concat(0+20*o,")"),roughness:.7,metalness:.4})]}),Array.from({length:6}).map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI/2,0],children:(0,n.jsxs)("mesh",{position:[.95*a,0,0],children:[(0,n.jsx)("boxGeometry",{args:[.3*a,.259375,1.5*a]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*o,", ").concat(20+20*o,", ").concat(20+20*o,")"),roughness:.8,metalness:.3})]})},t))]},i)})})});c.displayName="DragonHorns";var u=r(7125);let d=i.memo(e=>{let{parentRef:t,dashCharges:r,weaponType:s,weaponSubclass:l}=e,c=(0,i.useRef)(null),d=()=>{if(l)switch(l){case u.p.CHAOS:return"#00FF37";case u.p.ABYSSAL:return"#17CE54";case u.p.DIVINITY:return"#87CEEB";case u.p.VENGEANCE:return"#4682B4";case u.p.FROST:case u.p.ASSASSIN:return"#FF544E";case u.p.ARCANE:return"#00FF88";case u.p.NATURE:return"#00AA44";case u.p.ELEMENTAL:return"#3EB0FC";case u.p.VENOM:return"#17CC93"}switch(s){case u.v.SCYTHE:return"#17CE54";case u.v.SWORD:return"#87CEEB";case u.v.SABRES:return"#FF544E";case u.v.RUNEBLADE:return"#00FF88";case u.v.BOW:return"#3A905E"}};return(0,a.F)(e=>{let{clock:n}=e;if(!c.current||!t.current)return;let i=n.getElapsedTime();c.current.children.forEach((e,t)=>{let n=t/r.length*Math.PI*2+.5*i,o=.1+Math.sin(2*i+t);e.position.set(Math.cos(n)*o,.1*Math.sin(1.5*i+.5*t),Math.sin(n)*o),e.rotation.x=2*i+t,e.rotation.y=1.5*i+.7*t}),c.current.position.copy(t.current.position)}),(0,n.jsx)("group",{ref:c,children:r.map((e,t)=>{let r=e.isAvailable,i=d(),a="#333333";return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.115,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(r?i:a),emissive:new o.Color(r?i:a),emissiveIntensity:r?.3:.1,transparent:!0,opacity:r?.8:.4})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.115*1.225,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:r?i:"#333333",emissive:r?i:"#333333",emissiveIntensity:r?.5:.1,transparent:!0,opacity:r?.4:.15,depthWrite:!1,side:o.DoubleSide,blending:o.AdditiveBlending})]})]},t)})})});d.displayName="ChargedOrbitals";let h=()=>(0,n.jsxs)("group",{rotation:[Math.PI/4,0,0],position:[0,-.125,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.0175,.0175,.175,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:new o.Vector3(0,.1,0),rotation:new o.Euler(0,0,Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:new o.Vector3(0,-.1,0),rotation:new o.Euler(0,0,-Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.0325,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#a4a4a4",roughness:.5,metalness:.2})]})]});function p(e){let{parentRef:t}=e,r=(0,i.useRef)([]),o=(0,i.useRef)(null);return(0,a.F)(()=>{if(!t.current||!o.current)return;let e=t.current.position;o.current.position.set(e.x,0,e.z),r.current.forEach((e,t)=>{let r=t/16*Math.PI*2+.001*Date.now(),n=-(.4675*Math.cos(r)),i=.4675*Math.sin(r),o=.02*Math.sin(.002*Date.now()+t);e.position.set(n,o-.5,i),e.rotation.y=r+Math.PI/3})}),(0,n.jsx)("group",{ref:o,children:Array.from({length:16}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(r.current[t]=e)},children:h()},t))})}function m(e){let{chargeProgress:t,isCharging:r,onRelease:s,currentSubclass:l,hasInstantPowershot:c=!1,isAbilityBowAnimation:d=!1,isViperStingCharging:h=!1,viperStingChargeProgress:p=0,isBarrageCharging:m=!1,barrageChargeProgress:g=0,isCobraShotCharging:f=!1,cobraShotChargeProgress:y=0}=e,x=(0,i.useRef)(null),v=(0,i.useRef)(r),M=t>=.8&&t<=.98;(0,a.F)(()=>{let e=r&&!d&&!h&&!m&&!f;if(v.current&&!e&&!h&&!m&&!f){let e=t>=.8&&t<=.98;s(t,e)}v.current=e});let S=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e},w={steps:1,depth:.03,bevelEnabled:!1};return(0,n.jsx)("group",{position:[.6,.65,.875],rotation:[-Math.PI/2,-Math.PI/2,-Math.PI/2],scale:[.875,.8,.8],children:(0,n.jsxs)("group",{ref:x,position:[-.9,.075,.75],rotation:[Math.PI,Math.PI/2,0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("tubeGeometry",{args:[new o.CatmullRomCurve3([new o.Vector3(-.875,0,0),new o.Vector3(-.85,.2,0),new o.Vector3(-.25,.5,0),new o.Vector3(-.4,.35,0),new o.Vector3(.4,.35,0),new o.Vector3(.25,.5,0),new o.Vector3(.85,.2,0),new o.Vector3(.875,0,0)]),64,.035,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:M?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:M?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:M?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*p:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("tubeGeometry",{args:[(e=>{let t=1.35*e;return new o.CubicBezierCurve3(new o.Vector3(-.8,0,0),new o.Vector3(0,0,-t),new o.Vector3(0,0,-t),new o.Vector3(.8,0,0))})(f?y:m?g:h?p:t),16,.02,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:1,transparent:!0,opacity:.6})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[-.4,0,.475],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,n.jsx)("meshStandardMaterial",{color:M?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:M?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:M?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*p:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{position:[.4,0,.475],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,n.jsx)("meshStandardMaterial",{color:M?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:M?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:M?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*p:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,transparent:!0,opacity:.8})]})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[-1,0,-.2],rotation:[Math.PI/2,0,Math.PI/2],scale:[.4,-.4,.4],children:[(0,n.jsx)("extrudeGeometry",{args:[S(),w]}),(0,n.jsx)("meshStandardMaterial",{color:M?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:M?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:M?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*p:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,metalness:.8,roughness:.1,transparent:!0,opacity:.8,side:o.DoubleSide})]}),(0,n.jsxs)("mesh",{position:[1,0,-.2],rotation:[Math.PI/2,0,Math.PI/2],scale:[.4,.4,.4],children:[(0,n.jsx)("extrudeGeometry",{args:[S(),w]}),(0,n.jsx)("meshStandardMaterial",{color:M?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:M?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*p),", ").concat(Math.floor(63+125*p),", ").concat(Math.floor(155+97*p),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:M?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*p:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,metalness:.8,roughness:.1,transparent:!0,opacity:.8,side:o.DoubleSide})]})]}),(r||h||m||f)&&(0,n.jsxs)("group",{position:[0,0,.8-(f?y:m?g:h?p:t)*1.35],rotation:[Math.PI/2,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.9,8]}),(0,n.jsx)("meshStandardMaterial",{color:f?"#00ff40":m?"#ff8800":h?"#A855C7":"#00ffff",emissive:f?"#00ff40":m?"#ff8800":h?"#A855C7":"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsxs)("mesh",{position:[0,.35,0],children:[(0,n.jsx)("coneGeometry",{args:[.03,.175,8]}),(0,n.jsx)("meshStandardMaterial",{color:f?"#00ff40":m?"#ff8800":h?"#A855C7":"#00ffff",emissive:f?"#00ff40":m?"#ff8800":h?"#A855C7":"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]})]})]})})}function g(e){let{scytheRef:t,basePosition:r,isEmpowered:i=!1}=e,s=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e},l={steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16};return(0,n.jsxs)("group",{ref:t,position:[r[0],r[1],r[2]],rotation:[0,0,Math.PI],scale:[.65,.75,.65],children:[(0,n.jsxs)("group",{position:[0,-0,0],rotation:[0,0,Math.PI+.3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,1.5,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#a86432",roughness:.7})]}),[...Array(7)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.6-.2*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.07,.01,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#a86432",metalness:.3,roughness:.7})]},t))]}),(0,n.jsxs)("group",{position:[-0,0,0],rotation:[Math.PI/1,0,Math.PI-.3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>2*e.clock.getElapsedTime()),children:(0,n.jsxs)("mesh",{"position-y":.55,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.14,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.55,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.14,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.4,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.2,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.2,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.4,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#8A2BE2":"#17CE54",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,n.jsx)("group",{position:[.375,.45,.65],rotation:[.2,-Math.PI/3.6,Math.PI-.4],scale:[.8,.45,.8],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[s(),{...l,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#8A2BE2":"#17CE54",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:o.DoubleSide})]})}),(0,n.jsx)("group",{position:[-.375,-.45,-.65],rotation:[.2,Math.PI/14-1.1,-.4],scale:[.8,.45,.8],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[s(),{...l,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:i?"#8A2BE2":"#17CE54",emissive:i?"#8A2BE2":"#17CE54",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:o.DoubleSide})]})})]})}function f(e){let{currentSubclass:t=u.p.CHAOS,level:r=1,isEmpowered:o=!1,isSpinning:s=!1}=e;(0,i.useEffect)(()=>{},[o]),(0,i.useEffect)(()=>{},[s]);let l=(0,i.useRef)(null),c=(0,i.useRef)(0),d=[-1.175,.65,.3];return(0,a.F)((e,t)=>{if(l.current){if(s){c.current+=t;let e=15*c.current;l.current.position.set(0,.5,1.2),l.current.rotation.set(Math.PI/8,0,e)}else c.current=0,l.current.rotation.x*=.85,l.current.rotation.y*=.85,l.current.rotation.z*=.85,l.current.position.x+=(d[0]-l.current.position.x)*.14,l.current.position.y+=(d[1]-l.current.position.y)*.14,l.current.position.z+=(d[2]-l.current.position.z)*.025}}),(0,n.jsx)(g,{scytheRef:l,basePosition:d,isEmpowered:o})}var y=r(6663);function x(e){let{isSwinging:t,isSmiting:r,isOathstriking:s,isDivineStorming:l=!1,isColossusStriking:c=!1,isCharging:u=!1,isDeflecting:d=!1,chargeDirectionProp:h,onSwingComplete:p,onSmiteComplete:m,onOathstrikeComplete:g,onDivineStormComplete:f,onColossusStrikeComplete:x,onChargeComplete:v,onDeflectComplete:M,hasChainLightning:S=!1,comboStep:w=1,currentSubclass:j,enemyData:C=[],onHit:b,setDamageNumbers:I,nextDamageNumberId:P,setActiveEffects:D,playerPosition:E,playerRotation:F,dragonGroupRef:A,playerEntityId:R}=e,T=(0,i.useRef)(null),B=(0,i.useRef)(0),k=(0,i.useRef)(0),z=(0,i.useRef)(0),V=(0,i.useRef)(0);(0,i.useRef)(0);let G=(0,i.useRef)(null),N=(0,i.useRef)(new o.Vector3),W=(0,i.useRef)(null),L=(0,i.useRef)(new Set),H=(0,i.useRef)([]);(0,i.useRef)(1);let O=(0,i.useRef)(0),U=(0,i.useRef)(null),q=(0,i.useRef)(!1),_=(0,i.useRef)(!1),Z=[-1.18,.225,.3],Y=(0,i.useRef)([]),Q=(0,i.useRef)({}),J=(0,i.useRef)({}),X=(0,i.useRef)(!1),K=(0,i.useRef)(w),$=(0,i.useRef)(!1),ee=(0,i.useRef)(0),et=(0,i.useRef)(w),er=(0,i.useRef)([...Z]),en=(0,i.useRef)([0,0,0]);(0,i.useEffect)(()=>{K.current!==w&&(K.current=w)},[w]),(0,a.F)((e,n)=>{if(T.current){if(Date.now(),!t&&!r&&!c&&!l&&!s&&!u&&!d&&$.current){if(ee.current,ee.current+=7*n,ee.current>=1){if($.current=!1,ee.current=0,w!==et.current){let e=ei(w);er.current=e.position,en.current=e.rotation}else er.current=[...Z],en.current=[0,0,0];T.current.position.set(...er.current),T.current.rotation.set(...en.current)}else{let e;let t=1-Math.pow(1-ee.current,3),r=T.current.position,n=T.current.rotation;e=w!==et.current?ei(w):{position:[...Z],rotation:[0,0,0]};let i=Math.sin(ee.current*Math.PI),o=r.x+(e.position[0]-r.x)*t,a=r.y+(e.position[1]-r.y)*t+.15*i,s=r.z+(e.position[2]-r.z)*t;T.current.position.set(o,a,s);let l=n.x+(e.rotation[0]-n.x)*t,c=n.y+(e.rotation[1]-n.y)*t,u=n.z+(e.rotation[2]-n.z)*t;T.current.rotation.set(l,c,u)}return}if(l){if(V.current+=25*n,V.current>=1*Math.PI*4){V.current=0,Q.current={},T.current.position.set(...Z),T.current.rotation.set(0,0,0),null==f||f();return}let e=V.current,t=1.75*Math.cos(e),r=1.75*Math.sin(e);T.current.rotation.set(Math.PI/4,-e+Math.PI,1),T.current.rotateY(-e+Math.PI),T.current.position.set(t,.65,r);let i=Date.now();C.forEach(e=>{if(e.health&&!(e.health<=0)){if(e.id===(null==R?void 0:R.toString())){console.log("⚔️ Divine Storm: Skipping self-damage for player entity ".concat(e.id));return}!(i-(Q.current[e.id]||0)<200)&&5>=(E||new o.Vector3(0,0,0)).distanceTo(e.position)&&(Q.current[e.id]=i,null==b||b(e.id,40),I&&P&&I(t=>[...t,{id:P.current++,damage:40,position:e.position.clone(),isCritical:!1,isDivineStorm:!0}]))}});return}if(q.current){if(O.current+=27.5*n,O.current>=1*Math.PI*2){O.current=0,U.current=null,q.current=!1,T.current.position.set(...Z),T.current.rotation.set(0,0,0),null==v||v();return}let e=O.current,t=1.5*Math.cos(e),r=1.5*Math.sin(e);T.current.position.set(t,.65,r),T.current.rotation.set(Math.PI/4,-e+Math.PI,1),T.current.rotateY(-e+Math.PI);return}if(u){if(!W.current){W.current=Date.now(),G.current=(null==E?void 0:E.clone())||new o.Vector3(0,0,0),L.current.clear(),h?N.current=h.clone().normalize():N.current=new o.Vector3(0,0,-1).normalize();let e=window.gameUI;e&&(e.getCurrentRage&&e.getCurrentRage(),e.gainRage(0),e.getCurrentRage&&e.getCurrentRage())}let e=(Date.now()-W.current)/1e3;if(e<.1){let t=e/.1,r=t<.5?2*t*t:1-Math.pow(-2*t+2,3)/2;T.current.rotation.set(Math.PI/2*r,0,0),Z[2];let n=Z[2]+1.5*r;T.current.position.set(Z[0],Z[1]+.2,n);return}let t=Math.min((e-.1)/.45,1);if(!G.current||!N.current||!E){W.current=null,G.current=null,null==v||v();return}let r=N.current.clone().multiplyScalar(9.5*(1-Math.pow(1-t,2)));if(G.current.clone().add(r).length()>25){W.current=null,G.current=null,null==v||v();return}if(C&&C.length>0&&b&&t>0&&E)for(let e of C)!L.current.has(e.id)&&!(e.health<=0)&&2.5>=E.distanceTo(e.position)&&(L.current.add(e.id),b(e.id,40),I&&P&&I(t=>[...t,{id:P.current++,damage:40,position:e.position.clone(),isCritical:!1,isBreach:!0}]));T.current.rotation.set(Math.PI/2,0,-.175),T.current.position.set(Z[0],Z[1]+.2,Z[2]+1.5);return}if(u||null===W.current||q.current||_.current||(_.current=!0),_.current&&!q.current&&(W.current=null,G.current=null,L.current.clear(),H.current=[],_.current=!1,q.current=!0,O.current=0,U.current=Date.now()),u||null===W.current||_.current||q.current||(W.current=null,G.current=null,L.current.clear(),H.current=[],_.current=!1,T.current.rotation.set(0,0,0),T.current.position.set(...Z)),u&&!W.current&&(_.current=!1,q.current=!1,O.current=0),r){let e,t,r,i,o;k.current+=n*(k.current<Math.PI/2?3:6);let a=Math.min(k.current/Math.PI,1);if(a<.5){let n=.45*a;e=-Math.PI/3-n*Math.PI/3,t=n*Math.PI/4,r=Z[0]+1.5*n,i=Z[1]+1.5*n,o=Z[2]-1.5*n}else{let n=(a-.5)*2;e=-2*Math.PI/3+3*n*Math.PI/2,t=Math.PI/4*(1-n),r=Z[0]+1.5*(1-n),i=Z[1]+(1.5-2*n),o=Z[2]-(1.5-3*n)}T.current.position.set(r,i,o),T.current.rotation.set(e,t,0),k.current>=Math.PI&&(k.current=0,T.current.rotation.set(0,0,0),T.current.position.set(...Z),null==m||m());return}if(c){let e,t,r,i,o;z.current+=n*(z.current<Math.PI/2?3:6);let a=Math.min(z.current/Math.PI,1);if(a<.5){let n=.45*a;e=-Math.PI/3-n*Math.PI/3,t=n*Math.PI/4,r=Z[0]+1.5*n,i=Z[1]+1.5*n,o=Z[2]-1.5*n}else{let n=(a-.5)*2;e=-2*Math.PI/3+3*n*Math.PI/2,t=Math.PI/4*(1-n),r=Z[0]+1.5*(1-n),i=Z[1]+(1.5-2*n),o=Z[2]-(1.5-3*n)}T.current.position.set(r,i,o),T.current.rotation.set(e,t,0),z.current>=Math.PI&&(z.current=0,T.current.rotation.set(0,0,0),T.current.position.set(...Z),null==x||x());return}if(t){K.current!==w&&(K.current=w),0===B.current&&(X.current=!1),B.current+=8*n;let e=Math.min(B.current/Math.PI/1.5,1),t=K.current,r=3===t?.9*Math.PI:.55*Math.PI;if((3===t?e>=.25&&e<=.75:e>=.15&&e<=.65)&&!X.current&&(eo(t),X.current=!0),B.current>=r){B.current=0,X.current=!1,J.current={},et.current=t,2===t?$.current=!1:($.current=!0,ee.current=0),null==p||p();return}if(1===t){let t=e<=.25?2*e:.725-(e-.115)*1.1,r=Z[0]+2*Math.sin(t*Math.PI),n=Z[1]+-2*Math.sin(t*Math.PI),i=Z[2]+1*Math.cos(t*Math.PI);T.current.position.set(r,n,i),T.current.rotation.set(-.75*Math.sin(t*Math.PI)+1.25,Math.sin(t*Math.PI)*Math.PI/1.125,Math.PI/3*Math.sin(t*Math.PI))}else if(2===t){let t=e<=.275?2*e:.625-(e-.075)*1.2,r=Z[0]+2.5-2.5*Math.sin(t*Math.PI),n=Z[1]+-.2*Math.sin(t*Math.PI),i=Z[2]+1.1*Math.cos(t*Math.PI);T.current.position.set(r,n,i),T.current.rotation.set(-.75*Math.sin(t*Math.PI)+1.5,-Math.sin(t*Math.PI)*Math.PI,-(Math.PI/1.75*Math.sin(t*Math.PI)))}else if(3===t){var i,a;let t,r,o,s,l;if(B.current<=3*n){let e=T.current.position,t=T.current.rotation;T.current.userData={startPos:[e.x,e.y,e.z],startRot:[t.x,t.y,t.z]}}let c=(null===(i=T.current.userData)||void 0===i?void 0:i.startPos)||Z,u=(null===(a=T.current.userData)||void 0===a?void 0:a.startRot)||[0,0,0];if(e<.2){let n=5*e,i=Z[0]+1.5,a=Z[1]+1.5,d=Z[2]-1.5;o=c[0]+(i-c[0])*n,s=c[1]+(a-c[1])*n,l=c[2]+(d-c[2])*n,t=u[0]+(-Math.PI/3-Math.PI/3-u[0])*n,r=u[1]+(Math.PI/4-u[1])*n}else{let n=(e-.2)*2;t=-2*Math.PI/3+3*n*Math.PI/2,r=Math.PI/4*(1-n),o=Z[0]+1.5*(1-n),s=Z[1]+(2-5*n),l=Z[2]-(1.5-3.5*n)}T.current.position.set(o,s,l),T.current.rotation.set(t,r,0)}}else t||r||c||l||s||u||d||$.current||2===et.current&&3===w||(T.current.rotation.x*=.85,T.current.rotation.y*=.85,T.current.rotation.z*=.85,T.current.position.x+=(Z[0]-T.current.position.x)*.14,T.current.position.y+=(Z[1]-T.current.position.y)*.14,T.current.position.z+=(Z[2]-T.current.position.z)*.14);if(S&&T.current){if(.8>Math.random())for(let e=0;e<3;e++){let e=2.2*Math.random(),t=new o.Vector3((Math.random()-.5)*.4,e,(Math.random()-.5)*.4);Y.current.push({position:t,velocity:new o.Vector3((Math.random()-.5)*4,(Math.random()-.2)*4,(Math.random()-.5)*4).multiplyScalar(.8),life:1,scale:.02*Math.random()+.005})}Y.current.forEach(e=>{e.velocity.x+=Math.sin(.01*Date.now())*n*.5,e.velocity.z+=Math.cos(.01*Date.now())*n*.5,e.position.add(e.velocity.clone().multiplyScalar(n)),e.life-=1.5*n,e.velocity.y+=.5*n}),Y.current.length>120&&(Y.current=Y.current.slice(-120)),Y.current=Y.current.filter(e=>e.life>0)}}});let ei=e=>{switch(e){case 1:return{position:[Z[0]+.3,Z[1]+.2,Z[2]+.1],rotation:[.2,.3,.1]};case 2:return{position:[Z[0]-.3,Z[1]-.1,Z[2]+.1],rotation:[.2,-.3,-.1]};case 3:return{position:[Z[0],Z[1]-.15,Z[2]-.2],rotation:[-.5,0,0]};default:return{position:[...Z],rotation:[0,0,0]}}},eo=e=>{if(!E||!C.length)return;let t=Date.now(),r={1:25,2:30,3:40}[e],n=0;if(C.forEach(i=>{i.health&&!(i.health<=0)&&!(t-(J.current[i.id]||0)<100)&&5>=E.distanceTo(i.position)&&(3===e||i.position.clone().sub(E).normalize().dot(new o.Vector3(0,0,-1))>-.5)&&(J.current[i.id]=t,null==b||b(i.id,r),n++,I&&P&&I(e=>[...e,{id:P.current++,damage:r,position:i.position.clone(),isCritical:!1}]))}),n>0){let e=window.gameUI;if(e){e.getCurrentRage&&e.getCurrentRage();let t=Math.min(5*n,5);e.gainRage(t),e.getCurrentRage&&e.getCurrentRage()}}},ea=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(-.25,.25),e.lineTo(-.15,-.15),e.lineTo(0,0),e.lineTo(.25,.25),e.lineTo(.15,-.15),e.lineTo(0,0),e.lineTo(0,.08),e.lineTo(.2,.2),e.quadraticCurveTo(.8,.15,1.5,.18),e.quadraticCurveTo(2,.1,2.2,0),e.quadraticCurveTo(2,-.1,1.5,-.18),e.quadraticCurveTo(.8,-.15,.2,-.2),e.lineTo(0,-.08),e.lineTo(0,0),e},es={steps:2,depth:.05,bevelEnabled:!0,bevelThickness:.014,bevelSize:.02,bevelOffset:.04,bevelSegments:2},el={...es,depth:.06,bevelThickness:.02,bevelSize:.02,bevelOffset:0,bevelSegments:6};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{rotation:[-.65,0,.2],scale:[.85,.95,.825],children:[(0,n.jsxs)("group",{ref:T,position:[Z[0],Z[1],Z[2]],rotation:[0,0,Math.PI],scale:[.75,.8,.65],children:[(0,n.jsxs)("group",{position:[.25,-.55,.35],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.04,.9,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.35-.11*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.045,.016,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[.25,.225,.35],rotation:[Math.PI,1.5,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.26,.07,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.25*Math.cos(t*Math.PI/4),.25*Math.sin(t*Math.PI/4),0],rotation:[0,0,t*Math.PI/4-Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.07,.55,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]},"spike-".concat(t))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.155,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(11907088),emissive:new o.Color(11907088),emissiveIntensity:3,transparent:!0,opacity:1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(1087413),emissive:new o.Color(1087413),emissiveIntensity:40,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.145,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(1087413),emissive:new o.Color(1087413),emissiveIntensity:35,transparent:!0,opacity:.6})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.175,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(1087413),emissive:new o.Color(1087413),emissiveIntensity:30,transparent:!0,opacity:.4})]}),(0,n.jsx)("pointLight",{color:new o.Color(1160495),intensity:2,distance:1,decay:2})]}),(0,n.jsxs)("group",{position:[.25,.5,.35],rotation:[0,-Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[ea(),es]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(1087413),emissive:new o.Color(1087413),emissiveIntensity:1.5,metalness:.3,roughness:.1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(0,.06),e.lineTo(.15,.15),e.quadraticCurveTo(1.2,.12,1.5,.15),e.quadraticCurveTo(2,.08,2.15,0),e.quadraticCurveTo(2,-.08,1.5,-.15),e.quadraticCurveTo(1.2,-.12,.15,-.15),e.lineTo(0,-.05),e.lineTo(0,0),e})(),el]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(1087413),emissive:new o.Color(1087413),emissiveIntensity:3,metalness:.2,roughness:.1,opacity:.8,transparent:!0})]})]}),(0,n.jsx)("group",{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("group",{position:[.25,.7,.35],rotation:[0,-Math.PI/2,Math.PI/2],scale:[.95,1.1,.95],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[ea(),{...es,depth:.07}]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(8900331),emissive:new o.Color(4620980),emissiveIntensity:1.5,transparent:!0,opacity:.3,blending:o.AdditiveBlending})]})}),Y.current.map((e,t)=>(0,n.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],children:[(0,n.jsx)("sphereGeometry",{args:[1.25,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(8900331),emissive:new o.Color(4620980),emissiveIntensity:3*e.life,transparent:!0,opacity:.6*e.life,blending:o.AdditiveBlending})]},t))]})})]}),u&&H.current.map(e=>(0,n.jsxs)("mesh",{position:[e.position.x,e.position.y,e.position.z],scale:[.2*e.life,.2*e.life,.2*e.life],children:[(0,n.jsx)("sphereGeometry",{args:[.5,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(11907088),emissive:new o.Color(11907088),emissiveIntensity:3*e.life,transparent:!0,opacity:.9*e.life,blending:o.AdditiveBlending})]},e.id)),l&&(0,n.jsx)("group",{children:(0,n.jsx)("pointLight",{color:new o.Color(11907088),intensity:1,distance:8,decay:1})})]}),(0,n.jsx)(y.Z,{isActive:d,duration:3,onComplete:M,playerPosition:E,playerRotation:F,dragonGroupRef:A})]})}let v=(e,t,r)=>e*(1-r)+t*r;function M(e){let{isSwinging:t,onSwingComplete:r,onLeftSwingStart:s,onRightSwingStart:l,isCharging:c=!1,isSkyfalling:u=!1,isBackstabbing:d=!1,isSundering:h=!1,onBackstabComplete:p=()=>{},onSunderComplete:m=()=>{},subclass:g="FROST"}=e;i.useEffect(()=>{},[d]);let f=(0,i.useRef)(null),y=(0,i.useRef)(0),x=(0,i.useRef)(null),M=(0,i.useRef)(0),S=[-.8,.75,.65],w=[.8,.75,.65],j=(0,i.useRef)(0),C=(0,i.useRef)(!1),b=(0,i.useRef)(0),I=(0,i.useRef)(0),P=(0,i.useRef)("none"),D=(0,i.useRef)(!1),E=(0,i.useRef)({left:{x:0,y:0,z:0},right:{x:0,y:0,z:0}}),F=(0,i.useRef)(0),A=(0,i.useRef)("none"),R=(0,i.useRef)(!1);(0,i.useRef)({left:{x:0,y:0,z:0},right:{x:0,y:0,z:0}});let T=(0,i.useRef)(!1);(0,i.useEffect)(()=>{d||(D.current=!1,P.current="none",I.current=0)},[d]),(0,i.useEffect)(()=>{h||(R.current=!1,A.current="none",F.current=0)},[h]),(0,i.useEffect)(()=>{u||(T.current=!1)},[u]),(0,a.F)((e,n)=>{if(f.current&&x.current){if(u&&!T.current)f.current.position.x+=(-.8-f.current.position.x)*.3,f.current.position.y+=(-.2-f.current.position.y)*.3,f.current.position.z+=(.5-f.current.position.z)*.3,x.current.position.x+=(.8-x.current.position.x)*.3,x.current.position.y+=(-.2-x.current.position.y)*.3,x.current.position.z+=(.5-x.current.position.z)*.3,f.current.rotation.x=v(1.05*f.current.rotation.x,.37*Math.PI,.3),f.current.rotation.z=v(f.current.rotation.z,1.65*Math.PI,.2),x.current.rotation.x=v(1.05*x.current.rotation.x,.37*Math.PI,.3),x.current.rotation.z=v(x.current.rotation.z,-(1.65*Math.PI),.2),y.current=0,M.current=0,b.current=0,j.current=0,C.current=!1,I.current=0,P.current="none",F.current=0,A.current="none";else if(d&&!D.current){if("none"===P.current){P.current="windup",I.current=0;let e=S[0]+14695761589768238e-32-.45,t=S[1]+-.25*Math.sin(2*Math.PI),r=S[2]+13471114790620887e-32,n=w[0]-14695761589768238e-32+.45,i=w[1]+-.25*Math.sin(2*Math.PI),o=w[2]+13471114790620887e-32;f.current.position.set(e,t,r),x.current.position.set(n,i,o),f.current.rotation.set(.5*Math.PI*Math.sin(.95*Math.PI),.5*Math.PI*Math.sin(.95*Math.PI),-.1*Math.PI*Math.sin(.95*Math.PI)),x.current.rotation.set(.5*Math.PI*Math.sin(.95*Math.PI),-(.5*Math.PI*Math.sin(.95*Math.PI)),.1*Math.PI*Math.sin(.95*Math.PI))}if(I.current+=1*n,"windup"===P.current){let e=Math.min(I.current/.125,1),t=.125*Math.sin(e*Math.PI*.15);f.current.position.z=f.current.position.z-t,x.current.position.z=x.current.position.z-t;let r=Math.sin(.225*Math.PI)*(.5*Math.PI+Math.PI/4),n=.3*Math.PI*Math.sin(.225*Math.PI)-Math.PI/1.75,i=-.1*Math.PI*Math.sin(.225*Math.PI),o=Math.sin(.225*Math.PI)*(.5*Math.PI+Math.PI/4),a=-(.3*Math.PI*Math.sin(.225*Math.PI))+Math.PI/1.75,s=.1*Math.PI*Math.sin(.225*Math.PI);f.current.rotation.x=r,f.current.rotation.y=n,f.current.rotation.z=i,x.current.rotation.x=o,x.current.rotation.y=a,x.current.rotation.z=s,E.current={left:{x:r,y:n,z:i},right:{x:o,y:a,z:s}},e>=1&&(P.current="thrust",I.current=0)}else if("thrust"===P.current){let e=Math.min(I.current/.15,1),t=Math.sin(e*Math.PI*.175);f.current.position.z+=t,x.current.position.z+=t;let r=.325*t;f.current.position.x+=r,x.current.position.x-=r,f.current.rotation.x=E.current.left.x,f.current.rotation.y=E.current.left.y,f.current.rotation.z=E.current.left.z,x.current.rotation.x=E.current.right.x,x.current.rotation.y=E.current.right.y,x.current.rotation.z=E.current.right.z,e>=.85&&(P.current="recover",I.current=0)}else if("recover"===P.current){let e=Math.min(I.current/.2,1),t=1-Math.pow(1-e,.175);f.current.position.x=v(f.current.position.x,S[0],t),f.current.position.y=v(f.current.position.y,S[1],t),f.current.position.z=v(f.current.position.z,S[2],t),x.current.position.x=v(x.current.position.x,w[0],t),x.current.position.y=v(x.current.position.y,w[1],t),x.current.position.z=v(x.current.position.z,w[2],t),f.current.rotation.x=v(f.current.rotation.x,0,t),f.current.rotation.y=v(f.current.rotation.y,0,t),f.current.rotation.z=v(f.current.rotation.z,0,t),x.current.rotation.x=v(x.current.rotation.x,0,t),x.current.rotation.y=v(x.current.rotation.y,0,t),x.current.rotation.z=v(x.current.rotation.z,0,t),e>=1&&(P.current="none",I.current=0,D.current=!0,p())}}else if(h&&!R.current){if("none"===A.current&&(A.current="windup",F.current=0,f.current.position.set(-1.5,.75,0),x.current.position.set(1.5,.75,0),f.current.rotation.set(1,.5*Math.PI,0),x.current.rotation.set(1,-(.5*Math.PI),0)),F.current+=2*n,"windup"===A.current){let e=Math.min(F.current/.15,1),t=.5*Math.sin(e*Math.PI*.5);f.current.position.x+=t,x.current.position.x-=t,e>=1&&(A.current="whirlwind",F.current=0)}else if("whirlwind"===A.current){let e=Math.min(F.current/1,1),t=(1-Math.pow(1-e,2))*Math.PI*4,r=1.2*Math.cos(t),n=1.2*Math.sin(t);f.current.position.set(r,.75,n);let i=-t,o=1.2*Math.cos(i),a=1.2*Math.sin(i);x.current.position.set(o,.75,a);let s=t+.5*Math.PI;f.current.rotation.set(0,s,0);let l=i-.5*Math.PI;x.current.rotation.set(0,l,0);let c=.1*Math.sin(2*t);f.current.rotation.x=c,x.current.rotation.x=-c,e>=1&&(A.current="recover",F.current=0)}else if("recover"===A.current){let e=Math.min(F.current/.3,1),t=1-Math.pow(1-e,3);f.current.position.x=v(f.current.position.x,S[0],t),f.current.position.y=v(f.current.position.y,S[1],t),f.current.position.z=v(f.current.position.z,S[2],t),x.current.position.x=v(x.current.position.x,w[0],t),x.current.position.y=v(x.current.position.y,w[1],t),x.current.position.z=v(x.current.position.z,w[2],t),f.current.rotation.x=v(f.current.rotation.x,0,t),f.current.rotation.y=v(f.current.rotation.y,0,t),f.current.rotation.z=v(f.current.rotation.z,0,t),x.current.rotation.x=v(x.current.rotation.x,0,t),x.current.rotation.y=v(x.current.rotation.y,0,t),x.current.rotation.z=v(x.current.rotation.z,0,t),e>=1&&(A.current="none",F.current=0,R.current=!0,m())}}else if(t){if(0===y.current&&0===M.current&&(C.current=!1),f.current){if(b.current<.115)b.current+=n;else{0===y.current&&s(),y.current+=12*n;let e=Math.min(y.current/Math.PI,1),t=S[0]+1.2*Math.sin(e*Math.PI)-.45,r=S[1]+-.25*Math.sin(e*Math.PI*2),i=S[2]+1.75*Math.sin(e*Math.PI);f.current.position.set(t,r,i),f.current.rotation.set(.65*Math.PI*Math.sin(e*Math.PI),.3*Math.PI*Math.sin(e*Math.PI),-.1*Math.PI*Math.sin(e*Math.PI)),y.current>=Math.PI&&(y.current=0,b.current=0,f.current.rotation.set(0,0,0),f.current.position.set(...S))}}if(x.current){0===M.current&&l(),M.current+=12*n;let e=Math.min(M.current/Math.PI,1),t=w[0]-1.2*Math.sin(e*Math.PI)+.45,i=w[1]+-.25*Math.sin(e*Math.PI*2),o=w[2]+1.75*Math.sin(e*Math.PI);x.current.position.set(t,i,o),x.current.rotation.set(.5*Math.PI*Math.sin(e*Math.PI),-(.3*Math.PI*Math.sin(e*Math.PI)),.2*Math.PI*Math.sin(e*Math.PI)),M.current>=Math.PI&&(M.current=0,j.current=0,x.current.rotation.set(0,0,0),x.current.position.set(...w),C.current=!0,r())}}else f.current.position.x+=(S[0]-f.current.position.x)*.2,f.current.position.y+=(S[1]-f.current.position.y)*.2,f.current.position.z+=(S[2]-f.current.position.z)*.2,x.current.position.x+=(w[0]-x.current.position.x)*.2,x.current.position.y+=(w[1]-x.current.position.y)*.2,x.current.position.z+=(w[2]-x.current.position.z)*.2,f.current.rotation.x*=.85,f.current.rotation.y*=.85,f.current.rotation.z*=.85,x.current.rotation.x*=.85,x.current.rotation.y*=.85,x.current.rotation.z*=.85,t||(y.current=0,M.current=0,b.current=0,j.current=0,C.current=!1),d||(I.current=0,P.current="none"),h||(F.current=0,A.current="none")}});let B=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(-.15,.1),e.lineTo(-.2,0),e.lineTo(-.2,-.05),e.lineTo(0,0),e.lineTo(.15,.1),e.lineTo(.2,0),e.lineTo(.3,0),e.lineTo(0,0),e.lineTo(0,.05),e.quadraticCurveTo(.3,.15,.5,.2),e.quadraticCurveTo(.7,.25,.9,.15),e.quadraticCurveTo(1,.1,1.1,0),e.quadraticCurveTo(1,-.05,.8,-.1),e.lineTo(.7,-.15),e.lineTo(.65,-.1),e.quadraticCurveTo(.4,-.08,.2,-.05),e.quadraticCurveTo(.1,-.02,0,0),e},k=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(-.13,.08),e.lineTo(-.18,0),e.lineTo(-.08,-.04),e.lineTo(0,0),e.lineTo(.13,.08),e.lineTo(.18,0),e.lineTo(.08,-.04),e.lineTo(0,0),e.lineTo(0,.04),e.quadraticCurveTo(.28,.13,.48,.18),e.quadraticCurveTo(.68,.23,.88,.13),e.quadraticCurveTo(.98,.08,1.08,0),e.quadraticCurveTo(.98,-.04,.78,-.08),e.lineTo(.68,-.13),e.lineTo(.63,-.08),e.quadraticCurveTo(.38,-.06,.18,-.04),e.quadraticCurveTo(.08,-.02,0,0),e},z={steps:2,depth:.02,bevelEnabled:!0,bevelThickness:.004,bevelSize:.01,bevelSegments:3},V={...z,depth:.025,bevelThickness:.003,bevelSize:.004,bevelOffset:0},G=(()=>{switch(g){case"FROST":default:return{primary:"#ff0000",emissive:"#ff2200",secondary:"#cc0000",secondaryEmissive:"#ff0000"};case"ASSASSIN":return{primary:"#8b0000",emissive:"#ff0000",secondary:"#4b0000",secondaryEmissive:"#cc0000"}}})();return(0,n.jsxs)("group",{position:[0,-.6,.5],rotation:[-.55,0,0],scale:[.775,.775,.775],children:[(0,n.jsxs)("group",{ref:f,position:[S[0],S[1],S[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,n.jsxs)("group",{position:[.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,n.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[B(),z]}),(0,n.jsx)("meshStandardMaterial",{color:G.primary,emissive:G.emissive,emissiveIntensity:3,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[0,0,-.02],children:[(0,n.jsx)("extrudeGeometry",{args:[k(),{...V,depth:.06}]}),(0,n.jsx)("meshStandardMaterial",{color:G.secondary,emissive:G.secondaryEmissive,emissiveIntensity:8,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,n.jsx)("pointLight",{color:G.emissive,intensity:5,distance:2,decay:2})]})]}),(0,n.jsxs)("group",{ref:x,position:[w[0],w[1],w[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,n.jsxs)("group",{position:[-.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,n.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[-.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[B(),z]}),(0,n.jsx)("meshStandardMaterial",{color:G.primary,emissive:G.emissive,emissiveIntensity:2,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[0,0,-.02],children:[(0,n.jsx)("extrudeGeometry",{args:[k(),{...V,depth:.06}]}),(0,n.jsx)("meshStandardMaterial",{color:G.secondary,emissive:G.secondaryEmissive,emissiveIntensity:3.5,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,n.jsx)("pointLight",{color:G.emissive,intensity:1.5,distance:2,decay:2})]})]})]})}function S(e){let{isSwinging:t,isSmiting:r,isOathstriking:s,isDeathGrasping:l=!1,isDivineStorming:c=!1,isColossusStriking:u=!1,isCharging:d=!1,isDeflecting:h=!1,chargeDirectionProp:p,onSwingComplete:m,onSmiteComplete:g,onDeathGraspComplete:f,onOathstrikeComplete:x,onDivineStormComplete:v,onColossusStrikeComplete:M,onChargeComplete:S,onDeflectComplete:w,hasChainLightning:j=!1,comboStep:C=1,currentSubclass:b,enemyData:I=[],onHit:P,setDamageNumbers:D,nextDamageNumberId:E,setActiveEffects:F,playerPosition:A,playerRotation:R,dragonGroupRef:T,playerEntityId:B}=e,k=(0,i.useRef)(null),z=(0,i.useRef)(0),V=(0,i.useRef)(0),G=(0,i.useRef)(0);(0,i.useRef)(0),(0,i.useRef)(0),(0,i.useRef)(0),(0,i.useRef)(null),(0,i.useRef)(new o.Vector3),(0,i.useRef)(null),(0,i.useRef)(new Set),(0,i.useRef)([]),(0,i.useRef)(1),(0,i.useRef)(0),(0,i.useRef)(null),(0,i.useRef)(!1),(0,i.useRef)(!1);let N=[-1.18,.225,.3],W=(0,i.useRef)([]);(0,i.useRef)({});let L=(0,i.useRef)({}),H=(0,i.useRef)(!1),O=(0,i.useRef)(C),U=(0,i.useRef)(!1),q=(0,i.useRef)(0),_=(0,i.useRef)(C),Z=(0,i.useRef)([...N]),Y=(0,i.useRef)([0,0,0]);(0,i.useEffect)(()=>{O.current!==C&&(O.current=C)},[C]),(0,a.F)((e,n)=>{if(k.current){if(Date.now(),!t&&!r&&!l&&!u&&!c&&!s&&!d&&!h&&U.current){if(q.current,q.current+=7*n,q.current>=1){if(U.current=!1,q.current=0,C!==_.current){let e=Q(C);Z.current=e.position,Y.current=e.rotation}else Z.current=[...N],Y.current=[0,0,0];k.current.position.set(...Z.current),k.current.rotation.set(...Y.current)}else{let e;let t=1-Math.pow(1-q.current,3),r=k.current.position,n=k.current.rotation;e=C!==_.current?Q(C):{position:[...N],rotation:[0,0,0]};let i=Math.sin(q.current*Math.PI),o=r.x+(e.position[0]-r.x)*t,a=r.y+(e.position[1]-r.y)*t+.15*i,s=r.z+(e.position[2]-r.z)*t;k.current.position.set(o,a,s);let l=n.x+(e.rotation[0]-n.x)*t,c=n.y+(e.rotation[1]-n.y)*t,u=n.z+(e.rotation[2]-n.z)*t;k.current.rotation.set(l,c,u)}return}if(!c&&!d){if(r){let e,t,r,i,o;V.current+=n*(V.current<Math.PI/2?3:6);let a=Math.min(V.current/Math.PI,1);if(a<.5){let n=.45*a;e=-Math.PI/3-n*Math.PI/3,t=n*Math.PI/4,r=N[0]+1.5*n,i=N[1]+1.5*n,o=N[2]-1.5*n}else{let n=(a-.5)*2;e=-2*Math.PI/3+3*n*Math.PI/2,t=Math.PI/4*(1-n),r=N[0]+1.5*(1-n),i=N[1]+(1.5-2*n),o=N[2]-(1.5-3*n)}k.current.position.set(r,i,o),k.current.rotation.set(e,t,0),V.current>=Math.PI&&(V.current=0,k.current.rotation.set(0,0,0),k.current.position.set(...N),null==g||g());return}if(l){let e,t,r,i,o;G.current+=4*n;let a=Math.min(G.current/(1.2*Math.PI),1);if(a<.4){let n=a/.4;e=-Math.PI/6-n*Math.PI/3,t=n*Math.PI/6,r=N[0]-1*n,i=N[1]+.5*n,o=N[2]+.5*n}else{let n=(a-.4)/.6;e=-Math.PI/2+n*Math.PI,t=Math.PI/6*(1-n),r=N[0]-(1-2.5*n),i=N[1]+(.5-1*n),o=N[2]+(.5-1.5*n)}k.current.position.set(r,i,o),k.current.rotation.set(e,t,0),G.current>=1.2*Math.PI&&(G.current=0,k.current.rotation.set(0,0,0),k.current.position.set(...N),null==f||f());return}if(t){O.current!==C&&(O.current=C),0===z.current&&(H.current=!1),z.current+=8*n;let e=Math.min(z.current/Math.PI/1.5,1),t=O.current,r=3===t?.9*Math.PI:.55*Math.PI;if((3===t?e>=.25&&e<=.75:e>=.15&&e<=.65)&&!H.current&&(J(t),H.current=!0),z.current>=r){z.current=0,H.current=!1,L.current={},_.current=t,2===t?U.current=!1:(U.current=!0,q.current=0),null==m||m();return}if(1===t){let t=e<=.25?2*e:.725-(e-.115)*1.1,r=N[0]+2*Math.sin(t*Math.PI),n=N[1]+-2*Math.sin(t*Math.PI),i=N[2]+1*Math.cos(t*Math.PI);k.current.position.set(r,n,i),k.current.rotation.set(-.75*Math.sin(t*Math.PI)+1.25,Math.sin(t*Math.PI)*Math.PI/1.125,Math.PI/3*Math.sin(t*Math.PI))}else if(2===t){let t=e<=.275?2*e:.625-(e-.075)*1.2,r=N[0]+2.5-2.5*Math.sin(t*Math.PI),n=N[1]+-.2*Math.sin(t*Math.PI),i=N[2]+1.1*Math.cos(t*Math.PI);k.current.position.set(r,n,i),k.current.rotation.set(-.75*Math.sin(t*Math.PI)+1.5,-Math.sin(t*Math.PI)*Math.PI,-(Math.PI/1.75*Math.sin(t*Math.PI)))}else if(3===t){var i,a;let t,r,o,s,l;if(z.current<=3*n){let e=k.current.position,t=k.current.rotation;k.current.userData={startPos:[e.x,e.y,e.z],startRot:[t.x,t.y,t.z]}}let c=(null===(i=k.current.userData)||void 0===i?void 0:i.startPos)||N,u=(null===(a=k.current.userData)||void 0===a?void 0:a.startRot)||[0,0,0];if(e<.2){let n=5*e,i=N[0]+1.5,a=N[1]+1.5,d=N[2]-1.5;o=c[0]+(i-c[0])*n,s=c[1]+(a-c[1])*n,l=c[2]+(d-c[2])*n,t=u[0]+(-Math.PI/3-Math.PI/3-u[0])*n,r=u[1]+(Math.PI/4-u[1])*n}else{let n=(e-.2)*2;t=-2*Math.PI/3+3*n*Math.PI/2,r=Math.PI/4*(1-n),o=N[0]+1.5*(1-n),s=N[1]+(2-5*n),l=N[2]-(1.5-3.5*n)}k.current.position.set(o,s,l),k.current.rotation.set(t,r,0)}}else t||r||l||u||c||s||d||h||U.current||2===_.current&&3===C||(k.current.rotation.x*=.85,k.current.rotation.y*=.85,k.current.rotation.z*=.85,k.current.position.x+=(N[0]-k.current.position.x)*.14,k.current.position.y+=(N[1]-k.current.position.y)*.14,k.current.position.z+=(N[2]-k.current.position.z)*.14);if(j&&k.current){if(.8>Math.random())for(let e=0;e<3;e++){let e=2.2*Math.random(),t=new o.Vector3((Math.random()-.5)*.4,e,(Math.random()-.5)*.4);W.current.push({position:t,velocity:new o.Vector3((Math.random()-.5)*4,(Math.random()-.2)*4,(Math.random()-.5)*4).multiplyScalar(.8),life:1,scale:.02*Math.random()+.005})}W.current.forEach(e=>{e.velocity.x+=Math.sin(.01*Date.now())*n*.5,e.velocity.z+=Math.cos(.01*Date.now())*n*.5,e.position.add(e.velocity.clone().multiplyScalar(n)),e.life-=1.5*n,e.velocity.y+=.5*n}),W.current.length>120&&(W.current=W.current.slice(-120)),W.current=W.current.filter(e=>e.life>0)}}}});let Q=e=>{switch(e){case 1:return{position:[N[0]+.3,N[1]+.2,N[2]+.1],rotation:[.2,.3,.1]};case 2:return{position:[N[0]-.3,N[1]-.1,N[2]+.1],rotation:[.2,-.3,-.1]};case 3:return{position:[N[0],N[1]-.15,N[2]-.2],rotation:[-.5,0,0]};default:return{position:[...N],rotation:[0,0,0]}}},J=e=>{if(!A||!I.length)return;let t=Date.now(),r={1:30,2:35,3:45}[e],n=0;if(I.forEach(i=>{i.health&&!(i.health<=0)&&!(t-(L.current[i.id]||0)<100)&&5>=A.distanceTo(i.position)&&(3===e||i.position.clone().sub(A).normalize().dot(new o.Vector3(0,0,-1))>-.5)&&(L.current[i.id]=t,null==P||P(i.id,r),n++,D&&E&&D(e=>[...e,{id:E.current++,damage:r,position:i.position.clone(),isCritical:!1}]))}),n>0){let e=window.gameUI;if(e){let t=Math.min(5*n,5);e.gainRage(t)}}},X=()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(-.25,.25),e.lineTo(-.15,-.15),e.lineTo(0,0),e.lineTo(.25,.25),e.lineTo(.15,-.15),e.lineTo(0,0),e.lineTo(0,.08),e.lineTo(-.2,.12),e.quadraticCurveTo(.8,-.15,-.15,.12),e.quadraticCurveTo(1.8,-0,1.75,.05),e.quadraticCurveTo(2.15,.05,2.35,.225),e.quadraticCurveTo(2.125,-.125,2,-.25),e.quadraticCurveTo(1.8,-.45,1.675,-.55),e.quadraticCurveTo(.9,-.35,.125,-.325),e.lineTo(0,-.08),e.lineTo(0,0),e},K={steps:2,depth:.05,bevelEnabled:!0,bevelThickness:.014,bevelSize:.02,bevelOffset:.04,bevelSegments:2},$={...K,depth:.06,bevelThickness:.02,bevelSize:.02,bevelOffset:0,bevelSegments:6};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("group",{rotation:[-.65,0,.2],scale:[.8,.9,.65],children:(0,n.jsxs)("group",{ref:k,position:[N[0],N[1],N[2]],rotation:[0,0,Math.PI],scale:[.75,.8,.65],children:[(0,n.jsxs)("group",{position:[.25,-.55,.35],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.04,.9,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.35-.11*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.045,.016,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[.25,.225,.35],rotation:[Math.PI,1.5,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.26,.07,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.25*Math.cos(t*Math.PI/4),.25*Math.sin(t*Math.PI/4),0],rotation:[0,0,t*Math.PI/4-Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.07,.55,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]},"spike-".concat(t))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.155,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(65416),emissive:new o.Color(65416),emissiveIntensity:3,transparent:!0,opacity:1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(43588),emissive:new o.Color(43588),emissiveIntensity:40,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.145,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(43588),emissive:new o.Color(43588),emissiveIntensity:35,transparent:!0,opacity:.6})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.175,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(43588),emissive:new o.Color(43588),emissiveIntensity:30,transparent:!0,opacity:.4})]}),(0,n.jsx)("pointLight",{color:new o.Color(65416),intensity:2,distance:1,decay:2})]}),(0,n.jsxs)("group",{position:[.25,.5,.35],rotation:[0,-Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[X(),K]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(43588),emissive:new o.Color(43588),emissiveIntensity:1.5,metalness:.3,roughness:.1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.Shape;return e.moveTo(0,0),e.lineTo(0,.06),e.lineTo(-.15,.09),e.quadraticCurveTo(.6,-.11,-.11,.09),e.quadraticCurveTo(1.35,-.11,1.575,.04),e.quadraticCurveTo(1.61,.015,2.12,0),e.quadraticCurveTo(1.975,-.094,1.9,-.188),e.quadraticCurveTo(1.7,-.338,1.606,-.413),e.quadraticCurveTo(.85,-.263,.094,-.244),e.lineTo(0,-.06),e.lineTo(0,0),e})(),$]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(43588),emissive:new o.Color(43588),emissiveIntensity:3,metalness:.2,roughness:.1,opacity:.8,transparent:!0})]})]}),j&&(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[.25,.7,.35],rotation:[0,-Math.PI/2,Math.PI/2],scale:[.95,1.1,.95],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[X(),{...K,depth:.07}]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(65416),emissive:new o.Color(43588),emissiveIntensity:1.5,transparent:!0,opacity:.3,blending:o.AdditiveBlending})]})}),W.current.map((e,t)=>(0,n.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],children:[(0,n.jsx)("sphereGeometry",{args:[1.25,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Color(65416),emissive:new o.Color(43588),emissiveIntensity:3*e.life,transparent:!0,opacity:.6*e.life,blending:o.AdditiveBlending})]},t))]})]})}),(0,n.jsx)(y.Z,{isActive:h,duration:3,onComplete:w,playerPosition:A,playerRotation:R,dragonGroupRef:T})]})}var w=r(4937);let j=i.memo(e=>{let{position:t,onComplete:r}=e,[o,s]=(0,i.useState)(0),l=(0,i.useCallback)((e,t)=>{s(e=>{let n=e+t;return n>=1.5&&r(),n})},[1.5,r]);(0,a.F)(l);let c=o/1.5,u=Math.sin(c*Math.PI),d=1+2*c,h=(0,i.useMemo)(()=>({color:"#60FF38",emissive:"#60FF38",emissiveIntensity:1.5,transparent:!0}),[]),p=(0,i.useMemo)(()=>({color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2.5,transparent:!0}),[]),m=(0,i.useMemo)(()=>[void 0,void 0,void 0],[]),g=(0,i.useMemo)(()=>[...Array(12)],[]);return(0,n.jsxs)("group",{position:t.toArray(),children:[m.map((e,t)=>(0,n.jsxs)("mesh",{position:[0,2*c+.5*t,0],rotation:[Math.PI/2,0,2*o],children:[(0,n.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,n.jsx)("meshStandardMaterial",{...h,opacity:u*(1-.2*t)})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{scale:[d,d,d],children:[(0,n.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2,transparent:!0,opacity:.3*u})]}),g.map((e,t)=>{let r=t/12*Math.PI*2,i=.75+c;return(0,n.jsxs)("mesh",{position:[Math.cos(r+2*o)*i/1.1,2*c+.5*Math.sin(3*o+t),Math.sin(r+2*o)*i/1.1],children:[(0,n.jsx)("sphereGeometry",{args:[.095,8,8]}),(0,n.jsx)("meshStandardMaterial",{...p,opacity:.8*u})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#60FF38",intensity:2*u,distance:5,decay:2})]})});j.displayName="HealingEffect";let C=(0,i.forwardRef)((e,t)=>{let{parentRef:r}=e,[a,s]=(0,i.useState)(!1),l=(0,i.useCallback)(()=>{s(!0)},[]);return(0,i.useImperativeHandle)(t,()=>({triggerHealingEffect:l})),a&&r.current?(0,n.jsx)(j,{position:r.current.position.clone().add(new o.Vector3(0,0,0)),onComplete:()=>s(!1)}):null});C.displayName="Reanimate";var b=e=>{let{movementDirection:t=new o.Vector3}=e,r=(0,i.useRef)(null),[s,l]=(0,i.useState)({x:0,y:0});(0,a.F)(e=>{let{clock:n}=e;if(!r.current)return;let i=n.getElapsedTime(),o=1.2*t.length(),a=-(.45*t.z)*o,s=-(.125*t.x)*o,c=Math.min(1.5*o,1),u=.035*Math.sin(.7*i)*(1-c)+a*c,d=.175*Math.sin(.5*i)*(1-c)+s*c;l({x:u,y:d}),r.current.rotation.x=.1+u,r.current.rotation.y=d});let c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,r=1.8*Math.pow(t/20,5),i=Math.max(0,1-t/15),o=s.x*i,a=s.y*Math.pow(i,1.2);return(0,n.jsxs)("group",{position:[0,-r+.325,-(.2*t)*(1-t/40-.1)],scale:e,rotation:[-(Math.atan2(.8*Math.pow((t+1)/15,2.2)-r,.4*(1-t/20))+(0===t?Math.PI:0)+o*(1-t/15))+.85*o,a*(1-t/2),0],children:[(0,n.jsxs)("mesh",{rotation:[-(Math.PI/4),0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.055,.125,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("group",{rotation:[Math.PI/2,0,Math.PI/2],children:[(0,n.jsxs)("mesh",{position:[0,.08,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.08,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.015,.25,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,-(Math.PI/2)],children:[(0,n.jsx)("coneGeometry",{args:[.015,.2,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]}),(0,n.jsxs)("group",{rotation:[Math.PI/24,0,-Math.PI/2],children:[(0,n.jsxs)("mesh",{position:[0,.08,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.05,0,0],rotation:[0,0,2*Math.PI],children:[(0,n.jsx)("coneGeometry",{args:[.0125,.04,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.015,.04,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]}),(0,n.jsxs)("mesh",{position:[0,.025,.06],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("sphereGeometry",{args:[.025,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]})};return(0,n.jsx)("group",{ref:r,position:[0,-.7,-.25],rotation:[-.1,0,0],children:[...Array(15)].map((e,t)=>(0,n.jsx)(i.Fragment,{children:c(1-.04*t,t)},t))})};function I(e){let{position:t=new o.Vector3(0,0,0),movementDirection:r=new o.Vector3(0,0,0),isDashing:a=!1,entityId:h,dashCharges:g=[{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0}],chargeDirection:y,currentWeapon:v=u.v.BOW,currentSubclass:j=u.p.ELEMENTAL,isCharging:I=!1,chargeProgress:P=0,isSwinging:D=!1,isSpinning:E=!1,onBowRelease:F=()=>{},onScytheSwingComplete:A=()=>{},onSwordSwingComplete:R=()=>{},onSabresSwingComplete:T=()=>{},onSabresLeftSwingStart:B=()=>{},onSabresRightSwingStart:k=()=>{},onBackstabComplete:z=()=>{},onSunderComplete:V=()=>{},swordComboStep:G=1,isSkyfalling:N=!1,isBackstabbing:W=!1,isSundering:L=!1,isDivineStorming:H=!1,isSwordCharging:O=!1,isDeflecting:U=!1,isSmiting:q=!1,isDeathGrasping:_=!1,onSmiteComplete:Z=()=>{},onDeathGraspComplete:Y=()=>{},onChargeComplete:Q=()=>{},onDeflectComplete:J=()=>{},enemyData:X=[],onHit:K=()=>{},setDamageNumbers:$=()=>{},nextDamageNumberId:ee={current:0},playerPosition:et,playerRotation:er=new o.Vector3(0,0,0),isViperStingCharging:en=!1,viperStingChargeProgress:ei=0,isBarrageCharging:eo=!1,barrageChargeProgress:ea=0,isCobraShotCharging:es=!1,cobraShotChargeProgress:el=0,reanimateRef:ec,setActiveEffects:eu=()=>{}}=e,ed=(0,i.useRef)(null),eh=(0,i.useMemo)(()=>(0,n.jsx)("group",{scale:[.95,.7,.95],position:[0,.04,-.015],rotation:[.4,0,0],children:(0,n.jsx)(s,{})}),[]);(0,i.useMemo)(()=>(0,n.jsx)("group",{scale:[.85,.85,.85],position:[0,.05,.1],children:(0,n.jsx)(b,{movementDirection:r})}),[r]),(0,i.useMemo)(()=>(0,n.jsx)("group",{scale:[.235,.335,.235],position:[-.05,.215,.35],rotation:[.15,0,-5],children:(0,n.jsx)(c,{isLeft:!0})}),[]),(0,i.useMemo)(()=>(0,n.jsx)("group",{scale:[.235,.335,.235],position:[.05,.215,.35],rotation:[.15,0,5],children:(0,n.jsx)(c,{isLeft:!1})}),[]);let ep=(0,i.useMemo)(()=>(0,n.jsxs)("group",{position:[0,.2,-.15],children:[(0,n.jsx)("group",{rotation:[0,Math.PI/5.5,0],children:(0,n.jsx)(l,{isLeftWing:!0,parentRef:ed,isDashing:a})}),(0,n.jsx)("group",{rotation:[0,-Math.PI/5.5,0],children:(0,n.jsx)(l,{isLeftWing:!1,parentRef:ed,isDashing:a})})]}),[a]);return(0,n.jsxs)("group",{ref:ed,position:[t.x,t.y+.2,t.z],children:[eh,ep,(0,n.jsx)(d,{parentRef:ed,dashCharges:g,weaponType:v,weaponSubclass:j}),(0,n.jsx)(p,{parentRef:ed}),v===u.v.BOW?(0,n.jsx)(m,{position:t,direction:r,chargeProgress:P,isCharging:I,onRelease:F,currentSubclass:j,hasInstantPowershot:!1,isAbilityBowAnimation:!1,isViperStingCharging:en,viperStingChargeProgress:ei,isBarrageCharging:eo,barrageChargeProgress:ea,isCobraShotCharging:es,cobraShotChargeProgress:el}):v===u.v.SCYTHE?(0,n.jsx)(f,{parentRef:ed,currentSubclass:j,level:1,isEmpowered:!1,isSpinning:E}):v===u.v.SWORD?(0,n.jsx)(x,{isSwinging:D,isSmiting:!1,isOathstriking:!1,isDivineStorming:H,isColossusStriking:!1,isCharging:O,isDeflecting:U,chargeDirectionProp:y,onSwingComplete:R,onSmiteComplete:()=>{},onOathstrikeComplete:()=>{},onDivineStormComplete:()=>{},onColossusStrikeComplete:()=>{},onChargeComplete:Q,onDeflectComplete:J,hasChainLightning:!1,comboStep:G,currentSubclass:j,enemyData:X,onHit:K,setDamageNumbers:$,nextDamageNumberId:ee,setActiveEffects:eu,playerPosition:et,playerRotation:er,dragonGroupRef:ed,playerEntityId:h}):v===u.v.SABRES?(0,n.jsx)(M,{isSwinging:D,onSwingComplete:T||(()=>{}),onLeftSwingStart:B||(()=>{}),onRightSwingStart:k||(()=>{}),isCharging:I,isSkyfalling:N,isBackstabbing:W,isSundering:L,onBackstabComplete:z,onSunderComplete:V,subclass:j}):v===u.v.RUNEBLADE?(0,n.jsx)(S,{isSwinging:D,isSmiting:q,isDeathGrasping:_,isOathstriking:!1,isDivineStorming:H,isColossusStriking:!1,isCharging:O,isDeflecting:U,chargeDirectionProp:y,onSwingComplete:R,onSmiteComplete:Z,onDeathGraspComplete:Y,onOathstrikeComplete:()=>{},onDivineStormComplete:()=>{},onColossusStrikeComplete:()=>{},onChargeComplete:Q,onDeflectComplete:J,hasChainLightning:!1,comboStep:G,currentSubclass:j,enemyData:X,onHit:K,setDamageNumbers:$,nextDamageNumberId:ee,setActiveEffects:eu,playerPosition:et,playerRotation:er,dragonGroupRef:ed,playerEntityId:h}):null,H&&v===u.v.SWORD&&(0,n.jsx)(w.Z,{position:t,onComplete:()=>{},parentRef:ed,isActive:H,enemyData:X,onHitTarget:(e,t,r,n,i)=>{null==K||K(e,t),$&&ee&&$(e=>[...e,{id:ee.current++,damage:t,position:n.clone(),isCritical:r,isDivineStorm:i}])}}),v===u.v.SCYTHE&&(0,n.jsx)(C,{parentRef:ed,ref:ec})]})}var P=r(319);let D=i.memo(e=>{let{parentRef:t,weaponType:r,weaponSubclass:s,targetPosition:l}=e,c=(0,i.useRef)([]),d=(0,i.useRef)([]),[h,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e;l?(e=l.clone(),d.current=Array(20).fill(0).map(()=>e.clone()),p(!0)):t.current&&(e=t.current.position.clone(),d.current=Array(20).fill(0).map(()=>e.clone()),p(!0))},[t,l,20]);let m=()=>{if(s)switch(s){case u.p.CHAOS:case u.p.ABYSSAL:return"#17CE54";case u.p.DIVINITY:return"#3FD3FC";case u.p.VENGEANCE:return"#4682B4";case u.p.FROST:case u.p.ASSASSIN:return"#FF544E";case u.p.ARCANE:return"#00FF88";case u.p.NATURE:return"#00AA44";case u.p.ELEMENTAL:return"#3EB0FC";case u.p.VENOM:return"#17CC93"}switch(r){case u.v.SCYTHE:return"#17CE54";case u.v.SWORD:return"#6DFF9E";case u.v.SABRES:return"#FF544E";case u.v.RUNEBLADE:return"#00FF88";case u.v.BOW:return"#3A905E"}};return((0,a.F)(()=>{let e;if(h){if(l&&l.clone)e=l.clone();else{if(!t.current||!t.current.position||!t.current.position.clone)return;e=t.current.position.clone()}e.y+=.3,d.current.unshift(e),d.current=d.current.slice(0,20),c.current.forEach((e,t)=>{e&&d.current[t]&&(e.position.copy(d.current[t]),e.scale.setScalar(1-t/20*.6),e.material&&e.material instanceof o.MeshBasicMaterial&&(e.material.opacity=(1-t/20)*.2))})}}),h)?(0,n.jsx)(n.Fragment,{children:Array.from({length:20}).map((e,t)=>(0,n.jsxs)("mesh",{ref:e=>{e&&(c.current[t]=e)},children:[(0,n.jsx)("sphereGeometry",{args:[.475,16,16]}),(0,n.jsx)("meshBasicMaterial",{color:new o.Color(m()),transparent:!0,opacity:.3,depthWrite:!1})]},t))}):null});D.displayName="GhostTrail";var E=r(7771),F=r(73),A=r(6862),R=r(8001),T=r(244);function B(e){let{entityId:t,position:r,world:s,onMeshReady:l,currentWeapon:c=u.v.BOW,currentSubclass:d=u.p.ELEMENTAL,isCharging:h=!1,chargeProgress:p=0,isSwinging:m=!1,isSpinning:g=!1,isDeflecting:f=!1,isSmiting:y=!1,isDeathGrasping:x=!1,onSmiteComplete:v=()=>{},onDeathGraspComplete:M=()=>{},onBowRelease:S=()=>{},onScytheSwingComplete:w=()=>{},onSwordSwingComplete:j=()=>{},onSabresSwingComplete:C=()=>{},onBackstabComplete:b=()=>{},onSunderComplete:B=()=>{},swordComboStep:k=1,isSkyfalling:z=!1,isBackstabbing:V=!1,isSundering:G=!1,isDivineStorming:N=!1,isSwordCharging:W=!1,onChargeComplete:L=()=>{},onDeflectComplete:H=()=>{},rotation:O,isLocalPlayer:U=!0,isViperStingCharging:q=!1,viperStingChargeProgress:_=0,isBarrageCharging:Z=!1,barrageChargeProgress:Y=0,isCobraShotCharging:Q=!1,cobraShotChargeProgress:J=0,reanimateRef:X}=e,K=(0,i.useRef)(!1);K.current||(K.current=!0);let{camera:$}=(0,a.D)(),ee=(0,i.useRef)(null),et=(0,i.useRef)(new o.Vector3(0,0,0)),er=(0,i.useRef)(r?r.clone():new o.Vector3(0,.5,0)),en=(0,i.useRef)(!1),[ei,eo]=(0,i.useState)(new o.Vector3(0,0,0)),ea=(0,i.useRef)(new o.Vector3(0,0,-1)),[es,el]=(0,i.useState)([]),[ec,eu]=(0,i.useState)([{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0}]),[ed,eh]=(0,i.useState)(void 0),[ep,em]=(0,i.useState)([]),eg=(0,i.useRef)(0),ef=(0,i.useRef)(!1),[ey,ex]=(0,i.useState)([]);(0,a.F)(()=>{if(ee.current){if(W&&!ef.current){let e=new o.Vector3;$.getWorldDirection(e),e.y=0,e.normalize(),eh(e)}ef.current=W;let e=Date.now();ex(t=>t.filter(t=>!t.startTime||!t.duration||e-t.startTime<1e3*t.duration)),r&&ee.current.position.copy(r);let n=s.getEntity(t);if(n){.01>Math.random()&&(n.getAllComponents(),n.getComponentNames());let e=n.getComponent(E.i);e&&("function"==typeof e.getDashChargeStatus||"Movement"===e.componentType||"Movement"===e.constructor.name)&&(en.current=e.isDashing,"function"==typeof e.getDashChargeStatus&&eu(e.getDashChargeStatus()),e.isCharging?eh(e.chargeDirection.clone()):eh(void 0))}if(r){let e=r.clone().sub(er.current);e.length()>.001?et.current.copy(e.normalize()):et.current.set(0,0,0),er.current.copy(r)}if(U&&$){let e=new o.Vector3;$.getWorldDirection(e);let r=Math.atan2(e.x,e.z);ee.current.rotation.y=r;let n=s.getEntity(t),i=new o.Vector3(0,r,0);if(n){let e=n.getComponent(E.i);if(e&&e.inputStrength>.1){let t=e.moveDirection;if(t.length()>.1){let e=Math.atan2(t.x,t.z);i=new o.Vector3(0,e,0),ea.current.set(t.x,0,t.z).normalize()}}else{let e=Math.atan2(ea.current.x,ea.current.z);i=new o.Vector3(0,e,0)}}eo(i)}else!U&&O&&(ee.current.rotation.set(O.x,O.y,O.z),eo(new o.Vector3(O.x,O.y,O.z)));if(c===u.v.SWORD){let e=s.queryEntities([F.w,A.S,R.C]).map(e=>{let t=e.getComponent(F.w),r=e.getComponent(A.S);return{id:e.id.toString(),position:t.getWorldPosition(),health:r.currentHealth}}).filter(e=>e.health>0);el(e),m&&e.length}}}),(0,i.useEffect)(()=>{ee.current&&l&&l(ee.current)},[l]);let ev=(e,r)=>{let n=s.getEntity(parseInt(e)),i=s.getEntity(t);if(n&&i){let e=s.getSystem(T.b);e&&e.queueDamage(n,r,i,"sword")}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("group",{ref:ee,children:(0,n.jsx)(I,{position:new o.Vector3(0,0,0),movementDirection:et.current,isDashing:en.current,entityId:t,dashCharges:ec,chargeDirection:ed,currentWeapon:c,currentSubclass:d,isCharging:h,chargeProgress:p,isSwinging:m,isSpinning:g,onBowRelease:S,onScytheSwingComplete:w,onSwordSwingComplete:j,onSabresSwingComplete:C,onBackstabComplete:b,onSunderComplete:B,swordComboStep:k,isSkyfalling:z,isBackstabbing:V,isSundering:G,isDivineStorming:N,isSwordCharging:W,isDeflecting:f,isSmiting:y,isDeathGrasping:x,onSmiteComplete:v,onDeathGraspComplete:M,onChargeComplete:L,onDeflectComplete:H,enemyData:es,onHit:ev,setDamageNumbers:em,nextDamageNumberId:eg,playerPosition:r,playerRotation:ei,isViperStingCharging:q,viperStingChargeProgress:_,isBarrageCharging:Z,barrageChargeProgress:Y,isCobraShotCharging:Q,cobraShotChargeProgress:J,reanimateRef:X,setActiveEffects:ex})}),(0,n.jsx)(D,{parentRef:ee,weaponType:c,weaponSubclass:d}),U&&c===u.v.BOW&&(0,n.jsx)(P.default,{parentRef:ee,enemyData:es,onHit:ev,setDamageNumbers:em,nextDamageNumberId:eg,onHealthChange:e=>{},charges:ec.map((e,t)=>({id:t+1,available:e.isAvailable,cooldownStartTime:e.cooldownRemaining>0?Date.now()-(15e3-1e3*e.cooldownRemaining):null})),setCharges:e=>{"function"==typeof e?eu(t=>e(t.map((e,t)=>({id:t+1,available:e.isAvailable,cooldownStartTime:e.cooldownRemaining>0?Date.now()-(15e3-1e3*e.cooldownRemaining):null}))).map((e,t)=>({isAvailable:e.available,cooldownRemaining:e.cooldownStartTime?Math.max(0,(15e3-(Date.now()-e.cooldownStartTime))/1e3):0}))):eu(e.map(e=>({isAvailable:e.available,cooldownRemaining:e.cooldownStartTime?Math.max(0,(15e3-(Date.now()-e.cooldownStartTime))/1e3):0})))}})]})}},7125:function(e,t,r){var n,i,o,a;r.d(t,{p:function(){return i},v:function(){return n}}),(o=n||(n={})).SCYTHE="SCYTHE",o.SWORD="SWORD",o.SABRES="SABRES",o.RUNEBLADE="RUNEBLADE",o.BOW="BOW",(a=i||(i={})).CHAOS="CHAOS",a.ABYSSAL="ABYSSAL",a.DIVINITY="DIVINITY",a.VENGEANCE="VENGEANCE",a.FROST="FROST",a.ASSASSIN="ASSASSIN",a.ARCANE="ARCANE",a.NATURE="NATURE",a.ELEMENTAL="ELEMENTAL",a.VENOM="VENOM"},5658:function(e,t,r){r.d(t,{Z:function(){return x}});var n=r(7437),i=r(2265),o=r(1448);let a=e=>{switch(e){case 1:case 5:return{color:"#ff0000",emissive:"#600000"};case 2:return{color:"#ffa500",emissive:"#cc8400"};case 3:return{color:"#87ceeb",emissive:"#4682b4"};case 4:return{color:"#dda0dd",emissive:"#9370db"};default:return{color:"#00ff00",emissive:"#006600"}}},s=e=>{let t=a(e),r=new o.Color(t.color);return{uniforms:{topColor:{value:r.clone().multiplyScalar(.5)},middleColor:{value:r.clone().multiplyScalar(.85)},bottomColor:{value:r.clone().lerp(new o.Color("#87CEEB"),.6)},offset:{value:33},exponent:{value:.6}},vertexShader:"\n      varying vec3 vWorldPosition;\n      \n      void main() {\n        vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n        vWorldPosition = worldPosition.xyz;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n    ",fragmentShader:"\n      uniform vec3 topColor;\n      uniform vec3 middleColor;\n      uniform vec3 bottomColor;\n      uniform float offset;\n      uniform float exponent;\n      \n      varying vec3 vWorldPosition;\n      \n      void main() {\n        float h = normalize(vWorldPosition + vec3(0.0, offset, 0.0)).y;\n        float mixStrength = max(pow(max(h, 0.0), exponent), 0.0);\n        vec3 color = mix(middleColor, topColor, mixStrength);\n        color = mix(bottomColor, color, smoothstep(0.0, 1.0, h));\n        gl_FragColor = vec4(color, 1.0);\n      }\n    "}};var l=e=>{let{level:t=1}=e,r=(0,i.useMemo)(()=>{let e=s(t);return{uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:o.BackSide}},[t]),a=(0,i.useMemo)(()=>new o.SphereGeometry(500,32,32),[]);return(0,n.jsx)("mesh",{geometry:a,children:(0,n.jsx)("shaderMaterial",{attach:"material",args:[r]})})},c=r(1276),u=()=>{let e=(0,i.useRef)(null),t=(0,i.useRef)(null),r=(0,i.useMemo)(()=>new o.SphereGeometry(1,24,24),[]),a=(0,i.useMemo)(()=>new o.RingGeometry(1.4,2.1,48),[]),s=(0,i.useMemo)(()=>new o.MeshStandardMaterial({color:"#B8E0D2",roughness:.7,metalness:.2,emissive:"#B8E0D2",emissiveIntensity:.675}),[]),l=(0,i.useMemo)(()=>new o.MeshBasicMaterial({color:"#4dff90",transparent:!0,opacity:.5}),[]),u=(0,i.useMemo)(()=>new o.MeshBasicMaterial({color:"#4dff90",transparent:!0,opacity:.2,side:o.BackSide}),[]),d=(0,i.useMemo)(()=>{let e=document.createElement("canvas");e.width=256,e.height=256;let t=e.getContext("2d"),r=t.createRadialGradient(128,128,50,128,128,128);r.addColorStop(0,"rgba(255, 255, 255, 0)"),r.addColorStop(.3,"rgba(255, 255, 255, 0.8)"),r.addColorStop(.5,"rgba(255, 255, 255, 1)"),r.addColorStop(.7,"rgba(255, 255, 255, 0.6)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=r,t.fillRect(0,0,256,256);let n=new o.CanvasTexture(e);return n.minFilter=o.LinearFilter,n.magFilter=o.LinearFilter,n.generateMipmaps=!1,n},[]),h=(0,i.useMemo)(()=>new o.MeshStandardMaterial({map:d,color:"#A8DBFF",transparent:!0,opacity:1,side:o.DoubleSide,alphaMap:d,roughness:.7,metalness:.2,emissive:"#77FFC0",emissiveIntensity:1.1}),[d]),p=(0,i.useMemo)(()=>new o.Frustum,[]),m=(0,i.useMemo)(()=>new o.Matrix4,[]),g=(0,i.useMemo)(()=>new o.Sphere(new o.Vector3,24*Math.sqrt(3)),[]);return(0,c.F)((r,n)=>{e.current&&(e.current.rotation.z+=.006*n),t.current&&(m.multiplyMatrices(r.camera.projectionMatrix,r.camera.matrixWorldInverse),p.setFromProjectionMatrix(m),g.center.copy(t.current.position),t.current.visible=p.intersectsSphere(g))}),(0,n.jsxs)("group",{ref:t,position:[100,80,-150],scale:[24,24,24],rotation:[1,.1,.1],children:[(0,n.jsx)("mesh",{geometry:r,material:s}),(0,n.jsx)("mesh",{ref:e,rotation:[Math.PI/2.8,0,0],geometry:a,material:h}),(0,n.jsx)("mesh",{scale:[1.05,1.05,1.05],geometry:r,material:l}),(0,n.jsx)("mesh",{scale:[1.1,1.1,1.1],geometry:r,material:u})]})},d=r(6018),h=e=>{let{mountains:t}=e,r=(0,i.useRef)(null),a=(0,i.useRef)(null),s=(0,i.useMemo)(()=>t.map((e,t)=>(0,d.C)(t)),[t]),l=(0,i.useMemo)(()=>new o.MeshStandardMaterial({color:"#8B7355",roughness:.8,metalness:.1}),[]),c=(0,i.useMemo)(()=>new o.MeshStandardMaterial({color:"#6B5B47",roughness:.9,metalness:.05}),[]),u=(0,i.useMemo)(()=>new o.MeshStandardMaterial({color:"#f0f0f0",roughness:.3,metalness:0}),[]),h=(0,i.useMemo)(()=>new o.ConeGeometry(23,34.5,24,6),[]),p=(0,i.useMemo)(()=>new o.ConeGeometry(24,29,25,5),[]);return(0,i.useEffect)(()=>{if(!r.current||!a.current)return;let e=new o.Matrix4;t.forEach((t,n)=>{var i;e.makeTranslation(t.position.x,t.position.y,t.position.z);let a=new o.Matrix4().makeScale(t.scale,t.scale,t.scale);e.multiply(a),null===(i=r.current)||void 0===i||i.setMatrixAt(n,e)}),t.forEach((t,r)=>{var n;let i=new o.Matrix4().makeRotationFromEuler(new o.Euler(0,.5,.1)),s=-4*t.scale,l=-5*t.scale,c=-2*t.scale;e.makeTranslation(t.position.x+s,t.position.y+l,t.position.z+c);let u=new o.Matrix4().makeScale(t.scale,t.scale,t.scale);e.multiply(i).multiply(u),null===(n=a.current)||void 0===n||n.setMatrixAt(r,e)}),r.current.instanceMatrix.needsUpdate=!0,a.current.instanceMatrix.needsUpdate=!0},[t]),(0,n.jsxs)("group",{children:[(0,n.jsx)("instancedMesh",{args:[h,l,t.length],ref:r,castShadow:!0,receiveShadow:!0}),(0,n.jsx)("instancedMesh",{args:[p,c,t.length],ref:a,castShadow:!0}),t.map((e,t)=>(0,n.jsx)("mesh",{geometry:s[t],material:u,position:[e.position.x,e.position.y+14*e.scale,e.position.z],scale:[.9*e.scale,e.scale,.9*e.scale],castShadow:!0},"peak-".concat(t)))]})},p=i.memo(e=>{let{position:t=[0,0,0],level:r=1}=e,a=e=>{switch(e){case 1:return{color:"#FF6E6E",emissive:"#FF6E6E"};case 2:return{color:"#ffa500",emissive:"#cc8400"};case 3:return{color:"#87ceeb",emissive:"#4682b4"};case 4:return{color:"#dda0dd",emissive:"#9370db"};case 5:return{color:"#ff0000",emissive:"#600000"};default:return{color:"#00ff00",emissive:"#006600"}}},{pillarGeometries:s,materials:l}=(0,i.useMemo)(()=>{let e=new o.CylinderGeometry(2,2.2,1,8),t=new o.CylinderGeometry(1.5,1.5,8,8),n=new o.CylinderGeometry(2.2,2,1,8),i=new o.MeshStandardMaterial({color:"#ffffff",roughness:.7,metalness:.2}),s=new o.SphereGeometry(1,32,32),l=a(r);return{pillarGeometries:{base:e,column:t,top:n,orb:s},materials:{stone:i,orb:new o.MeshStandardMaterial({color:l.color,emissive:l.emissive,metalness:1,roughness:.2})}}},[r]),[c,u]=i.useState(0);i.useEffect(()=>{let e;let t=()=>{u(e=>(e+.02)%(2*Math.PI)),e=requestAnimationFrame(t)};return t(),()=>{cancelAnimationFrame(e)}},[]),i.useEffect(()=>()=>{Object.values(s).forEach(e=>e.dispose()),Object.values(l).forEach(e=>e.dispose())},[s,l]);let d=a(r);return(0,n.jsxs)("group",{position:t,scale:[.35,.35,.35],children:[(0,n.jsx)("mesh",{geometry:s.base,material:l.stone,position:[0,0,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.column,material:l.stone,position:[0,.25,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.top,material:l.stone,position:[0,3,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.orb,material:l.orb,position:[0,5,0],rotation:[c,c,0],children:(0,n.jsx)("pointLight",{color:d.color,intensity:.5,distance:5})})]})}),m=i.memo(e=>{let{position:t=[0,0,0],scale:r=1,level:a=1}=e,{pedestalGeometry:s,material:l}=(0,i.useMemo)(()=>({pedestalGeometry:{base:new o.CylinderGeometry(4,4.5,2.5,12),topRing:new o.CylinderGeometry(4.2,4.2,.3,12)},material:new o.MeshStandardMaterial({color:"#e8e8e8",roughness:.8,metalness:.1})}),[]);return i.useEffect(()=>()=>{Object.values(s).forEach(e=>e.dispose()),l.dispose()},[s,l]),(0,n.jsxs)("group",{position:t,scale:[r/1.25,r/1.25,r/1.25],children:[(0,n.jsx)("mesh",{geometry:s.base,material:l,position:[0,0,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.topRing,material:l,position:[0,.6,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("pointLight",{position:[0,2.5,0],color:(e=>{switch(e){case 1:return{color:"#FF6E6E",emissive:"#FF6E6E"};case 2:return{color:"#ffa500",emissive:"#cc8400"};case 3:return{color:"#87ceeb",emissive:"#4682b4"};case 4:return{color:"#dda0dd",emissive:"#9370db"};case 5:return{color:"#ff0000",emissive:"#600000"};default:return{color:"#00ff00",emissive:"#006600"}}})(a).color,intensity:.8,distance:8,decay:2})]})}),g=r(73),f=r(3478),y=e=>{let{world:t,positions:r}=e,n=(0,i.useRef)([]);return(0,i.useEffect)(()=>{let e=[];return r.forEach(r=>{let n=t.createEntity(),i=t.createComponent(g.w);i.setPosition(r[0],r[1]+1,r[2]),n.addComponent(i);let o=t.createComponent(f.YM);o.type=f.F5.CYLINDER,o.radius=.7,o.height=3,o.layer=f.aB.ENVIRONMENT,o.isStatic=!0,o.isTrigger=!1,o.setOffset(0,0,0),n.addComponent(o),t.notifyEntityAdded(n),e.push(n)}),n.current=e,()=>{e.forEach(e=>{t.getEntity(e.id)&&t.destroyEntity(e.id)}),n.current=[]}},[t,r]),null},x=e=>{let{level:t=1,enableMountains:r=!0,enablePlanet:o=!0,enableSky:a=!0,world:s}=e,c=(0,i.useMemo)(()=>(0,d.m)(),[]),g=(0,i.useMemo)(()=>[[0,0,-5],[-4.25,0,2.5],[4.25,0,2.5]],[]),f=(0,i.useMemo)(()=>[0,0,0],[]);return(0,n.jsxs)("group",{name:"environment",children:[a&&(0,n.jsx)(l,{level:t}),o&&(0,n.jsx)(u,{}),r&&(0,n.jsx)(h,{mountains:c}),(0,n.jsx)(m,{position:f,scale:.4,level:t}),(0,n.jsx)(p,{position:g[0],level:t}),(0,n.jsx)(p,{position:g[1],level:t}),(0,n.jsx)(p,{position:g[2],level:t}),s&&(0,n.jsx)(y,{world:s,positions:g})]})}},2824:function(e,t,r){r.d(t,{Z:function(){return j}});var n=r(7437),i=r(2265),o=r(1276),a=r(73),s=r(1168),l=r(246),c=r(8001),u=r(6862),d=r(1448),h=e=>{let{color:t,size:r,mesh1Ref:a,mesh2Ref:s,opacity:l=1}=e,c=(0,i.useRef)(null),u=(0,i.useRef)(null),h=(0,i.useRef)(new Float32Array(135)),p=(0,i.useRef)(new Float32Array(135)),m=(0,i.useRef)(new Float32Array(45)),g=(0,i.useRef)(new Float32Array(45)),f=(0,i.useRef)(new Float32Array(45)),y=(0,i.useRef)(new Float32Array(45)),x=(0,i.useRef)(!1),v=(0,i.useRef)(new d.Vector3),M=(0,i.useRef)(new d.Vector3),S=(0,i.useRef)(0);return(0,i.useEffect)(()=>{if(a.current&&s.current&&!x.current){let{x:e,y:t,z:r}=a.current.position,{x:n,y:i,z:o}=s.current.position;v.current.set(e,t,r),M.current.set(n,i,o);for(let a=0;a<45;a++)h.current[3*a]=e,h.current[3*a+1]=t,h.current[3*a+2]=r,p.current[3*a]=n,p.current[3*a+1]=i,p.current[3*a+2]=o,m.current[a]=0,g.current[a]=0,f.current[a]=0,y.current[a]=0;x.current=!0}},[a,s]),(0,o.F)((e,t)=>{var n,i;if(!(null===(n=c.current)||void 0===n?void 0:n.parent)||!(null===(i=u.current)||void 0===i?void 0:i.parent)||!a.current||!s.current||!x.current||(S.current+=t,S.current<.016))return;S.current=0;let o=a.current.position,d=s.current.position,w=o.distanceTo(v.current),j=d.distanceTo(M.current);if(w>.05||j>.05){v.current.copy(o),M.current.copy(d);for(let e=44;e>0;e--)h.current[3*e]=h.current[(e-1)*3],h.current[3*e+1]=h.current[(e-1)*3+1],h.current[3*e+2]=h.current[(e-1)*3+2],p.current[3*e]=p.current[(e-1)*3],p.current[3*e+1]=p.current[(e-1)*3+1],p.current[3*e+2]=p.current[(e-1)*3+2];if(h.current[0]=o.x,h.current[1]=o.y,h.current[2]=o.z,p.current[0]=d.x,p.current[1]=d.y,p.current[2]=d.z,c.current&&u.current){let e=c.current.geometry,t=u.current.geometry;e.attributes.position.needsUpdate=!0,t.attributes.position.needsUpdate=!0}}for(let e=0;e<45;e++)m.current[e]=.6*Math.pow(1-e/45,2)*l,g.current[e]=.6*Math.pow(1-e/45,2)*l,f.current[e]=.5*r*Math.pow(1-e/45,.5),y.current[e]=.5*r*Math.pow(1-e/45,.5);if(c.current&&u.current){let e=c.current.geometry,t=u.current.geometry;e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0,t.attributes.opacity.needsUpdate=!0,t.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("points",{ref:c,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:45,array:h.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:45,array:m.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:45,array:f.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:d.AdditiveBlending,vertexShader:"\n            attribute float opacity;\n            attribute float scale;\n            varying float vOpacity;\n            void main() {\n              vOpacity = opacity;\n              vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n              gl_Position = projectionMatrix * mvPosition;\n              gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n            }\n          ",fragmentShader:"\n            varying float vOpacity;\n            uniform vec3 uColor;\n            void main() {\n              float d = length(gl_PointCoord - vec2(0.5));\n              float strength = smoothstep(0.5, 0.1, d);\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n              gl_FragColor = vec4(glowColor, vOpacity * strength);\n            }\n          ",uniforms:{uColor:{value:t}}})]}),(0,n.jsxs)("points",{ref:u,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:45,array:p.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:45,array:g.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:45,array:y.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:d.AdditiveBlending,vertexShader:"\n            attribute float opacity;\n            attribute float scale;\n            varying float vOpacity;\n            void main() {\n              vOpacity = opacity;\n              vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n              gl_Position = projectionMatrix * mvPosition;\n              gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n            }\n          ",fragmentShader:"\n            varying float vOpacity;\n            uniform vec3 uColor;\n            void main() {\n              float d = length(gl_PointCoord - vec2(0.5));\n              float strength = smoothstep(0.5, 0.1, d);\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n              gl_FragColor = vec4(glowColor, vOpacity * strength);\n            }\n          ",uniforms:{uColor:{value:t}}})]})]})};function p(e){let{id:t,position:r,direction:a,onImpact:s,checkCollisions:l}=e,c=(0,i.useRef)(null),u=(0,i.useRef)(null),p=(0,i.useRef)(new d.Clock),m=(0,i.useRef)(r.clone()),g=(0,i.useRef)(r.clone()),f=(0,i.useRef)(!1),y=(0,i.useRef)(null),[x,v]=(0,i.useState)(1),{scene:M}=(0,o.D)(),S=new d.Color("#8B00FF"),w=(0,i.useRef)(0);return(0,o.F)((e,r)=>{if(!c.current||!u.current)return;let n=Date.now();if(null!==y.current){let e=Math.min((n-y.current)/500,1);if(v(1-e),e>=1){c.current.removeFromParent(),u.current.removeFromParent(),s&&s();return}}if(f.current)return;if(p.current.getElapsedTime()>5){f.current=!0,y.current=n;return}w.current+=r;let i=a.clone().multiplyScalar(.25*r*60);if(m.current.add(i),m.current.distanceTo(g.current)>=20){f.current=!0,y.current=n,s&&s(m.current.clone());return}if(l){let e=m.current.clone();if(l(t,e)){f.current=!0,y.current=n,s&&s(e);return}}let o=3.5*w.current*Math.PI*2,h=new d.Vector3(.375*Math.cos(o),.375*Math.sin(.5*o)*.3,0),x=new d.Vector3(.375*Math.cos(o+Math.PI),.375*Math.sin((o+Math.PI)*.5)*.3,0),M=new d.Vector3,S=new d.Vector3(0,1,0);M.crossVectors(a,S).normalize(),S.crossVectors(M,a).normalize();let j=M.clone().multiplyScalar(h.x).add(S.clone().multiplyScalar(h.y)),C=M.clone().multiplyScalar(x.x).add(S.clone().multiplyScalar(x.y));c.current.position.copy(m.current.clone().add(j)),u.current.position.copy(m.current.clone().add(C))}),(0,n.jsxs)("group",{name:"crossentropy-bolt-group",children:[(0,n.jsxs)("mesh",{ref:c,position:m.current,children:[(0,n.jsx)("sphereGeometry",{args:[.25,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#A020F0",emissiveIntensity:2*x,transparent:!0,opacity:.9*x,depthWrite:!1,blending:d.AdditiveBlending,toneMapped:!1}),(0,n.jsx)("pointLight",{color:S,intensity:5*x,distance:12})]}),(0,n.jsxs)("mesh",{ref:u,position:m.current,children:[(0,n.jsx)("sphereGeometry",{args:[.25,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#A020F0",emissiveIntensity:2*x,transparent:!0,opacity:.9*x,depthWrite:!1,blending:d.AdditiveBlending,toneMapped:!1}),(0,n.jsx)("pointLight",{color:S,intensity:5*x,distance:12})]}),(0,n.jsx)(h,{color:S,size:.225,mesh1Ref:c,mesh2Ref:u,opacity:x}),(0,n.jsx)("pointLight",{color:S,intensity:8*x,distance:4,decay:2})]})}var m=e=>{let{color:t,size:r,meshRef:a,opacity:s=1}=e,l=(0,i.useRef)(null),c=(0,i.useRef)(new Float32Array(75)),u=(0,i.useRef)(new Float32Array(25)),h=(0,i.useRef)(new Float32Array(25)),p=(0,i.useRef)(!1),m=(0,i.useRef)(new d.Vector3),g=(0,i.useRef)(0);return(0,i.useEffect)(()=>{if(a.current&&!p.current){let e=new d.Vector3;a.current.getWorldPosition(e);let{x:t,y:r,z:n}=e;m.current.set(t,r,n);for(let e=0;e<25;e++)c.current[3*e]=t,c.current[3*e+1]=r,c.current[3*e+2]=n,u.current[e]=0,h.current[e]=0;p.current=!0}},[a]),(0,o.F)((e,t)=>{var n;if(!(null===(n=l.current)||void 0===n?void 0:n.parent)||!a.current||!p.current||(g.current+=t,g.current<.02))return;g.current=0;let i=new d.Vector3;if(a.current.getWorldPosition(i),i.distanceTo(m.current)>.08){m.current.copy(i);for(let e=24;e>0;e--)c.current[3*e]=c.current[(e-1)*3],c.current[3*e+1]=c.current[(e-1)*3+1],c.current[3*e+2]=c.current[(e-1)*3+2];c.current[0]=i.x,c.current[1]=i.y,c.current[2]=i.z,l.current&&(l.current.geometry.attributes.position.needsUpdate=!0)}for(let e=0;e<25;e++)u.current[e]=.7*Math.pow(1-e/25,2)*s,h.current[e]=.6*r*Math.pow(1-e/25,.6);if(l.current){let e=l.current.geometry;e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:l,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:25,array:c.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:25,array:u.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:25,array:h.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:d.AdditiveBlending,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 18.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            // Entropic effect with green energy glow\n            vec3 glowColor = mix(uColor, vec3(0.4, 1.0, 0.6), 0.3);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})};function g(e){let{id:t,position:r,direction:a,onImpact:s,checkCollisions:l}=e,c=(0,i.useRef)(null);(0,i.useRef)(null);let u=(0,i.useRef)(r.clone()),h=(0,i.useRef)(!1),[p,g]=(0,i.useState)(!1),[y,x]=(0,i.useState)(null),v=(0,i.useRef)(r.clone().add(a.clone().multiplyScalar(25))),M=(0,i.useRef)(0),S=(0,i.useRef)(1e3*Math.random()),w=(0,i.useRef)(new d.Vector3);return(0,i.useEffect)(()=>{c.current&&c.current.position.copy(r)},[r]),(0,o.F)((e,r)=>{if(!c.current||h.current)return;M.current+=r;let n=Math.min(1*M.current,1),i=u.current.clone().lerp(v.current,n),o=M.current,a=S.current,d=(1-n)*.15;w.current.set(.3*Math.sin(8*o+a)*Math.sin(3*o+.5*a)*3.5+(Math.random()-.5)*d,.4*Math.cos(6*o+1.5*a)*Math.sin(4*o+.8*a)*3.6+(Math.random()-.5)*d,.25*Math.sin(7*o+2*a)*Math.cos(5*o+1.2*a)*3.4+(Math.random()-.5)*d);let p=i.clone().add(w.current);if(c.current.position.copy(p),l){let e=c.current.position.clone();if(l(t,e)){h.current=!0,x(e),g(!0),s&&s(e);return}}n>=1&&!h.current&&(h.current=!0,x(v.current.clone()),g(!0),s&&s(v.current.clone()))}),(0,n.jsxs)("group",{children:[!h.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m,{color:new d.Color("#00ff44"),size:.3,meshRef:c,opacity:1}),(0,n.jsx)("group",{ref:c,position:r.toArray(),children:(0,n.jsx)("group",{rotation:[0,Math.atan2(a.x,a.z),0],children:(0,n.jsx)("pointLight",{color:"#00ff44",intensity:3,distance:4,decay:2})})})]}),p&&y&&(0,n.jsx)(f,{position:y,onComplete:()=>{setTimeout(()=>{s&&s()},200)}})]})}function f(e){let{position:t,onComplete:r}=e,o=(0,i.useRef)(Date.now()),[,a]=(0,i.useState)({});(0,i.useEffect)(()=>{let e=setInterval(()=>{a({}),(Date.now()-o.current)/1e3>.7&&(clearInterval(e),r&&r())},16),t=setTimeout(()=>{clearInterval(e),r&&r()},700);return()=>{clearInterval(e),clearTimeout(t)}},[r]);let s=(Date.now()-o.current)/1e3,l=Math.max(0,1-s/.7);return l<=0?null:(0,n.jsxs)("group",{position:t,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.675*(1+1.5*s),12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#00ff44",emissiveIntensity:1*l,transparent:!0,opacity:.6*l,blending:d.AdditiveBlending,depthWrite:!1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.45*(1+2*s),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#33ff66",emissive:"#33ff66",emissiveIntensity:1*l,transparent:!0,opacity:.7*l,blending:d.AdditiveBlending,depthWrite:!1})]}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2,i=1*(1+1.2*s);return(0,n.jsxs)("mesh",{position:[Math.sin(r)*i,Math.cos(r)*i*.2,Math.cos(r+Math.PI/3)*i*.4],rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("coneGeometry",{args:[.08,.4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#66ff88",emissiveIntensity:1.5*l,transparent:!0,opacity:.8*l})]},t)}),[void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,t*Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[1*(1+1.5*s)+.2*t,.08,6,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#00ff44",emissiveIntensity:1.5*l,transparent:!0,opacity:.5*l*(1-.3*t),blending:d.AdditiveBlending})]},"energy-ring-".concat(t))),(0,n.jsx)("pointLight",{color:"#00ff44",intensity:8*l,distance:4,decay:2})]})}var y=function(e){let{color:t,size:r,arrowHeadRef:a,arrowShaftRef:s,opacity:l=1}=e,c=(0,i.useRef)(null),u=(0,i.useRef)([]),h=(0,i.useRef)(!1),p=(0,i.useMemo)(()=>{let e=new d.BufferGeometry,t=new Float32Array(225),r=new Float32Array(225),n=[];for(let e=0;e<75;e++){t[3*e]=0,t[3*e+1]=0,t[3*e+2]=0;let n=1-e/75;r[3*e]=1,r[3*e+1]=.6*n,r[3*e+2]=0}for(let e=0;e<74;e++)n.push(e,e+1);return e.setAttribute("position",new d.BufferAttribute(t,3)),e.setAttribute("color",new d.BufferAttribute(r,3)),e.setIndex(n),e},[75]),m=(0,i.useMemo)(()=>new d.LineBasicMaterial({vertexColors:!0,transparent:!0,opacity:.8*l,blending:d.AdditiveBlending,depthWrite:!1,linewidth:3}),[l]);return(0,o.F)(()=>{if(!a.current||!c.current)return;let e=new d.Vector3;if(a.current.getWorldPosition(e),.01>e.lengthSq())return;if(!h.current){for(let t=0;t<75;t++)u.current.push(e.clone());h.current=!0;let t=p.attributes.position.array;for(let r=0;r<75;r++)t[3*r]=e.x,t[3*r+1]=e.y,t[3*r+2]=e.z;p.attributes.position.needsUpdate=!0;return}u.current.unshift(e),u.current.length>75&&u.current.pop();let t=p.attributes.position.array;for(let e=0;e<u.current.length;e++){let r=u.current[e];t[3*e]=r.x,t[3*e+1]=r.y,t[3*e+2]=r.z}p.attributes.position.needsUpdate=!0}),(0,n.jsxs)("group",{name:"charged-arrow-trail",children:[(0,n.jsx)("primitive",{ref:c,object:new d.Line(p,m)}),u.current.slice(0,5).map((e,i)=>(0,n.jsxs)("mesh",{position:e,children:[(0,n.jsx)("sphereGeometry",{args:[2*r*(.3-.05*i),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:t,emissive:t,emissiveIntensity:2-.3*i,transparent:!0,opacity:l*(1-.2*i),depthWrite:!1,blending:d.AdditiveBlending,toneMapped:!1})]},i)),u.current.slice(0,3).map((e,t)=>(0,n.jsx)("group",{position:e,children:[0,1,2].map(e=>(0,n.jsxs)("mesh",{position:[(Math.random()-.5)*.3,(Math.random()-.5)*.3,(Math.random()-.5)*.3],children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc00",emissive:"#ff8800",emissiveIntensity:3,transparent:!0,opacity:l*(1-.3*t),depthWrite:!1,blending:d.AdditiveBlending})]},e))},"spark-".concat(t)))]})};function x(e){let{position:t,direction:r,onImpact:a}=e,s=(0,i.useRef)(null),l="#ffaa00",c=(0,i.useRef)(null),u=(0,i.useRef)(null);return(0,o.F)((e,n)=>{if(!s.current)return;s.current.position.copy(t);let i=t.clone().add(r.clone().normalize());s.current.lookAt(i)}),(0,n.jsxs)("group",{name:"charged-arrow-group",children:[(0,n.jsxs)("group",{ref:s,position:t,children:[(0,n.jsxs)("mesh",{ref:c,position:[0,0,.2],children:[(0,n.jsx)("coneGeometry",{args:[.08,.25,8]}),(0,n.jsx)("meshStandardMaterial",{color:l,emissive:"#ff6600",emissiveIntensity:3,transparent:!0,opacity:.9,depthWrite:!1,blending:d.AdditiveBlending,toneMapped:!1}),(0,n.jsx)("pointLight",{color:l,intensity:8,distance:6})]}),(0,n.jsxs)("mesh",{ref:u,children:[(0,n.jsx)("cylinderGeometry",{args:[.02,.03,.4,8]}),(0,n.jsx)("meshStandardMaterial",{color:l,emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:.8,depthWrite:!1,blending:d.AdditiveBlending,toneMapped:!1})]}),(0,n.jsx)("group",{position:[0,0,-.15],children:[0,120,240].map((e,t)=>(0,n.jsxs)("mesh",{position:[.04*Math.cos(e*Math.PI/180),.04*Math.sin(e*Math.PI/180),0],rotation:[0,0,e*Math.PI/180],children:[(0,n.jsx)("planeGeometry",{args:[.08,.12]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc44",emissive:"#ff9900",emissiveIntensity:1.5,transparent:!0,opacity:.7,side:d.DoubleSide,depthWrite:!1,blending:d.AdditiveBlending})]},t))}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.22499999999999998,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:l,emissive:"#ffaa00",emissiveIntensity:1,transparent:!0,opacity:.3,depthWrite:!1,blending:d.AdditiveBlending,toneMapped:!1})]}),(0,n.jsx)("pointLight",{color:l,intensity:12,distance:8,decay:2})]}),(0,n.jsx)(y,{color:l,size:.15,arrowHeadRef:c,arrowShaftRef:u,opacity:1})]})}function v(e){let{position:t,direction:r,onImpact:a,distanceTraveled:s=0,maxDistance:l=25}=e,c=(0,i.useRef)(null),u="#ffaa00",h=.7*l,p=Math.max(.1,1-Math.max(0,Math.min(1,(s-h)/(l-h))));return(0,o.F)((e,n)=>{if(!c.current)return;c.current.position.copy(t);let i=t.clone().add(r.clone().normalize());c.current.lookAt(i)}),(0,n.jsx)("group",{name:"regular-arrow-group",children:(0,n.jsxs)("group",{ref:c,position:t,children:[(0,n.jsxs)("mesh",{position:[0,0,.2],children:[(0,n.jsx)("coneGeometry",{args:[.08,.25,8]}),(0,n.jsx)("meshStandardMaterial",{color:u,emissive:"#ff6600",emissiveIntensity:3*p,transparent:!0,opacity:.9*p,depthWrite:!1,blending:d.AdditiveBlending,toneMapped:!1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.02,.03,.4,8]}),(0,n.jsx)("meshStandardMaterial",{color:u,emissive:"#ff8800",emissiveIntensity:2*p,transparent:!0,opacity:.8*p,depthWrite:!1,blending:d.AdditiveBlending,toneMapped:!1})]}),(0,n.jsx)("group",{position:[0,0,-.15],children:[0,120,240].map((e,t)=>(0,n.jsxs)("mesh",{position:[.04*Math.cos(e*Math.PI/180),.04*Math.sin(e*Math.PI/180),0],rotation:[0,0,e*Math.PI/180],children:[(0,n.jsx)("planeGeometry",{args:[.08,.12]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc44",emissive:"#ff9900",emissiveIntensity:1.5*p,transparent:!0,opacity:.7*p,side:d.DoubleSide,depthWrite:!1,blending:d.AdditiveBlending})]},t))}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.22499999999999998,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:u,emissive:"#ffaa00",emissiveIntensity:1*p,transparent:!0,opacity:.3*p,depthWrite:!1,blending:d.AdditiveBlending,toneMapped:!1})]})]})})}var M=r(6374);function S(e){let{position:t,onComplete:r,color:a=new d.Color("#00ff44"),size:s=.15,duration:l=.5}=e,c=(0,i.useRef)(null),u=(0,i.useRef)(null);return(0,o.F)(e=>{if(!c.current)return;null===u.current&&(u.current=e.clock.getElapsedTime());let t=(e.clock.getElapsedTime()-u.current)/l;if(t>=1){r();return}let n=Math.max(0,1-t);if(c.current.scale.setScalar(1+3*t),c.current.material instanceof d.Material){let e=c.current.material;e.opacity=.8*n,e.emissiveIntensity=1.5*n}}),(0,n.jsxs)("mesh",{ref:c,position:t,children:[(0,n.jsx)("torusGeometry",{args:[2*s,.3*s,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:a,emissive:a,emissiveIntensity:1.5,transparent:!0,opacity:.8,depthWrite:!1,blending:d.AdditiveBlending})]})}function w(e){let{position:t,chargeTime:r=1,explosionStartTime:o,onComplete:a}=e,s=(0,i.useRef)(o||Date.now()),[,l]=(0,i.useState)({}),c=Math.min(r/4,1),u=.6+1*c,h=2.5+4*c;(0,i.useEffect)(()=>{let e=setInterval(()=>{l({}),(Date.now()-s.current)/1e3>1&&(clearInterval(e),a&&a())},16),t=setTimeout(()=>{clearInterval(e),a&&a()},1e3);return()=>{clearInterval(e),clearTimeout(t)}},[a]);let p=(Date.now()-s.current)/1e3,m=Math.max(0,1-p/1);if(m<=0)return null;let g=4+(p<.15?10:0);return(0,n.jsxs)("group",{position:t,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.4*u*(1+p*g),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#AA00FF",emissiveIntensity:h*m*.6,transparent:!0,opacity:.85*m,depthWrite:!1,blending:d.AdditiveBlending})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.5*u*(1+p*(g+1)),24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#9932CC",emissive:"#DA70D6",emissiveIntensity:.6*h*m,transparent:!0,opacity:.9*m,depthWrite:!1,blending:d.AdditiveBlending})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.6*u*(1+p*(g+2)),16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF00FF",emissive:"#FF69B4",emissiveIntensity:.4*h*m,transparent:!0,opacity:.7*m,depthWrite:!1,blending:d.AdditiveBlending})]}),[.5,.7,.85,1,1.2,1.4].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[e*u*(1+p*(g+2)),.08*u,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#AA00FF",emissiveIntensity:h*m*.4,transparent:!0,opacity:.8*m*(1-.12*t),depthWrite:!1,blending:d.AdditiveBlending})]},t)),[...Array(16)].map((e,t)=>{let r=t/16*Math.PI*2,i=u*(1+p*(g-.5))*(1+.4*Math.random());return(0,n.jsxs)("mesh",{position:[Math.sin(r)*i,Math.cos(r)*i+(Math.random()-.5)*.6,(Math.random()-.5)*.4],children:[(0,n.jsx)("sphereGeometry",{args:[.1*u,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF00FF",emissive:"#FF69B4",emissiveIntensity:1.5*h*m,transparent:!0,opacity:.95*m,depthWrite:!1,blending:d.AdditiveBlending})]},"spark-".concat(t))}),[...Array(32)].map((e,t)=>{let r=t/32*Math.PI*2+.5*Math.random(),i=.7*u*(1+p*(g+1))*(1+.3*Math.random());return(0,n.jsxs)("mesh",{position:[Math.sin(r)*i,Math.cos(r)*i+(Math.random()-.5)*.4,(Math.random()-.5)*.3],children:[(0,n.jsx)("sphereGeometry",{args:[.05*u,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#DA70D6",emissive:"#FF1493",emissiveIntensity:1.8*h*m,transparent:!0,opacity:.9*m,depthWrite:!1,blending:d.AdditiveBlending})]},"small-spark-".concat(t))}),(0,n.jsx)("pointLight",{color:"#8B00FF",intensity:4*h*m,distance:6*u,decay:1.8}),(0,n.jsx)("pointLight",{color:"#FF00FF",intensity:2*h*m,distance:9*u,decay:1.5}),p<.15&&(0,n.jsx)("pointLight",{color:"#DA70D6",intensity:8*h*(1-6.67*p),distance:4*u,decay:1}),(0,n.jsx)("pointLight",{color:"#9932CC",intensity:1.2*h*m,distance:12*u,decay:2})]})}function j(e){let{world:t}=e,[r,h]=(0,i.useState)({crossentropy:[],entropic:[],charged:[],regular:[],barrage:[]}),[m,f]=(0,i.useState)([]),y=(0,i.useRef)(0),j=(0,i.useRef)(0),C=(0,i.useRef)(0),b=(0,i.useRef)(0),I=(0,i.useRef)(0),P=(0,i.useRef)(0),D=(0,i.useRef)(0),E=(e,r)=>{if(!t)return!1;for(let e of t.getAllEntities()){let t=e.getComponent(c.C),n=e.getComponent(u.S),i=e.getComponent(a.w);if(!t||!n||!i||n.isDead)continue;let o=new d.Vector3(r.x,0,r.z),s=new d.Vector3(i.position.x,0,i.position.z);if(1.5>=o.distanceTo(s))return!0}return!1},F=(e,r)=>{if(!t)return!1;for(let e of t.getAllEntities()){let t=e.getComponent(c.C),n=e.getComponent(u.S),i=e.getComponent(a.w);if(!t||!n||!i||n.isDead)continue;let o=new d.Vector3(r.x,0,r.z),s=new d.Vector3(i.position.x,0,i.position.z);if(1.6>=o.distanceTo(s))return!0}return!1};(0,o.F)(e=>{var n,i;let o=e.clock.getElapsedTime();if(o-D.current<.016||(D.current=o,!t))return;let c=t.queryEntities([a.w,s.W,l.T]),u=[],p=[],g=[],x=[],v=[];for(let e of c){let t=e.getComponent(l.T),n=e.getComponent(a.w),i=e.getComponent(s.W);if(!(null==t?void 0:t.mesh)||!n||!i)continue;let o=t.mesh.userData,c=o.direction||i.velocity.clone().normalize();if(o.isCrossentropyBolt){let t=r.crossentropy.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),u.push(t)):u.push({id:y.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id})}else if(o.isEntropicBolt){let t=r.entropic.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),p.push(t)):p.push({id:j.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id})}else if(o.isChargedArrow){let t=r.charged.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),g.push(t)):g.push({id:C.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id,subclass:o.subclass,level:o.level,opacity:o.opacity||1})}else if(o.isBarrageArrow){let t=r.barrage.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),v.push(t)):v.push({id:I.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id,subclass:o.subclass,level:o.level,opacity:o.opacity||1})}else if(o.isRegularArrow){let t=r.regular.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),x.push(t)):x.push({id:b.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id,subclass:o.subclass,level:o.level,opacity:o.opacity||1})}}let M=(null===(n=t.getEvents)||void 0===n?void 0:n.call(t,"explosion"))||[],S=[...m];for(let e of M){let t={id:P.current++,position:e.position.clone(),color:e.color||new d.Color("#00ff44"),size:e.size||1,duration:e.duration||2};S.push(t)}M.length>0&&(null===(i=t.clearEvents)||void 0===i||i.call(t,"explosion")),(u.length!==r.crossentropy.length||p.length!==r.entropic.length||g.length!==r.charged.length||x.length!==r.regular.length||v.length!==r.barrage.length||u.some(e=>!r.crossentropy.find(t=>t.entityId===e.entityId))||p.some(e=>!r.entropic.find(t=>t.entityId===e.entityId))||g.some(e=>!r.charged.find(t=>t.entityId===e.entityId))||x.some(e=>!r.regular.find(t=>t.entityId===e.entityId))||v.some(e=>!r.barrage.find(t=>t.entityId===e.entityId)))&&h({crossentropy:u,entropic:p,charged:g,regular:x,barrage:v}),S.length!==m.length&&f(S)});let A=e=>{f(t=>t.filter(t=>t.id!==e))};return(0,n.jsxs)(n.Fragment,{children:[r.crossentropy.map(e=>(0,n.jsx)(p,{id:e.id,position:e.position,direction:e.direction,checkCollisions:F,onImpact:e=>{if(e){let t={id:P.current++,position:e.clone(),color:new d.Color("#8B00FF"),size:2.5,duration:1,type:"crossentropy",chargeTime:1};f(e=>[...e,t])}}},e.id)),r.entropic.map(e=>(0,n.jsx)(g,{id:e.id,position:e.position,direction:e.direction,checkCollisions:E,onImpact:e=>{}},e.id)),r.charged.map(e=>(0,n.jsx)(x,{position:e.position,direction:e.direction,onImpact:()=>{}},e.id)),r.regular.map(e=>{let r=null==t?void 0:t.getEntity(e.entityId),i=null==r?void 0:r.getComponent(s.W),o=(null==i?void 0:i.distanceTraveled)||0,a=(null==i?void 0:i.maxDistance)||25;return(0,n.jsx)(v,{position:e.position,direction:e.direction,distanceTraveled:o,maxDistance:a,onImpact:()=>{}},e.id)}),(0,n.jsx)(M.Z,{projectiles:r.barrage.map(e=>{let r=null==t?void 0:t.getEntity(e.entityId),n=null==r?void 0:r.getComponent(s.W),i=(null==n?void 0:n.distanceTraveled)||0,o=(null==n?void 0:n.maxDistance)||25;return{id:e.id,position:e.position,direction:e.direction,startPosition:e.position.clone(),maxDistance:o,damage:30,startTime:Date.now(),hasCollided:!1,hitEnemies:new Set,opacity:e.opacity,distanceTraveled:i}})}),m.map(e=>"crossentropy"===e.type?(0,n.jsx)(w,{position:e.position,chargeTime:e.chargeTime||.75,explosionStartTime:Date.now(),onComplete:()=>A(e.id)},e.id):(0,n.jsx)(S,{position:e.position,color:e.color,size:e.size/2,duration:e.duration,onComplete:()=>A(e.id)},e.id))]})}},6374:function(e,t,r){r.d(t,{Z:function(){return o}});var n=r(7437);r(2265);var i=r(1448);function o(e){let{projectiles:t}=e;return(0,n.jsx)(n.Fragment,{children:t.map(e=>{let t=e.distanceTraveled||e.position.distanceTo(e.startPosition),r=e.maxDistance||25,o=.7*r,a=(void 0!==e.opacity?e.opacity:1)*Math.max(.1,1-Math.max(0,Math.min(1,(t-o)/(r-o))));return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.025,.1,1.8,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#0088ff",emissive:"#0088ff",emissiveIntensity:1.2*a,transparent:!0,opacity:a})]}),[void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,0,-(.4*t)+.4],rotation:[Math.PI,0,.004*Date.now()+t*Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.1+.03*t,.04,6,10]}),(0,n.jsx)("meshStandardMaterial",{color:"#0088ff",emissive:"#0088ff",emissiveIntensity:2.5*a,transparent:!0,opacity:(.8-.1*t)*a,blending:i.AdditiveBlending})]},"barrage-ring-".concat(t))),(0,n.jsx)("pointLight",{color:"#0088ff",intensity:2.5*a,distance:4,decay:2})]})},e.id)})})}},7057:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(7437),i=r(2265),o=r(4244),a=r(1448),s=r(1276),l=r(7125),c=e=>{let{position:t,direction:r,onComplete:o,subclass:c,isElementalShotsUnlocked:u=!0,isPerfectShot:d=!1}=e,h=(0,i.useRef)(null),p=(0,i.useRef)(Date.now()),m=d?200:166,g=(0,i.useRef)(null),f=c===l.p.VENOM?{core:"#00ff40",emissive:"#00aa20",outer:"#00ff60"}:c===l.p.ELEMENTAL?u?{core:"#ff4400",emissive:"#cc0000",outer:"#ff6600"}:{core:"#0066ff",emissive:"#0044cc",outer:"#0088ff"}:{core:"#ffffff",emissive:"#cccccc",outer:"#ffffff"};(0,s.F)(()=>{if(Date.now()-p.current>=m&&!g.current&&(g.current=Date.now()),g.current&&Date.now()-g.current>=300){o();return}});let y=g.current?Math.max(0,1-(Date.now()-g.current)/300):1;return(0,n.jsx)("group",{ref:h,position:t.toArray(),children:(0,n.jsxs)("group",{rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[d?.035:.025,d?.035:.025,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:f.core,emissive:f.emissive,emissiveIntensity:(d?15:12)*y,transparent:!0,opacity:.95*y})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[d?.08:.0625,d?.08:.0625,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:f.core,emissive:f.emissive,emissiveIntensity:(d?10:8)*y,transparent:!0,opacity:.7*y})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[d?.095:.075,d?.095:.075,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:f.outer,emissive:f.emissive,emissiveIntensity:(d?6:4)*y,transparent:!0,opacity:.5*y})]}),[...Array(d?8:6)].map((e,t)=>{let r=Math.min(1,(Date.now()-p.current)/800),i=g.current?Math.max(0,1-(Date.now()-g.current)/600):1,o=1-.1*t;return(0,n.jsxs)("group",{position:[0,0,3*t],children:[(0,n.jsxs)("mesh",{rotation:[0,.002*Date.now()+t,0],scale:[o,o,o],children:[(0,n.jsx)("torusGeometry",{args:[.4,.08,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:f.outer,emissive:f.emissive,emissiveIntensity:2*i,transparent:!0,opacity:.4*i*(1-.5*r),blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,-.003*Date.now()+t,0],scale:[.7*o,.7*o,.7*o],children:[(0,n.jsx)("torusGeometry",{args:[.3,.06,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:f.core,emissive:f.emissive,emissiveIntensity:1.5*i,transparent:!0,opacity:.3*i*(1-.3*r),blending:a.AdditiveBlending})]})]},"ring-".concat(t))}),(0,n.jsx)("pointLight",{color:f.core,intensity:(d?20:15)*y,distance:d?10:8,decay:2,position:[0,0,10]}),d&&(0,n.jsxs)(n.Fragment,{children:[[void 0,void 0,void 0,void 0].map((e,t)=>{let r=t/4*Math.PI*2;return(0,n.jsx)("group",{position:[.15*Math.sin(r+.01*Date.now()),.15*Math.cos(r+.01*Date.now()),10+2*Math.sin(.005*Date.now()+t)],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:8*y,transparent:!0,opacity:.8*y,blending:a.AdditiveBlending})]})},"lightning-".concat(t))}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.12,.12,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:2*y,transparent:!0,opacity:.3*y,blending:a.AdditiveBlending})]})]})]})})};function u(){let{activeEffects:e,removeEffect:t}=(0,o.sf)();return(0,n.jsx)(n.Fragment,{children:e.map(e=>(0,n.jsx)(c,{position:e.position,direction:e.direction,subclass:e.subclass,isElementalShotsUnlocked:e.isElementalShotsUnlocked,isPerfectShot:e.isPerfectShot,onComplete:()=>t(e.id)},e.id))})}},7019:function(e,t,r){r.r(t),r.d(t,{default:function(){return w},getGlobalCobraShotProjectiles:function(){return S},triggerGlobalCobraShot:function(){return M}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448);let s=e=>{let{projectile:t}=e,r=(0,i.useRef)(null);return((0,o.F)(()=>{if(!r.current)return;r.current.position.copy(t.position);let e=t.direction.clone().normalize(),n=Math.atan2(e.x,e.z),i=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z));r.current.rotation.set(i,n,0)}),t.active)?(0,n.jsx)("group",{ref:r,children:(0,n.jsx)("pointLight",{color:"#00ff40",intensity:2*t.opacity,distance:3,decay:2})}):null};function l(e){let{projectilePool:t}=e;return(0,n.jsx)(n.Fragment,{children:t.map(e=>(0,n.jsx)(s,{projectile:e},e.id))})}var c=e=>{let{position:t,direction:r,onComplete:a,isReturning:s=!1}=e,l=(0,i.useRef)(null),c=(0,i.useRef)(Date.now()),u=(0,i.useRef)(null),d="#00ff40",h="#00aa20",p="#00ff60";(0,o.F)(()=>{if(Date.now()-c.current>=175&&!u.current&&(u.current=Date.now()),u.current&&Date.now()-u.current>=150){a();return}});let m=u.current?Math.max(0,1-(Date.now()-u.current)/400):1;return(0,n.jsxs)("group",{ref:l,position:t.toArray(),children:[(0,n.jsxs)("group",{rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:h,emissiveIntensity:16*m,transparent:!0,opacity:.98*m})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:h,emissiveIntensity:12*m,transparent:!0,opacity:.8*m})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.12,.12,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:p,emissive:d,emissiveIntensity:8*m,transparent:!0,opacity:.6*m})]}),[...Array(8)].map((e,t)=>{let r=Math.min(1,(Date.now()-c.current)/140),i=.8+.3*Math.sin(r*Math.PI*4+t);return(0,n.jsxs)("mesh",{position:[0,0,20*r-10],rotation:[Math.PI/2,0,(.01*Date.now()+t)%(2*Math.PI)],scale:[i,i,1],children:[(0,n.jsx)("torusGeometry",{args:[.15,.03,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:d,emissiveIntensity:8*m,transparent:!0,opacity:m*(1-r)*.8,blending:2,depthWrite:!1})]},t)}),[...Array(12)].map((e,t)=>{let r=Math.min(1,(Date.now()-c.current)/157.5);return(0,n.jsxs)("mesh",{position:[.5*Math.sin(r*Math.PI*6+t),0,20*r-10],scale:[.3,.3,.3],children:[(0,n.jsx)("sphereGeometry",{args:[.08,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:p,emissive:p,emissiveIntensity:10*m,transparent:!0,opacity:m*(1-r)*.6,blending:2,depthWrite:!1})]},"particle-".concat(t))})]}),(0,n.jsx)("pointLight",{color:d,intensity:8*m,distance:8,decay:1})]})},u=r(3351),d=r(8001),h=r(73),p=r(6862);let m=null,g=(e,t)=>!!m&&!!m.addVenomousEnemy&&(m.addVenomousEnemy(e,t),!0);function f(e){let{world:t}=e,[r,a]=(0,i.useState)([]),s=(0,i.useRef)(0),l=(0,i.useRef)(0),c=(0,i.useCallback)(()=>t?t.getAllEntities().filter(e=>e.hasComponent(d.C)&&e.hasComponent(h.w)&&e.hasComponent(p.S)).map(e=>{e.getComponent(d.C);let t=e.getComponent(h.w),r=e.getComponent(p.S);return{id:e.id.toString(),position:t.position.clone(),health:r.currentHealth,isDying:r.isDead,deathStartTime:r.isDead?Date.now():void 0}}):[],[t]),g=(0,i.useCallback)((e,t)=>{let r={id:s.current++,enemyId:e,position:t.clone(),startTime:Date.now(),duration:6e3};a(e=>[...e,r])},[]);i.useEffect(()=>(m={addVenomousEnemy:g},()=>{m=null}),[g]),(0,o.F)(e=>{let n=e.clock.getElapsedTime();if(n-l.current<.1||(l.current=n,!t))return;let i=t.getAllEntities();i.forEach(e=>{let t=e.getComponent(d.C),n=e.getComponent(h.w);t&&n&&t.isVenomous&&!r.find(t=>t.enemyId===e.id.toString())&&g(e.id.toString(),n.position)}),a(e=>e.filter(e=>{let t=i.find(t=>t.id.toString()===e.enemyId);if(!t)return!1;let r=t.getComponent(d.C),n=t.getComponent(p.S);return!!r&&!!n&&!n.isDead&&r.isVenomous}))});let f=e=>{a(t=>t.filter(t=>t.id!==e))};return(0,n.jsx)(n.Fragment,{children:r.map(e=>(0,n.jsx)(u.Z,{position:e.position,enemyId:e.enemyId,enemyData:c(),duration:e.duration,startTime:e.startTime,onComplete:()=>f(e.id)},e.id))})}var y=r(244);let x=null,v=null;function M(e,t){x&&x(e,t)}function S(){return v?v():[]}function w(e){let{world:t}=e,r=(0,i.useRef)([]),s=(0,i.useRef)([]),m=(0,i.useRef)([]);(0,i.useRef)(0),(0,i.useRef)(0);let M=(0,i.useRef)(0),S=(0,i.useRef)(0);(0,i.useEffect)(()=>{r.current=[,,,].fill(null).map((e,t)=>({id:t,position:new a.Vector3,direction:new a.Vector3,startPosition:new a.Vector3,maxDistance:25,active:!1,startTime:0,hitEnemies:new Set,opacity:1,fadeStartTime:null}))},[]);let w=(0,i.useCallback)(()=>r.current.find(e=>!e.active),[]),j=(0,i.useCallback)((e,t)=>{let r=w();if(!r)return;let n=Date.now();r.position.copy(e),r.direction.copy(t).normalize(),r.startPosition.copy(e),r.active=!0,r.startTime=n,r.hitEnemies.clear(),r.opacity=1,r.fadeStartTime=null,I(e,t)},[w]);(0,i.useEffect)(()=>(x=j,v=()=>r.current,()=>{x=null,v=null}),[j]);let C=(0,i.useCallback)(e=>{let t={id:M.current++,position:e.clone(),startTime:Date.now()};s.current.push(t)},[]),b=(0,i.useCallback)(e=>{s.current=s.current.filter(t=>t.id!==e)},[]),I=(0,i.useCallback)((e,t)=>{let r={id:S.current++,position:e.clone(),direction:t.clone(),startTime:Date.now()};m.current.push(r)},[]),P=(0,i.useCallback)(e=>{m.current=m.current.filter(t=>t.id!==e)},[]);return(0,o.F)(()=>{let e=Date.now();r.current.forEach(r=>{if(!r.active)return;r.startTime;let n=r.direction.clone().multiplyScalar(1);r.position.add(n);let i=r.position.distanceTo(r.startPosition);if(i>20&&!r.fadeStartTime&&(r.fadeStartTime=e),r.fadeStartTime){let t=e-r.fadeStartTime;if(r.opacity=Math.max(0,1-t/1e3),r.opacity<=0||i>25){r.active=!1,r.opacity=1,r.fadeStartTime=null;return}}t.getAllEntities().forEach(e=>{if(r.hitEnemies.has(e.id))return;let n=e.getComponent(d.C),i=e.getComponent(p.S),o=e.getComponent(h.w);if(n&&i&&o&&!i.isDead&&1.25>=r.position.distanceTo(o.position)){r.hitEnemies.add(e.id);let i=t.getSystem(y.b);i&&i.queueDamage(e,29,void 0,"cobra_shot");let a=Date.now()/1e3;n.applyVenom(6,17,a),g(e.id.toString(),o.position),C(o.position),r.active=!1,r.opacity=1,r.fadeStartTime=null}})});let n=t.getAllEntities(),i=t.getSystem(y.b);n.forEach(t=>{let r=t.getComponent(d.C),n=t.getComponent(p.S),o=t.getComponent(h.w);if(!r||!n||!o||n.isDead)return;let a=r.updateVenomStatus(e/1e3);a.shouldDealDamage&&i&&(i.queueDamage(t,a.damage,void 0,"venom"),C(o.position))})}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{projectilePool:r.current}),(0,n.jsx)(f,{world:t}),s.current.map(e=>(0,n.jsx)(u.Z,{position:e.position,onComplete:()=>b(e.id)},e.id)),m.current.map(e=>(0,n.jsx)(c,{position:e.position,direction:e.direction,onComplete:()=>P(e.id)},e.id))]})}},3351:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448);function s(e){let{position:t,onComplete:r,duration:s=1e3,startTime:l=Date.now(),enemyId:c,enemyData:u=[]}=e,d=(0,i.useRef)(null),h=(0,i.useRef)(l);(0,o.F)(()=>{if(!d.current)return;let e=Date.now()-h.current,t=Math.min(e/s,1);if(c&&u.length>0){let e=u.find(e=>e.id===c);if(e&&e.health>0&&!e.isDying&&!e.deathStartTime){let t=e.position.clone();t.y+=1,d.current.position.copy(t)}}let n=1+1.5*t;d.current.scale.set(n,n,n);let i=c?.8+.2*Math.sin(.01*e):1-t;d.current.children.forEach(e=>{if(e instanceof a.Mesh){let t=e.material;void 0!==t.opacity&&(t.opacity=i)}}),t>=1&&!c&&r()});let p=(0,i.useRef)(Math.random()*Math.PI*2);return(0,n.jsxs)("group",{ref:d,position:[t.x,t.y+1,t.z],rotation:[0,p.current,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.4,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#00FF44",emissive:"#00FF44",emissiveIntensity:1.5,transparent:!0,opacity:.8,depthWrite:!1,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.2,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#33FF33",emissive:"#33FF33",emissiveIntensity:2,transparent:!0,opacity:.9,depthWrite:!1,blending:a.AdditiveBlending})]}),[...Array(6)].map((e,t)=>{let r=t/6*Math.PI*2;return(0,n.jsxs)("mesh",{position:[Math.cos(r)*(.3+.2*Math.random()),.4*Math.random()-.2,Math.sin(r)*(.3+.2*Math.random())],children:[(0,n.jsx)("sphereGeometry",{args:[.15+.1*Math.random(),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#00BB33",emissive:"#00BB33",emissiveIntensity:1.5,transparent:!0,opacity:.7,depthWrite:!1,blending:a.AdditiveBlending})]},t)}),[...Array(10)].map((e,t)=>{let r=Math.random()*Math.PI*2,i=.5*Math.random();return(0,n.jsxs)("mesh",{position:[Math.cos(r)*i,.4*Math.random()-.2,Math.sin(r)*i],children:[(0,n.jsx)("sphereGeometry",{args:[.05+.04*Math.random(),6,6]}),(0,n.jsx)("meshStandardMaterial",{color:t%2==0?"#00FF44":"#55FF00",emissive:t%2==0?"#00FF44":"#55FF00",emissiveIntensity:2,transparent:!0,opacity:.8,depthWrite:!1,blending:a.AdditiveBlending})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#00FF44",intensity:1.5,distance:3,decay:2})]})}},319:function(e,t,r){r.r(t),r.d(t,{default:function(){return m},getGlobalViperStingProjectiles:function(){return p},triggerGlobalViperSting:function(){return h}});var n=r(7437),i=r(2265),o=r(1448),a=r(1276);let s=e=>{let{projectile:t}=e,r=(0,i.useRef)(null);return((0,a.F)(()=>{if(!r.current)return;r.current.position.copy(t.position);let e=t.direction.clone().normalize(),n=Math.atan2(e.x,e.z),i=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z));r.current.rotation.set(i,n,0)}),t.active)?(0,n.jsxs)("group",{ref:r,children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.15,2.5,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B3F9B",emissive:"#5A2B5F",emissiveIntensity:1.2,transparent:!0,opacity:t.opacity})]}),(0,n.jsxs)("mesh",{position:[0,0,1.25],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.15,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#A855C7",emissive:"#7E3A9F",emissiveIntensity:1.5,transparent:!0,opacity:t.opacity})]}),[void 0,void 0].map((e,r)=>(0,n.jsx)("group",{position:[0,0,.3-.4*r],children:(0,n.jsxs)("mesh",{rotation:[0,0,.01*Date.now()+r*Math.PI/3],children:[(0,n.jsx)("torusGeometry",{args:[.15+.05*r,.02,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#A855C7",emissive:"#A855C7",emissiveIntensity:2.5,transparent:!0,opacity:.7*t.opacity,blending:o.AdditiveBlending,depthWrite:!1})]})},"ring-".concat(r))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#C084FC",emissive:"#A855C7",emissiveIntensity:3,transparent:!0,opacity:t.opacity,blending:o.AdditiveBlending,depthWrite:!1})]}),[...Array(8)].map((e,r)=>{let i=t.opacity*(1-r/8)*.6,a=1-r/8*.5;return(0,n.jsxs)("group",{position:[0,0,-(.8*(r+1))],children:[(0,n.jsxs)("mesh",{scale:[a,a,a],children:[(0,n.jsx)("sphereGeometry",{args:[.15,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#A855C7",emissive:"#A855C7",emissiveIntensity:6,transparent:!0,opacity:i,blending:o.AdditiveBlending,depthWrite:!1})]}),(0,n.jsxs)("mesh",{scale:[1.5*a,1.5*a,1.5*a],children:[(0,n.jsx)("sphereGeometry",{args:[.2,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#C084FC",emissive:"#C084FC",emissiveIntensity:3,transparent:!0,opacity:.5*i,blending:o.AdditiveBlending,depthWrite:!1})]})]},"trail-".concat(r))}),(0,n.jsx)("pointLight",{color:"#A855C7",intensity:2*t.opacity,distance:4,decay:2})]}):null};function l(e){let{projectilePool:t}=e;return(0,n.jsx)(n.Fragment,{children:t.current.filter(e=>e.active).map(e=>(0,n.jsx)(s,{projectile:e},"viper-sting-".concat(e.id)))})}var c=e=>{let{position:t,direction:r,onComplete:s,isReturning:l=!1}=e,c=(0,i.useRef)(null),u=(0,i.useRef)(Date.now()),d=(0,i.useRef)(null),h="#8B3F9B",p="#A855C7",m="#C084FC";(0,a.F)(()=>{if(Date.now()-u.current>=200&&!d.current&&(d.current=Date.now()),d.current&&Date.now()-d.current>=250){s();return}});let g=d.current?Math.max(0,1-(Date.now()-d.current)/350):1;return(0,n.jsx)("group",{ref:c,position:t.toArray(),children:(0,n.jsxs)("group",{rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.03,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:p,emissiveIntensity:14*g,transparent:!0,opacity:.95*g})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.07,.07,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:p,emissive:p,emissiveIntensity:9*g,transparent:!0,opacity:.7*g})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.09,.09,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:m,emissive:h,emissiveIntensity:5*g,transparent:!0,opacity:.5*g})]}),[...Array(7)].map((e,t)=>{let r=Math.min(1,(Date.now()-u.current)/900),i=d.current?Math.max(0,1-(Date.now()-d.current)/700):1,a=1-.08*t;return(0,n.jsxs)("group",{position:[0,0,2.8*t],children:[(0,n.jsxs)("mesh",{rotation:[0,.0025*Date.now()+t,0],scale:[a,a,a],children:[(0,n.jsx)("torusGeometry",{args:[.35,.07,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:m,emissive:p,emissiveIntensity:2.5*i,transparent:!0,opacity:.45*i*(1-.4*r),blending:o.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,-.0035*Date.now()+t,0],scale:[.75*a,.75*a,.75*a],children:[(0,n.jsx)("torusGeometry",{args:[.28,.05,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:p,emissiveIntensity:1.8*i,transparent:!0,opacity:.35*i*(1-.25*r),blending:o.AdditiveBlending})]})]},"ring-".concat(t))}),[...Array(6)].map((e,t)=>{let r=t/6*Math.PI*2,i=.05*Math.sin(.003*Date.now()+t);return(0,n.jsx)("group",{position:[.12*Math.sin(r+.002*Date.now()),.12*Math.cos(r+.002*Date.now())+i,8+3*Math.sin(.004*Date.now()+t)],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.025,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:m,emissive:m,emissiveIntensity:6*g,transparent:!0,opacity:.7*g,blending:o.AdditiveBlending})]})},"venom-particle-".concat(t))}),(0,n.jsx)("pointLight",{color:p,intensity:18*g,distance:9,decay:2,position:[0,0,10]}),l&&(0,n.jsxs)(n.Fragment,{children:[[void 0,void 0,void 0,void 0,void 0].map((e,t)=>{let r=t/5*Math.PI*2;return(0,n.jsx)("group",{position:[.18*Math.sin(r+.012*Date.now()),.18*Math.cos(r+.012*Date.now()),10+2.5*Math.sin(.006*Date.now()+t)],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#E879F9",emissive:"#E879F9",emissiveIntensity:10*g,transparent:!0,opacity:.9*g,blending:o.AdditiveBlending})]})},"soul-energy-".concat(t))}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#E879F9",emissive:"#E879F9",emissiveIntensity:3*g,transparent:!0,opacity:.4*g,blending:o.AdditiveBlending})]})]})]})})};let u=()=>{let[e,t]=(0,i.useState)([]),r=(0,i.useRef)(1);return{activeEffects:e,createBeamEffect:(0,i.useCallback)(function(e,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=r.current++,a={id:o,position:e.clone(),direction:n.clone().normalize(),isReturning:i,startTime:Date.now()};return t(e=>[...e,a]),o},[]),removeEffect:(0,i.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]),clearAllEffects:(0,i.useCallback)(()=>{t([])},[])}},d={},h=()=>!!d.shootViperSting&&d.shootViperSting(),p=()=>d.getProjectiles?d.getProjectiles():[];function m(e){let{parentRef:t,enemyData:r,onHit:a,setDamageNumbers:s,nextDamageNumberId:h,onHealthChange:p,charges:m,setCharges:g}=e,[f,y]=(0,i.useState)([]);(0,i.useRef)(0);let{activeEffects:x,createBeamEffect:v,removeEffect:M}=u(),{shootViperSting:S,projectilePool:w}=function(e){let{parentRef:t,onHit:r,enemyData:n,setDamageNumbers:a,nextDamageNumberId:s,onHealthChange:l,createBeamEffect:c,applyDoT:u,charges:d,setCharges:h}=e,p=(0,i.useRef)([]),m=(0,i.useRef)([]),g=(0,i.useRef)(0),f=(0,i.useRef)(0),y=(0,i.useRef)(0);(0,i.useEffect)(()=>{p.current=[,,,].fill(null).map((e,t)=>({id:t,position:new o.Vector3,direction:new o.Vector3,startPosition:new o.Vector3,maxDistance:20,active:!1,startTime:0,hitEnemies:new Set,opacity:1,fadeStartTime:null,isReturning:!1,returnHitEnemies:new Set}))},[]);let x=(0,i.useCallback)(()=>p.current.find(e=>!e.active),[]),v=(0,i.useCallback)(()=>{let e=Date.now();if(e-g.current<2e3||!t.current)return!1;let r=x();if(!r)return!1;g.current=e;let n=t.current.position.clone();n.y+=0;let i=new o.Vector3(0,0,1);return t.current.quaternion&&"number"==typeof t.current.quaternion.x?i.applyQuaternion(t.current.quaternion):i.set(0,0,1),r.position.copy(n),r.direction.copy(i),r.startPosition.copy(n),r.startTime=e,r.active=!0,r.hitEnemies.clear(),r.returnHitEnemies.clear(),r.opacity=1,r.fadeStartTime=null,r.isReturning=!1,r.id=f.current++,c&&c(n,i,!1),!0},[c,t,x,d,h]),M=(0,i.useCallback)(e=>{if(!t.current)return;let r={id:y.current++,position:e.clone(),targetPosition:t.current.position.clone(),startTime:Date.now(),duration:1250,active:!0};m.current.push(r)},[t]);return(0,i.useEffect)(()=>{let e;let i=()=>{let l=Date.now();p.current.forEach(e=>{if(e.active){if(e.fadeStartTime){let t=(l-e.fadeStartTime)/350;if(e.opacity=Math.max(0,1-t),t>=1){e.active=!1;return}}if(e.isReturning){if(!t.current)return;if(e.position.distanceTo(e.startPosition)>1.5&&!e.fadeStartTime)for(let t of(e.position.add(e.direction.clone().multiplyScalar(.625)),n)){if(t.isDying||t.health<=0||e.returnHitEnemies.has(t.id))continue;let n=window.localSocketId;if(n&&t.id===n)continue;let i=new o.Vector3(e.position.x,0,e.position.z),l=new o.Vector3(t.position.x,0,t.position.z);1.3>i.distanceTo(l)&&(e.returnHitEnemies.add(t.id),t.id!==n&&(r(t.id,61),u&&u(t.id),a(e=>[...e,{id:s.current++,damage:61,position:t.position.clone(),isCritical:!1,isViperSting:!0}]),M(t.position)))}else e.fadeStartTime||(e.fadeStartTime=l)}else if(e.position.distanceTo(e.startPosition)<e.maxDistance&&!e.fadeStartTime)for(let t of(e.position.add(e.direction.clone().multiplyScalar(.625)),n)){if(t.isDying||t.health<=0||e.hitEnemies.has(t.id))continue;let n=window.localSocketId;if(n&&t.id===n)continue;let i=new o.Vector3(e.position.x,0,e.position.z),l=new o.Vector3(t.position.x,0,t.position.z);1.3>i.distanceTo(l)&&(e.hitEnemies.add(t.id),t.id!==n&&(r(t.id,61),u&&u(t.id),a(e=>[...e,{id:s.current++,damage:61,position:t.position.clone(),isCritical:!1,isViperSting:!0}]),M(t.position)))}else!e.fadeStartTime&&(e.isReturning=!0,e.direction=new o.Vector3().subVectors(e.startPosition,e.position).normalize(),c&&c(e.position,e.direction,!0))}}),p.current.some(e=>e.active)&&(e=requestAnimationFrame(i))};return e=requestAnimationFrame(i),()=>{cancelAnimationFrame(e)}},[n,r,a,s,l,M,t,c,u]),{shootViperSting:v,projectilePool:p,soulStealEffects:m}}({parentRef:t,onHit:a,enemyData:r,setDamageNumbers:s,nextDamageNumberId:h,onHealthChange:p,createBeamEffect:v,applyDoT:e=>{},charges:m,setCharges:g});return(0,i.useEffect)(()=>(d.shootViperSting=S,d.getProjectiles=()=>w.current,()=>{d={}}),[S,w]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{projectilePool:w}),x.map(e=>(0,n.jsx)(c,{position:e.position,direction:e.direction,isReturning:e.isReturning,onComplete:()=>M(e.id)},e.id))]})}},4244:function(e,t,r){r.d(t,{sf:function(){return c}});var n=r(2265);let i=[],o=1,a=null,s=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=!(arguments.length>4)||void 0===arguments[4]||arguments[4],l=o++,c={id:l,position:e.clone(),direction:t.clone().normalize(),subclass:r,isElementalShotsUnlocked:s,isPerfectShot:n,startTime:Date.now()};return i=[...i,c],a&&a(i),l},l=e=>{i=i.filter(t=>t.id!==e),a&&a(i)},c=()=>{let[e,t]=(0,n.useState)(i);return a=t,{activeEffects:e,createPowershotEffect:(0,n.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=!(arguments.length>4)||void 0===arguments[4]||arguments[4];return s(e,t,r,n,i)},[]),removeEffect:(0,n.useCallback)(e=>{l(e)},[]),clearAllEffects:(0,n.useCallback)(()=>{i=[],t([])},[])}}},9640:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(7437);function i(e){let{experience:t,level:r,playerId:i,isLocalPlayer:o=!1}=e,a=e=>{switch(e){case 1:default:return 0;case 2:return 25;case 3:return 75;case 4:return 150;case 5:return 250}},s=r>=5?100:Math.min((t-(1===r?0:2===r?25:3===r?75:4===r?150:0))/(e=>{switch(e){case 1:return 25;case 2:return 50;case 3:return 75;case 4:return 100;default:return 0}})(r)*100,100),{min:l,max:c}={min:a(r),max:a(r+1)},u=t-l,d=r>=5;return(0,n.jsx)("div",{className:"fixed bottom-16 left-1/2 transform -translate-x-1/2 z-40",children:(0,n.jsx)("div",{className:"bg-black bg-opacity-70 backdrop-blur-sm rounded-lg p-2 border border-gray-600",children:(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsxs)("div",{className:"text-sm font-bold ".concat(o?"text-yellow-400":"text-blue-400"),children:["LV ",r]}),(0,n.jsx)("div",{className:"text-xs text-gray-400",children:d?"MAX":"".concat(u,"/").concat(c-l," EXP")})]}),(0,n.jsx)("div",{className:"w-48 h-2 bg-gray-700 rounded-full overflow-hidden",children:(0,n.jsx)("div",{className:"h-full transition-all duration-300 ".concat(o?"bg-gradient-to-r from-yellow-500 to-yellow-400":"bg-gradient-to-r from-blue-500 to-blue-400"),style:{width:"".concat(s,"%")}})}),(0,n.jsxs)("div",{className:"text-xs text-gray-400",children:["Total: ",t," EXP"]})]})})})}r(2265)},2295:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(7437),i=r(2265),o=r(7125);function a(e){let{content:t,visible:r,x:i,y:o}=e;return r?(0,n.jsxs)("div",{className:"fixed z-50 bg-gray-900 border border-gray-600 rounded-lg p-3 text-white text-sm max-w-xs pointer-events-none",style:{left:i-150,top:o-80,transform:"translateX(-50%)"},children:[(0,n.jsx)("div",{className:"font-semibold text-blue-300 mb-1",children:t.name}),(0,n.jsx)("div",{className:"text-gray-300",children:t.description})]}):null}function s(e){let{currentWeapon:t,controlSystem:r}=e,[s,l]=(0,i.useState)(null),[c,u]=(0,i.useState)({x:0,y:0}),[d,h]=(0,i.useState)({}),[p,m]=(0,i.useState)({current:0,max:5}),g=[{name:"Sword",type:o.v.SWORD,key:"1",icon:"⚔️"},{name:"Bow",type:o.v.BOW,key:"2",icon:"\uD83C\uDFF9"},{name:"Scythe",type:o.v.SCYTHE,key:"3",icon:"⚡"},{name:"Sabres",type:o.v.SABRES,key:"4",icon:"⚔️"},{name:"Runeblade",type:o.v.RUNEBLADE,key:"5",icon:"\uD83D\uDD2E"}],f={[o.v.SWORD]:[{name:"Deflect Barrier",key:"Q",cooldown:8,currentCooldown:0,description:"Creates a protective barrier that blocks damage and reflects projectiles for 3 seconds."},{name:"Charge",key:"E",cooldown:3,currentCooldown:0,description:"Dash forward 10.5 units, gaining 20 rage. Can damage enemies in your path."},{name:"Divine Storm",key:"R",cooldown:4,currentCooldown:0,description:"Consumes all rage (min 20) to create a devastating storm. Duration: 4s + 1s per 10 rage consumed."}],[o.v.BOW]:[{name:"Barrage",key:"Q",cooldown:5,currentCooldown:0,description:"Fires 5 arrows in a spread pattern after a short charge. High damage per arrow."},{name:"Cobra Shot",key:"E",cooldown:2,currentCooldown:0,description:"Fires a venomous green arrow that applies poison damage over time to enemies."},{name:"Viper Sting",key:"R",cooldown:7,currentCooldown:0,description:"Charges for 1 second then fires a powerful piercing projectile with special effects."}],[o.v.SCYTHE]:[{name:"Reanimate",key:"Q",cooldown:1,currentCooldown:0,description:"Costs 20 mana. Heals 20 HP and creates visual healing effects around the player."},{name:"Entropic Bolt",key:"E",cooldown:.5,currentCooldown:0,description:"Fires a chaotic bolt that moves erratically and deals high damage to enemies."},{name:"Crossentropy Bolt",key:"R",cooldown:1,currentCooldown:0,description:"Costs 40 mana. Fires a slow, high-damage piercing projectile with extended range."}],[o.v.SABRES]:[{name:"Backstab",key:"Q",cooldown:2,currentCooldown:0,description:"Deals 75 damage to enemies in front (175 if attacking from behind). Costs 60 energy."},{name:"Skyfall",key:"E",cooldown:4,currentCooldown:0,description:"Leap high into the air and crash down, dealing 150 damage to enemies below. Costs 40 energy."},{name:"Not Assigned",key:"R",cooldown:0,currentCooldown:0,description:"No ability assigned to this slot yet."}],[o.v.RUNEBLADE]:[{name:"Death Grasp",key:"Q",cooldown:12,currentCooldown:0,description:"Fires spiraling chains that pull the first enemy hit towards you, dealing damage and stunning them briefly."},{name:"Smite",key:"E",cooldown:8,currentCooldown:0,description:"Calls down a bolt of divine energy that strikes enemies in a small area, dealing heavy damage."},{name:"Oathstrike",key:"R",cooldown:15,currentCooldown:0,description:"Unleashes a powerful strike that deals massive damage and has a chance to critically strike all enemies in range."}]};(0,i.useEffect)(()=>{if(!r||!r.getAbilityCooldowns)return;let e=()=>{let e=r.getAbilityCooldowns(),t={};Object.keys(e).forEach(r=>{t[r]=e[r].current}),h(t),r.getWeaponSwitchCooldown&&m(r.getWeaponSwitchCooldown())},t=setInterval(e,100);return e(),()=>clearInterval(t)},[r,t]);let y=(e,t)=>{let r=e.currentTarget.getBoundingClientRect();l({name:t.name,description:t.description}),u({x:r.left+r.width/2,y:r.top})},x=(e,t)=>{let r=e.currentTarget.getBoundingClientRect();l({name:t.name,description:"Switch to ".concat(t.name," (").concat(t.key,")")}),u({x:r.left+r.width/2,y:r.top})},v=()=>{l(null)},M=f[t]||[];return 0===M.length?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-40",children:(0,n.jsx)("div",{className:"bg-black bg-opacity-70 backdrop-blur-sm rounded-lg p-3 border border-gray-600",children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[g.map(e=>{let r=e.type===t,i=p.current>0;return p.max>0&&(p.current,p.max),(0,n.jsxs)("div",{className:"relative w-12 h-12 rounded-lg border-2 transition-all duration-200 ".concat(r?"border-yellow-400 bg-yellow-900 bg-opacity-50":i?"border-red-500 bg-red-900 bg-opacity-30":"border-gray-400 bg-gray-900 bg-opacity-30 hover:bg-opacity-50"," cursor-pointer flex items-center justify-center"),onMouseEnter:t=>x(t,e),onMouseLeave:v,children:[(0,n.jsx)("div",{className:"absolute -top-2 -left-2 bg-gray-800 border border-gray-600 rounded text-xs text-white px-1 py-0.5 font-semibold",children:e.key}),(0,n.jsx)("div",{className:"text-2xl ".concat(r?"text-yellow-400":i?"text-red-400":"text-gray-300"),children:e.icon}),i&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-60 rounded-lg"}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-white text-sm font-bold bg-black bg-opacity-60 rounded px-1",children:Math.ceil(p.current)})})]})]},e.key)}),(0,n.jsx)("div",{className:"w-px h-8 bg-gray-600"}),M.map(e=>{var i,a;let s=d[e.key]||0;e.cooldown>0&&e.cooldown;let l=s>0,c="Not Assigned"===e.name;return(0,n.jsxs)("div",{className:"relative w-12 h-12 rounded-lg border-2 transition-all duration-200 ".concat(c?"border-gray-600 bg-gray-800 opacity-50":l?"border-red-500 bg-red-900 bg-opacity-30":"border-green-400 bg-green-900 bg-opacity-30 hover:bg-opacity-50"," cursor-pointer flex items-center justify-center"),onMouseEnter:t=>y(t,e),onMouseLeave:v,children:[(0,n.jsx)("div",{className:"absolute -top-2 -left-2 bg-gray-800 border border-gray-600 rounded text-xs text-white px-1 py-0.5 font-semibold",children:e.key}),(0,n.jsx)("div",{className:"w-8 h-8 rounded flex items-center justify-center text-lg font-bold ".concat(c?"text-gray-500":l?"text-red-400":"text-green-400"),children:(i=e.key,(null===(a=({[o.v.SWORD]:{Q:"\uD83D\uDEE1️",E:"⚡",R:"\uD83C\uDF2A️"},[o.v.BOW]:{Q:"\uD83C\uDFF9",E:"\uD83D\uDC0D",R:"\uD83D\uDC0D"},[o.v.SCYTHE]:{Q:"\uD83D\uDC9A",E:"⚡",R:"⚔️"},[o.v.SABRES]:{Q:"\uD83D\uDDE1️",E:"\uD83C\uDF1F",R:"❓"},[o.v.RUNEBLADE]:{Q:"⛓️",E:"⚡",R:"\uD83D\uDCAB"}})[t])||void 0===a?void 0:a[i])||"❓")}),l&&!c&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-white text-sm font-bold bg-black bg-opacity-60 rounded px-1",children:Math.ceil(s)})})}),(()=>{var i,a,s,l,c,u,d;if(!r||!r.getAbilityCooldowns)return null;let h=r.getAbilityCooldowns(),p=h[e.key];if(p&&p.isActive)return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-yellow-400 bg-opacity-20 border-2 border-yellow-400 animate-pulse"});if("R"===e.key&&t===o.v.BOW&&(null===(i=r.isViperStingChargingActive)||void 0===i?void 0:i.call(r))){let e=(null===(c=r.getViperStingChargeProgress)||void 0===c?void 0:c.call(r))||0;return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-purple-400 bg-opacity-20 border-2 border-purple-400",children:(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-purple-400 bg-opacity-60 transition-all duration-100",style:{height:"".concat(100*e,"%")}})})}if("Q"===e.key&&t===o.v.BOW&&(null===(a=r.isBarrageChargingActive)||void 0===a?void 0:a.call(r))){let e=(null===(u=r.getBarrageChargeProgress)||void 0===u?void 0:u.call(r))||0;return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-orange-400 bg-opacity-20 border-2 border-orange-400",children:(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-orange-400 bg-opacity-60 transition-all duration-100",style:{height:"".concat(100*e,"%")}})})}if("E"===e.key&&t===o.v.BOW&&(null===(s=r.isCobraShotChargingActive)||void 0===s?void 0:s.call(r))){let e=(null===(d=r.getCobraShotChargeProgress)||void 0===d?void 0:d.call(r))||0;return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-green-400 bg-opacity-20 border-2 border-green-400",children:(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-green-400 bg-opacity-60 transition-all duration-100",style:{height:"".concat(100*e,"%")}})})}if("E"===e.key&&t===o.v.SABRES&&(null===(l=r.isSkyfallActive)||void 0===l?void 0:l.call(r)))return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-yellow-400 bg-opacity-20 border-2 border-yellow-400 animate-pulse"});if("Q"===e.key&&t===o.v.RUNEBLADE){let t=h[e.key];if(t&&t.isActive)return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-purple-400 bg-opacity-20 border-2 border-purple-400 animate-pulse"})}if("E"===e.key&&t===o.v.RUNEBLADE){let t=h[e.key];if(t&&t.isActive)return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-yellow-400 bg-opacity-20 border-2 border-yellow-400 animate-pulse"})}return null})()]},e.key)})]})})}),s&&(0,n.jsx)(a,{content:s,visible:!0,x:c.x,y:c.y})]})}function l(e){let{current:t,max:r,color:i,backgroundColor:o="#333"}=e,a=Math.max(0,Math.min(100,t/r*100));return(0,n.jsx)("div",{className:"w-full",children:(0,n.jsxs)("div",{className:"w-full h-6 rounded-lg border-2 border-gray-600 overflow-hidden relative",style:{backgroundColor:o},children:[(0,n.jsx)("div",{className:"h-full transition-all duration-300 ease-out rounded-sm",style:{width:"".concat(a,"%"),backgroundColor:i,boxShadow:"0 0 10px ".concat(i,"40")}}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsxs)("span",{className:"text-sm text-white font-medium drop-shadow-lg",children:[Math.round(t),"/",r]})})]})})}function c(e){let{currentWeapon:t,playerHealth:r,maxHealth:a,playerShield:c=200,maxShield:u=200,mana:d=200,maxMana:h=200,energy:p=100,maxEnergy:m=100,rage:g=0,maxRage:f=100,controlSystem:y}=e,[x,v]=(0,i.useState)(d),[M,S]=(0,i.useState)(p),[w,j]=(0,i.useState)(g),[C,b]=(0,i.useState)(Date.now());(0,i.useEffect)(()=>{v(d)},[d]),(0,i.useEffect)(()=>{if(t===o.v.SCYTHE||t===o.v.RUNEBLADE){let e=setInterval(()=>{v(e=>Math.min(h,e+4))},500);return()=>clearInterval(e)}},[t,h]),(0,i.useEffect)(()=>{if(t===o.v.BOW||t===o.v.SABRES){let e=setInterval(()=>{S(e=>Math.min(m,e+7))},500);return()=>clearInterval(e)}},[t,m]),(0,i.useEffect)(()=>{if(t===o.v.SWORD){let e=setInterval(()=>{Date.now()-C>6e3&&j(e=>Math.max(0,e-5))},1e3);return()=>clearInterval(e)}},[t,C]),(0,i.useEffect)(()=>{t===o.v.SCYTHE?(v(h),S(m),j(0)):t===o.v.SWORD?(j(0),v(h),S(m),b(Date.now())):t===o.v.BOW||t===o.v.SABRES?(S(m),v(h),j(0)):t===o.v.RUNEBLADE&&(v(h),S(m),j(0))},[t,h,m,f]);let I=e=>{(t===o.v.SCYTHE||t===o.v.RUNEBLADE)&&v(t=>Math.max(0,t-e))},P=e=>{(t===o.v.BOW||t===o.v.SABRES)&&S(t=>Math.max(0,t-e))},D=e=>{t===o.v.SWORD&&(j(t=>Math.min(f,t+e)),b(Date.now()))},E=e=>{t===o.v.SWORD&&j(t=>Math.max(0,t-e))},F=()=>{t===o.v.SWORD&&j(0)};return(0,i.useEffect)(()=>{window.gameUI={consumeMana:I,consumeEnergy:P,gainRage:D,consumeRage:E,consumeAllRage:F,getCurrentMana:()=>x,getCurrentEnergy:()=>M,getCurrentRage:()=>w,canCastCrossentropy:()=>x>=40,canCastEntropicBolt:()=>x>=10,canCastCrossentropyBolt:()=>x>=40,canCastReanimate:()=>x>=20,canCastFrostNova:()=>x>=25,canCastSmite:()=>x>=35,canCastDeathGrasp:()=>x>=25,canCastDivineStorm:()=>w>=40,canCastBarrage:()=>M>=40,canCastCobraShot:()=>M>=40,canCastViperSting:()=>M>=60,canCastBackstab:()=>M>=60,canCastSkyfall:()=>M>=40,canCastSunder:()=>M>=35}},[x,M,w,t]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed bottom-32 left-1/2 transform -translate-x-1/2 z-50",children:(0,n.jsxs)("div",{className:"bg-black bg-opacity-60 backdrop-blur-sm rounded-lg p-4 border border-gray-600 min-w-80",children:[(0,n.jsx)("div",{className:"w-full mb-2",children:(0,n.jsxs)("div",{className:"w-full h-3 rounded-lg border border-blue-500 overflow-hidden relative",style:{backgroundColor:"#1a2332"},children:[(0,n.jsx)("div",{className:"h-full transition-all duration-300 ease-out rounded-sm",style:{width:"".concat(Math.max(0,Math.min(100,c/u*100)),"%"),backgroundColor:"#4A90E2",boxShadow:"0 0 8px #4A90E240"}}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsxs)("span",{className:"text-xs text-white font-medium drop-shadow-lg",children:[Math.round(c),"/",u]})})]})}),(0,n.jsx)("div",{className:"mb-2",children:(0,n.jsx)(l,{current:r,max:a,color:"#DC2626",backgroundColor:"#331a1a"})}),(()=>{switch(t){case o.v.SCYTHE:return(0,n.jsx)(l,{current:x,max:h,color:"#4A90E2",backgroundColor:"#1a2332"});case o.v.SWORD:return(0,n.jsx)(l,{current:w,max:f,color:"#FF6B35",backgroundColor:"#332318"});case o.v.BOW:case o.v.SABRES:return(0,n.jsx)(l,{current:M,max:m,color:"#FFD700",backgroundColor:"#332b18"});case o.v.RUNEBLADE:return(0,n.jsx)(l,{current:x,max:150,color:"#9B59B6",backgroundColor:"#2a1a33"});default:return null}})()]})}),(0,n.jsx)(s,{currentWeapon:t,controlSystem:y})]})}},4954:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),i=r(2265),o=r(946);function a(e){let{onJoinSuccess:t,currentWeapon:r,currentSubclass:a,gameMode:s="multiplayer"}=e,{joinRoom:l,isConnected:c,isInRoom:u,connectionError:d,players:h,previewRoom:p,clearPreview:m,currentPreview:g,startGame:f,gameStarted:y}=(0,o.p)(),[x,v]=(0,i.useState)("default"),[M,S]=(0,i.useState)(""),[w,j]=(0,i.useState)(!1),[C,b]=(0,i.useState)(!1),[I,P]=(0,i.useState)(!1);(0,i.useEffect)(()=>{g&&P(!1)},[g]);let D=async()=>{if(!M.trim()){alert("Please enter a player name");return}j(!0);try{await l(x,M.trim(),r,a,s),m(),b(!1),setTimeout(()=>{j(!1)},1e3)}catch(e){console.error("Failed to join room:",e),j(!1)}},E=()=>{b(!1),m()};return u?(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/95 p-8 rounded-xl border-2 ".concat("pvp"===s?"border-red-500":"border-green-500"," text-white max-w-md w-11/12 z-50 text-center"),children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-4",children:["pvp"===s?"PVP":"Multiplayer"," Room: ",x]}),(0,n.jsxs)("p",{className:"mb-4",children:["Players connected: ",h.size,"/5"]}),(0,n.jsx)("div",{className:"flex flex-col gap-3 mb-6",children:Array.from(h.values()).map(e=>(0,n.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white/10 rounded-lg border border-gray-600",children:[(0,n.jsx)("span",{className:"font-bold text-green-500",children:e.name}),(0,n.jsxs)("span",{className:"text-orange-500 capitalize",children:["(",e.weapon,")"]}),(0,n.jsxs)("span",{className:"text-red-400 font-mono",children:[e.health,"/",e.maxHealth," HP"]})]},e.id))}),(0,n.jsx)("button",{className:"w-full px-8 py-4 text-xl ".concat("pvp"===s?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"," text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:-translate-y-1"),onClick:()=>{f(),t()},disabled:!1,children:y?"Join Game":"Start ".concat("pvp"===s?"PVP":"Game")})]}):C&&g?(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/95 p-8 rounded-xl border-2 ".concat("pvp"===s?"border-red-500":"border-green-500"," text-white max-w-2xl w-11/12 z-50"),children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-6",children:["pvp"===s?"PVP":"Multiplayer"," Room Preview: ",g.roomId]}),g.exists?(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,n.jsxs)("div",{className:"flex justify-around bg-white/5 p-4 rounded-lg mb-4",children:[(0,n.jsxs)("p",{className:"m-0 font-bold text-green-500",children:["Players: ",g.playerCount,"/",g.maxPlayers]}),"pvp"!==s&&(0,n.jsxs)("p",{className:"m-0 font-bold text-green-500",children:["Enemies: ",g.enemies.length]}),"pvp"===s&&(0,n.jsx)("p",{className:"m-0 font-bold text-red-500",children:"Mode: Player vs Player"})]}),g.playerCount>0?(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsx)("h3",{className:"text-lg font-bold",children:"Players in Room:"}),g.players.map(e=>(0,n.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white/10 rounded-lg border border-gray-600",children:[(0,n.jsx)("span",{className:"font-bold text-green-500",children:e.name}),(0,n.jsxs)("span",{className:"text-orange-500 capitalize",children:["(",e.weapon,")"]}),(0,n.jsxs)("span",{className:"text-red-400 font-mono",children:[e.health,"/",e.maxHealth," HP"]})]},e.id))]}):(0,n.jsx)("div",{className:"text-center p-8 bg-white/5 rounded-lg text-gray-300",children:(0,n.jsx)("p",{children:"This room is empty. You'll be the first player!"})}),(0,n.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-green-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-green-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:D,disabled:w||!M.trim()||g.playerCount>=g.maxPlayers,children:w?"Joining...":g.playerCount>=g.maxPlayers?"Room Full":"Join This Room"}),(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-gray-600 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-gray-500 hover:-translate-y-1 disabled:bg-gray-800 disabled:cursor-not-allowed disabled:transform-none",onClick:E,disabled:w,children:"Back"})]})]}):(0,n.jsxs)("div",{className:"text-center p-8 bg-white/5 rounded-lg text-gray-300",children:[(0,n.jsx)("p",{children:"This room doesn't exist yet. You'll create it when you join!"}),(0,n.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-green-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-green-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:D,disabled:w||!M.trim(),children:w?"Creating Room...":"Create & Join Room"}),(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-gray-600 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-gray-500 hover:-translate-y-1 disabled:bg-gray-800 disabled:cursor-not-allowed disabled:transform-none",onClick:E,disabled:w,children:"Back"})]})]})]}):(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/95 p-8 rounded-xl border-2 ".concat("pvp"===s?"border-red-500":"border-green-500"," text-white max-w-lg w-11/12 z-50"),children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-2",children:["Join ","pvp"===s?"PVP":"Multiplayer"," Game"]}),(0,n.jsx)("p",{className:"mb-6 text-gray-300",children:"pvp"===s?"Battle against other players":"Play with up to 5 players per room"}),(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("label",{htmlFor:"playerName",className:"font-bold text-green-500",children:"Your Name:"}),(0,n.jsx)("input",{id:"playerName",type:"text",value:M,onChange:e=>S(e.target.value),placeholder:"Enter your name",maxLength:20,disabled:w,className:"p-3 border-2 border-gray-600 rounded-lg bg-white/10 text-white text-base focus:outline-none focus:border-green-500 focus:bg-white/15 disabled:opacity-60 disabled:cursor-not-allowed"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("label",{htmlFor:"roomId",className:"font-bold text-green-500",children:"Room ID:"}),(0,n.jsx)("input",{id:"roomId",type:"text",value:x,onChange:e=>v(e.target.value),placeholder:"Room ID (e.g., 'default', 'room1')",maxLength:50,disabled:w,className:"p-3 border-2 border-gray-600 rounded-lg bg-white/10 text-white text-base focus:outline-none focus:border-green-500 focus:bg-white/15 disabled:opacity-60 disabled:cursor-not-allowed"})]}),d&&(0,n.jsxs)("div",{className:"bg-red-500/20 border border-red-400 text-red-400 p-4 rounded-lg text-center",children:["Error: ",d]}),(0,n.jsxs)("div",{className:"text-center p-2 rounded-lg bg-white/10 font-bold",children:["Status: ",c?"Connected":"Connecting..."]}),(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-blue-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-blue-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:()=>{if(!x.trim()){alert("Please enter a room ID");return}if(!c){alert("Not connected to server. Please wait for connection.");return}P(!0),p(x.trim()),b(!0),setTimeout(()=>{I&&(P(!1),alert("Room preview timed out. Please try again."),b(!1))},5e3)},disabled:!c||!x.trim()||I,children:I?"Loading...":"Preview Room"}),(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-green-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-green-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:D,disabled:w||!c||!M.trim(),children:w?"Joining...":"Join Directly"})]}),(0,n.jsxs)("div",{className:"bg-white/5 p-4 rounded-lg text-sm",children:[(0,n.jsx)("p",{className:"m-0 mb-2 font-bold ".concat("pvp"===s?"text-red-500":"text-green-500"),children:"Tips:"}),(0,n.jsxs)("ul",{className:"m-0 pl-6",children:[(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Use the same Room ID to play with friends"}),(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Maximum 5 players per room"}),"pvp"===s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Fight against other players to win"}),(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"No AI enemies - only player vs player combat"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"All players fight the same enemies together"}),(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Damage and kills are shared across all players"})]})]})]})]})]})}},8815:function(e,t,r){r.d(t,{l:function(){return l}});var n=r(1448),i=r(73),o=r(3478),a=r(1168),s=r(6862);class l{updatePosition(e,t){if(!this.isActive||!this.entity)return;this.playerPosition.copy(e),this.playerRotation.copy(t);let r=new n.Vector3(Math.sin(t.y),0,-Math.cos(t.y)),o=e.clone().add(r.multiplyScalar(2.5));o.y+=.5;let a=this.entity.getComponent(i.w);a&&(a.setPosition(o.x,o.y,o.z),a.setRotation(t.x,t.y,t.z))}activate(e,t,r){if(this.isActive)return;if(this.playerPosition.copy(e),this.playerRotation.copy(t),this.playerEntity=r||null,this.isActive=!0,this.playerEntity){let e=this.playerEntity.getComponent(s.S);e&&e.setInvulnerable(3)}this.entity=this.world.createEntity();let a=new n.Vector3(Math.sin(t.y),0,-Math.cos(t.y)),l=e.clone().add(a.multiplyScalar(2.5));l.y+=.5;let c=new i.w;c.setPosition(l.x,l.y,l.z),c.setRotation(t.x,t.y,t.z),this.entity.addComponent(c);let u=new o.YM(o.F5.SPHERE,3);u.layer=o.aB.PLAYER,u.isTrigger=!0,u.onTriggerEnter=(e,t)=>{this.handleProjectileCollision(t)},this.entity.addComponent(u)}deactivate(){this.isActive&&this.entity&&(this.world.destroyEntity(this.entity.id),this.entity=null,this.isActive=!1)}handleProjectileCollision(e){let t=e.getComponent(a.W);if(!t)return;let r=e.getComponent(i.w);if(!r)return;let n=r.getWorldPosition(),o=this.entity.getComponent(i.w).getWorldPosition(),s=n.clone().sub(o).normalize(),l=t.velocity.clone().reflect(s);t.velocity.copy(l),t.owner=-2,t.hitTargets.clear(),t.lifetime=0}isBarrierActive(){return this.isActive}getBarrierPosition(){if(!this.entity)return null;let e=this.entity.getComponent(i.w);return e?e.getWorldPosition():null}constructor(e){this.entity=null,this.isActive=!1,this.playerEntity=null,this.world=e,this.playerPosition=new n.Vector3,this.playerRotation=new n.Vector3}}},6663:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448);function s(e){let{isActive:t,duration:r,onComplete:s,playerPosition:l=new a.Vector3(0,0,0),playerRotation:c=new a.Vector3(0,0,0),dragonGroupRef:u}=e,d=(0,i.useRef)(null),h=(0,i.useRef)(null),p=(0,i.useRef)(0);return((0,i.useEffect)(()=>{t?h.current=Date.now():h.current=null,p.current=0},[t]),(0,o.F)((e,n)=>{if(!d.current||!t||!h.current)return;let i=(Date.now()-h.current)/1e3,o=Math.min(i/r,1);p.current=o;let m=l,g=c;(null==u?void 0:u.current)&&(m=u.current.position,g=new a.Vector3(u.current.rotation.x,u.current.rotation.y,u.current.rotation.z));let f=new a.Vector3(Math.sin(g.y),0,Math.cos(g.y-.75)),y=m.clone().add(f.multiplyScalar(2.5));y.y+=.25,d.current.position.copy(y),d.current.rotation.set(g.x,g.y,g.z);let x=1;o<.1?x=o/.1:o>.9&&(x=1-(o-.9)/.1),d.current.scale.setScalar(.325),d.current.traverse(e=>{e.material&&(e.material.opacity=x)});let v=1+.3*Math.sin(8*i);d.current.traverse(e=>{e.material&&void 0!==e.material.emissiveIntensity&&(e.material.emissiveIntensity=v)}),o>=1&&(null==s||s())}),t)?(0,n.jsxs)("group",{ref:d,children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[3,3,.1,32]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16766720),emissive:new a.Color(16753920),emissiveIntensity:1.5,transparent:!0,opacity:.7,side:a.DoubleSide,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[2.2,2.2,.05,32]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:2,transparent:!0,opacity:.5,side:a.DoubleSide,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[3.5,3.5,.02,32]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16753920),emissive:new a.Color(16740096),emissiveIntensity:1,transparent:!0,opacity:.3,side:a.DoubleSide,blending:a.AdditiveBlending})]}),(0,n.jsx)("group",{rotation:[Math.PI/2,0,0],children:[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[1.5*Math.cos(t*Math.PI/4),1.5*Math.sin(t*Math.PI/4),.05],rotation:[0,0,t*Math.PI/4],children:[(0,n.jsx)("boxGeometry",{args:[.8,.1,.05]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:3,transparent:!0,opacity:.8,blending:a.AdditiveBlending})]},t))}),(0,n.jsxs)("group",{rotation:[Math.PI/2,0,0],children:[(0,n.jsxs)("mesh",{position:[0,0,.1],children:[(0,n.jsx)("boxGeometry",{args:[.15,2.5,.05]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:4,transparent:!0,opacity:.9,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{position:[0,0,.1],children:[(0,n.jsx)("boxGeometry",{args:[2.5,.15,.05]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:4,transparent:!0,opacity:.9,blending:a.AdditiveBlending})]})]}),(0,n.jsx)("group",{rotation:[Math.PI/2,0,0],children:[...Array(12)].map((e,t)=>(0,n.jsxs)("mesh",{position:[Math.cos(t*Math.PI/6)*(3.8+.3*Math.sin(.005*Date.now()+t)),Math.sin(t*Math.PI/6)*(3.8+.3*Math.sin(.005*Date.now()+t)),.2*Math.sin(.003*Date.now()+t)],children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16766720),emissive:new a.Color(16753920),emissiveIntensity:2,transparent:!0,opacity:.6,blending:a.AdditiveBlending})]},"particle-".concat(t)))}),(0,n.jsx)("pointLight",{color:new a.Color(16766720),intensity:2,distance:8,decay:2})]}):null}},1151:function(e,t,r){r.d(t,{Z0:function(){return c},ZP:function(){return u}});var n=r(7437),i=r(2265),o=r(1276),a=r(6663);let s=[],l=1;function c(e,t,r){let n={id:l++,position:e.clone(),rotation:t.clone(),startTime:Date.now(),duration:3e3,playerId:r};return s.push(n),n.id}function u(e){let{}=e,[t,r]=(0,i.useState)([]);return(0,o.F)(()=>{let e=Date.now(),t=s.filter(t=>e-t.startTime<t.duration);s=t,r(t)}),(0,n.jsx)(n.Fragment,{children:t.map(e=>(0,n.jsx)(a.Z,{isActive:!0,duration:e.duration/1e3,playerPosition:e.position,playerRotation:e.rotation,onComplete:()=>{var t;t=e.id,s=s.filter(e=>e.id!==t)}},e.id))})}},4937:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(7437),i=r(2265),o=r(1448),a=r(1276);function s(e){let{position:t,onComplete:r,parentRef:s,isActive:l=!0,enemyData:c=[],onHitTarget:u,playerId:d}=e,h=(0,i.useRef)(null),p=(0,i.useRef)(0),m=(0,i.useRef)([]),g=(0,i.useRef)({});return(0,a.F)((e,n)=>{var i;if(!h.current)return;let a=(null==s?void 0:null===(i=s.current)||void 0===i?void 0:i.position)||t;h.current.position.copy(a);let f=Date.now();if(!l){r();return}if(p.current+=n,h.current.rotation.y+=4*n,c.forEach(e=>{e.health&&!(e.health<=0)&&(!d||e.id!==d)&&!(f-(g.current[e.id]||0)<200)&&4>=a.distanceTo(e.position)&&(g.current[e.id]=f,null==u||u(e.id,40,!1,e.position,!0))}),.6>Math.random()){let e=Math.random()*Math.PI*2,t=1.5*Math.random(),r=new o.Vector3(Math.cos(e)*t,-2+.6*Math.random(),Math.sin(e)*t);m.current.push({id:Date.now()+Math.random(),position:r,type:"orbital"})}if(.4>Math.random()){let e=Math.random()*Math.PI*2,t=1*Math.random(),r=new o.Vector3(Math.cos(e)*t,1+1.2*Math.random(),Math.sin(e)*t);m.current.push({id:Date.now()+Math.random(),position:r,type:"falling"})}m.current.length>50&&(m.current=m.current.slice(-50))}),(0,n.jsx)("group",{ref:h,children:(0,n.jsx)("pointLight",{color:new o.Color(16766720),intensity:1,distance:8,decay:1})})}},9709:function(e,t,r){r.d(t,{ZP:function(){return d},e6:function(){return u}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448),s=r(4937);let l=[],c=1;function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,n={id:c++,position:e.clone(),startTime:Date.now(),duration:r,playerId:t};return l.push(n),n.id}function d(e){let{enemyData:t=[],onHitTarget:r,playerId:c}=e,[u,d]=(0,i.useState)([]),h=(0,i.useRef)(new Map);return(0,o.F)(()=>{let e=Date.now(),t=l.filter(t=>e-t.startTime<t.duration);l=t,d(t);let r=new Set(t.map(e=>e.id));h.current.forEach((e,t)=>{r.has(t)||h.current.delete(t)}),t.forEach(e=>{h.current.has(e.id)?h.current.get(e.id).position.copy(e.position):h.current.set(e.id,{position:e.position.clone()})})}),(0,n.jsx)(n.Fragment,{children:u.map(e=>{let i=h.current.get(e.id);return i||(i={position:e.position&&e.position.clone?e.position.clone():new a.Vector3(0,0,0)},h.current.set(e.id,i)),(0,n.jsx)(s.Z,{position:e.position,parentRef:{current:i},isActive:!0,enemyData:t,onHitTarget:r,playerId:e.playerId||c,onComplete:()=>{var t;t=e.id,l=l.filter(e=>e.id!==t),h.current.delete(e.id)}},e.id)})})}},6923:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),i=r(2265),o=r(1276);function a(e){let{position:t,duration:r=1500,startTime:a=Date.now(),onComplete:s}=e,l=(0,i.useRef)(null),[c,u]=(0,i.useState)(1),[d,h]=(0,i.useState)(1),[p,m]=(0,i.useState)(0),g=(0,i.useRef)(.05*Math.random()+.02);(0,i.useEffect)(()=>{let e=setTimeout(()=>{s&&s()},r);return()=>{clearTimeout(e)}},[r,s]),(0,o.F)(()=>{if(!l.current)return;let e=Date.now()-a,t=Math.min(e/r,1);if(t>=1&&s){s();return}t<.3?m(t/.3):m(1),t>.6?h(1-(t-.6)/.4):h(1),u((.7+.3*Math.sin(.008*e))*d),l.current.rotation.y+=g.current,l.current.rotation.x=.1*Math.sin(.002*e)});let f=.1+2.5*p,y=1.15*f;return(0,n.jsxs)("group",{ref:l,position:t,children:[(0,n.jsxs)("mesh",{position:[0,.5,0],children:[(0,n.jsx)("sphereGeometry",{args:[1*f,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#4FC3F7",emissiveIntensity:.8*c,transparent:!0,opacity:.3*d,roughness:.1,metalness:.2})]}),[...Array(12)].map((e,t)=>{let r=t*Math.PI*2/12,i=.8*f;return(0,n.jsx)("group",{rotation:[0,r,0],position:[Math.cos(r)*i,0,Math.sin(r)*i],children:(0,n.jsxs)("mesh",{rotation:[Math.PI/6,0,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.4*f,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#29B6F6",emissiveIntensity:.6*c,transparent:!0,opacity:.8*d,roughness:.05,metalness:.15})]})},t)}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.1+.15*t,0],rotation:[Math.PI/2,0,t*Math.PI/6],scale:[y*(.8+.2*t),y*(.8+.2*t),1],children:[(0,n.jsx)("torusGeometry",{args:[1,.08,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#29B6F6",emissiveIntensity:.7*c,transparent:!0,opacity:.6*d*(1-.2*t),roughness:.1,metalness:.2})]},"ring-".concat(t))),[...Array(24)].map((e,t)=>{let r=t*Math.PI*2/24,i=f*(.6+.4*Math.random());return(0,n.jsxs)("mesh",{position:[Math.cos(r)*i+(Math.random()-.5)*2,2*Math.random()+.2,Math.sin(r)*i+(Math.random()-.5)*2],rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("octahedronGeometry",{args:[.08+.12*Math.random(),0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.9*c,transparent:!0,opacity:.5*d})]},"particle-".concat(t))}),(0,n.jsxs)("mesh",{position:[0,-.1,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("circleGeometry",{args:[1.1*f,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.3*c,transparent:!0,opacity:.4*d,roughness:.8,metalness:.1})]}),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:8*c*d,distance:2*f,position:[0,1,0]}),(0,n.jsx)("pointLight",{color:"#B3E5FC",intensity:3*c*d,distance:3*f,position:[0,.5,0]})]})}},6932:function(e,t,r){r.r(t),r.d(t,{addGlobalFrozenEnemy:function(){return p},default:function(){return g},getActiveFrostNovas:function(){return m},triggerGlobalFrostNova:function(){return h}});var n=r(7437),i=r(2265),o=r(1276),a=r(6923),s=r(8787),l=r(8001),c=r(73),u=r(6862);let d=null,h=e=>!!d&&(d.triggerFrostNova(e),!0),p=(e,t)=>!!d&&(d.addFrozenEnemy(e,t),!0),m=()=>d&&d.getActiveFrostNovas?d.getActiveFrostNovas():[];function g(e){let{world:t}=e,[r,h]=(0,i.useState)([]),[p,m]=(0,i.useState)([]),g=(0,i.useRef)(0),f=(0,i.useRef)(0),y=(0,i.useRef)(0),x=(0,i.useCallback)(()=>t?t.getAllEntities().filter(e=>e.hasComponent(l.C)&&e.hasComponent(c.w)&&e.hasComponent(u.S)).map(e=>{e.getComponent(l.C);let t=e.getComponent(c.w),r=e.getComponent(u.S);return{id:e.id.toString(),position:t.position.clone(),health:r.currentHealth,isDying:r.isDead,deathStartTime:r.isDead?Date.now():void 0}}):[],[t]),v=(0,i.useCallback)(e=>{let t={id:g.current++,position:e.clone(),startTime:Date.now(),duration:1200};h(e=>[...e,t])},[]),M=(0,i.useCallback)((e,t)=>{let r={id:f.current++,enemyId:e,position:t.clone(),startTime:Date.now(),duration:5e3};m(e=>[...e,r])},[]),S=(0,i.useCallback)(()=>r,[r]);i.useEffect(()=>(d={triggerFrostNova:v,addFrozenEnemy:M,getActiveFrostNovas:S},()=>{d=null}),[v,M,S]),(0,o.F)(e=>{let r=e.clock.getElapsedTime();if(r-y.current<.1||(y.current=r,!t))return;let n=Date.now(),i=t.getAllEntities();i.forEach(e=>{let t=e.getComponent(l.C),r=e.getComponent(c.w);t&&r&&t.isFrozen&&!p.find(t=>t.enemyId===e.id.toString())&&M(e.id.toString(),r.position)}),m(e=>e.filter(e=>{if(n-e.startTime>=e.duration)return!1;let t=i.find(t=>t.id.toString()===e.enemyId);if(!t)return!1;let r=t.getComponent(l.C),o=t.getComponent(u.S);return!!r&&!!o&&!o.isDead})),h(e=>e.filter(e=>!(n-e.startTime>=e.duration)))});let w=e=>{h(t=>t.filter(t=>t.id!==e))},j=e=>{m(t=>t.filter(t=>t.id!==e))},C=x();return(0,n.jsxs)(n.Fragment,{children:[r.map(e=>(0,n.jsx)(a.Z,{position:e.position,duration:e.duration,startTime:e.startTime,onComplete:()=>w(e.id)},e.id)),p.map(e=>(0,n.jsx)(s.Z,{position:e.position,duration:e.duration,startTime:e.startTime,enemyId:e.enemyId,enemyData:C,onComplete:()=>j(e.id)},e.id))]})}},8787:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),i=r(2265),o=r(1276);function a(e){let{position:t,duration:r=5e3,startTime:a=Date.now(),enemyId:s,enemyData:l=[],onComplete:c}=e,u=(0,i.useRef)(null),[d,h]=(0,i.useState)(1),[p,m]=(0,i.useState)(1),g=(0,i.useRef)(.02*Math.random()+.01);return(0,i.useEffect)(()=>{let e=setTimeout(()=>{c&&c()},r);return()=>{clearTimeout(e)}},[r,c,s]),(0,o.F)(()=>{if(!u.current)return;let e=Date.now()-a,t=Math.min(e/r,1);if(t>=1&&c){c();return}if(s&&l.length>0){let e=l.find(e=>e.id===s);if(e&&e.health>0&&!e.isDying&&!e.deathStartTime){let t=e.position.clone();t.y+=.5,u.current.position.copy(t)}}t>.9?m(1-(t-.9)/.09999999999999998):m(1),h((.8+.2*Math.sin(.005*e))*p),u.current.rotation.y+=g.current,u.current.rotation.x=.1*Math.sin(.003*e)}),(0,n.jsxs)("group",{ref:u,position:t,children:[(0,n.jsxs)("mesh",{position:[0,-.6,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.8,.9,.5,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#81D4FA",emissiveIntensity:.3*d,transparent:!0,opacity:.7*p,roughness:.1,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,.95,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.9,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.5*d,transparent:!0,opacity:.8*p,roughness:.05,metalness:.1})]}),[...Array(6)].map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI/3,0],position:[.7*Math.cos(t*Math.PI/3),-.2+.3*Math.sin(t),.7*Math.sin(t*Math.PI/3)],children:(0,n.jsxs)("mesh",{rotation:[Math.PI/6,0,Math.PI/4],children:[(0,n.jsx)("octahedronGeometry",{args:[.25,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#29B6F6",emissiveIntensity:.4*d,transparent:!0,opacity:.6*p,roughness:.1,metalness:.15})]})},t)),[...Array(12)].map((e,t)=>(0,n.jsxs)("mesh",{position:[(Math.random()-.5)*2,2.5*Math.random()-.2,(Math.random()-.5)*2],rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("octahedronGeometry",{args:[.05+.1*Math.random(),0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.8*d,transparent:!0,opacity:.4*p})]},"particle-".concat(t))),[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,-0+.2*t,0],rotation:[Math.PI/2,0,t*Math.PI/4],children:[(0,n.jsx)("torusGeometry",{args:[.6+.25*t,.05,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#29B6F6",emissiveIntensity:.6*d,transparent:!0,opacity:.5*p,roughness:.1,metalness:.2})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.2*d,transparent:!0,opacity:.4*p})]}),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:3*d*p,distance:6,position:[0,1,0]})]})}},6534:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(7437),i=r(2265),o=r(1276),a=r(1448);function s(e){let{position:t,onComplete:r,onHit:s,onDamageDealt:l,enemyData:c=[],playerPosition:u}=e,d=(0,i.useRef)(null),h=(0,i.useRef)(0),p=(0,i.useRef)(0);(0,i.useRef)(!1);let m=(0,i.useRef)(!1),g=(0,i.useMemo)(()=>({core:new a.CylinderGeometry(.08,.08,20,16),inner:new a.CylinderGeometry(.18,.18,20,16),outer:new a.CylinderGeometry(.32,.32,20,16),glow1:new a.CylinderGeometry(.45,.45,20,16),glow2:new a.CylinderGeometry(.55,.45,20,16),outerGlow:new a.CylinderGeometry(.6,.65,20,16),torus:new a.TorusGeometry(.85,.08,8,32),skyTorus:new a.TorusGeometry(.7,.08,32,32),sphere:new a.SphereGeometry(.12,8,8)}),[]),f=(0,i.useMemo)(()=>({core:new a.MeshStandardMaterial({color:"#00FF88",emissive:"#00FF88",emissiveIntensity:50,transparent:!0,opacity:.995}),inner:new a.MeshStandardMaterial({color:"#00FF88",emissive:"#00FF88",emissiveIntensity:30,transparent:!0,opacity:.675}),outer:new a.MeshStandardMaterial({color:"#00FF88",emissive:"#00FF88",emissiveIntensity:20,transparent:!0,opacity:.625}),glow1:new a.MeshStandardMaterial({color:"#00FF88",emissive:"#00FF88",emissiveIntensity:4,transparent:!0,opacity:.55}),glow2:new a.MeshStandardMaterial({color:"#00FF88",emissive:"#00AA44",emissiveIntensity:3,transparent:!0,opacity:.425}),outerGlow:new a.MeshStandardMaterial({color:"#00FF88",emissive:"#00AA44",emissiveIntensity:1.5,transparent:!0,opacity:.2}),spiral:new a.MeshStandardMaterial({color:"#00FF88",emissive:"#00AA44",emissiveIntensity:10,transparent:!0,opacity:.5}),skySpiral:new a.MeshStandardMaterial({color:"#00FF88",emissive:"#00AA44",emissiveIntensity:10,transparent:!0,opacity:.4}),particle:new a.MeshStandardMaterial({color:"#00FF88",emissive:"#00AA44",emissiveIntensity:10,transparent:!0,opacity:.665})}),[]),y=(0,i.useMemo)(()=>[,,,].fill(0).map((e,t)=>({rotation:new a.Euler(Math.PI/4,t*Math.PI/1.5,Math.PI)})),[]),x=(0,i.useMemo)(()=>Array(16).fill(0).map((e,t)=>({rotation:new a.Euler(0,t*Math.PI/1.5,0),position:new a.Vector3(0,6,0)})),[]),v=(0,i.useMemo)(()=>Array(8).fill(0).map((e,t)=>({position:new a.Vector3(.6*Math.cos(t*Math.PI/4),(t-4)*1.5,.6*Math.sin(t*Math.PI/4))})),[]),M=()=>{if(m.current||!c.length)return;m.current=!0;let e=!1;c.forEach(r=>{r.health&&!(r.health<=0)&&3>=t.distanceTo(r.position)&&(s&&s(r.id,80),e=!0)}),l&&l(e)};return(0,o.F)((e,n)=>{if(!d.current)return;if(p.current<.05){p.current+=n;return}h.current+=n;let i=Math.min(h.current/.9,1);if(i<1){let e=t.y+40,r=t.y;d.current.position.y=e+(r-e)*i,i>=.8&&!m.current&&M();let n=i<.9?1:1-(i-.9)/.1;d.current.scale.set(n,n,n)}else r()}),(0,n.jsxs)("group",{ref:d,position:[t.x,t.y+40,t.z],visible:p.current>=.05,children:[(0,n.jsx)("mesh",{geometry:g.core,material:f.core}),(0,n.jsx)("mesh",{geometry:g.inner,material:f.inner}),(0,n.jsx)("mesh",{geometry:g.outer,material:f.outer}),(0,n.jsx)("mesh",{geometry:g.glow1,material:f.glow1}),(0,n.jsx)("mesh",{geometry:g.glow2,material:f.glow2}),(0,n.jsx)("mesh",{geometry:g.outerGlow,material:f.outerGlow}),y.map((e,t)=>(0,n.jsx)("mesh",{rotation:e.rotation,geometry:g.torus,material:f.spiral},t)),x.map((e,t)=>(0,n.jsx)("mesh",{rotation:e.rotation,position:e.position,geometry:g.skyTorus,material:f.skySpiral},t)),v.map((e,t)=>(0,n.jsx)("mesh",{position:e.position,geometry:g.sphere,material:f.particle},t)),(0,n.jsx)("pointLight",{position:[0,-10,0],color:"#00FF88",intensity:35,distance:25}),(0,n.jsx)("pointLight",{position:[0,0,0],color:"#00AA44",intensity:10,distance:6})]})}},2465:function(e,t,r){r.d(t,{Ei:function(){return d},ZP:function(){return h}});var n=r(7437),i=r(2265),o=r(1276),a=r(8001),s=r(73),l=r(6862),c=r(5113);let u=null,d=(e,t)=>!!u&&(u.addStunnedEnemy(e,t),!0);function h(e){let{world:t}=e,[r,d]=(0,i.useState)([]),h=(0,i.useRef)(0),p=(0,i.useRef)(0),m=(0,i.useCallback)(()=>t?t.getAllEntities().filter(e=>e.hasComponent(a.C)&&e.hasComponent(s.w)&&e.hasComponent(l.S)).map(e=>{e.getComponent(a.C);let t=e.getComponent(s.w),r=e.getComponent(l.S);return{id:e.id.toString(),position:t.position.clone(),health:r.currentHealth,isDying:r.isDead,deathStartTime:r.isDead?Date.now():void 0}}):[],[t]),g=(0,i.useCallback)((e,t)=>{let r={id:h.current++,enemyId:e,position:t.clone(),startTime:Date.now(),duration:4e3};d(e=>[...e,r])},[]),f=(0,i.useCallback)(()=>r,[r]);i.useEffect(()=>(u={addStunnedEnemy:g,getActiveStunnedEnemies:f},()=>{u=null}),[g,f]),(0,o.F)(e=>{let n=e.clock.getElapsedTime();if(n-p.current<.1||(p.current=n,!t))return;let i=Date.now(),o=t.getAllEntities();o.forEach(e=>{let t=e.getComponent(a.C),n=e.getComponent(s.w);t&&n&&t.isFrozen&&r.find(t=>t.enemyId===e.id.toString())}),d(e=>e.filter(e=>{if(i-e.startTime>=e.duration)return!1;let t=o.find(t=>t.id.toString()===e.enemyId);if(!t)return!1;let r=t.getComponent(l.S);if(r&&r.isDead)return!1;let n=t.getComponent(a.C);return!n||!!n.isFrozen}))});let y=m();return(0,n.jsx)(n.Fragment,{children:r.map(e=>(0,n.jsx)(c.Z,{position:e.position,duration:e.duration,startTime:e.startTime,enemyId:e.enemyId,enemyData:y,onComplete:()=>{d(t=>t.filter(t=>t.id!==e.id))}},e.id))})}},5113:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),i=r(2265),o=r(1276);function a(e){let{position:t,duration:r=4e3,startTime:a=Date.now(),enemyId:s,enemyData:l=[],onComplete:c}=e,u=(0,i.useRef)(null),[d,h]=(0,i.useState)(1),[p,m]=(0,i.useState)(1),g=(0,i.useRef)(.03*Math.random()+.02),f=(0,i.useRef)(.008*Math.random()+.006),y=(0,i.useRef)(0);return(0,i.useEffect)(()=>{let e=setTimeout(()=>{c&&c()},r);return()=>{clearTimeout(e)}},[r,c,s]),(0,o.F)(()=>{if(!u.current)return;let e=Date.now()-a;y.current=e;let t=Math.min(e/r,1);if(t>=1&&c){c();return}if(s&&l.length>0){let e=l.find(e=>e.id===s);if(e&&e.health>0&&!e.isDying&&!e.deathStartTime){let t=e.position.clone();t.y+=.5,u.current.position.copy(t)}}t>.875?m(1-(t-.875)/.125):m(1),h((.6+.4*Math.sin(e*f.current))*p),u.current.rotation.y+=g.current,u.current.rotation.x=.15*Math.sin(.004*e),u.current.rotation.z=.1*Math.cos(.003*e)}),(0,n.jsxs)("group",{ref:u,position:t,children:[(0,n.jsxs)("mesh",{position:[0,-.5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.9,1,.4,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#FFD700",emissive:"#FFA500",emissiveIntensity:.4*d,transparent:!0,opacity:.6*p,roughness:.2,metalness:.8})]}),(0,n.jsxs)("mesh",{position:[0,1,0],children:[(0,n.jsx)("sphereGeometry",{args:[.8,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FFFF00",emissive:"#FFD700",emissiveIntensity:.8*d,transparent:!0,opacity:.7*p,roughness:.1,metalness:.3})]}),[...Array(8)].map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI/4,0],position:[.8*Math.cos(t*Math.PI/4),.2+.4*Math.sin(t+.01*y.current),.8*Math.sin(t*Math.PI/4)],children:(0,n.jsxs)("mesh",{rotation:[Math.PI/3,0,Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.05,.6,.05]}),(0,n.jsx)("meshStandardMaterial",{color:"#FFFF00",emissive:"#FFC107",emissiveIntensity:.6*d,transparent:!0,opacity:.8*p,roughness:.1,metalness:.9})]})},t)),[...Array(16)].map((e,t)=>(0,n.jsxs)("mesh",{position:[(Math.random()-.5)*2.5,2*Math.random()+.2,(Math.random()-.5)*2.5],rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("boxGeometry",{args:[.02,.15,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#FFFFFF",emissive:"#FFFF00",emissiveIntensity:.9*d*(.5+.5*Math.sin(.02*y.current+t)),transparent:!0,opacity:.9*p*(.3+.7*Math.sin(.015*y.current+.5*t)),roughness:0,metalness:1})]},"spark-".concat(t))),(0,n.jsxs)("mesh",{position:[0,.5,0],children:[(0,n.jsx)("sphereGeometry",{args:[.3,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#FFFFFF",emissive:"#FFFF00",emissiveIntensity:1.2*d,transparent:!0,opacity:.9*p,roughness:0,metalness:.5})]}),(0,n.jsx)("pointLight",{color:"#FFFF00",intensity:2*d*p,distance:4,decay:2,position:[0,.5,0]})]})}}}]);