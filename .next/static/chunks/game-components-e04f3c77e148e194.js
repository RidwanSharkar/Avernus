"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[812],{4668:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),o=r(2265);function i(e){let{damageData:t,onComplete:r,camera:i,size:a,stackIndex:s}=e,[l,c]=(0,o.useState)(1),[d,u]=(0,o.useState)(0),[h,g]=(0,o.useState)(1);(0,o.useEffect)(()=>{let e=Date.now(),n=()=>{let o=Math.min((Date.now()-e)/3e3,1);u((1-Math.pow(1-o,3))*4+.8*s);let i=0===s?1.2:.9-.1*s;g(i+(.8-.1*s-i)*Math.min(2*o,1));let a=0===s?.6:.3-.1*s;if(o>a){let e=(o-a)/(1-a);c(1-e+(0===s?0:Math.max(0,.7-.2*s))*e)}else c(1-.2*s);o<1?requestAnimationFrame(n):r(t.id)};n()},[t.id,r,s]);let p=0,m=0;if(i&&a.width>0&&a.height>0&&t.position&&t.position.clone){let e=t.position.clone();e.y+=d;let r=e.clone().project(i);p=(.5*r.x+.5)*a.width,m=(-.5*r.y+.5)*a.height}else{let e=window.innerWidth/2,r=window.innerHeight/2;p=e+50*t.position.x,m=r-50*t.position.z-20*d}return(0,n.jsx)("div",{className:"absolute pointer-events-none select-none font-bold text-lg",style:{left:"".concat(p,"px"),top:"".concat(m,"px"),opacity:l,transform:"translate(-50%, -50%) scale(".concat(h,")"),textShadow:"2px 2px 4px rgba(0, 0, 0, 0.8)",zIndex:1e3-s,transition:s>0?"opacity 0.3s ease-out":"none"},children:(0,n.jsxs)("span",{className:"".concat(t.isCritical?"text-yellow-300 text-xl animate-pulse":"crossentropy"===t.damageType?"text-green-400":"healing"===t.damageType?"text-green-300":"text-red-400"),children:[t.damage,t.isCritical&&"!"]})})}function a(e){let{damageNumbers:t,onDamageNumberComplete:r,camera:o,size:a}=e,s=new Map;return t.forEach(e=>{let t="".concat(Math.round(2*e.position.x),"_").concat(Math.round(2*e.position.z));s.has(t)||s.set(t,[]),s.get(t).push(e)}),s.forEach(e=>{e.sort((e,t)=>t.timestamp-e.timestamp),e.splice(3)}),(0,n.jsx)("div",{className:"fixed inset-0 pointer-events-none",children:Array.from(s.values()).flat().map(e=>{let t="".concat(Math.round(2*e.position.x),"_").concat(Math.round(2*e.position.z)),l=s.get(t).findIndex(t=>t.id===e.id);return(0,n.jsx)(i,{damageData:e,onComplete:r,camera:o,size:a,stackIndex:l},e.id)})})}},1702:function(e,t,r){r.r(t),r.d(t,{GameScene:function(){return ex}});var n=r(7437),o=r(2265),i=r(1276),a=r(1448),s=r(7988),l=r(45),c=r(73),d=r(7771),u=r(6862),h=r(3974),g=r(3478),p=r(3842),m=r(7223),f=r(2082),y=r(2972),x=r(5773),v=r(2158),M=r(244),j=r(4451),w=r(9667),S=r(7125),C=r(2824),b=r(8001),D=r(4842),P=r(1159);function I(e){let{collectedBones:t,isLeftWing:r}=e,i=(0,o.useRef)(null),s=(0,o.useMemo)(()=>{let e=new a.Shape;return e.moveTo(0,0),e.lineTo(.06,.8),e.lineTo(.03,1),e.lineTo(0,.95),e.lineTo(-.03,1),e.lineTo(-.06,.8),e.lineTo(0,0),e},[]),l=(0,o.useMemo)(()=>{let e=new a.Shape;return e.moveTo(0,0),e.lineTo(.05,.6),e.lineTo(.025,.8),e.lineTo(0,.75),e.lineTo(-.025,.8),e.lineTo(-.05,.6),e.lineTo(0,0),e},[]),c=(0,o.useMemo)(()=>({steps:1,depth:.02,bevelEnabled:!0,bevelThickness:.005,bevelSize:.008,bevelSegments:2,curveSegments:8}),[]),d=(0,o.useMemo)(()=>({feather:new a.MeshStandardMaterial({color:"#F5F5DC",emissive:"#2A2A1A",emissiveIntensity:.3,metalness:.1,roughness:.6,side:a.DoubleSide}),redMarking:new a.MeshStandardMaterial({color:"#FF0000",emissive:"#FF0000",emissiveIntensity:1.5,metalness:.7,roughness:.2,opacity:.9,transparent:!0,side:a.DoubleSide}),wingBone:new a.MeshStandardMaterial({color:"#E8E8E8",emissive:"#404040",emissiveIntensity:.4,metalness:.3,roughness:.4})}),[]),u=(0,o.useMemo)(()=>new a.ExtrudeGeometry(s,c),[s,c]),h=(0,o.useMemo)(()=>new a.ExtrudeGeometry(l,c),[l,c]),g=(0,o.useMemo)(()=>[{pos:new a.Vector3(r?-1:1,.3,-.15),rot:new a.Euler(0,0,r?-Math.PI/4:Math.PI/4),scale:new a.Vector3(-1.1,1.4,-1),featherLength:1.6,hasRedMarking:!0},{pos:new a.Vector3(r?-1.4:1.4,.8,-.05),rot:new a.Euler(0,0,r?-Math.PI/3:Math.PI/3),scale:new a.Vector3(-1,1.3,-1),featherLength:1.5,hasRedMarking:!0},{pos:new a.Vector3(r?-1.5:1.5,1,0),rot:new a.Euler(0,0,r?-Math.PI/2.5:Math.PI/2.5),scale:new a.Vector3(-.9,1.2,-1),featherLength:1.4,hasRedMarking:!1},{pos:new a.Vector3(r?-1.6:1.6,1.5,.05),rot:new a.Euler(0,0,r?-Math.PI/2:Math.PI/2),scale:new a.Vector3(-.8,1.3,-1),featherLength:1.3,hasRedMarking:!0},{pos:new a.Vector3(r?-.7:.7,.2,-.1),rot:new a.Euler(0,0,r?-Math.PI/8:Math.PI/8),scale:new a.Vector3(-1,1.4,-1),featherLength:1,hasRedMarking:!1},{pos:new a.Vector3(r?-.9:.9,.4,-.05),rot:new a.Euler(0,0,r?-Math.PI/5:Math.PI/5),scale:new a.Vector3(-.9,1.2,-1),featherLength:1.1,hasRedMarking:!0},{pos:new a.Vector3(r?-1.1:1.1,.6,0),rot:new a.Euler(0,0,r?-Math.PI/3.5:Math.PI/3.5),scale:new a.Vector3(-.8,1.1,-1),featherLength:1.1,hasRedMarking:!1},{pos:new a.Vector3(r?-1.8:1.8,1.1,-.05),rot:new a.Euler(0,0,r?-Math.PI/12-Math.PI/3:Math.PI/12+Math.PI/3),scale:new a.Vector3(.9,1.2,1),featherLength:1.8,hasRedMarking:!0},{pos:new a.Vector3(r?-1.6:1.6,.35,-.05),rot:new a.Euler(0,0,r?-Math.PI/12-Math.PI/5:Math.PI/12+Math.PI/5),scale:new a.Vector3(.8,1,1),featherLength:1.5,hasRedMarking:!1}],[r]),p=(e,t)=>(0,n.jsxs)("group",{position:e.pos,rotation:e.rot,scale:e.scale,children:[(0,n.jsx)("mesh",{geometry:u,material:d.feather,children:(0,n.jsx)("pointLight",{color:"#F5F5DC",intensity:.3,distance:.8,decay:2})}),e.hasRedMarking&&(0,n.jsx)("mesh",{geometry:h,material:d.redMarking,position:[0,0,.01],children:(0,n.jsx)("pointLight",{color:"#FF0000",intensity:1.2,distance:1.2,decay:2})})]},"feather-".concat(t));return(0,n.jsx)("group",{ref:i,position:new a.Vector3(0,-.2,0),rotation:new a.Euler(0,0,0),children:g.slice(0,Math.min(g.length,Math.floor(1.2*t))).map((e,t)=>p(e,t))})}let E=()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.06,.016,.016]}),(0,n.jsx)("meshStandardMaterial",{color:"#aa0000",transparent:!0,opacity:.45,emissive:"#aa0000",emissiveIntensity:.5})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#aa0000",emissive:"#aa0000",emissiveIntensity:1.1,transparent:!0,opacity:.7})]})]});function F(e){let{parentRef:t}=e,r=(0,o.useRef)([]),a=(0,o.useRef)(null);return(0,i.F)(e=>{let{clock:n}=e;if(!t.current||!a.current)return;let o=t.current.position;a.current.position.set(o.x,0,o.z),r.current.forEach((e,t)=>{if(!e)return;let r=n.getElapsedTime(),o=t/28*.75,i=t/28*Math.PI*4+1.8*r,a=.5*(1.2-1.1*o),s=Math.cos(i)*a,l=Math.sin(i)*a;e.position.set(s,o,l),e.rotation.y=i+Math.PI/2,e.rotation.x=Math.PI/5,e.rotation.z=.12*Math.sin(2.5*r+t);let c=e.children[0];c&&c.material&&(c.material.opacity=Math.max(.15,1-1.8*o))})}),(0,n.jsxs)("group",{ref:a,children:[Array.from({length:28}).map((e,t)=>(0,n.jsx)("group",{ref:e=>{e&&(r.current[t]=e)},children:E()},t)),(0,n.jsx)("pointLight",{color:"#aa0000",intensity:.8,distance:3,decay:2,position:[0,.6,0]})]})}function R(){let e={roughness:.4,metalness:.3,transparent:!0,opacity:.95};return(0,n.jsx)("group",{children:[-.89,.89].map(t=>(0,n.jsxs)("group",{position:[.56*t,.625,-.75],rotation:[-1.35,0,3.025*t],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.0125,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",...e})]}),(0,n.jsxs)("group",{position:[0,1.35,-0],scale:1.6,rotation:[-.65,0,0],children:[[-.07,-.02,.02,.07].map((t,r)=>(0,n.jsx)("group",{position:[t,.125,-.15],rotation:[2,0,0],scale:[1,1.5,1.2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.02,.075,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",...e})]})},"upper-".concat(r))),[-.08,-.015,.015,.09].map((t,r)=>(0,n.jsx)("group",{position:[t,.01075,0],rotation:[-.45,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.025*(0===r||3===r?1.3:1),.095*(0===r||3===r?1.5:1),3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",...e})]})},"lower-".concat(r)))]}),(0,n.jsxs)("group",{position:[0,.4,.2],rotation:[-.05,0,.3*t],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.008,.8,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#c4c4c4",...e})]}),[void 0,void 0,void 0,void 0,void 0].map((r,o)=>(0,n.jsx)("group",{position:[.02*t,.095*o,.07],rotation:[Math.PI/1.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.0325,.1,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#b4b4b4",...e})]})},o))]}),(0,n.jsx)("group",{position:[0,1.0225,.3],rotation:[-.925,0,.5*t],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.07,.0075,.6,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#b4b4b4",...e})]})})]},t))})}var A=e=>{let{parentRef:t}=e,r=(0,o.useRef)(null),s=(0,o.useRef)(new Float32Array(3)),l=(0,o.useRef)(new Float32Array(1)),c=(0,o.useRef)(new Float32Array(1)),d=(0,o.useRef)(0);return(0,i.F)((e,n)=>{var o;if(!(null===(o=r.current)||void 0===o?void 0:o.parent)||!t.current)return;d.current+=n;let i=t.current.position;for(let e=0;e<1;e++){let t=e/1*Math.PI*2+.8*d.current,r=.15+.12*Math.sin(1.5*d.current+.3*e);s.current[3*e]=i.x+Math.cos(t)*r,s.current[3*e+1]=i.y+2e-4*Math.sin(.8*d.current+.15*e),s.current[3*e+2]=i.z+Math.sin(t)*r,l.current[e]=.35*Math.pow(1-e/1,1.2),c.current[e]=.5*Math.pow(1-e/1,.5)}if(r.current){let e=r.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:r,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:1,array:s.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:1,array:l.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:1,array:c.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:a.AdditiveBlending,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 24.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.9, 0.0, 0.0), vec3(1.0, 0.3, 0.3), 0.5);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};let B=new a.MeshStandardMaterial({color:"#e0e0e0",roughness:.3,metalness:.4}),T=new a.MeshStandardMaterial({color:"#c8c8c8",roughness:.2,metalness:.5}),k=new a.SphereGeometry(.08,8,8),V=new a.CylinderGeometry(.08,.064,1.3,6),z=new a.ConeGeometry(.04,.2,8);function G(e){let{isRaised:t=!1}=e,r=(0,o.useRef)(null);(0,i.F)((e,n)=>{if(!r.current)return;let o=r.current.rotation.x;r.current.rotation.x=a.MathUtils.lerp(o,t?-Math.PI/2.5:0,4*n)});let s=(e,t)=>(0,n.jsx)("mesh",{geometry:V,material:B,scale:[t/.08,e/1.3,t/.08]}),l=e=>(0,n.jsx)("mesh",{geometry:k,material:B,scale:[e/.08,e/.08,e/.08]}),c=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:s(e,.08)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:s(e,.08)}),(0,n.jsx)("group",{position:[0,e/2,0],children:l(.1)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:l(.1)})]});return(0,n.jsx)("group",{ref:r,children:(0,n.jsxs)("group",{children:[c(1.3,.2),(0,n.jsxs)("group",{position:[0,-.8,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.16,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#e0e0e0",roughness:.3,metalness:.4})]}),(0,n.jsxs)("group",{position:[0,-.45,.35],rotation:[-.8,0,0],children:[c(1,.16),(0,n.jsxs)("group",{position:[0,-.6,0],rotation:[0,0,0],children:[l(.12),(0,n.jsxs)("group",{position:[0,-.12,0],scale:[1.5,1.5,1.5],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.25,.2,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e0e0e0",roughness:.3})]}),[-.1,-.05,0,.05,.1].map((e,t)=>(0,n.jsxs)("group",{position:[e,-.12,0],rotation:[0,0,(t-2)*Math.PI/8],children:[s(.6,.025),(0,n.jsx)("group",{position:[.03,-.35,0],rotation:[0,0,Math.PI/6],scale:[1.4,1.4,1.4],children:(0,n.jsx)("mesh",{geometry:z,material:T})})]},t)),t&&(0,n.jsxs)("group",{position:[0,-.06,.12],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,10,10]}),(0,n.jsx)("meshStandardMaterial",{color:"#AA0000",emissive:"#AA0000",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsx)("pointLight",{color:"#AA0000",intensity:2.5,distance:3,decay:2})]})]})]})]})]})]})})}function N(e){let{isAttacking:t,attackingHand:r=null,onLightningStart:s,health:l=1}=e,c=(0,o.useRef)(null),d=(0,o.useRef)(0);return(0,i.F)((e,n)=>{c.current&&(t&&r?(d.current+=3*n,d.current>Math.PI/4&&d.current<Math.PI/3&&s&&s(r),d.current>=Math.PI&&(d.current=0)):d.current=0)}),(0,n.jsxs)("group",{ref:c,scale:[1.275,1.275,1.275],children:[" ",(0,n.jsx)("group",{scale:[.65,.65,.65],position:[0,1.45,.2],rotation:[.5,0,0],children:(0,n.jsx)(R,{})}),(0,n.jsx)("group",{scale:[1.1,1,.9],position:[0,1.45,0],rotation:[.3,0,0],children:(0,n.jsx)(P.Z,{})}),(0,n.jsxs)("group",{scale:[1.175,1.275,-.9],position:[0,.775,0],children:[(0,n.jsx)("group",{rotation:[0,Math.PI/5,0],children:(0,n.jsx)(I,{collectedBones:15,isLeftWing:!0,parentRef:c})}),(0,n.jsx)("group",{rotation:[0,-Math.PI/5,0],children:(0,n.jsx)(I,{collectedBones:15,isLeftWing:!1,parentRef:c})})]}),(0,n.jsx)("group",{scale:[1.2,1.2,1.2],position:[0,1.35,0],children:(0,n.jsx)(D.Z,{})}),(0,n.jsx)("group",{position:[0,1,0],scale:[.25,.25,.25],children:(0,n.jsx)(A,{parentRef:c})}),(0,n.jsx)("group",{position:[0,1.5,.25],scale:[.4,.4,.4],children:(0,n.jsx)(A,{parentRef:c})}),(0,n.jsx)("group",{position:[0,1.8,.35],scale:[.4,.4,.4],children:(0,n.jsx)(A,{parentRef:c})}),(0,n.jsxs)("group",{scale:[1.45,1.9,1.45],position:[0,-.25,0],children:[(0,n.jsx)("group",{position:[0,0,.1],rotation:[0,0,0],children:(0,n.jsx)(F,{parentRef:c})}),(0,n.jsx)("group",{position:[0,0,-.1],rotation:[0,Math.PI,0],children:(0,n.jsx)(F,{parentRef:c})})]}),(0,n.jsx)("group",{position:[-.5,1.4,.1],rotation:[0,Math.PI/6,0],scale:[.35,.35,.35],children:(0,n.jsx)(G,{isRaised:t&&"left"===r})}),(0,n.jsx)("group",{position:[.5,1.4,.1],rotation:[0,-Math.PI/6,0],scale:[.45,.375,.45],children:(0,n.jsx)(G,{isRaised:t&&"right"===r})}),(0,n.jsxs)("mesh",{position:[-.5,1.7,.125],children:[(0,n.jsx)("sphereGeometry",{args:[.2,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#CC0000",emissive:"#FF0000",emissiveIntensity:.4,transparent:!0,opacity:.9,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[-.5,1.7,.125],rotation:[Math.PI/2,-Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.25,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF4444",emissive:"#FF0000",emissiveIntensity:.6,transparent:!0,opacity:.95,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{position:[.5,1.7,.125],children:[(0,n.jsx)("sphereGeometry",{args:[.2,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#CC0000",emissive:"#FF0000",emissiveIntensity:.4,transparent:!0,opacity:.9,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[.5,1.7,.125],rotation:[Math.PI/2,Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.25,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF4444",emissive:"#FF0000",emissiveIntensity:.6,transparent:!0,opacity:.95,metalness:.8,roughness:.2})]}),(0,n.jsx)("group",{position:[0,1.2,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.8,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#440000",emissive:"#660000",emissiveIntensity:.5,transparent:!0,opacity:.15,blending:a.AdditiveBlending})]})}),l<.5&&(0,n.jsx)("group",{position:[0,1.2,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.6,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF0000",emissive:"#FF0000",emissiveIntensity:1.2,transparent:!0,opacity:.25,blending:a.AdditiveBlending})]})})]})}function W(e){let{entityId:t,position:r,world:a,onMeshReady:s}=e,l=(0,o.useRef)(null),d=(0,o.useRef)(0),h=(0,o.useRef)(!1),g=(0,o.useRef)(null),p=(0,o.useRef)(1),m=(0,o.useRef)(!1);return(0,i.F)((e,r)=>{if(d.current+=r,l.current){let e=a.getEntity(t);if(e){let t=e.getComponent(c.w),r=e.getComponent(u.S),n=e.getComponent(b.C);if(t&&l.current.position.copy(t.position),r&&(p.current=r.currentHealth/r.maxHealth),n){m.current=n.isDead;let e=Date.now()/1e3-n.lastAttackTime,t=Math.sin(.3*d.current)>.8;h.current=e<1||t,h.current?g.current=Math.sin(.6*d.current)>0?"left":"right":g.current=null}}m.current?l.current.visible=!1:(l.current.visible=!0,l.current.position.y+=.15*Math.sin(1.5*d.current),h.current||(l.current.rotation.y+=.3*r))}}),(0,o.useEffect)(()=>{l.current&&s&&s(l.current)},[s]),(0,n.jsx)("group",{ref:l,children:(0,n.jsx)(N,{isAttacking:h.current,attackingHand:g.current,onLightningStart:e=>{console.log("\uD83C\uDF29️ Boss lightning attack from ".concat(e," hand!"))},health:p.current})})}var L=r(3680),O=r(6520),H=e=>{let{parentRef:t}=e,r=(0,o.useRef)(null),s=(0,o.useRef)(new Float32Array(18)),l=(0,o.useRef)(new Float32Array(6)),c=(0,o.useRef)(new Float32Array(6)),d=(0,o.useRef)(0);return(0,i.F)((e,n)=>{var o;if(!(null===(o=r.current)||void 0===o?void 0:o.parent)||!t.current)return;d.current+=n;let i=t.current.position;for(let e=0;e<6;e++){let t=Math.acos(-1+2*e/6),r=Math.sqrt(6*Math.PI)*t+d.current,n=.5+.08*Math.sin(2*d.current+.3*e);s.current[3*e]=i.x+n*Math.cos(r)*Math.sin(t),s.current[3*e+1]=i.y+n*Math.sin(r)*Math.sin(t),s.current[3*e+2]=i.z+n*Math.cos(t),l.current[e]=.25*Math.pow(1-e/6,1.2),c.current[e]=.3*Math.pow(1-e/6,.5)}if(r.current){let e=r.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:r,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:6,array:s.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:6,array:l.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:6,array:c.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:a.AdditiveBlending,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z); // Smaller point size\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.25, 0.41, 0.88), vec3(0.53, 0.81, 0.92), 0.4); // More vibrant blue glow for grunt\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};let _=new a.Matrix4,U=new a.Vector3,Z=new a.Euler,Y=new a.Vector3,q=new a.Quaternion;function Q(e,t,r,n,o){q.setFromEuler(n),_.compose(r,q,o),e.setMatrixAt(t,_)}let J={sphere:new a.SphereGeometry(.02,8,8),cylinder:new a.CylinderGeometry(.04,.032,1,4),cone:new a.ConeGeometry(.02,.15,4),box:new a.BoxGeometry(.2,.15,.08),vertebrae:new a.CylinderGeometry(.0225,.0225,.03,6),eye:new a.SphereGeometry(.02,8,8),eyeGlow:new a.SphereGeometry(.035,8,8),eyeOuterGlow:new a.SphereGeometry(.05,6.5,2)},K={standardBone:new a.MeshStandardMaterial({color:"#e8e8e8",roughness:.4,metalness:.3}),darkBone:new a.MeshStandardMaterial({color:"#d4d4d4",roughness:.3,metalness:.4}),eyeCore:new a.MeshStandardMaterial({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:3}),eyeGlow:new a.MeshStandardMaterial({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1,transparent:!0,opacity:.75}),eyeOuterGlow:new a.MeshStandardMaterial({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1,transparent:!0,opacity:.7})};function X(){let e=(0,o.useMemo)(()=>{let e=new a.InstancedMesh(J.vertebrae,K.standardBone,5);return e.instanceMatrix.setUsage(a.DynamicDrawUsage),e},[]);return(0,o.useEffect)(()=>{[.15,.27,.39,.51,.63].forEach((t,r)=>{U.set(0,t,0),Z.set(.1,0,0),Y.set(1,1,1),Q(e,r,U,Z,Y)}),e.instanceMatrix.needsUpdate=!0},[e]),(0,n.jsx)("primitive",{object:e})}function $(e){let{position:t}=e,r=(0,o.useMemo)(()=>({core:new a.InstancedMesh(J.eye,K.eyeCore,1),innerGlow:new a.InstancedMesh(J.eyeGlow,K.eyeGlow,1),outerGlow:new a.InstancedMesh(J.eyeOuterGlow,K.eyeOuterGlow,1)}),[]);return(0,o.useEffect)(()=>{U.set(...t),Z.set(0,0,0),Q(r.core,0,U,Z,Y.set(1,1,1)),Q(r.innerGlow,0,U,Z,Y.set(1.2,1.2,1.2)),Q(r.outerGlow,0,U,Z,Y.set(1.4,1.4,1.4)),Object.values(r).forEach(e=>{e.instanceMatrix.needsUpdate=!0})},[r,t]),(0,n.jsxs)("group",{children:[(0,n.jsx)("primitive",{object:r.core}),(0,n.jsx)("primitive",{object:r.innerGlow}),(0,n.jsx)("primitive",{object:r.outerGlow}),(0,n.jsx)("pointLight",{color:"#4169E1",intensity:.5,distance:1,decay:2,position:t})]})}function ee(){let e=(e,t)=>(0,n.jsx)("mesh",{geometry:J.cylinder,material:K.standardBone,scale:[t/.04,e,t/.04]}),t=e=>(0,n.jsx)("mesh",{geometry:J.sphere,material:K.standardBone,scale:[e/.06,e/.06,e/.06]});return(0,n.jsxs)("group",{children:[t(.08),(0,n.jsxs)("group",{rotation:[.3,0,0],children:[e(.4,.07),(0,n.jsxs)("group",{position:[0,-.2,0],children:[t(.09),(0,n.jsxs)("group",{position:[0,0,-.5],children:[e(.8,.06),(0,n.jsxs)("group",{position:[0,-.4,0],children:[t(.05),(0,n.jsxs)("group",{position:[0,0,0],children:[e(.9,.04),(0,n.jsxs)("group",{position:[0,-.45,0],children:[t(.04),(0,n.jsxs)("group",{position:[0,0,0],children:[e(.7,.03),(0,n.jsx)("group",{position:[0,-.35,0],children:(0,n.jsx)("mesh",{geometry:J.cone,material:K.darkBone})})]})]})]})]})]})]})]})]})}function et(e){let{isLeftHand:t=!1}=e,r=(e,t)=>(0,n.jsx)("mesh",{geometry:J.cylinder,material:K.standardBone,scale:[t/.04,e,t/.04]}),o=e=>(0,n.jsx)("mesh",{geometry:J.sphere,material:K.standardBone,scale:[e/.06,e/.06,e/.06]}),i=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[0,e/2,0],children:o(.08)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:o(.08)})]}),s=(()=>{let e=new a.Shape;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})();return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[i(1.3,.15),(0,n.jsxs)("group",{position:[.25,-.85,.21],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[i(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[o(.09),(0,n.jsxs)("group",{position:[0,.1,0],children:[(0,n.jsxs)("group",{position:[-0,-.2,.2],rotation:[2+Math.PI/4,-1,2.675*Math.PI+.85],scale:[1.4,.55,1.4],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[s,{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16}]}),(0,n.jsx)("meshStandardMaterial",{color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:a.DoubleSide})]}),(0,n.jsx)("pointLight",{color:"#4169E1",intensity:1,distance:2,decay:2})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,n.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[r(.5,.02),(0,n.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t))]})]})]})]})]})})}function er(){let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,n.jsxs)("group",{scale:[e,e,e],position:[0,-.125,0],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.06,.115,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.1,.0275],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.03,.12,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.2,.04],rotation:[.2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.04,.175,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),[0,Math.PI/2,Math.PI,3*Math.PI/2].map((e,t)=>(0,n.jsx)("group",{rotation:[0,e,0],children:(0,n.jsxs)("mesh",{position:[.04,.05,0],children:[(0,n.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.5,metalness:.3})]})},t))]})};return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.185,.2,.225,4,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,.25,0],rotation:[2*Math.PI,Math.PI/3,0],children:[(0,n.jsx)("group",{position:[0,0,0],rotation:[0,0,0],children:e(1.5)}),(0,n.jsx)("group",{position:[0,-.05,.15],rotation:[-.2,0,0],children:e(1.1)}),(0,n.jsx)("group",{position:[0,-.05,-.15],rotation:[.2,0,0],children:e(1.1)})]})]})}function en(e){let{isLeft:t=!1}=e,r=1.2*Math.PI;return(0,n.jsx)("group",{rotation:[-.25,t?-.3:.3,t?-.4:.4],children:Array.from({length:10}).map((e,o)=>{let i=o/9,a=.15*(1-.8*i),s=1.4*Math.pow(i,1.3);return(0,n.jsxs)("group",{position:[s*(t?-.15:.15),.12*o,-(.6*s)],rotation:[-.8*i,Math.pow(i,1.2)*r,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[a,.92*a,.12,4]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*i,", ").concat(0+20*i,", ").concat(0+20*i,")"),roughness:.7,metalness:.4})]}),Array.from({length:4}).map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI*2/4,0],children:(0,n.jsxs)("mesh",{position:[.95*a,0,0],children:[(0,n.jsx)("boxGeometry",{args:[.4*a,.132,.2*a]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*i,", ").concat(20+20*i,", ").concat(20+20*i,")"),roughness:.8,metalness:.3})]})},t))]},o)})})}function eo(e){let{isAttacking:t,isWalking:r}=e,a=(0,o.useRef)(null),[s,l]=(0,o.useState)(0),[c,d]=(0,o.useState)(0),u=(0,o.useRef)(),h=[{left:"LeftFrontLeg",right:"RightFrontLeg",baseRotation:{x:.2,y:-.6,z:.6},rightBaseRotation:{x:.2,y:.6,z:-.6},phase:0},{left:"LeftMiddleFrontLeg",right:"RightMiddleFrontLeg",baseRotation:{x:.25,y:-.8,z:.7},rightBaseRotation:{x:.25,y:.8,z:-.7},phase:Math.PI},{left:"LeftMiddleBackLeg",right:"RightMiddleBackLeg",baseRotation:{x:.5,y:-1,z:.7},rightBaseRotation:{x:.5,y:1,z:-.7},phase:0},{left:"LeftBackLeg",right:"RightBackLeg",baseRotation:{x:1,y:-1.2,z:.6},rightBaseRotation:{x:1,y:1.2,z:-.6},phase:Math.PI}];return(0,i.F)((e,n)=>{if(!a.current)return;let o=a.current;if(r){let e=(s+7*n)%(2*Math.PI);l(e),["LeftFrontLeg","RightFrontLeg","LeftMiddleFrontLeg","RightMiddleFrontLeg","LeftMiddleBackLeg","RightMiddleBackLeg","LeftBackLeg","RightBackLeg"].forEach((t,r)=>{let n=o.getObjectByName(t);if(n){var i,a;t.includes("Right");let o=e+(r%2==0?0:Math.PI);n.rotation.x=.2*Math.cos(o),n.position.y=.6+.3*Math.max(0,Math.sin(o));let s=null===(i=n.children[0])||void 0===i?void 0:i.children[1],l=null==s?void 0:null===(a=s.children[1])||void 0===a?void 0:a.children[1];if(s&&l){let e=o+Math.PI/4;s.rotation.x=.4*Math.sin(e)-.2,l.rotation.x=-(.6*Math.sin(e))-.3}}})}if(t){d(e=>e+3*n);let e=[{left:"LeftLowerBackArm",right:"RightLowerBackArm",startTime:.65,rotationRange:.5*Math.PI},{left:"LeftMiddleBackArm",right:"RightMiddleBackArm",startTime:.95,rotationRange:.5*Math.PI},{left:"LeftUpperBackArm",right:"RightUpperBackArm",startTime:1.25,rotationRange:.5*Math.PI},{left:"LeftFrontArm",right:"RightFrontArm",startTime:1.55,rotationRange:.5*Math.PI}];e.forEach(e=>{let{left:t,right:r,startTime:n,rotationRange:i}=e,a=o.getObjectByName(t),s=o.getObjectByName(r);if(a&&s){let e=Math.max(0,Math.min(1,(c-n)*1)),t=Math.sin(e*Math.PI)*i,r=.5*Math.sin(e*Math.PI);a.rotation.y=4*Math.PI+t,s.rotation.y=4*Math.PI-t,a.rotation.z=r,s.rotation.z=r}}),c>2.45&&(d(0),e.forEach(e=>{let{left:t,right:r}=e,n=o.getObjectByName(t),i=o.getObjectByName(r);n&&i&&(n.rotation.z=0,i.rotation.z=0)}))}else[{left:"LeftLowerBackArm",right:"RightLowerBackArm",y:4.2*Math.PI},{left:"LeftMiddleBackArm",right:"RightMiddleBackArm",y:4.1*Math.PI},{left:"LeftUpperBackArm",right:"RightUpperBackArm",y:4*Math.PI},{left:"LeftFrontArm",right:"RightFrontArm",y:4.9*Math.PI}].forEach(e=>{let{left:t,right:r,y:n}=e,i=o.getObjectByName(t),a=o.getObjectByName(r);i&&a&&(i.rotation.y=n,a.rotation.y=-n)});t||h.forEach(t=>{let{left:r,right:n,baseRotation:i,rightBaseRotation:a,phase:s}=t,l=o.getObjectByName(r),c=o.getObjectByName(n);if(l&&c){let t=3*e.clock.getElapsedTime(),r=Math.sin(t+s),n=Math.sin(t+s+Math.PI);l.rotation.set(i.x+.15*r,i.y+.045*r,i.z+.075*r),c.rotation.set(a.x+.15*n,a.y+.045*n,a.z+.075*n)}})}),(0,o.useEffect)(()=>{let e=u.current;return()=>{e&&clearTimeout(e)}},[]),(0,n.jsxs)("group",{ref:a,scale:[1.1,1.3,1.3],children:[(0,n.jsx)("group",{position:[0,1.375,-0],children:(0,n.jsx)(H,{parentRef:a})}),(0,n.jsx)("group",{name:"Body",position:[0,1.2,-.25],scale:[1.8,1.4,1.65],rotation:[.25,0,0],children:(0,n.jsx)(P.Z,{})}),(0,n.jsx)("group",{scale:[.7,.7,.7],position:[0,1.25,-.1],rotation:[.25,0,0],children:(0,n.jsx)(R,{})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,1.3,-.3],rotation:[1,0,-4.25],children:(0,n.jsx)(en,{isLeft:!0})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,1.3,-.3],rotation:[1,0,4.25],children:(0,n.jsx)(en,{isLeft:!1})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,.7,-.6],rotation:[1,0,-4.25],children:(0,n.jsx)(en,{isLeft:!0})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,.7,-.6],rotation:[1,0,4.25],children:(0,n.jsx)(en,{isLeft:!1})}),(0,n.jsxs)("group",{name:"Head",position:[0,1.925,.2],scale:[.95,.8,.8],children:[(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[0,0,-.05],children:[(0,n.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,n.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,n.jsx)("group",{position:[0,-.15,.05],children:(0,n.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,n.jsx)("group",{position:[.025,-.25,.2175],children:[-.03,-.06,-.09,-0,.03].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.075,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))}),(0,n.jsx)("group",{position:[0,-.18,.2],children:[-.06,-.02,.02,.06].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[2.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.01,.08,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))})]}),(0,n.jsxs)("group",{position:[0,.05,.14],children:[(0,n.jsx)($,{position:[-.07,0,0]}),(0,n.jsx)($,{position:[.07,0,0]})]})]}),(0,n.jsx)("group",{position:[-.55,1.8,.05],rotation:[-.45,-Math.PI/1.2,-.525],children:(0,n.jsx)(er,{})}),(0,n.jsx)("group",{position:[.55,1.8,.05],rotation:[-.45,Math.PI/1.2,.525],children:(0,n.jsx)(er,{})}),(0,n.jsx)("group",{name:"LeftFrontArm",position:[-.4,1.525,.1],scale:[-.525,.425,.525],rotation:[.2,Math.PI/3,0],children:(0,n.jsx)(et,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightFrontArm",position:[.4,1.525,.1],scale:[.525,.425,.525],rotation:[.2,-Math.PI/3,0],children:(0,n.jsx)(et,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftUpperBackArm",position:[-.55,1.6,0],scale:[-1.1,.7,.9],rotation:[0,2*Math.PI,-.4],children:(0,n.jsx)(et,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightUpperBackArm",position:[.55,1.6,0],scale:[1.1,.7,.9],rotation:[0,-(2*Math.PI),.4],children:(0,n.jsx)(et,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftMiddleBackArm",position:[-.45,1.5,-.1],scale:[-.75,.75,.75],rotation:[.4,2.1*Math.PI,-.4],children:(0,n.jsx)(et,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightMiddleBackArm",position:[.45,1.5,-.1],scale:[.75,.75,.75],rotation:[.4,-(2.1*Math.PI),.4],children:(0,n.jsx)(et,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftLowerBackArm",position:[-.35,1.4,-.2],scale:[-.6,.6,.6],rotation:[.6,2.2*Math.PI,-.3],children:(0,n.jsx)(et,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightLowerBackArm",position:[.35,1.4,-.2],scale:[.6,.6,.6],rotation:[.6,-(2.2*Math.PI),.3],children:(0,n.jsx)(et,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftFrontLeg",position:[.4,.75,.4],rotation:[.2,-.6,.6],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"RightFrontLeg",position:[-.4,.75,.4],rotation:[.2,.6,-.6],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"LeftMiddleFrontLeg",position:[.6,.73,0],rotation:[.25,-.8,.7],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"RightMiddleFrontLeg",position:[-.6,.73,0],rotation:[.25,.8,-.7],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"LeftMiddleBackLeg",position:[.5,.71,-.35],rotation:[.5,-1,.7],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"RightMiddleBackLeg",position:[-.5,.71,-.35],rotation:[.5,1,-.7],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"LeftBackLeg",position:[.4,.7,-.725],rotation:[1,-1.2,.6],children:(0,n.jsx)(ee,{})}),(0,n.jsx)("group",{name:"RightBackLeg",position:[-.4,.7,-.725],rotation:[1,1.2,-.6],children:(0,n.jsx)(ee,{})}),(0,n.jsxs)("group",{position:[0,1.925,.245],scale:[.405,.425,.275],children:[(0,n.jsx)("group",{position:[.2,.2,0],rotation:[-.4,.5,-.2],children:(0,n.jsx)(en,{isLeft:!0})}),(0,n.jsx)("group",{position:[-.2,.2,0],rotation:[-.3,-.5,.3],children:(0,n.jsx)(en,{isLeft:!1})})]}),(0,n.jsxs)("group",{position:[0,.5,-.25],scale:[1.9,1,1.75],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.35,.34,.27,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsx)("group",{position:[0,.15,-.16],rotation:[.1,0,0],children:(0,n.jsx)(X,{})}),[-1,1].map(e=>(0,n.jsx)("group",{position:[.15*e,-.1,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]})]})}let ei=new O.L(()=>({sphere:new a.SphereGeometry(.3,12,12),cylinder:new a.CylinderGeometry(.12,.12,.8,4),cone:new a.ConeGeometry(.06,.25,4),box:new a.BoxGeometry(.15,.12,.06)}),e=>{},5),ea=new O.L(()=>({body:new a.MeshStandardMaterial({color:"#4169E1",emissive:"#1E3A8A",emissiveIntensity:.2,transparent:!0,opacity:.85,metalness:.6,roughness:.3}),bone:new a.MeshStandardMaterial({color:"#e8e8e8",emissive:"#d4d4d4",emissiveIntensity:.1,transparent:!0,opacity:.9,metalness:.3,roughness:.4}),claw:new a.MeshStandardMaterial({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.7,roughness:.2})}),e=>{Object.values(e).forEach(e=>{e.needsUpdate=!0})},5);function es(e){let{entityId:t,world:r,onMeshReady:s}=e,l=(0,o.useRef)(null),d=(0,o.useRef)(new a.Vector3),h=(0,o.useRef)(1),g=(0,o.useRef)(!1),p=(0,o.useRef)(!1),m=(0,o.useRef)(!1),f=(0,o.useRef)(0),{geometries:y,materials:x}=(0,o.useMemo)(()=>({geometries:ei.acquire(),materials:ea.acquire()}),[]);return(0,i.F)((e,n)=>{f.current+=n;let o=r.getEntity(t);if(!o)return;let i=o.getComponent(c.w),a=o.getComponent(u.S),s=o.getComponent(b.C);if(i&&l.current&&(d.current.copy(i.position),l.current.position.copy(i.position)),a&&(h.current=a.currentHealth/a.maxHealth),s){g.current=s.isDead;let e=Date.now()/1e3-s.lastAttackTime,t=Math.sin(.5*f.current)>.9;p.current=e<.8||t;let r=d.current.clone();if(i){let e=r.distanceTo(i.position);m.current=e>.01}}g.current&&l.current?l.current.visible=!1:l.current&&(l.current.visible=!0)}),(0,o.useEffect)(()=>{l.current&&s&&s(l.current)},[s]),(0,o.useEffect)(()=>()=>{ei.release(y),ea.release(x)},[y,x]),(0,o.useEffect)(()=>{let e=Math.max(.4,h.current);x.body.opacity=.85*e,x.bone.opacity=.9*e,x.claw.opacity=.9*e;let t=Math.max(.3,h.current);x.body.emissiveIntensity=.2*t,x.claw.emissiveIntensity=.8*t},[x,h.current]),(0,n.jsx)("group",{ref:l,children:(0,n.jsx)(eo,{isAttacking:p.current,isWalking:m.current,onHit:e=>{console.log("\uD83D\uDDE1️ Grunt hit for ".concat(e," damage!"))}})})}function el(e){let{world:t,maxInstances:r=200}=e,a=(0,o.useRef)({boss:[],elite:[],grunt:[]});return(0,i.F)(()=>{if(!t)return;let e=performance.now(),r=performance.now(),n=t.queryEntities([b.C,c.w]),o=[],i=[],s=[];for(let e of n){let t=e.getComponent(b.C);if(t)switch(t.type){case b.Z.BOSS:o.push(e.id);break;case b.Z.ELITE:i.push(e.id);break;case b.Z.GRUNT:s.push(e.id)}}if(a.current={boss:o,elite:i,grunt:s},Math.floor(e/16.67)%60==0){let e=performance.now()-r,t=o.length+i.length+s.length;t>0&&console.log("\uD83C\uDFAD Original Models: ".concat(t," enemies (").concat(o.length," bosses, ").concat(i.length," elites, ").concat(s.length," grunts) rendered in ").concat(e.toFixed(2),"ms"))}}),(0,n.jsxs)(n.Fragment,{children:[a.current.boss.map(e=>{let r=t.getEntity(e);if(!r)return null;let o=r.getComponent(c.w);return o?(0,n.jsx)(W,{entityId:e,position:o.position,world:t},e):null}),a.current.elite.map(e=>{let r=t.getEntity(e);if(!r)return null;let o=r.getComponent(c.w);return o?(0,n.jsx)(L.Z,{entityId:e,position:o.position,world:t},e):null}),a.current.grunt.map(e=>{let r=t.getEntity(e);return r&&r.getComponent(c.w)?(0,n.jsx)(es,{entityId:e,world:t},e):null})]})}function ec(e){let{world:t}=e;return(0,n.jsx)(el,{world:t,maxInstances:200})}var ed=r(7057),eu=r(6932),eh=r(7019),eg=r(9709),ep=r(1151),em=r(5050),ef=r(5658),ey=r(4244);function ex(){var e;let{onDamageNumbersUpdate:t,onDamageNumberComplete:r,onCameraUpdate:b,onGameStateUpdate:D,onControlSystemUpdate:P}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{scene:I,camera:E,gl:F,size:R}=(0,i.D)(),A=(0,o.useRef)(null),B=(0,o.useRef)(null),T=(0,o.useRef)(null),k=(0,o.useRef)(null),V=(0,o.useRef)(!1),[z,G]=(0,o.useState)(new a.Vector3(0,.5,0)),[N,W]=(0,o.useState)(null),[L,O]=(0,o.useState)({currentWeapon:S.v.BOW,currentSubclass:S.p.ELEMENTAL,isCharging:!1,chargeProgress:0,isSwinging:!1,isSpinning:!1,swordComboStep:1,isDivineStorming:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1}),{createPowershotEffect:H}=(0,ey.sf)();return(0,o.useEffect)(()=>{if(V.current)return;V.current=!0,(0,em.j4)(0),(0,em.Ge)(0);let e=new l.D({enableDebug:!0});A.current=e;let t=F.domElement;return e.initialize(t).then(()=>{let{player:t,controlSystem:r}=function(e,t,r,n){let o=e.getWorld(),i=e.getInputManager();n.shadowMap.enabled=!0,n.shadowMap.type=a.PCFSoftShadowMap;let s=new x.F,l=new v.s(5),S=new M.b(o),C=new p.K(t,r,n),b=new j.C(t,r),D=new y.c(o),P=new m.s(r,i,o,D),I=new f.D(r,i,{distance:8,height:2,mouseSensitivity:.005,smoothing:.15});D.setCombatSystem(S),o.addSystem(s),o.addSystem(l),o.addSystem(S),o.addSystem(C),o.addSystem(b),o.addSystem(D),o.addSystem(P),o.addSystem(I);let E=function(e){let t=e.createEntity(),r=e.createComponent(c.w);r.setPosition(0,.5,0),t.addComponent(r);let n=e.createComponent(d.i);n.maxSpeed=3.75,n.jumpForce=8,n.friction=.85,t.addComponent(n);let o=new u.S(500);o.enableRegeneration(1,5),t.addComponent(o);let i=new h.W(200,20,5);t.addComponent(i);let a=e.createComponent(g.YM);return a.type=g.F5.SPHERE,a.radius=1,a.layer=g.aB.PLAYER,a.setOffset(0,.5,0),t.addComponent(a),console.log("\uD83D\uDC64 Player entity created with components:",{transform:!!t.getComponent(c.w),movement:!!t.getComponent(d.i),health:!!t.getComponent(u.S),shield:!!t.getComponent(h.W),collider:!!t.getComponent(g.YM)}),t}(o);P.setPlayer(E),I.setTarget(E),I.snapToTarget();let F=new w.R(o,{enableObjectPooling:!0,enableHealthBars:!0,healthBarConfig:{showWhenFull:!0,fadeDistance:20}});return F.createTrainingDummy(new a.Vector3(5,0,5)),F.createElite(new a.Vector3(-8,0,8),2),F.createElite(new a.Vector3(8,0,3),2),console.log("✅ Game setup complete!"),console.log("\uD83D\uDC64 Player entity created with ID: ".concat(E.id)),console.log("\uD83C\uDFAF Enemies spawned on the map"),console.log("\uD83C\uDFF9 Bow arrows deal 10 base damage, Crossentropy bolts deal 30 base damage"),console.log("⚡ All damage now uses critical hit system with floating damage numbers!"),{player:E,controlSystem:P}}(e,I,E,F);console.log("\uD83C\uDFAE GameScene Player entity created:",t,"ID:",t.id),W(t),B.current=t.id,T.current=r,P&&P(r),r.setBowReleaseCallback((t,n)=>{if(console.log("\uD83C\uDFF9 Bow released with charge:",t,n?"✨ PERFECT SHOT!":""),n){console.log("\uD83C\uDF1F Creating perfect shot visual effect!");let t=e.getWorld().getEntity(B.current);if(t){let e=t.getComponent(c.w);if(e){let t=new a.Vector3;E.getWorldDirection(t),t.normalize();let n=new a.Vector3;n.crossVectors(t,new a.Vector3(0,1,0)).normalize();let o=new a.Matrix4;o.makeRotationAxis(n,Math.PI/12),t.applyMatrix4(o),t.normalize(),console.log("\uD83C\uDF1F Perfect shot effect created with ID:",H(e.position.clone(),t,r.getCurrentSubclass(),!0,!0))}}}}),r.setViperStingCallback((e,t)=>{console.log("\uD83D\uDC0D Viper Sting triggered at position:",e.toArray())}),r.setBarrageCallback((e,t)=>{console.log("\uD83C\uDFF9 Barrage triggered at position:",e.toArray())}),r.setDivineStormCallback((e,t,r)=>{console.log("⚡ Divine Storm activated at position:",e.toArray(),"duration:",r+"ms"),(0,eg.e6)(e,"local-player",r)}),r.setReanimateCallback(()=>{console.log("\uD83C\uDF3F Reanimate healing effect triggered"),k.current&&k.current.triggerHealingEffect()}),r.setSkyfallCallback((e,t)=>{console.log("\uD83C\uDF1F Skyfall triggered at position:",e.toArray())}),e.start()}),()=>{A.current&&A.current.destroy()}},[I,E,F]),(0,i.F)((e,r)=>{if(A.current&&A.current.isEngineRunning()){if(function(e){let t=document.getElementById("fps-counter");t&&(t.textContent="FPS: ".concat(e))}(A.current.getCurrentFPS()),N){let e=N.getComponent(c.w);e&&e.position&&G(e.position.clone())}T.current&&O({currentWeapon:T.current.getCurrentWeapon(),currentSubclass:T.current.getCurrentSubclass(),isCharging:T.current.isWeaponCharging(),chargeProgress:T.current.getChargeProgress(),isSwinging:T.current.isWeaponSwinging(),isSpinning:T.current.isWeaponCharging()&&T.current.getCurrentWeapon()===S.v.SCYTHE,swordComboStep:T.current.getSwordComboStep(),isDivineStorming:T.current.isDivineStormActive(),isSwordCharging:T.current.isChargeActive(),isDeflecting:T.current.isDeflectActive(),isViperStingCharging:T.current.isViperStingChargingActive(),viperStingChargeProgress:T.current.getViperStingChargeProgress(),isBarrageCharging:T.current.isBarrageChargingActive(),barrageChargeProgress:T.current.getBarrageChargeProgress(),isCobraShotCharging:T.current.isCobraShotChargingActive(),cobraShotChargeProgress:T.current.getCobraShotChargeProgress(),isSkyfalling:T.current.isSkyfallActive(),isBackstabbing:T.current.isBackstabActive()});let e=A.current.getWorld().getSystem(M.b);if(e&&t&&t(e.getDamageNumbers()),b&&b(E,R),D&&N&&T.current){let e=N.getComponent(u.S),t=N.getComponent(h.W);e&&D({playerHealth:e.currentHealth,maxHealth:e.maxHealth,playerShield:t?t.currentShield:0,maxShield:t?t.maxShield:0,currentWeapon:T.current.getCurrentWeapon(),currentSubclass:T.current.getCurrentSubclass()})}}}),o.useEffect(()=>{r&&(window.handleDamageNumberComplete=e=>{var t;let r=null===(t=A.current)||void 0===t?void 0:t.getWorld().getSystem(M.b);r&&r.removeDamageNumber(e)})},[r]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ef.Z,{level:1,world:null===(e=A.current)||void 0===e?void 0:e.getWorld()}),(0,n.jsx)("ambientLight",{intensity:.225}),(0,n.jsx)("directionalLight",{position:[10,10,5],intensity:.5,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),(0,n.jsxs)("mesh",{receiveShadow:!0,position:[0,-.5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[29,29,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#2d5a2d"})]}),(0,n.jsxs)("mesh",{position:[0,.01,0],children:[(0,n.jsx)("ringGeometry",{args:[28.5,29,64]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6b6b",transparent:!0,opacity:.3})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[5,1,5],children:[(0,n.jsx)("boxGeometry",{args:[2,2,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#8b4513"})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[-5,1,-5],children:[(0,n.jsx)("boxGeometry",{args:[2,2,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#8b4513"})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[0,1,-10],children:[(0,n.jsx)("boxGeometry",{args:[4,2,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#696969"})]}),(console.log("\uD83D\uDC09 GameScene DragonRenderer render check:",{playerEntity:!!N,engineRef:!!A.current,playerPosition:z.toArray()}),N&&A.current&&(0,n.jsx)(s.Z,{entityId:N.id,position:z,world:A.current.getWorld(),currentWeapon:L.currentWeapon,currentSubclass:L.currentSubclass,isCharging:L.isCharging,chargeProgress:L.chargeProgress,isSwinging:L.isSwinging,isSpinning:L.isSpinning,swordComboStep:L.swordComboStep,isDivineStorming:L.isDivineStorming,isSwordCharging:L.isSwordCharging,isDeflecting:L.isDeflecting,isViperStingCharging:L.isViperStingCharging,viperStingChargeProgress:L.viperStingChargeProgress,isBarrageCharging:L.isBarrageCharging,barrageChargeProgress:L.barrageChargeProgress,isCobraShotCharging:L.isCobraShotCharging,cobraShotChargeProgress:L.cobraShotChargeProgress,isSkyfalling:L.isSkyfalling,isBackstabbing:L.isBackstabbing,reanimateRef:k,onBowRelease:()=>{},onScytheSwingComplete:()=>{console.log("⚔️ Scythe swing completed")},onSwordSwingComplete:()=>{var e;console.log("\uD83D\uDDE1️ Sword swing completed - notifying control system"),null===(e=T.current)||void 0===e||e.onSwordSwingComplete()},onSabresSwingComplete:()=>{var e;console.log("⚔️ Sabres swing completed - notifying control system"),null===(e=T.current)||void 0===e||e.onSabresSwingComplete()},onChargeComplete:()=>{var e;console.log("⚔️ Charge completed - notifying control system"),null===(e=T.current)||void 0===e||e.onChargeComplete()},onDeflectComplete:()=>{var e;console.log("\uD83D\uDEE1️ Deflect completed - notifying control system"),null===(e=T.current)||void 0===e||e.onDeflectComplete()}})),A.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.Z,{world:A.current.getWorld()}),(0,n.jsx)(ec,{world:A.current.getWorld()}),(0,n.jsx)(ed.Z,{}),(0,n.jsx)(eu.default,{world:A.current.getWorld()}),(0,n.jsx)(eh.default,{world:A.current.getWorld()}),(0,n.jsx)(eg.ZP,{enemyData:[]}),(0,n.jsx)(ep.ZP,{})]})]})}},8026:function(e,t,r){r.r(t),r.d(t,{default:function(){return a}});var n=r(7437),o=r(2265);let i=(0,r(166).default)(()=>Promise.all([r.e(841),r.e(893),r.e(812),r.e(736),r.e(983)]).then(r.bind(r,1702)).then(e=>({default:e.GameScene})),{loadableGenerated:{webpack:()=>[1702]},ssr:!1,loading:()=>null});function a(e){return(0,n.jsx)(o.Suspense,{fallback:null,children:(0,n.jsx)(i,{...e})})}},888:function(e,t,r){r.r(t),r.d(t,{MultiplayerGameScene:function(){return k}});var n=r(7437),o=r(2265),i=r(1276),a=r(1448),s=r(7988),l=r(946),c=r(45),d=r(4058),u=r(73),h=r(7771),g=r(6862),p=r(3974),m=r(8001),f=r(3478),y=r(6776),x=r(3842),v=r(7223),M=r(2082),j=r(2972),w=r(5773),S=r(2158),C=r(244),b=r(4451),D=r(7125),P=r(2824),I=r(7057),E=r(6932),F=r(7019),R=r(5050),A=r(5658),B=r(4244),T=r(3680);function k(){var e;let{onDamageNumbersUpdate:t,onDamageNumberComplete:r,onCameraUpdate:k,onGameStateUpdate:V,onControlSystemUpdate:z}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{scene:G,camera:N,gl:W,size:L}=(0,i.D)(),{players:O,enemies:H,killCount:_,gameStarted:U,updatePlayerPosition:Z,updatePlayerWeapon:Y,updatePlayerHealth:q,broadcastPlayerAttack:Q,broadcastPlayerAbility:J,broadcastPlayerAnimationState:K,damageEnemy:X,socket:$}=(0,l.p)(),ee=(0,o.useRef)(null),et=(0,o.useRef)(null),er=(0,o.useRef)(null),en=(0,o.useRef)(null),eo=(0,o.useRef)(!1),ei=(0,o.useRef)(0),[ea,es]=(0,o.useState)(new a.Vector3(0,.5,0)),[el,ec]=(0,o.useState)(null),ed=(0,o.useRef)(new Map),[eu,eh]=(0,o.useState)({currentWeapon:D.v.BOW,currentSubclass:D.p.ELEMENTAL,isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1}),eg=(0,o.useRef)({weapon:D.v.BOW,subclass:D.p.ELEMENTAL}),[ep,em]=(0,o.useState)(new Map),{createPowershotEffect:ef}=(0,B.sf)();return((0,o.useEffect)(()=>{if(!$)return;let e=e=>{if(console.log("⚔️ Received player attack:",e),e.playerId!==$.id&&ee.current){var t;if("bow_release"===e.attackType&&(null===(t=e.animationData)||void 0===t?void 0:t.isPerfectShot)){console.log("\uD83C\uDF1F Creating perfect shot beam effect for other player!");let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=O.get(e.playerId);ef(t,r,(null==n?void 0:n.subclass)||D.p.ELEMENTAL,!0,!0)}if(["regular_arrow","charged_arrow","entropic_bolt","crossentropy_bolt","perfect_shot"].includes(e.attackType)){console.log("\uD83C\uDFF9 Creating multiplayer projectile:",e.attackType);let t=ee.current.getWorld().getSystem(j.c);if(t){let r=new a.Vector3(e.position.x,e.position.y,e.position.z),n=new a.Vector3(e.direction.x,e.direction.y,e.direction.z);switch(e.attackType){case"regular_arrow":t.createProjectile(ee.current.getWorld(),r,n,-1,{speed:25,damage:0,lifetime:3,opacity:.8});break;case"charged_arrow":t.createChargedArrowProjectile(ee.current.getWorld(),r,n,-1,{speed:35,damage:0,lifetime:5,piercing:!0,opacity:.8});break;case"entropic_bolt":t.createEntropicBoltProjectile(ee.current.getWorld(),r,n,-1,{speed:20,damage:0,lifetime:8,piercing:!0,opacity:.8});break;case"crossentropy_bolt":t.createCrossentropyBoltProjectile(ee.current.getWorld(),r,n,-1,{speed:15,damage:0,lifetime:10,piercing:!0,opacity:.8});break;case"perfect_shot":t.createChargedArrowProjectile(ee.current.getWorld(),r,n,-1,{speed:40,damage:0,lifetime:6,piercing:!0,opacity:1})}}}em(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1},o=e.animationData||{},i=Date.now();return r.set(e.playerId,{...n,isSwinging:e.attackType.includes("swing")||e.attackType.includes("sword"),isCharging:e.attackType.includes("bow")&&e.attackType.includes("charge"),isSpinning:e.attackType.includes("scythe")||o.isSpinning||!1,swordComboStep:o.comboStep||n.swordComboStep,chargeProgress:o.chargeProgress||0,lastAttackType:e.attackType,lastAttackTime:i,lastAnimationUpdate:i}),setTimeout(()=>{em(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&n.lastAnimationUpdate===i&&r.set(e.playerId,{...n,isSwinging:!1,isCharging:!1,isSpinning:!1}),r})},e.attackType.includes("scythe")?2e3:e.attackType.includes("sword")?800:e.attackType.includes("bow")?500:1e3),r})}},t=e=>{console.log("✨ Received player ability:",e),e.playerId!==$.id&&"divine_storm"===e.abilityType&&em(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1};return r.set(e.playerId,{...n,isDivineStorming:!0,isSpinning:!0}),setTimeout(()=>{em(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isDivineStorming:!1,isSpinning:!1}),r})},3e3),r})},r=e=>{console.log("\uD83D\uDCAB Received player effect:",e)},n=e=>{console.log("\uD83C\uDFAD Received player animation state:",e),e.playerId!==$.id&&em(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1};return r.set(e.playerId,{...n,...e.animationState,lastAnimationUpdate:Date.now()}),r})};return $.on("player-attacked",e),$.on("player-used-ability",t),$.on("player-effect",r),$.on("player-animation-state",n),()=>{$.off("player-attacked",e),$.off("player-used-ability",t),$.off("player-effect",r),$.off("player-animation-state",n)}},[$]),(0,o.useEffect)(()=>{let e=setInterval(()=>{em(e=>{let t=new Map(e),r=Date.now(),n=!1;return t.forEach((e,o)=>{e.lastAnimationUpdate&&r-e.lastAnimationUpdate>3e3&&(e.isSwinging||e.isCharging||e.isSpinning)&&(console.log("\uD83D\uDD27 Force resetting stuck animation for player ".concat(o)),t.set(o,{...e,isSwinging:!1,isCharging:!1,isSpinning:!1}),n=!0)}),n?t:e})},1e3);return()=>clearInterval(e)},[]),(0,o.useEffect)(()=>{if(!ee.current||!U)return;let e=ee.current.getWorld();H.forEach((t,r)=>{if(ed.current.has(r)){let n=ed.current.get(r),o=e.getEntity(n);if(o){let e=o.getComponent(u.w);e&&e.setPosition(t.position.x,t.position.y,t.position.z);let r=o.getComponent(g.S);r&&(r.maxHealth=t.maxHealth,r.currentHealth=t.health,t.isDying&&!r.isDead&&(r.currentHealth=0))}}else{let n=e.createEntity(),o=e.createComponent(u.w);o.setPosition(t.position.x,t.position.y,t.position.z),n.addComponent(o);let i=e.createComponent(m.C);i.type="elite"===t.type?m.Z.ELITE:m.Z.GRUNT,i.level=1,n.addComponent(i);let s=e.createComponent(g.S);s.maxHealth=t.maxHealth,s.currentHealth=t.health,n.addComponent(s);let l=e.createComponent(f.YM);l.type=f.F5.SPHERE,l.radius=2,l.layer=f.aB.ENEMY,l.setOffset(0,1,0),n.addComponent(l);let c=e.createComponent(y.T),d={width:1.2,height:.1,offset:new a.Vector3(0,2.5,0),showWhenFull:!1,fadeDistance:20,healthColor:new a.Color(65280),lowHealthColor:new a.Color(16776960),criticalHealthColor:new a.Color(16711680)};c.width=d.width,c.height=d.height,c.offset.copy(d.offset),c.showWhenFull=d.showWhenFull,c.fadeDistance=d.fadeDistance,c.healthColor.copy(d.healthColor),c.lowHealthColor.copy(d.lowHealthColor),c.criticalHealthColor.copy(d.criticalHealthColor),n.addComponent(c),e.notifyEntityAdded(n),ed.current.set(r,n.id),console.log("\uD83D\uDD17 Created local ECS entity ".concat(n.id," for server enemy ").concat(r," (").concat(t.type,") with health bar"))}});let t=new Set(H.keys()),r=[];ed.current.forEach((n,o)=>{if(!t.has(o)){let t=e.getEntity(n);if(t){let e=t.getComponent(g.S);e&&(e.currentHealth=0,e.isDead=!0),console.log("\uD83D\uDC80 Marked local ECS entity ".concat(n," as dead for deleted server enemy ").concat(o))}r.push(o)}}),r.forEach(e=>{ed.current.delete(e)})},[H,U]),(0,o.useEffect)(()=>{if(eo.current||!U)return;eo.current=!0,(0,R.j4)(0),(0,R.Ge)(0);let e=new c.D({enableDebug:!0});ee.current=e;let t=W.domElement;return e.initialize(t).then(()=>{let{player:t,controlSystem:r}=function(e,t,r,n,o){let i=e.getWorld(),s=e.getInputManager();n.shadowMap.enabled=!0,n.shadowMap.type=a.PCFSoftShadowMap;let l=new w.F,c=new S.s(5),d=new C.b(i),m=new x.K(t,r,n),f=new b.C(t,r),y=new j.c(i),D=new v.s(r,s,i,y),P=new M.D(r,s,{distance:8,height:2,mouseSensitivity:.005,smoothing:.15});y.setCombatSystem(d),d.setEnemyDamageCallback(o),i.addSystem(l),i.addSystem(c),i.addSystem(d),i.addSystem(m),i.addSystem(f),i.addSystem(y),i.addSystem(D),i.addSystem(P);let I=function(e){let t=e.createEntity(),r=e.createComponent(u.w);r.setPosition(0,.5,0),t.addComponent(r);let n=e.createComponent(h.i);n.maxSpeed=3.75,n.jumpForce=8,n.friction=.85,t.addComponent(n);let o=e.createComponent(g.S);o.maxHealth=200,o.enableRegeneration(2,5),t.addComponent(o);let i=new p.W(100,20,5);return t.addComponent(i),console.log("\uD83D\uDC64 Multiplayer player entity created with components:",{transform:!!t.getComponent(u.w),movement:!!t.getComponent(h.i),health:!!t.getComponent(g.S),shield:!!t.getComponent(p.W)}),t}(i);return D.setPlayer(I),P.setTarget(I),P.snapToTarget(),console.log("\uD83C\uDF0D Total entities in world:",i.getAllEntities().length),console.log("✅ Multiplayer game setup complete!"),console.log("\uD83D\uDC64 Player entity created with ID: ".concat(I.id)),console.log("\uD83C\uDF10 Multiplayer enemies and players will be synchronized from server"),{player:I,controlSystem:D}}(e,G,N,W,(e,t)=>{let r=parseInt(e),n=null;ed.current.forEach((e,t)=>{e===r&&(n=t)}),n?(console.log("\uD83C\uDFAF Mapping local entity ".concat(e," to server enemy ").concat(n," for ").concat(t," damage")),X(n,t)):console.warn("⚠️ Could not find server enemy ID for local entity ".concat(e))});ec(t),et.current=t.id,er.current=r,z&&z(r),r.setBowReleaseCallback((t,n)=>{if(console.log("\uD83C\uDFF9 Bow released with charge:",t,n?"✨ PERFECT SHOT!":""),el){let e=el.getComponent(u.w);if(e){let r=new a.Vector3;N.getWorldDirection(r),r.normalize(),Q("bow_release",e.position,r,{chargeProgress:t,isPerfectShot:n})}}if(n){console.log("\uD83C\uDF1F Creating perfect shot visual effect!");let t=e.getWorld().getEntity(et.current);if(t){let e=t.getComponent(u.w);if(e){let t=new a.Vector3;N.getWorldDirection(t),t.normalize();let n=new a.Vector3;n.crossVectors(t,new a.Vector3(0,1,0)).normalize();let o=new a.Matrix4;o.makeRotationAxis(n,Math.PI/12),t.applyMatrix4(o),t.normalize(),console.log("\uD83C\uDF1F Perfect shot effect created with ID:",ef(e.position.clone(),t,r.getCurrentSubclass(),!0,!0))}}}}),r.setDivineStormCallback((e,t)=>{console.log("⚡ Divine Storm activated - broadcasting to other players"),J("divine_storm",e,t)}),r.setProjectileCreatedCallback((e,t,n,o)=>{console.log("\uD83C\uDFF9 Projectile created - broadcasting to other players:",e);let i={};(e.includes("arrow")||e.includes("bolt"))&&(i.chargeProgress=r.getChargeProgress()),Q(e,t,n,i)}),r.setReanimateCallback(()=>{console.log("\uD83C\uDF3F Multiplayer Reanimate healing effect triggered"),en.current&&en.current.triggerHealingEffect()}),e.start()}),()=>{ee.current&&ee.current.destroy()}},[G,N,W,U]),(0,i.F)((e,r)=>{if(ee.current&&ee.current.isEngineRunning()&&U){if(el){let e=el.getComponent(u.w);e&&(es(e.position.clone()),Z(e.position,{x:0,y:0,z:0}))}if(er.current){let e={currentWeapon:er.current.getCurrentWeapon(),currentSubclass:er.current.getCurrentSubclass(),isCharging:er.current.isWeaponCharging(),chargeProgress:er.current.getChargeProgress(),isSwinging:er.current.isWeaponSwinging(),swordComboStep:er.current.getSwordComboStep(),isDivineStorming:er.current.isDivineStormActive()},t=eg.current;(e.currentWeapon!==t.weapon||e.currentSubclass!==t.subclass)&&(console.log("\uD83D\uDD04 Weapon changed:",e.currentWeapon,e.currentSubclass),Y(e.currentWeapon,e.currentSubclass),eg.current={weapon:e.currentWeapon,subclass:e.currentSubclass}),eh(e);let r=Date.now();if(r-ei.current>100){let t=e.currentWeapon===D.v.SCYTHE&&e.isCharging,n=e.isDivineStorming;K({isCharging:e.isCharging,chargeProgress:e.chargeProgress,isSwinging:e.isSwinging,swordComboStep:e.swordComboStep,isDivineStorming:e.isDivineStorming,isSpinning:t||n}),ei.current=r}}let e=ee.current.getWorld().getSystem(C.b);if(e&&t&&t(e.getDamageNumbers()),k&&k(N,L),V&&el&&er.current){let e=el.getComponent(g.S),t=el.getComponent(p.W);e&&(V({playerHealth:e.currentHealth,maxHealth:e.maxHealth,playerShield:t?t.currentShield:0,maxShield:t?t.maxShield:0,currentWeapon:er.current.getCurrentWeapon(),currentSubclass:er.current.getCurrentSubclass()}),q(e.currentHealth,e.maxHealth))}}}),o.useEffect(()=>{r&&(window.handleDamageNumberComplete=e=>{var t;let r=null===(t=ee.current)||void 0===t?void 0:t.getWorld().getSystem(C.b);r&&r.removeDamageNumber(e)})},[r]),U)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(A.Z,{level:Math.min(5,Math.floor(_/10)+1),world:null===(e=ee.current)||void 0===e?void 0:e.getWorld()}),(0,n.jsx)("ambientLight",{intensity:.3}),(0,n.jsx)("directionalLight",{position:[10,10,5],intensity:.5,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),(0,n.jsxs)("mesh",{receiveShadow:!0,position:[0,-.5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[29,29,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#2d5a2d"})]}),(0,n.jsxs)("mesh",{position:[0,.01,0],children:[(0,n.jsx)("ringGeometry",{args:[28.5,29,64]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6b6b",transparent:!0,opacity:.3})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[5,1,5],children:[(0,n.jsx)("boxGeometry",{args:[2,2,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#8b4513"})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[-5,1,-5],children:[(0,n.jsx)("boxGeometry",{args:[2,2,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#8b4513"})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[0,1,-10],children:[(0,n.jsx)("boxGeometry",{args:[4,2,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#696969"})]}),el&&ee.current&&$&&(0,n.jsx)(s.Z,{entityId:el.id,position:ea,world:ee.current.getWorld(),currentWeapon:eu.currentWeapon,currentSubclass:eu.currentSubclass,isCharging:eu.isCharging,chargeProgress:eu.chargeProgress,isSwinging:eu.isSwinging,swordComboStep:eu.swordComboStep,isDivineStorming:eu.isDivineStorming,reanimateRef:en,onBowRelease:()=>{},onScytheSwingComplete:()=>{console.log("⚔️ Scythe swing completed");let e=new a.Vector3;N.getWorldDirection(e),e.normalize(),Q("scythe_swing",ea,e,{isSpinning:!0})},onSwordSwingComplete:()=>{var e;console.log("\uD83D\uDDE1️ Sword swing completed - notifying control system"),null===(e=er.current)||void 0===e||e.onSwordSwingComplete();let t=new a.Vector3;N.getWorldDirection(t),t.normalize(),Q("sword_swing",ea,t,{comboStep:eu.swordComboStep})},onChargeComplete:()=>{var e;console.log("⚔️ Charge completed - notifying control system"),null===(e=er.current)||void 0===e||e.onChargeComplete()},onDeflectComplete:()=>{var e;console.log("\uD83D\uDEE1️ Deflect completed - notifying control system"),null===(e=er.current)||void 0===e||e.onDeflectComplete()}}),Array.from(O.values()).map(e=>{var t;if(e.id===(null==$?void 0:$.id))return null;let r=ep.get(e.id)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1};return(0,n.jsx)(s.Z,{entityId:parseInt(e.id.replace(/\D/g,"0")),position:new a.Vector3(e.position.x,e.position.y,e.position.z),world:(null===(t=ee.current)||void 0===t?void 0:t.getWorld())||new d.q,currentWeapon:e.weapon,currentSubclass:e.subclass,isCharging:r.isCharging,chargeProgress:r.chargeProgress,isSwinging:r.isSwinging,isSpinning:r.isSpinning,swordComboStep:r.swordComboStep,isDivineStorming:r.isDivineStorming,onBowRelease:()=>{},onScytheSwingComplete:()=>{},onSwordSwingComplete:()=>{}},e.id)}),ee.current&&(()=>{let e=ee.current.getWorld().getAllEntities(),t=e.filter(e=>e.hasComponent(m.C));return console.log("\uD83D\uDD0D All entities:",e.length,"Enemy entities:",t.length),t})().map(e=>{let t=e.getComponent(m.C),r=e.getComponent(u.w);if(!t||!r)return null;switch(t.type){case m.Z.ELITE:return(0,n.jsx)(T.Z,{entityId:e.id,position:r.position.clone(),world:ee.current.getWorld()},e.id);case m.Z.GRUNT:case m.Z.BOSS:default:return null}}),ee.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(P.Z,{world:ee.current.getWorld()}),(0,n.jsx)(I.Z,{}),(0,n.jsx)(E.default,{world:ee.current.getWorld()}),(0,n.jsx)(F.default,{world:ee.current.getWorld()})]})]}):null}},6619:function(e,t,r){r.r(t),r.d(t,{PVPGameScene:function(){return q}});var n=r(7437),o=r(2265),i=r(1276),a=r(1448),s=r(7988),l=r(946),c=r(45),d=r(4058),u=r(73),h=r(7771),g=r(6862),p=r(3974),m=r(1168),f=r(246),y=r(3478),x=r(2115),v=r(3842),M=r(7223),j=r(2082),w=r(2972),S=r(5773),C=r(2158),b=r(244),D=r(3021),P=r(7125),I=r(2824),E=r(7057),F=r(6932),R=r(6923),A=r(7019),B=r(319),T=r(3351);function k(e){let{position:t,debuffType:r,duration:a=5e3,startTime:s=Date.now(),onComplete:l}=e,c=(0,o.useRef)(null),[d,u]=(0,o.useState)(1),[h,g]=(0,o.useState)(1),p=(0,o.useRef)(.02*Math.random()+.01);(0,o.useEffect)(()=>{let e=setTimeout(()=>{console.log("\uD83C\uDFAF Debuff indicator (".concat(r,") completed after"),a,"ms"),l&&l()},a);return()=>{clearTimeout(e)}},[a,l,r]),(0,i.F)(()=>{if(!c.current)return;let e=Date.now()-s,t=Math.min(e/a,1);if(t>=1&&l){console.log("\uD83C\uDFAF Debuff indicator (".concat(r,") exceeded duration, forcing completion")),l();return}t>.8?g(1-(t-.8)/.19999999999999996):g(1),u((.6+.4*Math.sin(.008*e))*h),c.current.rotation.y+=p.current,c.current.rotation.z=.1*Math.sin(.003*e)});let m=(()=>{switch(r){case"frozen":return{color:"#4FC3F7",emissive:"#29B6F6",symbol:"❄️"};case"slowed":return{color:"#FFA726",emissive:"#FF9800",symbol:"\uD83D\uDC0C"};default:return{color:"#9E9E9E",emissive:"#757575",symbol:"?"}}})();return(0,n.jsxs)("group",{ref:c,position:[t.x,t.y+2.5,t.z],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("circleGeometry",{args:[.4,16]}),(0,n.jsx)("meshStandardMaterial",{color:m.color,emissive:m.emissive,emissiveIntensity:.3*d,transparent:!0,opacity:.6*h,roughness:.1,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,0,-.01],rotation:[0,0,0],children:[(0,n.jsx)("ringGeometry",{args:[.35,.45,16]}),(0,n.jsx)("meshStandardMaterial",{color:m.color,emissive:m.emissive,emissiveIntensity:.5*d,transparent:!0,opacity:.8*h,roughness:.05,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,0,.01],children:[(0,n.jsx)("circleGeometry",{args:[.25,12]}),(0,n.jsx)("meshStandardMaterial",{color:m.emissive,emissive:m.emissive,emissiveIntensity:.8*d,transparent:!0,opacity:.4*h})]}),[...Array(6)].map((e,t)=>{let r=t*Math.PI*2/6,o=.6+.1*Math.sin(.003*Date.now()+t);return(0,n.jsxs)("mesh",{position:[Math.cos(r)*o,Math.sin(r)*o*.3,0],children:[(0,n.jsx)("sphereGeometry",{args:[.03,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:m.color,emissive:m.emissive,emissiveIntensity:.9*d,transparent:!0,opacity:.7*h})]},t)}),(0,n.jsx)("pointLight",{color:m.color,intensity:1.5*d*h,distance:3,position:[0,0,.2]})]})}var V=r(8787),z=r(9709),G=r(1151);function N(e){let{playerId:t,playerName:r,position:s,health:l,maxHealth:c,shield:d=0,maxShield:u=200,camera:h,showDistance:g=25}=e,p=(0,o.useRef)(null),m=(0,o.useRef)({healthBar:null,shieldBar:null,background:null,shieldBackground:null}),[f,y]=(0,o.useState)(!1),x=new a.Vector3(0,3,0);return(0,o.useEffect)(()=>{if(!p.current)return;let e=new a.PlaneGeometry(2,.15),t=new a.MeshBasicMaterial({color:new a.Color(3355443),transparent:!0,opacity:.8,depthWrite:!1}),r=new a.Mesh(e,t);r.position.set(0,0,.001),m.current.background&&p.current.remove(m.current.background),m.current.background=r,p.current.add(r);let n=new a.PlaneGeometry(2,.15),o=new a.MeshBasicMaterial({color:new a.Color(65280),transparent:!0,opacity:.9,depthWrite:!1}),i=new a.Mesh(n,o);i.position.set(0,0,.002),m.current.healthBar&&p.current.remove(m.current.healthBar),m.current.healthBar=i,p.current.add(i);let s=new a.PlaneGeometry(2,.105),l=new a.MeshBasicMaterial({color:new a.Color(1712946),transparent:!0,opacity:.8,depthWrite:!1}),c=new a.Mesh(s,l);c.position.set(0,.2,.001),m.current.shieldBackground&&p.current.remove(m.current.shieldBackground),m.current.shieldBackground=c,p.current.add(c);let d=new a.PlaneGeometry(2,.105),u=new a.MeshBasicMaterial({color:new a.Color(4886754),transparent:!0,opacity:.9,depthWrite:!1}),h=new a.Mesh(d,u);return h.position.set(0,.2,.002),m.current.shieldBar&&p.current.remove(m.current.shieldBar),m.current.shieldBar=h,p.current.add(h),()=>{e.dispose(),t.dispose(),n.dispose(),o.dispose(),s.dispose(),l.dispose(),d.dispose(),u.dispose()}},[]),(0,i.F)(()=>{if(!p.current||!h)return;let e=s.clone().add(x),t=h.position.distanceTo(e),r=t<=g&&(l<c||d<u);if(r!==f&&y(r),!r){p.current.visible=!1;return}if(p.current.visible=!0,p.current.position.copy(e),p.current.lookAt(h.position),m.current.healthBar){let e=Math.max(0,Math.min(1,l/c));m.current.healthBar.scale.x=e,m.current.healthBar.position.x=-(2*(1-e))/2;let t=m.current.healthBar.material;e>.6?t.color.setHex(65280):e>.3?t.color.setHex(16776960):t.color.setHex(16711680)}if(m.current.shieldBar&&u>0){let e=Math.max(0,Math.min(1,d/u));m.current.shieldBar.scale.x=e,m.current.shieldBar.position.x=-(2*(1-e))/2}let n=.8*g,o=t>n?Math.max(.3,1-(t-n)/(g-n)):1;[m.current.background,m.current.healthBar,m.current.shieldBackground,m.current.shieldBar].forEach(e=>{if(e){let t=e.material;t.opacity=t.userData.baseOpacity*o}})}),(0,o.useEffect)(()=>{[{mesh:m.current.background,opacity:.8},{mesh:m.current.healthBar,opacity:.9},{mesh:m.current.shieldBackground,opacity:.8},{mesh:m.current.shieldBar,opacity:.9}].forEach(e=>{let{mesh:t,opacity:r}=e;t&&(t.material.userData.baseOpacity=r)})},[]),(0,n.jsx)("group",{ref:p})}function W(e){let{entityId:t,world:r,position:s,ownerId:l,towerIndex:c,health:d,maxHealth:h,isDead:g=!1,color:p}=e,m=(0,o.useRef)(null),f=(0,o.useRef)(null),y=(0,o.useMemo)(()=>[new a.Color(4886754),new a.Color(16739125),new a.Color(5294200),new a.Color(10181046),new a.Color(15965202)],[]),v=p||y[c%y.length],M=Math.max(0,d/h),j=g?.3:Math.max(.5,M),w=g?new a.Color(6710886):v.clone().lerp(new a.Color(16711680),1-M);return(0,i.F)(()=>{if(!r||g)return;let e=r.getEntity(t);if(!e)return;let n=e.getComponent(x.N);if(!n||!n.currentTarget)return;let o=r.getEntity(n.currentTarget);if(!o)return;let i=o.getComponent(u.w);if(!i)return;let l=new a.Vector3;if(l.copy(i.position),l.sub(s),l.y=0,l.normalize(),f.current){let e=Math.atan2(l.x,l.z);f.current.rotation.y=e}}),(0,n.jsxs)("group",{ref:m,position:[s.x,s.y,s.z],children:[(0,n.jsxs)("mesh",{position:[0,2,0],castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("cylinderGeometry",{args:[1,1.5,4,8]}),(0,n.jsx)("meshStandardMaterial",{color:w,metalness:.3,roughness:.7,transparent:!0,opacity:j})]}),(0,n.jsxs)("mesh",{position:[0,4.25,0],castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("cylinderGeometry",{args:[.8,.8,.5,8]}),(0,n.jsx)("meshStandardMaterial",{color:w.clone().multiplyScalar(1.2),metalness:.5,roughness:.5,transparent:!0,opacity:j})]}),(0,n.jsx)("mesh",{ref:f,position:[0,4.25,0],castShadow:!0,children:(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{position:[.5,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("cylinderGeometry",{args:[.1,.1,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:2899536,metalness:.8,roughness:.2,transparent:!0,opacity:j})]})})}),[0,1,2,3].map(e=>{let t=e/4*Math.PI*2,r=1.35*Math.cos(t),o=1.35*Math.sin(t);return(0,n.jsxs)("mesh",{position:[r,1.2,o],castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("boxGeometry",{args:[.2,.3,.2]}),(0,n.jsx)("meshStandardMaterial",{color:w.clone().multiplyScalar(.8),metalness:.4,roughness:.8,transparent:!0,opacity:j})]},e)}),!g&&(0,n.jsxs)("group",{position:[0,5.5,0],children:[(0,n.jsxs)("mesh",{position:[0,0,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("planeGeometry",{args:[3,.3]}),(0,n.jsx)("meshBasicMaterial",{color:3355443,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{position:[-(3*(1-M))/2,.01,0],rotation:[-Math.PI/2,0,0],scale:[M,1,1],children:[(0,n.jsx)("planeGeometry",{args:[3,.25]}),(0,n.jsx)("meshBasicMaterial",{color:M>.5?65280:M>.25?16776960:16711680,transparent:!0,opacity:.9})]}),(0,n.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("planeGeometry",{args:[4,.5]}),(0,n.jsx)("meshBasicMaterial",{color:0,transparent:!0,opacity:.7})]})]}),g&&(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("sphereGeometry",{args:[2,8,8]}),(0,n.jsx)("meshBasicMaterial",{color:6710886,transparent:!0,opacity:.1,wireframe:!0})]})})]})}var L=r(5050),O=r(5658),H=r(4244);function _(e){let{world:t,players:n,onPlayerHit:o,onPlayerVenomed:s,serverPlayerEntities:l,localSocketId:c}=e;return(0,i.F)(()=>{let{getGlobalCobraShotProjectiles:e}=r(7019);e().forEach(e=>{if(!e.active)return;let t=e.position;n.forEach(r=>{if(r.id===c)return;let n=new a.Vector3(r.position.x,r.position.y,r.position.z);if(1.5>=t.distanceTo(n)){let t=parseInt(r.id)||r.id.length;e.hitEnemies.has(t)||(e.hitEnemies.add(t),o(r.id,29),console.log("\uD83D\uDC0D Cobra Shot projectile ".concat(e.id," hit player ").concat(r.id," (local: ").concat(r.id===c,"), applying venom effect at target position:"),n.toArray()),s(r.id,n.clone()),e.active=!1,e.fadeStartTime=Date.now())}})})}),null}function U(e){let{world:t,players:r,onPlayerHit:n,onPlayerSlowed:s,serverPlayerEntities:l,localSocketId:c}=e,d=(0,o.useRef)(new Set);return(0,i.F)(()=>{t&&t.getAllEntities().filter(e=>e.hasComponent(m.W)&&e.hasComponent(u.w)&&e.hasComponent(f.T)).forEach(e=>{var t,o;let i=e.getComponent(f.T),h=e.getComponent(u.w),g=e.getComponent(m.W);if(!(null==i?void 0:null===(o=i.mesh)||void 0===o?void 0:null===(t=o.userData)||void 0===t?void 0:t.isBarrageArrow)||!h||!g)return;let p=h.position;r.forEach(t=>{if(t.id===c)return;let r=new a.Vector3(t.position.x,t.position.y,t.position.z);if(1.25>=p.distanceTo(r)){let o="".concat(e.id,"-").concat(t.id),i=l.current.get(t.id);!i||g.hasHitTarget(i)||d.current.has(o)||(g.addHitTarget(i),d.current.add(o),n(t.id,30),console.log("\uD83C\uDFF9 Barrage projectile ".concat(e.id," hit player ").concat(t.id,", applying slow effect at target position:"),r.toArray()),s(t.id,r.clone()),setTimeout(()=>{d.current.delete(o)},1e4))}})})}),null}function Z(e){let{world:t,players:n,onPlayerHit:s,onPlayerFrozen:l,serverPlayerEntities:c,localSocketId:d}=e,u=(0,o.useRef)(new Set),h=(0,o.useRef)(0);return(0,i.F)(()=>{if(!t)return;let e=Date.now();if(e-h.current<50)return;h.current=e;let{getActiveFrostNovas:o}=r(6932);(o?o():[]).forEach(e=>{n.forEach(t=>{if(t.id===d)return;let r=new a.Vector3(t.position.x,t.position.y,t.position.z);if(6>=e.position.distanceTo(r)){let n="".concat(e.id,"-").concat(t.id);u.current.has(n)||(u.current.add(n),s(t.id,50),console.log("❄️ FrostNova ".concat(e.id," hit player ").concat(t.id,", applying freeze effect at target position:"),r.toArray()),l(t.id,r.clone()),setTimeout(()=>{u.current.delete(n)},7e3))}})})}),null}r(6374);let Y=o.memo(e=>{let{position:t,onComplete:r}=e,[a,s]=(0,o.useState)(0);(0,i.F)((e,t)=>{s(e=>{let n=e+t;return n>=1.5&&r(),n})});let l=a/1.5,c=Math.sin(l*Math.PI),d=1+2*l;return(0,n.jsxs)("group",{position:t.toArray(),children:[[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,2*l+.5*t,0],rotation:[Math.PI/2,0,2*a],children:[(0,n.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:1.5,transparent:!0,opacity:c*(1-.2*t)})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{scale:[d,d,d],children:[(0,n.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2,transparent:!0,opacity:.3*c})]}),[...Array(12)].map((e,t)=>{let r=t/12*Math.PI*2,o=.75+l;return(0,n.jsxs)("mesh",{position:[Math.cos(r+2*a)*o/1.1,2*l+.5*Math.sin(3*a+t),Math.sin(r+2*a)*o/1.1],children:[(0,n.jsx)("sphereGeometry",{args:[.095,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2.5,transparent:!0,opacity:.8*c})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#60FF38",intensity:2*c,distance:5,decay:2})]})});function q(){var e;let{onDamageNumbersUpdate:t,onDamageNumberComplete:m,onCameraUpdate:q,onGameStateUpdate:Q,onControlSystemUpdate:J}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{scene:K,camera:X,gl:$,size:ee}=(0,i.D)(),{players:et,towers:er,gameStarted:en,updatePlayerPosition:eo,updatePlayerWeapon:ei,updatePlayerHealth:ea,broadcastPlayerAttack:es,broadcastPlayerAbility:el,broadcastPlayerAnimationState:ec,broadcastPlayerDamage:ed,broadcastPlayerEffect:eu,broadcastPlayerDebuff:eh,damageTower:eg,socket:ep}=(0,l.p)(),em=(0,o.useRef)(null),ef=(0,o.useRef)(null),ey=(0,o.useRef)(null),ex=(0,o.useRef)(null),ev=(0,o.useRef)(null),eM=(0,o.useRef)(!1),ej=(0,o.useRef)(0),[ew,eS]=(0,o.useState)(new a.Vector3(0,.5,0)),[eC,eb]=(0,o.useState)(null),eD=(0,o.useRef)({position:new a.Vector3(0,.5,0),quaternion:{x:0,y:0,z:0,w:1}}),eP=(0,o.useRef)(new Map),eI=(0,o.useRef)(new Map),[eE,eF]=(0,o.useState)([]),eR=(0,o.useRef)(0),[eA,eB]=(0,o.useState)([]),eT=(0,o.useRef)(0),[ek,eV]=(0,o.useState)([]),ez=(0,o.useRef)(0),[eG,eN]=(0,o.useState)([]),eW=(0,o.useRef)(0),eL=(0,o.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,o=e===(null==ep?void 0:ep.id);console.log("\uD83C\uDFAF Creating PVP ".concat(t," effect for player ").concat(e," (isLocal: ").concat(o,") at position:"),r.toArray()),console.log('\uD83D\uDD0D Debug: playerId="'.concat(e,'", socket?.id="').concat(null==ep?void 0:ep.id,'", comparison result: ').concat(e===(null==ep?void 0:ep.id)));let i={id:ez.current++,playerId:e,debuffType:t,position:r.clone(),startTime:Date.now(),duration:n};if(eV(e=>[...e,i]),o&&eC){let e=eC.getComponent(h.i);e&&("frozen"===t?(e.freeze(n),console.log("\uD83E\uDDCA Applied freeze to local player for ".concat(n,"ms - movement speed set to 0"))):"slowed"===t&&(e.slow(n,.5),console.log("\uD83D\uDC0C Applied slow to local player for ".concat(n,"ms - movement speed reduced to 50%"))))}setTimeout(()=>{eV(e=>e.filter(e=>e.id!==i.id)),console.log("\uD83C\uDFAF PVP ".concat(t," effect expired for player ").concat(e))},i.duration)},[null==ep?void 0:ep.id,eC]),eO=(0,o.useCallback)((e,t)=>{let r=e===(null==ep?void 0:ep.id);console.log("❄️ Creating PVP frozen effect for player ".concat(e," (isLocal: ").concat(r,") at position:"),t.toArray()),eL(e,"frozen",t,5e3),eh&&(eh(e,"frozen",5e3,{position:{x:t.x,y:t.y,z:t.z}}),console.log("❄️ Broadcasting frozen effect for player ".concat(e)))},[eL,eh]),eH=(0,o.useCallback)((e,t)=>{console.log("\uD83C\uDF3F Creating PVP reanimate effect for player ".concat(e," at position:"),t.toArray());let r={id:eR.current++,playerId:e,position:t.clone(),startTime:Date.now(),duration:1500};eF(e=>[...e,r]),setTimeout(()=>{eF(e=>e.filter(e=>e.id!==r.id)),console.log("\uD83C\uDF3F PVP reanimate effect expired for player ".concat(e))},r.duration)},[]),e_=(0,o.useCallback)((e,t)=>{console.log("❄️ Creating PVP frost nova effect for player ".concat(e," at position:"),t.toArray());let r={id:eW.current++,playerId:e,position:t.clone(),startTime:Date.now(),duration:1200};eN(e=>[...e,r]),setTimeout(()=>{eN(e=>e.filter(e=>e.id!==r.id)),console.log("❄️ PVP frost nova effect expired for player ".concat(e))},r.duration)},[]),eU=(0,o.useCallback)((e,t)=>{let r=e===(null==ep?void 0:ep.id);if(console.log("☠️ Creating PVP venom effect for player ".concat(e," (isLocal: ").concat(r,") at position:"),t.toArray()),r){console.warn("⚠️ Attempted to create venom effect on local player ".concat(e," - this should not happen!"));return}let n={id:eT.current++,playerId:e,position:t.clone(),startTime:Date.now(),duration:6e3};eB(e=>[...e,n]);let o=0,i=setInterval(()=>{if(++o>6){clearInterval(i);return}console.log("☠️ Venom tick ".concat(o,"/").concat(6," - dealing ").concat(17," damage to player ").concat(e," (isLocal: ").concat(r,")")),ed&&ed(e,17)},1e3);setTimeout(()=>{eB(e=>e.filter(e=>e.id!==n.id)),console.log("☠️ PVP venom effect expired for player ".concat(e))},n.duration)},[null==ep?void 0:ep.id,ed]),[eZ,eY]=(0,o.useState)({currentWeapon:P.v.BOW,currentSubclass:P.p.ELEMENTAL,isCharging:!1,chargeProgress:0,isSwinging:!1,isSpinning:!1,swordComboStep:1,isDivineStorming:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1}),eq=(0,o.useRef)({weapon:P.v.BOW,subclass:P.p.ELEMENTAL}),[eQ,eJ]=(0,o.useState)(new Map),{createPowershotEffect:eK}=(0,H.sf)();return((0,o.useEffect)(()=>{if(!ep)return;let e=e=>{if(console.log("⚔️ Received PVP player attack:",e),e.playerId!==ep.id&&em.current){var t;if("bow_release"===e.attackType&&(null===(t=e.animationData)||void 0===t?void 0:t.isPerfectShot)){console.log("\uD83C\uDF1F Creating perfect shot beam effect for PVP player!");let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=et.get(e.playerId);eK(t,r,(null==n?void 0:n.subclass)||P.p.ELEMENTAL,!0,!0)}if("viper_sting_projectile"===e.attackType){console.log("\uD83D\uDC0D Creating PVP Viper Sting visual effect from player",e.playerId);let t=new a.Vector3(e.position.x,e.position.y,e.position.z),n=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),o=em.current.getWorld().getSystem(w.c);if(o){let r=eP.current.get(e.playerId)||-Math.abs(1e3*e.playerId.length+Date.now()%1e3);o.createProjectile(em.current.getWorld(),t,n,r,{speed:16,damage:61,lifetime:5,piercing:!0,opacity:.8})}let{triggerGlobalViperSting:i}=r(319),s=eD.current.position.clone(),l={...eD.current.quaternion};eD.current.position.copy(t);let c=Math.atan2(n.x,n.z);eD.current.quaternion={x:0,y:Math.sin(c/2),z:0,w:Math.cos(c/2)},i(),setTimeout(()=>{eD.current.position.copy(s),eD.current.quaternion=l},100);return}if("cobra_shot_projectile"===e.attackType){console.log("\uD83D\uDC0D Creating PVP Cobra Shot visual effect from player",e.playerId);let{triggerGlobalCobraShot:t}=r(7019);t(new a.Vector3(e.position.x,e.position.y,e.position.z),new a.Vector3(e.direction.x,e.direction.y,e.direction.z));return}if("sword_charge_hit"===e.attackType){if(console.log("⚔️ Received PVP sword charge hit from player",e.playerId,"animationData:",e.animationData),!e.animationData||"number"!=typeof e.animationData.damage||"number"!=typeof e.animationData.targetId){console.warn("⚠️ Invalid sword charge hit animationData:",e.animationData);return}eP.current.get((null==ep?void 0:ep.id)||"")===e.animationData.targetId&&eC&&ed&&(null==ep?void 0:ep.id)&&eC.getComponent(g.S)&&(ed(ep.id,e.animationData.damage),console.log("⚔️ Took ".concat(e.animationData.damage," charge damage from ").concat(e.playerId)));return}if(["regular_arrow","charged_arrow","entropic_bolt","crossentropy_bolt","perfect_shot","barrage_projectile"].includes(e.attackType)){console.log("\uD83C\uDFF9 Creating PVP projectile:",e.attackType,"from player",e.playerId);let t=em.current.getWorld().getSystem(w.c);if(t){let r=new a.Vector3(e.position.x,e.position.y,e.position.z),n=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),o=eP.current.get(e.playerId)||-Math.abs(1e3*e.playerId.length+Date.now()%1e3);switch(e.attackType){case"regular_arrow":t.createProjectile(em.current.getWorld(),r,n,o,{speed:25,damage:10,lifetime:3,maxDistance:25,opacity:.8});break;case"charged_arrow":t.createChargedArrowProjectile(em.current.getWorld(),r,n,o,{speed:35,damage:50,lifetime:3,piercing:!0,opacity:.8});break;case"entropic_bolt":t.createEntropicBoltProjectile(em.current.getWorld(),r,n,o,{speed:20,damage:20,lifetime:1.75,piercing:!1,opacity:.8});break;case"crossentropy_bolt":t.createCrossentropyBoltProjectile(em.current.getWorld(),r,n,o,{speed:15,damage:90,lifetime:2.5,piercing:!1,opacity:.8});break;case"perfect_shot":t.createChargedArrowProjectile(em.current.getWorld(),r,n,o,{speed:40,damage:75,lifetime:3,piercing:!0,opacity:1});break;case"barrage_projectile":let i=t.createProjectile(em.current.getWorld(),r,n,o,{speed:22,damage:30,lifetime:3,maxDistance:25,piercing:!1,opacity:.8}).getComponent(f.T);(null==i?void 0:i.mesh)&&(i.mesh.userData.isBarrageArrow=!0,i.mesh.userData.isRegularArrow=!1)}}}eJ(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0},o=e.animationData||{},i=Date.now();r.set(e.playerId,{...n,isSwinging:e.attackType.includes("swing")||e.attackType.includes("sword")&&!e.attackType.includes("charge"),isCharging:e.attackType.includes("bow")&&e.attackType.includes("charge"),isSpinning:e.attackType.includes("scythe")||e.attackType.includes("entropic_bolt")||e.attackType.includes("crossentropy_bolt")||e.attackType.includes("sword_charge_spin")||o.isSpinning||!1,isSwordCharging:"sword_charge_spin"===e.attackType||"sword_charge_start"===e.attackType||o.isSpinning||o.isSwordCharging||!1,swordComboStep:o.comboStep||n.swordComboStep,chargeProgress:o.chargeProgress||0,isSkyfalling:n.isSkyfalling||!1,isBackstabbing:n.isBackstabbing||!1,lastAttackType:e.attackType,lastAttackTime:i,lastAnimationUpdate:i});let a=et.get(e.playerId),s=(null==a?void 0:a.weapon)||P.v.BOW,l=null==a?void 0:a.subclass,c=100;if("sword_charge_spin"===e.attackType)c=50;else if("sword_charge_start"===e.attackType)c=450;else switch(s){case P.v.SCYTHE:c=l===P.p.ABYSSAL?350:167.5;break;case P.v.SWORD:c=80;break;case P.v.SABRES:c=275;break;case P.v.SPEAR:c=l===P.p.STORM?275:200;break;case P.v.BOW:c=300;break;default:c=100}return setTimeout(()=>{eJ(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&n.lastAnimationUpdate===i&&r.set(e.playerId,{...n,isSwinging:!1,isCharging:!1,isSpinning:!1,isSwordCharging:!1}),r})},c),r})}},t=e=>{if(console.log("✨ Received PVP player ability:",e),console.log("\uD83D\uDD0D DEBUG: Ability type:",e.abilityType,"from player:",e.playerId,"my ID:",ep.id),e.playerId!==ep.id){if("divine_storm"===e.abilityType){console.log("⚡ Handling Divine Storm ability from player",e.playerId);let t=new a.Vector3(e.position.x,e.position.y,e.position.z);(0,z.e6)(t,e.playerId),eJ(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isDivineStorming:!0,isSpinning:!0,isSwordCharging:!1}),setTimeout(()=>{eJ(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isDivineStorming:!1,isSpinning:!1}),r})},4e3),r})}else if("viper_sting"===e.abilityType){console.log("\uD83D\uDC0D Handling Viper Sting ability from player",e.playerId);let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=eD.current.position.clone(),o={...eD.current.quaternion};eD.current.position.copy(t);let i=Math.atan2(r.x,r.z);eD.current.quaternion={x:0,y:Math.sin(i/2),z:0,w:Math.cos(i/2)},console.log("\uD83D\uDC0D Viper Sting visual trigger result:",(0,B.triggerGlobalViperSting)()),setTimeout(()=>{eD.current.position.copy(n),eD.current.quaternion=o},100),eJ(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isViperStingCharging:!0,viperStingChargeProgress:1}),setTimeout(()=>{eJ(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isViperStingCharging:!1,viperStingChargeProgress:0}),r})},2e3),r})}else if("barrage"===e.abilityType)console.log("\uD83C\uDFF9 Handling Barrage ability from player",e.playerId),new a.Vector3(e.position.x,e.position.y,e.position.z),new a.Vector3(e.direction.x,e.direction.y,e.direction.z),eJ(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isBarrageCharging:!0,barrageChargeProgress:1}),setTimeout(()=>{eJ(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isBarrageCharging:!1,barrageChargeProgress:0}),r})},1500),r});else if("frost_nova"===e.abilityType){console.log("❄️ Handling Frost Nova ability from player",e.playerId),console.log("\uD83D\uDD0D DEBUG: Creating Frost Nova effect at position:",e.position);let t=new a.Vector3(e.position.x,e.position.y,e.position.z);e_(e.playerId,t)}else if("reanimate"===e.abilityType){console.log("\uD83C\uDF3F Handling Reanimate ability from player",e.playerId),console.log("\uD83D\uDD0D DEBUG: Creating Reanimate effect at position:",e.position);let t=new a.Vector3(e.position.x,e.position.y,e.position.z);eH(e.playerId,t)}else if("charge"===e.abilityType)console.log("⚔️ Handling Charge ability from player",e.playerId),eJ(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isSwordCharging:!0}),setTimeout(()=>{eJ(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isSwordCharging:!1}),r})},2e3),r});else if("deflect"===e.abilityType){console.log("\uD83D\uDEE1️ Handling Deflect ability from player",e.playerId);let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z),n=new a.Vector3(0,Math.atan2(r.x,r.z),0);(0,G.Z0)(t,n,e.playerId),eJ(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isDeflecting:!0}),setTimeout(()=>{eJ(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isDeflecting:!1}),r})},3e3),r})}else if("skyfall"===e.abilityType)console.log("\uD83C\uDF1F Handling Skyfall ability from player",e.playerId),eJ(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isSkyfalling:!0}),setTimeout(()=>{eJ(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isSkyfalling:!1}),r})},1750),r});else if("backstab"===e.abilityType){console.log("\uD83D\uDDE1️ Handling Backstab ability from player",e.playerId);let t=new a.Vector3(e.position.x,e.position.y,e.position.z),r=new a.Vector3(e.direction.x,e.direction.y,e.direction.z);if(eJ(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isDeflecting:!1,isSwordCharging:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isBackstabbing:!0}),setTimeout(()=>{eJ(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isBackstabbing:!1}),r})},1e3),r}),et.get(e.playerId)){let n=et.get((null==ep?void 0:ep.id)||"");if(n&&(null==ep?void 0:ep.id)!==e.playerId){let o=new a.Vector3(n.position.x,n.position.y,n.position.z);if(2.5>=t.distanceTo(o)){let i=new a.Vector3().subVectors(o,t).normalize();if(r.dot(i)>=Math.cos(Math.PI/3)){let r=75,i=new a.Vector3(Math.sin(n.rotation.y),0,Math.cos(n.rotation.y)).normalize(),s=new a.Vector3().subVectors(t,o).normalize();-.3>i.dot(s)?(r=150,console.log("\uD83D\uDDE1️ BACKSTAB! Player ".concat(e.playerId," attacked local player from behind for ").concat(r," damage"))):console.log("\uD83D\uDDE1️ Front attack from player ".concat(e.playerId," for ").concat(r," damage")),ed&&(null==ep?void 0:ep.id)&&ed(ep.id,r,"backstab")}}}}eJ(t=>{let r=new Map(t),n=r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.set(e.playerId,{...n,isSwinging:!0}),setTimeout(()=>{eJ(t=>{let r=new Map(t),n=r.get(e.playerId);return n&&r.set(e.playerId,{...n,isSwinging:!1}),r})},300),r})}}},n=e=>{if(console.log("\uD83D\uDCA5 Received PVP player damage:",e),e.targetPlayerId===ep.id&&eC){let t=eC.getComponent(g.S),r=eC.getComponent(p.W);t&&(t.takeDamage(e.damage,Date.now()/1e3,eC),console.log("\uD83E\uDE78 Took ".concat(e.damage," damage from ").concat(e.sourcePlayerId,". Health: ").concat(t.currentHealth,"/").concat(t.maxHealth,", Shield: ").concat(r?r.currentShield:0,"/").concat(r?r.maxShield:0)))}},o=e=>{var t;console.log("\uD83C\uDFAD Received PVP player animation state:",e),(null===(t=e.animationState)||void 0===t?void 0:t.isBackstabbing)&&console.log("\uD83D\uDDE1️ DEBUG: Received backstab animation state from player",e.playerId,"isBackstabbing:",e.animationState.isBackstabbing),e.playerId!==ep.id&&eJ(t=>{let r=new Map(t),n={...r.get(e.playerId)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:3,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isBackstabbing:!1},...e.animationState,lastAnimationUpdate:Date.now()};return n.isBackstabbing&&console.log("\uD83D\uDDE1️ DEBUG: Setting backstab animation state for player",e.playerId,"to:",n.isBackstabbing),r.set(e.playerId,n),r})},i=e=>{var t;if(console.log("✨ Received PVP player effect:",e),(null===(t=e.effect)||void 0===t?void 0:t.type)==="venom"){let{targetPlayerId:t,position:r,duration:n}=e.effect;if(t&&r){let e=new a.Vector3(r.x,r.y,r.z);console.log("☠️ Creating venom effect for player ".concat(t," from broadcast")),eU(t,e)}}},s=e=>{console.log("\uD83C\uDFAF Received PVP player debuff:",e),console.log('\uD83D\uDD0D Debug: My socket ID is "'.concat(null==ep?void 0:ep.id,'", target is "').concat(e.targetPlayerId,'"'));let{targetPlayerId:t,debuffType:r,duration:n,effectData:o}=e;if(t&&r&&n){let e=(null==o?void 0:o.position)?new a.Vector3(o.position.x,o.position.y,o.position.z):new a.Vector3(0,0,0);console.log("\uD83C\uDFAF Creating ".concat(r," effect for player ").concat(t," from broadcast")),eL(t,r,e,n)}};return ep.on("player-attacked",e),ep.on("player-used-ability",t),ep.on("player-damaged",n),ep.on("player-animation-state",o),ep.on("player-effect",i),ep.on("player-debuff",s),()=>{ep.off("player-attacked",e),ep.off("player-used-ability",t),ep.off("player-damaged",n),ep.off("player-animation-state",o),ep.off("player-effect",i),ep.off("player-debuff",s)}},[ep,eC]),(0,o.useEffect)(()=>{let e=setInterval(()=>{eJ(e=>{let t=new Map(e),r=Date.now(),n=!1;return t.forEach((e,o)=>{e.lastAnimationUpdate&&r-e.lastAnimationUpdate>3e3&&(e.isSwinging||e.isCharging||e.isSpinning)&&(console.log("\uD83D\uDD27 Force resetting stuck animation for player ".concat(o)),t.set(o,{...e,isSwinging:!1,isCharging:!1,isSpinning:!1}),n=!0)}),n?t:e})},1e3);return()=>clearInterval(e)},[]),(0,o.useEffect)(()=>{if(!em.current||!en)return;let e=em.current.getWorld();et.forEach((t,r)=>{if(r!==(null==ep?void 0:ep.id)){if(eP.current.has(r)){let n=eP.current.get(r),o=e.getEntity(n);if(o){let e=o.getComponent(u.w);e&&(e.position.clone(),e.setPosition(t.position.x,t.position.y,t.position.z));let r=o.getComponent(h.i);r&&(r.velocity.set(0,0,0),r.acceleration.set(0,0,0));let n=o.getComponent(g.S);n&&(n.maxHealth=t.maxHealth,n.currentHealth=t.health)}else console.warn("⚠️ Could not find local ECS entity ".concat(n," for PVP player ").concat(r))}else{let n=e.createEntity(),o=e.createComponent(u.w);o.setPosition(t.position.x,t.position.y,t.position.z),n.addComponent(o);let i=new g.S(t.maxHealth);i.currentHealth=t.health,n.addComponent(i);let a=new p.W(100,20,5);n.addComponent(a);let s=e.createComponent(h.i);s.maxSpeed=3.75,s.jumpForce=8,s.friction=.85,s.canMove=!1,n.addComponent(s);let l=e.createComponent(y.YM);l.type=y.F5.SPHERE,l.radius=.9,l.layer=y.aB.ENEMY,l.setMask(y.aB.ENVIRONMENT),l.setOffset(0,.25,0),n.addComponent(l),e.notifyEntityAdded(n),eP.current.set(r,n.id),console.log("\uD83D\uDD17 Created local ECS entity ".concat(n.id," for PVP player ").concat(r," (").concat(t.name,") at position [").concat(t.position.x.toFixed(2),", ").concat(t.position.y.toFixed(2),", ").concat(t.position.z.toFixed(2),"]")),console.log("\uD83D\uDEAB Remote player ".concat(r," collision mask: ").concat(l.mask," (ENVIRONMENT only - no player-to-player collision)"))}}});let t=new Set(et.keys()),r=[];eP.current.forEach((n,o)=>{if(!t.has(o)||o===(null==ep?void 0:ep.id)){let t=e.getEntity(n);if(t){let e=t.getComponent(g.S);e&&(e.currentHealth=0,e.isDead=!0),console.log("\uD83D\uDC80 Marked local ECS entity ".concat(n," as dead for disconnected player ").concat(o))}r.push(o)}}),r.forEach(e=>{eP.current.delete(e)}),er.forEach((t,r)=>{if(eI.current.has(r)){let n=eI.current.get(r),o=e.getEntity(n);if(o){let e=o.getComponent(g.S);e&&(e.maxHealth=t.maxHealth,e.currentHealth=t.health,t.isDead&&!e.isDead&&(e.currentHealth=0,e.isDead=!0));let r=o.getComponent(x.N);r&&t.isDead&&!r.isDead&&r.die(Date.now()/1e3)}else console.warn("⚠️ Could not find local ECS entity ".concat(n," for tower ").concat(r))}else{let n=e.createEntity(),o=e.createComponent(u.w);o.setPosition(t.position.x,t.position.y,t.position.z),n.addComponent(o);let i=e.createComponent(x.N);i.ownerId=t.ownerId,i.towerIndex=t.towerIndex,n.addComponent(i);let a=new g.S(t.maxHealth);a.currentHealth=t.health,n.addComponent(a);let s=e.createComponent(y.YM);s.type=y.F5.CYLINDER,s.radius=1.5,s.height=4,s.layer=y.aB.ENEMY,s.setMask(y.aB.ENVIRONMENT|y.aB.PLAYER),s.setOffset(0,2,0),n.addComponent(s),e.notifyEntityAdded(n),eI.current.set(r,n.id),console.log("\uD83C\uDFF0 Created local ECS entity ".concat(n.id," for tower ").concat(r," (Owner: ").concat(t.ownerId,") at position [").concat(t.position.x.toFixed(2),", ").concat(t.position.y.toFixed(2),", ").concat(t.position.z.toFixed(2),"]"))}});let n=new Set(er.keys()),o=[];eI.current.forEach((t,r)=>{if(!n.has(r)){let n=e.getEntity(t);if(n){let e=n.getComponent(g.S),o=n.getComponent(x.N);e&&o&&(e.currentHealth=0,e.isDead=!0,o.die(Date.now()/1e3)),console.log("\uD83D\uDC80 Marked local ECS entity ".concat(t," as dead for removed tower ").concat(r))}o.push(r)}}),o.forEach(e=>{eI.current.delete(e)})},[et,er,en,null==ep?void 0:ep.id]),(0,o.useEffect)(()=>{ex.current&&(null==ep?void 0:ep.id)&&ex.current.setPlayerMapping(eP.current,ep.id)},[et,null==ep?void 0:ep.id]),(0,o.useEffect)(()=>{if(eM.current||!en)return;eM.current=!0,(0,L.j4)(0),(0,L.Ge)(0);let e=new c.D({enableDebug:!0});em.current=e;let t=$.domElement;return e.initialize(t).then(()=>{let{player:t,controlSystem:r,towerSystem:n}=function(e,t,r,n,o,i){let s=e.getWorld(),l=e.getInputManager();n.shadowMap.enabled=!0,n.shadowMap.type=a.PCFSoftShadowMap;let c=new S.F,d=new C.s(5),m=new b.b(s),f=new v.K(t,r,n),x=new w.c(s),P=new D.R(s),I=new M.s(r,l,s,x),E=new j.D(r,l,{distance:8,height:2,mouseSensitivity:.005,smoothing:.15});x.setCombatSystem(m),P.setProjectileSystem(x),m.setPlayerDamageCallback(o),s.addSystem(c),s.addSystem(d),s.addSystem(m),s.addSystem(f),s.addSystem(x),s.addSystem(P),s.addSystem(I),s.addSystem(E);let F=function(e){let t=e.createEntity(),r=e.createComponent(u.w);r.setPosition(0,.5,0),t.addComponent(r);let n=e.createComponent(h.i);n.maxSpeed=3.75,n.jumpForce=8,n.friction=.85,t.addComponent(n);let o=new g.S(500);o.enableRegeneration(2,10),t.addComponent(o);let i=new p.W(200,20,5);t.addComponent(i);let a=e.createComponent(y.YM);a.type=y.F5.SPHERE,a.radius=.9,a.layer=y.aB.PLAYER,a.setMask(y.aB.ENVIRONMENT),a.setOffset(0,.5,0),t.addComponent(a),console.log("\uD83D\uDC64 PVP player entity created with components:",{transform:!!t.getComponent(u.w),movement:!!t.getComponent(h.i),health:!!t.getComponent(g.S),shield:!!t.getComponent(p.W),collider:!!t.getComponent(y.YM)});let s=t.getComponent(y.YM);return console.log("\uD83D\uDEAB Local player collision mask: ".concat(null==s?void 0:s.mask," (ENVIRONMENT only - no player-to-player collision)")),t}(s);return I.setPlayer(F),E.setTarget(F),E.snapToTarget(),console.log("\uD83C\uDF0D Total entities in PVP world:",s.getAllEntities().length),console.log("✅ PVP game setup complete!"),console.log("\uD83D\uDC64 Player entity created with ID: ".concat(F.id)),console.log("⚔️ PVP players will be synchronized from server"),{player:F,controlSystem:I,towerSystem:P}}(e,K,X,$,(e,t)=>{let r=parseInt(e),n=null;eP.current.forEach((e,t)=>{e===r&&(n=t)}),n?(console.log("\uD83C\uDFAF Mapping local entity ".concat(e," to server player ").concat(n," for ").concat(t," PVP damage")),ed(n,t)):console.warn("⚠️ Could not find server player ID for local entity ".concat(e))},0);console.log("\uD83C\uDFAE PVP Player entity created:",t,"ID:",t.id),eb(t),ef.current=t.id,ey.current=r,ex.current=n,n&&(null==ep?void 0:ep.id)&&n.setPlayerMapping(eP.current,ep.id),J&&J(r),r.setBowReleaseCallback((t,n)=>{if(console.log("\uD83C\uDFF9 PVP Bow released with charge:",t,n?"✨ PERFECT SHOT!":""),eC){let e=eC.getComponent(u.w);if(e){let r=new a.Vector3;X.getWorldDirection(r),r.normalize(),es("bow_release",e.position,r,{chargeProgress:t,isPerfectShot:n})}}if(n){console.log("\uD83C\uDF1F Creating perfect shot visual effect!");let t=e.getWorld().getEntity(ef.current);if(t){let e=t.getComponent(u.w);if(e){let t=new a.Vector3;X.getWorldDirection(t),t.normalize();let n=new a.Vector3;n.crossVectors(t,new a.Vector3(0,1,0)).normalize();let o=new a.Matrix4;o.makeRotationAxis(n,Math.PI/12),t.applyMatrix4(o),t.normalize(),console.log("\uD83C\uDF1F Perfect shot effect created with ID:",eK(e.position.clone(),t,r.getCurrentSubclass(),!0,!0))}}}}),r.setDivineStormCallback((e,t,r)=>{console.log("⚡ PVP Divine Storm activated - broadcasting to other players"),(0,z.e6)(e,null==ep?void 0:ep.id,r),el("divine_storm",e,t)}),r.setViperStingCallback((e,t)=>{console.log("\uD83D\uDC0D PVP Viper Sting triggered - broadcasting to other players"),el("viper_sting",e,t)}),r.setBarrageCallback((e,t)=>{console.log("\uD83C\uDFF9 PVP Barrage triggered - broadcasting to other players"),el("barrage",e,t)}),console.log("\uD83D\uDD0D DEBUG: Setting up Frost Nova callback in PVP"),r.setFrostNovaCallback((e,t)=>{console.log("❄️ PVP Frost Nova triggered - broadcasting to other players"),el("frost_nova",e,t)}),r.setCobraShotCallback((e,t)=>{console.log("\uD83D\uDC0D PVP Cobra Shot triggered - local visual effects only")}),r.setChargeCallback((e,t)=>{console.log("⚔️ PVP Charge triggered - broadcasting to other players"),el("charge",e,t),es("sword_charge_start",e,t,{isSwordCharging:!0})}),r.setSkyfallCallback((e,t)=>{console.log("\uD83C\uDF1F PVP Skyfall triggered - broadcasting to other players"),el("skyfall",e,t)}),r.setBackstabCallback((e,t,r,n)=>{console.log("\uD83D\uDDE1️ PVP Backstab triggered - broadcasting to other players (damage: ".concat(r,", backstab: ").concat(n,")")),el("backstab",e,t)}),console.log("\uD83D\uDD27 Debug: Setting up debuff callback for ControlSystem"),r.setDebuffCallback((e,t,r,n)=>{console.log("\uD83C\uDFAF PVP Debuff callback triggered - ".concat(t," effect on entity ").concat(e)),console.log("\uD83D\uDD0D Debug: Looking for entity ".concat(e," in serverPlayerEntities:"),Array.from(eP.current.entries()));let o=null;eP.current.forEach((t,r)=>{console.log("\uD83D\uDD0D Debug: Checking entity ".concat(t," for player ").concat(r)),t===e&&(o=r,console.log("✅ Debug: Found match! Entity ".concat(e," belongs to player ").concat(r)))}),o&&eh?(console.log("\uD83C\uDFAF Broadcasting ".concat(t," effect to player ").concat(o)),eh(o,t,r,{position:{x:n.x,y:n.y,z:n.z}})):console.warn("⚠️ Could not find server player ID for local entity ".concat(e))}),r.setProjectileCreatedCallback((e,t,n,o)=>{console.log("\uD83C\uDFF9 PVP Projectile created - broadcasting to other players:",e);let i={};(e.includes("arrow")||e.includes("bolt"))&&(i.chargeProgress=r.getChargeProgress()),es(e,t,n,i)}),console.log("\uD83D\uDD0D DEBUG: Setting up Reanimate callback in PVP"),r.setReanimateCallback(()=>{if(console.log("\uD83C\uDF3F PVP Reanimate healing effect triggered - broadcasting to other players"),ev.current&&ev.current.triggerHealingEffect(),console.log("\uD83D\uDD0D DEBUG: Player entity available for Reanimate broadcast:",!!t),t){let e=t.getComponent(u.w);if(e){let t=new a.Vector3;X.getWorldDirection(t),t.normalize(),console.log("\uD83D\uDD0D DEBUG: Broadcasting Reanimate ability with position:",e.position),el("reanimate",e.position,t)}else console.log("\uD83D\uDD0D DEBUG: No transform component found on player entity")}else console.log("\uD83D\uDD0D DEBUG: No player entity available for Reanimate broadcast")}),e.start()}),()=>{em.current&&em.current.destroy()}},[K,X,$,en]),(0,o.useEffect)(()=>{window.pvpPlayers=et,window.localSocketId=null==ep?void 0:ep.id},[et,null==ep?void 0:ep.id]),(0,i.F)((e,r)=>{if(em.current&&em.current.isEngineRunning()&&en){if(eC){let e=eC.getComponent(u.w);if(e&&e.position){let t=e.position.clone();eS(t),eD.current.position.copy(t);let r=new a.Vector3;X.getWorldDirection(r);let n=Math.atan2(r.x,r.z);eD.current.quaternion={x:0,y:Math.sin(n/2),z:0,w:Math.cos(n/2)},eo(e.position,{x:0,y:n,z:0})}}if(ey.current){let e={currentWeapon:ey.current.getCurrentWeapon(),currentSubclass:ey.current.getCurrentSubclass(),isCharging:ey.current.isWeaponCharging(),chargeProgress:ey.current.getChargeProgress(),isSwinging:ey.current.isWeaponSwinging(),isSpinning:ey.current.isWeaponCharging()&&ey.current.getCurrentWeapon()===P.v.SCYTHE,swordComboStep:ey.current.getSwordComboStep(),isDivineStorming:ey.current.isDivineStormActive(),isSwordCharging:ey.current.isChargeActive(),isDeflecting:ey.current.isDeflectActive(),isViperStingCharging:ey.current.isViperStingChargingActive(),viperStingChargeProgress:ey.current.getViperStingChargeProgress(),isBarrageCharging:ey.current.isBarrageChargingActive(),barrageChargeProgress:ey.current.getBarrageChargeProgress(),isCobraShotCharging:ey.current.isCobraShotChargingActive(),cobraShotChargeProgress:ey.current.getCobraShotChargeProgress(),isSkyfalling:ey.current.isSkyfallActive(),isBackstabbing:ey.current.isBackstabActive()},t=eq.current;(e.currentWeapon!==t.weapon||e.currentSubclass!==t.subclass)&&(console.log("\uD83D\uDD04 PVP Weapon changed:",e.currentWeapon,e.currentSubclass),ei(e.currentWeapon,e.currentSubclass),eq.current={weapon:e.currentWeapon,subclass:e.currentSubclass}),eY(e);let r=Date.now();if(r-ej.current>100){let t=e.currentWeapon===P.v.SCYTHE&&e.isCharging,n=e.isDivineStorming||e.isSwordCharging,o={isCharging:e.isCharging,chargeProgress:e.chargeProgress,isSwinging:e.isSwinging,swordComboStep:e.swordComboStep,isDivineStorming:e.isDivineStorming,isSpinning:t||n,isDeflecting:e.isDeflecting,isSwordCharging:e.isSwordCharging,isViperStingCharging:e.isViperStingCharging,viperStingChargeProgress:e.viperStingChargeProgress,isBarrageCharging:e.isBarrageCharging,barrageChargeProgress:e.barrageChargeProgress,isBackstabbing:e.isBackstabbing};e.isBackstabbing&&(console.log("\uD83D\uDDE1️ DEBUG: Broadcasting backstab animation state:",e.isBackstabbing),console.log("\uD83D\uDDE1️ DEBUG: Full animation state being sent:",o),console.log("\uD83D\uDDE1️ DEBUG: Socket connected:",!!ep)),ec(o),ej.current=r}}let e=em.current.getWorld().getSystem(b.b);if(e&&t&&t(e.getDamageNumbers()),q&&q(X,ee),Q&&eC&&ey.current){let e=eC.getComponent(g.S),t=eC.getComponent(p.W);e&&(Q({playerHealth:e.currentHealth,maxHealth:e.maxHealth,playerShield:t?t.currentShield:0,maxShield:t?t.maxShield:0,currentWeapon:ey.current.getCurrentWeapon(),currentSubclass:ey.current.getCurrentSubclass()}),ea(e.currentHealth,e.maxHealth))}}}),o.useEffect(()=>{m&&(window.handleDamageNumberComplete=e=>{var t;let r=null===(t=em.current)||void 0===t?void 0:t.getWorld().getSystem(b.b);r&&r.removeDamageNumber(e)})},[m]),en)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O.Z,{level:1,world:null===(e=em.current)||void 0===e?void 0:e.getWorld()}),(0,n.jsx)("ambientLight",{intensity:.3}),(0,n.jsx)("directionalLight",{position:[10,10,5],intensity:.5,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),(0,n.jsxs)("mesh",{receiveShadow:!0,position:[0,-.5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[29,29,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#2d5a2d"})]}),(0,n.jsxs)("mesh",{position:[0,.01,0],scale:[2.5,2.5,2.5],children:[(0,n.jsx)("ringGeometry",{args:[25,29,64]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6b6b",transparent:!0,opacity:.3})]}),(0,n.jsxs)("mesh",{castShadow:!0,position:[0,1,-10],children:[(0,n.jsx)("boxGeometry",{args:[4,2,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#696969"})]}),eC&&em.current&&ep&&(0,n.jsx)(s.Z,{entityId:eC.id,position:ew,world:em.current.getWorld(),currentWeapon:eZ.currentWeapon,currentSubclass:eZ.currentSubclass,isCharging:eZ.isCharging,chargeProgress:eZ.chargeProgress,isSwinging:eZ.isSwinging,isSpinning:eZ.isSpinning,swordComboStep:eZ.swordComboStep,isDivineStorming:eZ.isDivineStorming,isSwordCharging:eZ.isSwordCharging,isDeflecting:eZ.isDeflecting,isViperStingCharging:eZ.isViperStingCharging,viperStingChargeProgress:eZ.viperStingChargeProgress,isBarrageCharging:eZ.isBarrageCharging,barrageChargeProgress:eZ.barrageChargeProgress,isCobraShotCharging:eZ.isCobraShotCharging,cobraShotChargeProgress:eZ.cobraShotChargeProgress,isSkyfalling:eZ.isSkyfalling,isBackstabbing:eZ.isBackstabbing,reanimateRef:ev,isLocalPlayer:!0,onBowRelease:()=>{},onScytheSwingComplete:()=>{console.log("⚔️ PVP Scythe swing completed");let e=new a.Vector3;X.getWorldDirection(e),e.normalize(),es("scythe_swing",ew,e,{isSpinning:!0})},onSwordSwingComplete:()=>{var e;console.log("\uD83D\uDDE1️ PVP Sword swing completed - notifying control system"),null===(e=ey.current)||void 0===e||e.onSwordSwingComplete();let t=new a.Vector3;X.getWorldDirection(t),t.normalize(),es("sword_swing",ew,t,{comboStep:eZ.swordComboStep})},onSabresSwingComplete:()=>{var e;console.log("⚔️ PVP Sabres swing completed - notifying control system"),null===(e=ey.current)||void 0===e||e.onSabresSwingComplete();let t=new a.Vector3;X.getWorldDirection(t),t.normalize(),es("sabres_swing",ew,t)},onChargeComplete:()=>{var e;console.log("⚔️ PVP Charge completed - notifying control system"),null===(e=ey.current)||void 0===e||e.onChargeComplete();let t=new a.Vector3;X.getWorldDirection(t),t.normalize(),es("sword_charge_spin",ew,t,{isSpinning:!0})},onDeflectComplete:()=>{var e;console.log("\uD83D\uDEE1️ PVP Deflect completed - notifying control system"),null===(e=ey.current)||void 0===e||e.onDeflectComplete()}}),Array.from(et.values()).map(e=>{var t;if(e.id===(null==ep?void 0:ep.id))return null;let r=eQ.get(e.id)||{isCharging:!1,chargeProgress:0,isSwinging:!1,swordComboStep:1,isDivineStorming:!1,isSpinning:!1,isSwordCharging:!1,isDeflecting:!1,isViperStingCharging:!1,viperStingChargeProgress:0,isBarrageCharging:!1,barrageChargeProgress:0,isCobraShotCharging:!1,cobraShotChargeProgress:0,isSkyfalling:!1,isBackstabbing:!1};return r.isBackstabbing&&console.log("\uD83D\uDDE1️ DEBUG: Rendering player",e.id,"with isBackstabbing:",r.isBackstabbing),(0,n.jsx)(s.Z,{entityId:parseInt(e.id.replace(/\D/g,"0")),position:new a.Vector3(e.position.x,e.position.y,e.position.z),world:(null===(t=em.current)||void 0===t?void 0:t.getWorld())||new d.q,currentWeapon:e.weapon,currentSubclass:e.subclass,isCharging:r.isCharging,chargeProgress:r.chargeProgress,isSwinging:r.isSwinging,isSpinning:r.isSpinning,swordComboStep:r.swordComboStep,isDivineStorming:r.isDivineStorming,isSwordCharging:r.isSwordCharging,isDeflecting:r.isDeflecting,isViperStingCharging:r.isViperStingCharging,viperStingChargeProgress:r.viperStingChargeProgress,isBarrageCharging:r.isBarrageCharging,barrageChargeProgress:r.barrageChargeProgress,isCobraShotCharging:r.isCobraShotCharging,cobraShotChargeProgress:r.cobraShotChargeProgress,isSkyfalling:r.isSkyfalling,isBackstabbing:r.isBackstabbing,rotation:e.rotation,isLocalPlayer:!1,onBowRelease:()=>{},onScytheSwingComplete:()=>{},onSwordSwingComplete:()=>{}},e.id)}),Array.from(er.values()).map(e=>{var t;return(0,n.jsx)(W,{entityId:parseInt(e.id.replace(/\D/g,"0")),world:(null===(t=em.current)||void 0===t?void 0:t.getWorld())||new d.q,position:new a.Vector3(e.position.x,e.position.y,e.position.z),ownerId:e.ownerId,towerIndex:e.towerIndex,health:e.health,maxHealth:e.maxHealth,isDead:e.isDead},e.id)}),Array.from(et.values()).map(e=>{if(e.id===(null==ep?void 0:ep.id))return null;let t=eP.current.get(e.id),r=0,o=200;if(t&&em.current){let e=em.current.getWorld().getEntity(t);if(e){let t=e.getComponent(p.W);t&&(r=t.currentShield,o=t.maxShield)}}return(0,n.jsx)(N,{playerId:e.id,playerName:e.name,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,maxHealth:e.maxHealth,shield:r,maxShield:o,camera:X,showDistance:35},"healthbar-".concat(e.id))}),em.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.Z,{world:em.current.getWorld()}),(0,n.jsx)(E.Z,{}),(0,n.jsx)(F.default,{world:em.current.getWorld()}),(0,n.jsx)(A.default,{world:em.current.getWorld()}),(0,n.jsx)(z.ZP,{enemyData:Array.from(et.values()).filter(e=>e.id!==(null==ep?void 0:ep.id)).map(e=>({id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health})),onHitTarget:(e,t)=>{console.log("⚡ Divine Storm hit player ".concat(e," for ").concat(t," damage")),ed&&ed(e,t)}}),(0,n.jsx)(G.ZP,{}),(0,n.jsx)(_,{world:em.current.getWorld(),players:Array.from(et.values()),serverPlayerEntities:eP,localSocketId:null==ep?void 0:ep.id,onPlayerHit:(e,t)=>{console.log("\uD83D\uDC0D Cobra Shot hit player ".concat(e," for ").concat(t," damage")),ed&&ed(e,t)},onPlayerVenomed:(e,t)=>{eU(e,t),eu&&(eu({type:"venom",targetPlayerId:e,position:{x:t.x,y:t.y,z:t.z},duration:6e3}),console.log("☠️ Broadcasting venom effect for player ".concat(e)))}}),(0,n.jsx)(U,{world:em.current.getWorld(),players:Array.from(et.values()),serverPlayerEntities:eP,localSocketId:null==ep?void 0:ep.id,onPlayerHit:(e,t)=>{console.log("\uD83C\uDFF9 Barrage hit player ".concat(e," for ").concat(t," damage")),ed&&ed(e,t)},onPlayerSlowed:(e,t)=>{eL(e,"slowed",t,5e3),eh&&(eh(e,"slowed",5e3,{position:{x:t.x,y:t.y,z:t.z},speedMultiplier:.5}),console.log("\uD83D\uDC0C Broadcasting slow effect for player ".concat(e)))}}),(0,n.jsx)(Z,{world:em.current.getWorld(),players:Array.from(et.values()),serverPlayerEntities:eP,localSocketId:null==ep?void 0:ep.id,onPlayerHit:(e,t)=>{console.log("❄️ FrostNova hit player ".concat(e," for ").concat(t," damage")),ed&&ed(e,t)},onPlayerFrozen:(e,t)=>{eO(e,t)}}),(0,n.jsx)(B.default,{parentRef:eD,enemyData:Array.from(et.values()).filter(e=>e.id!==(null==ep?void 0:ep.id)).map(e=>({id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,isDying:!1})),onHit:(e,t)=>{console.log("\uD83D\uDC0D Viper Sting hit player ".concat(e," for ").concat(t," damage")),ed&&ed(e,t)},setDamageNumbers:()=>{},nextDamageNumberId:{current:Date.now()},charges:[{id:1,available:!0,cooldownStartTime:null},{id:2,available:!0,cooldownStartTime:null},{id:3,available:!0,cooldownStartTime:null}],setCharges:()=>{}}),eE.map(e=>{let t=et.get(e.playerId),r=t?new a.Vector3(t.position.x,t.position.y,t.position.z):e.position;return(0,n.jsx)(Y,{position:r,onComplete:()=>{eF(t=>t.filter(t=>t.id!==e.id))}},e.id)}),eG.map(e=>{let t=et.get(e.playerId),r=t?new a.Vector3(t.position.x,t.position.y,t.position.z):e.position;return(0,n.jsx)(R.Z,{position:r,duration:e.duration,startTime:e.startTime,onComplete:()=>{eN(t=>t.filter(t=>t.id!==e.id))}},e.id)}),eA.map(e=>{let t=et.get(e.playerId),r=t?new a.Vector3(t.position.x,t.position.y+1,t.position.z):e.position;return(0,n.jsx)(T.Z,{position:r,duration:e.duration,startTime:e.startTime,enemyId:e.playerId,enemyData:Array.from(et.values()).filter(e=>e.id!==(null==ep?void 0:ep.id)).map(e=>({id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,isDying:!1})),onComplete:()=>{eB(t=>t.filter(t=>t.id!==e.id))}},e.id)}),ek.map(e=>{let t=et.get(e.playerId),r=t?new a.Vector3(t.position.x,t.position.y,t.position.z):e.position;return"frozen"===e.debuffType?(0,n.jsx)(V.Z,{position:r,duration:e.duration,startTime:e.startTime,enemyId:e.playerId,enemyData:Array.from(et.values()).map(e=>({id:e.id,position:new a.Vector3(e.position.x,e.position.y,e.position.z),health:e.health,isDying:!1})),onComplete:()=>{eV(t=>t.filter(t=>t.id!==e.id))}},e.id):(0,n.jsx)(k,{position:r,debuffType:e.debuffType,duration:e.duration,startTime:e.startTime,onComplete:()=>{eV(t=>t.filter(t=>t.id!==e.id))}},e.id)})]})]}):null}Y.displayName="PVPReanimateEffect"},1159:function(e,t,r){var n=r(7437),o=r(2265);let i=o.memo(()=>{let e=(0,o.useRef)(null),t=(0,o.useMemo)(()=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,n.jsxs)("group",{position:[0,e,0],scale:t,children:[(0,n.jsxs)("group",{rotation:[0,0,-Math.PI/3],children:[(0,n.jsxs)("mesh",{position:[.085,.05,.08],rotation:[.3,Math.PI/2,-.5],children:[(0,n.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,0,-.1],children:[(0,n.jsx)("sphereGeometry",{args:[.0375,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("group",{rotation:[0,0,Math.PI/3],children:[(0,n.jsxs)("mesh",{position:[-.085,.05,.08],rotation:[.3,-Math.PI/2,0],children:[(0,n.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.3,-.15,0],children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.05,.075,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]})},[]),r=(0,o.useMemo)(()=>()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.9,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.3,-.15,0,.15,.3].map((e,t)=>(0,n.jsxs)("group",{position:[0,e,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.06,.04,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,0,-.125],children:[(0,n.jsx)("boxGeometry",{args:[.0175,.06,.075]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]},t))]}),[]);return(0,n.jsx)("group",{ref:e,position:[0,.04,-0],rotation:[.25,Math.PI+Math.PI,0],children:(0,n.jsxs)("group",{children:[r(),(0,n.jsxs)("group",{position:[0,0,0],children:[t(.45,.7),t(.3,.8),t(.15,.9),t(0,1),t(-.15,.9),t(-.3,.8),t(-.45,.7)]})]})})});i.displayName="BonePlate",t.Z=i},4842:function(e,t,r){var n=r(7437),o=r(2265),i=r(1448),a=r(1276);t.Z=e=>{let{movementDirection:t=new i.Vector3}=e,r=(0,o.useRef)(null),[s,l]=(0,o.useState)({x:0,y:0});(0,a.F)(e=>{let{clock:n}=e;if(!r.current)return;let o=n.getElapsedTime(),i=1.2*t.length(),a=-(.45*t.z)*i,s=-(.125*t.x)*i,c=Math.min(1.5*i,1),d=.035*Math.sin(.7*o)*(1-c)+a*c,u=.175*Math.sin(.5*o)*(1-c)+s*c;l({x:d,y:u}),r.current.rotation.x=.1+d,r.current.rotation.y=u});let c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,r=1.8*Math.pow(t/20,5),o=Math.max(0,1-t/15),i=s.x*o,a=s.y*Math.pow(o,1.2);return(0,n.jsxs)("group",{position:[0,-r+.325,-(.2*t)*(1-t/40-.1)],scale:e,rotation:[-(Math.atan2(.8*Math.pow((t+1)/15,2.2)-r,.4*(1-t/20))+(0===t?Math.PI:0)+i*(1-t/15))+.85*i,a*(1-t/2),0],children:[(0,n.jsxs)("mesh",{rotation:[-(Math.PI/4),0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.055,.125,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("group",{rotation:[Math.PI/2,0,Math.PI/2],children:[(0,n.jsxs)("mesh",{position:[0,.08,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.08,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.015,.25,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,-(Math.PI/2)],children:[(0,n.jsx)("coneGeometry",{args:[.015,.2,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]}),(0,n.jsxs)("group",{rotation:[Math.PI/24,0,-Math.PI/2],children:[(0,n.jsxs)("mesh",{position:[0,.08,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.05,0,0],rotation:[0,0,2*Math.PI],children:[(0,n.jsx)("coneGeometry",{args:[.0125,.04,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.015,.04,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]}),(0,n.jsxs)("mesh",{position:[0,.025,.06],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("sphereGeometry",{args:[.025,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]})};return(0,n.jsx)("group",{ref:r,position:[0,-.7,-.25],rotation:[-.1,0,0],children:[...Array(15)].map((e,t)=>(0,n.jsx)(o.Fragment,{children:c(1-.04*t,t)},t))})}},7988:function(e,t,r){r.d(t,{Z:function(){return B}});var n=r(7437),o=r(2265),i=r(1448),a=r(1276),s=r(1159),l=r(4842);let c=o.memo(e=>{let{isLeftWing:t,isDashing:r}=e,s=(0,o.useRef)(null),[l,c]=(0,o.useState)(!1),[d,u]=(0,o.useState)(0),h=(0,o.useRef)([]),g=(0,o.useMemo)(()=>[{pos:new i.Vector3(t?-.3:.3,.275,0),rot:new i.Euler(0,0,t?-Math.PI/5:Math.PI/5),scale:1.2},{pos:new i.Vector3(t?-.5:.5,.45,0),rot:new i.Euler(0,0,t?-Math.PI/3.5:Math.PI/3.5),scale:1.4},{pos:new i.Vector3(t?-.65:.65,.6,0),rot:new i.Euler(0,0,t?-Math.PI/2.5:Math.PI/2.5),scale:1},{pos:new i.Vector3(t?-.85:.85,.72,.1),rot:new i.Euler(.1,0,t?-Math.PI/2.2:Math.PI/2.2),scale:1},{pos:new i.Vector3(t?-1.05:1.05,.8,.2),rot:new i.Euler(.2,0,t?-Math.PI/2:Math.PI/2),scale:.9},{pos:new i.Vector3(t?-1.2:1.2,.9,.2),rot:new i.Euler(.2,0,t?-Math.PI/1.8:Math.PI/1.8),scale:.8},{pos:new i.Vector3(t?-1.3:1.3,.75,.2),rot:new i.Euler(.05,0,t?-(-Math.PI/.475):-(Math.PI/.475)),scale:1},{pos:new i.Vector3(t?.05:-.05,-.5,-0),rot:new i.Euler(.05,0,t?-(-Math.PI/.475):-(Math.PI/.475)),scale:.8}],[t]),p=(0,o.useMemo)(()=>[-1,-1,-1,-1,-1,-1,-1,6],[]),m=(0,o.useMemo)(()=>g.map(e=>e.rot.clone()),[g]);(0,o.useEffect)(()=>{r&&!l&&(c(!0),u(Date.now()/1e3))},[r,l]),(0,a.F)(()=>{if(l&&h.current.length>0){let e=Math.min((Date.now()/1e3-d)/.45,1);if(e>=1)c(!1),h.current.forEach((e,t)=>{e&&m[t]&&e.rotation.copy(m[t])});else{let r=.3*Math.sin(e*Math.PI*2),n=.5*Math.sin(e*Math.PI);h.current.forEach((e,o)=>{if(e&&m[o]){let i=m[o],a=r*(1-.1*o);e.rotation.x=i.x,e.rotation.y=i.y,e.rotation.z=i.z+(t?-a-n:a+n)}})}}});let f=(0,o.useMemo)(()=>()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.023,.0175,.32,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:new i.Vector3(0,.2,0),children:[(0,n.jsx)("sphereGeometry",{args:[.035,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.4,metalness:.3})]})]}),[]),y=e=>{if(e>=g.length)return null;let t=g[e],r=p.map((t,r)=>t===e?r:-1).filter(e=>-1!==e);return(0,n.jsxs)("group",{ref:t=>{h.current[e]=t},position:t.pos,rotation:t.rot,scale:t.scale,children:[f(),r.map(e=>(0,n.jsx)("group",{position:new i.Vector3(0,.16,0),children:y(e)},"child-".concat(e)))]},"bone-".concat(e))};return(0,n.jsx)("group",{ref:s,rotation:new i.Euler(0,Math.PI,0),position:new i.Vector3(0,-.3,0),children:p.map((e,t)=>-1===e?y(t):null)})});c.displayName="BoneWings";let d=o.memo(e=>{let{isLeft:t=!1}=e,r=1.75*Math.PI;return(0,n.jsx)("group",{rotation:[-.45,t?-.7:.7,t?-.15:.15],children:Array.from({length:18}).map((e,o)=>{let i=o/19,a=.075*(1-.725*i),s=3.25*Math.pow(i,2.7);return(0,n.jsxs)("group",{position:[s*(t?-.15:.15),.0675*o,-(.725*s)],rotation:[-1.5*i,Math.pow(i,.2)*r,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[a,1.5*a,.0675,10]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*i,", ").concat(0+20*i,", ").concat(0+20*i,")"),roughness:.7,metalness:.4})]}),Array.from({length:6}).map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI/2,0],children:(0,n.jsxs)("mesh",{position:[.95*a,0,0],children:[(0,n.jsx)("boxGeometry",{args:[.3*a,.259375,1.5*a]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*i,", ").concat(20+20*i,", ").concat(20+20*i,")"),roughness:.8,metalness:.3})]})},t))]},o)})})});d.displayName="DragonHorns";var u=r(7125);let h=o.memo(e=>{let{parentRef:t,dashCharges:r,weaponType:s,weaponSubclass:l}=e,c=(0,o.useRef)(null),d=()=>{if(l)switch(l){case u.p.CHAOS:return"#00FF37";case u.p.ABYSSAL:return"#17CE54";case u.p.DIVINITY:return"#87CEEB";case u.p.VENGEANCE:return"#4682B4";case u.p.FROST:case u.p.ASSASSIN:case u.p.PYRO:return"#FF544E";case u.p.STORM:return"#C6C6C6";case u.p.ELEMENTAL:return"#3EB0FC";case u.p.VENOM:return"#17CC93"}switch(s){case u.v.SCYTHE:return"#17CE54";case u.v.SWORD:return"#87CEEB";case u.v.SABRES:return"#FF544E";case u.v.SPEAR:return"#C6C6C6";case u.v.BOW:return"#3A905E"}};return(0,a.F)(e=>{let{clock:n}=e;if(!c.current||!t.current)return;let o=n.getElapsedTime();c.current.children.forEach((e,t)=>{let n=t/r.length*Math.PI*2+.5*o,i=.1+Math.sin(2*o+t);e.position.set(Math.cos(n)*i,.1*Math.sin(1.5*o+.5*t),Math.sin(n)*i),e.rotation.x=2*o+t,e.rotation.y=1.5*o+.7*t}),c.current.position.copy(t.current.position)}),(0,n.jsx)("group",{ref:c,children:r.map((e,t)=>{let r=e.isAvailable,o=d(),a="#333333";return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.115,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:new i.Color(r?o:a),emissive:new i.Color(r?o:a),emissiveIntensity:r?.3:.1,transparent:!0,opacity:r?.8:.4})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.115*1.225,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:r?o:"#333333",emissive:r?o:"#333333",emissiveIntensity:r?.5:.1,transparent:!0,opacity:r?.4:.15,depthWrite:!1,side:i.DoubleSide,blending:i.AdditiveBlending})]})]},t)})})});h.displayName="ChargedOrbitals";let g=()=>(0,n.jsxs)("group",{rotation:[Math.PI/4,0,0],position:[0,-.125,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.0175,.0175,.175,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:new i.Vector3(0,.1,0),rotation:new i.Euler(0,0,Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:new i.Vector3(0,-.1,0),rotation:new i.Euler(0,0,-Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.0325,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#a4a4a4",roughness:.5,metalness:.2})]})]});function p(e){let{parentRef:t}=e,r=(0,o.useRef)([]),i=(0,o.useRef)(null);return(0,a.F)(()=>{if(!t.current||!i.current)return;let e=t.current.position;i.current.position.set(e.x,0,e.z),r.current.forEach((e,t)=>{let r=t/16*Math.PI*2+.001*Date.now(),n=-(.4675*Math.cos(r)),o=.4675*Math.sin(r),i=.02*Math.sin(.002*Date.now()+t);e.position.set(n,i-.5,o),e.rotation.y=r+Math.PI/3})}),(0,n.jsx)("group",{ref:i,children:Array.from({length:16}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(r.current[t]=e)},children:g()},t))})}function m(e){let{chargeProgress:t,isCharging:r,onRelease:s,currentSubclass:l,hasInstantPowershot:c=!1,isAbilityBowAnimation:d=!1,isViperStingCharging:h=!1,viperStingChargeProgress:g=0,isBarrageCharging:p=!1,barrageChargeProgress:m=0,isCobraShotCharging:f=!1,cobraShotChargeProgress:y=0}=e,x=(0,o.useRef)(null),v=(0,o.useRef)(r),M=t>=.8&&t<=.98;(0,a.F)(()=>{let e=r&&!d&&!h&&!p&&!f;if(v.current&&!e&&!h&&!p&&!f){let e=t>=.8&&t<=.98;s(t,e)}v.current=e});let j=()=>{let e=new i.Shape;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e},w={steps:1,depth:.03,bevelEnabled:!1};return(0,n.jsx)("group",{position:[.6,.65,.875],rotation:[-Math.PI/2,-Math.PI/2,-Math.PI/2],scale:[.875,.8,.8],children:(0,n.jsxs)("group",{ref:x,position:[-.9,.075,.75],rotation:[Math.PI,Math.PI/2,0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("tubeGeometry",{args:[new i.CatmullRomCurve3([new i.Vector3(-.875,0,0),new i.Vector3(-.85,.2,0),new i.Vector3(-.25,.5,0),new i.Vector3(-.4,.35,0),new i.Vector3(.4,.35,0),new i.Vector3(.25,.5,0),new i.Vector3(.85,.2,0),new i.Vector3(.875,0,0)]),64,.035,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:M?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*g),", ").concat(Math.floor(63+125*g),", ").concat(Math.floor(155+97*g),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:M?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*g),", ").concat(Math.floor(63+125*g),", ").concat(Math.floor(155+97*g),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:M?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*g:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("tubeGeometry",{args:[(e=>{let t=1.35*e;return new i.CubicBezierCurve3(new i.Vector3(-.8,0,0),new i.Vector3(0,0,-t),new i.Vector3(0,0,-t),new i.Vector3(.8,0,0))})(f?y:p?m:h?g:t),16,.02,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:1,transparent:!0,opacity:.6})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[-.4,0,.475],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,n.jsx)("meshStandardMaterial",{color:M?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*g),", ").concat(Math.floor(63+125*g),", ").concat(Math.floor(155+97*g),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:M?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*g),", ").concat(Math.floor(63+125*g),", ").concat(Math.floor(155+97*g),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:M?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*g:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{position:[.4,0,.475],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,n.jsx)("meshStandardMaterial",{color:M?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*g),", ").concat(Math.floor(63+125*g),", ").concat(Math.floor(155+97*g),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:M?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*g),", ").concat(Math.floor(63+125*g),", ").concat(Math.floor(155+97*g),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:M?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*g:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,transparent:!0,opacity:.8})]})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[-1,0,-.2],rotation:[Math.PI/2,0,Math.PI/2],scale:[.4,-.4,.4],children:[(0,n.jsx)("extrudeGeometry",{args:[j(),w]}),(0,n.jsx)("meshStandardMaterial",{color:M?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*g),", ").concat(Math.floor(63+125*g),", ").concat(Math.floor(155+97*g),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:M?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*g),", ").concat(Math.floor(63+125*g),", ").concat(Math.floor(155+97*g),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:M?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*g:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,metalness:.8,roughness:.1,transparent:!0,opacity:.8,side:i.DoubleSide})]}),(0,n.jsxs)("mesh",{position:[1,0,-.2],rotation:[Math.PI/2,0,Math.PI/2],scale:[.4,.4,.4],children:[(0,n.jsx)("extrudeGeometry",{args:[j(),w]}),(0,n.jsx)("meshStandardMaterial",{color:M?"#ffffff":f?"rgb(".concat(Math.floor(0+255*y),", ").concat(Math.floor(255),", ").concat(Math.floor(64+32*y),")"):h?"rgb(".concat(Math.floor(139+116*g),", ").concat(Math.floor(63+125*g),", ").concat(Math.floor(155+97*g),")"):l===u.p.VENOM&&c?"#00ff40":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissive:M?"#ffffff":f?"rgb(".concat(Math.floor(0+170*y),", ").concat(Math.floor(170+85*y),", ").concat(Math.floor(32+32*y),")"):h?"rgb(".concat(Math.floor(139+116*g),", ").concat(Math.floor(63+125*g),", ").concat(Math.floor(155+97*g),")"):l===u.p.VENOM&&c?"#00aa20":l===u.p.ELEMENTAL&&r?"rgb(".concat(Math.floor(193+62*t),", ").concat(Math.floor(140-140*t),", ").concat(Math.floor(75-75*t),")"):"#C18C4B",emissiveIntensity:M?4+2*Math.sin(.02*Date.now()):f?2+2*y:h?2+2*g:l===u.p.VENOM&&c?2.5:l===u.p.ELEMENTAL&&r?1.5+1.5*t:1.5,metalness:.8,roughness:.1,transparent:!0,opacity:.8,side:i.DoubleSide})]})]}),(r||h||p||f)&&(0,n.jsxs)("group",{position:[0,0,.8-(f?y:p?m:h?g:t)*1.35],rotation:[Math.PI/2,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.9,8]}),(0,n.jsx)("meshStandardMaterial",{color:f?"#00ff40":p?"#ff8800":h?"#A855C7":"#00ffff",emissive:f?"#00ff40":p?"#ff8800":h?"#A855C7":"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsxs)("mesh",{position:[0,.35,0],children:[(0,n.jsx)("coneGeometry",{args:[.03,.175,8]}),(0,n.jsx)("meshStandardMaterial",{color:f?"#00ff40":p?"#ff8800":h?"#A855C7":"#00ffff",emissive:f?"#00ff40":p?"#ff8800":h?"#A855C7":"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]})]})]})})}function f(e){let{scytheRef:t,basePosition:r,isEmpowered:o=!1}=e,s=()=>{let e=new i.Shape;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e},l={steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16};return(0,n.jsxs)("group",{ref:t,position:[r[0],r[1],r[2]],rotation:[0,0,Math.PI],scale:[.65,.75,.65],children:[(0,n.jsxs)("group",{position:[0,-0,0],rotation:[0,0,Math.PI+.3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,1.5,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#a86432",roughness:.7})]}),[...Array(7)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.6-.2*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.07,.01,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#a86432",metalness:.3,roughness:.7})]},t))]}),(0,n.jsxs)("group",{position:[-0,0,0],rotation:[Math.PI/1,0,Math.PI-.3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>2*e.clock.getElapsedTime()),children:(0,n.jsxs)("mesh",{"position-y":.55,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.14,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:o?"#8A2BE2":"#17CE54",emissive:o?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.55,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.14,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:o?"#8A2BE2":"#17CE54",emissive:o?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.4,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:o?"#8A2BE2":"#17CE54",emissive:o?"#9370DB":"#17CE54",emissiveIntensity:1,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.2,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:o?"#8A2BE2":"#17CE54",emissive:o?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.2,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:o?"#8A2BE2":"#17CE54",emissive:o?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,a.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.4,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:o?"#8A2BE2":"#17CE54",emissive:o?"#9370DB":"#17CE54",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,n.jsx)("meshStandardMaterial",{color:o?"#8A2BE2":"#17CE54",emissive:o?"#8A2BE2":"#17CE54",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,n.jsx)("group",{position:[.375,.45,.65],rotation:[.2,-Math.PI/3.6,Math.PI-.4],scale:[.8,.45,.8],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[s(),{...l,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:o?"#8A2BE2":"#17CE54",emissive:o?"#8A2BE2":"#17CE54",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:i.DoubleSide})]})}),(0,n.jsx)("group",{position:[-.375,-.45,-.65],rotation:[.2,Math.PI/14-1.1,-.4],scale:[.8,.45,.8],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[s(),{...l,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:o?"#8A2BE2":"#17CE54",emissive:o?"#8A2BE2":"#17CE54",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:i.DoubleSide})]})})]})}function y(e){let{currentSubclass:t=u.p.CHAOS,level:r=1,isEmpowered:i=!1,isSpinning:s=!1}=e;(0,o.useEffect)(()=>{i&&console.log("[Scythe] Legion empowerment activated - showing green trails")},[i]),(0,o.useEffect)(()=>{s&&console.log("[Scythe] Spinning animation started")},[s]);let l=(0,o.useRef)(null),c=(0,o.useRef)(0),d=[-1.175,.65,.3];return(0,a.F)((e,t)=>{if(l.current){if(s){c.current+=t;let e=15*c.current;l.current.position.set(0,.5,1.2),l.current.rotation.set(Math.PI/8,0,e)}else c.current=0,l.current.rotation.x*=.85,l.current.rotation.y*=.85,l.current.rotation.z*=.85,l.current.position.x+=(d[0]-l.current.position.x)*.14,l.current.position.y+=(d[1]-l.current.position.y)*.14,l.current.position.z+=(d[2]-l.current.position.z)*.025}}),(0,n.jsx)(f,{scytheRef:l,basePosition:d,isEmpowered:i})}var x=r(6663);function v(e){let{isSwinging:t,isSmiting:r,isOathstriking:s,isDivineStorming:l=!1,isColossusStriking:c=!1,isCharging:d=!1,isDeflecting:u=!1,chargeDirectionProp:h,onSwingComplete:g,onSmiteComplete:p,onOathstrikeComplete:m,onDivineStormComplete:f,onColossusStrikeComplete:y,onChargeComplete:v,onDeflectComplete:M,hasChainLightning:j=!1,comboStep:w=1,currentSubclass:S,enemyData:C=[],onHit:b,setDamageNumbers:D,nextDamageNumberId:P,setActiveEffects:I,playerPosition:E,playerRotation:F,dragonGroupRef:R}=e,A=(0,o.useRef)(null),B=(0,o.useRef)(0),T=(0,o.useRef)(0),k=(0,o.useRef)(0),V=(0,o.useRef)(0);(0,o.useRef)(0);let z=(0,o.useRef)(null),G=(0,o.useRef)(new i.Vector3),N=(0,o.useRef)(null),W=(0,o.useRef)(new Set),L=(0,o.useRef)([]);(0,o.useRef)(1);let O=(0,o.useRef)(0),H=(0,o.useRef)(null),_=(0,o.useRef)(!1),U=(0,o.useRef)(!1),Z=[-1.18,.225,.3],Y=(0,o.useRef)([]),q=(0,o.useRef)({}),Q=(0,o.useRef)({}),J=(0,o.useRef)(!1),K=(0,o.useRef)(w),X=(0,o.useRef)(!1),$=(0,o.useRef)(0),ee=(0,o.useRef)(w),et=(0,o.useRef)([...Z]),er=(0,o.useRef)([0,0,0]);(0,o.useEffect)(()=>{K.current!==w&&(console.log("\uD83D\uDD04 ComboStep prop changed: ".concat(K.current," → ").concat(w)),K.current=w)},[w]),(0,a.F)((e,n)=>{var o,a,m;if(A.current){if(Date.now(),!t&&!r&&!c&&!l&&!s&&!d&&!u&&X.current){if(0===$.current&&console.log("\uD83D\uDD04 Combo transition started: ".concat(ee.current," → ").concat(w,", progress: ").concat((100*$.current).toFixed(1),"%")),$.current+=7*n,$.current>=1){if(console.log("✅ Combo transition completed: ".concat(ee.current," → ").concat(w)),X.current=!1,$.current=0,w!==ee.current){let e=en(w);et.current=e.position,er.current=e.rotation,console.log("\uD83C\uDFAF Ready position set for combo ".concat(w,": [").concat(e.position[0].toFixed(2),", ").concat(e.position[1].toFixed(2),", ").concat(e.position[2].toFixed(2),"]"))}else et.current=[...Z],er.current=[0,0,0],console.log("\uD83C\uDFE0 Returning to base position: [".concat(Z[0].toFixed(2),", ").concat(Z[1].toFixed(2),", ").concat(Z[2].toFixed(2),"]"));A.current.position.set(...et.current),A.current.rotation.set(...er.current)}else{let e;let t=1-Math.pow(1-$.current,3),r=A.current.position,n=A.current.rotation;w!==ee.current?(e=en(w),console.log("\uD83D\uDD04 Combo continuing: ".concat(ee.current," → ").concat(w,", target: [").concat(e.position[0].toFixed(2),", ").concat(e.position[1].toFixed(2),", ").concat(e.position[2].toFixed(2),"]"))):(e={position:[...Z],rotation:[0,0,0]},console.log("\uD83D\uDD04 Combo ended: returning to base position [".concat(Z[0].toFixed(2),", ").concat(Z[1].toFixed(2),", ").concat(Z[2].toFixed(2),"]")));let o=Math.sin($.current*Math.PI);$.current<.1&&(console.log("\uD83D\uDD04 Combo transition: ".concat(ee.current," → ").concat(w)),console.log("\uD83D\uDCCD From: [".concat(r.x.toFixed(2),", ").concat(r.y.toFixed(2),", ").concat(r.z.toFixed(2),"]")),console.log("\uD83C\uDFAF To: [".concat(e.position[0].toFixed(2),", ").concat(e.position[1].toFixed(2),", ").concat(e.position[2].toFixed(2),"]")),console.log("\uD83D\uDCD0 Arc height: ".concat(.15,", Progress: ").concat((100*$.current).toFixed(1),"%")));let i=r.x+(e.position[0]-r.x)*t,a=r.y+(e.position[1]-r.y)*t+.15*o,s=r.z+(e.position[2]-r.z)*t;A.current.position.set(i,a,s);let l=n.x+(e.rotation[0]-n.x)*t,c=n.y+(e.rotation[1]-n.y)*t,d=n.z+(e.rotation[2]-n.z)*t;A.current.rotation.set(l,c,d)}return}if(l){if(V.current+=22.5*n,V.current>=1*Math.PI*4){V.current=0,q.current={},A.current.position.set(...Z),A.current.rotation.set(0,0,0),null==f||f();return}let e=V.current,t=1.75*Math.cos(e),r=1.75*Math.sin(e);A.current.rotation.set(Math.PI/3,-e+Math.PI,1),A.current.rotateY(-e+Math.PI),A.current.position.set(t,.65,r);let o=Date.now();C.forEach(e=>{e.health&&!(e.health<=0)&&!(o-(q.current[e.id]||0)<200)&&5>=(E||new i.Vector3(0,0,0)).distanceTo(e.position)&&(q.current[e.id]=o,null==b||b(e.id,40),D&&P&&D(t=>[...t,{id:P.current++,damage:40,position:e.position.clone(),isCritical:!1,isDivineStorm:!0}]))});return}if(_.current){if(console.log("\uD83C\uDF2A️ Charge spin active - rotation: ".concat(O.current.toFixed(2),", isCharging: ").concat(d)),O.current+=27.5*n,O.current>=1*Math.PI*2){console.log("✅ Charge spin completed! Calling onChargeComplete"),O.current=0,H.current=null,_.current=!1,A.current.position.set(...Z),A.current.rotation.set(0,0,0),null==v||v();return}let e=O.current,t=1.6*Math.cos(e),r=1.6*Math.sin(e);A.current.position.set(t,.65,r),A.current.rotation.set(Math.PI/3,-e+Math.PI,1),A.current.rotateY(-e+Math.PI);return}if(d){if(!N.current){N.current=Date.now(),z.current=(null==E?void 0:E.clone())||new i.Vector3(0,0,0),W.current.clear(),h?G.current=h.clone().normalize():G.current=new i.Vector3(0,0,-1).normalize();let e=window.gameUI;if(e){let t=e.getCurrentRage?e.getCurrentRage():"unknown";e.gainRage(0);let r=e.getCurrentRage?e.getCurrentRage():"unknown";console.log("⚔️ Gained 5 rage from charge attack - Rage: ".concat(t," → ").concat(r))}console.log("⚔️ Charge initialized! Start time: ".concat(N.current,", Position: ").concat(null===(o=z.current)||void 0===o?void 0:o.toArray()))}let e=(Date.now()-N.current)/1e3;if(e<.1){let t=e/.1,r=t<.5?2*t*t:1-Math.pow(-2*t+2,3)/2;A.current.rotation.set(Math.PI/2*r,0,0),Z[2];let n=Z[2]+1.5*r;A.current.position.set(Z[0],Z[1]+.2,n);return}let t=Math.min((e-.1)/.45,1);if(!z.current||!G.current||!E){N.current=null,z.current=null,null==v||v();return}let r=G.current.clone().multiplyScalar(9.5*(1-Math.pow(1-t,2))),n=z.current.clone().add(r).length();if(n>25){console.warn("[Charge] Cancelled: would move too far from origin (".concat(n.toFixed(2)," > ").concat(25,")")),N.current=null,z.current=null,null==v||v();return}if(C&&C.length>0&&b&&t>0&&E)for(let e of(console.log("\uD83C\uDFC3 Charge dash progress: ".concat((100*t).toFixed(1),"%, checking ").concat(C.length," enemies")),console.log("\uD83C\uDFAF Player position: [".concat(E.x.toFixed(2),", ").concat(E.y.toFixed(2),", ").concat(E.z.toFixed(2),"]")),C)){if(W.current.has(e.id)||e.health<=0)continue;let t=E.distanceTo(e.position);console.log("\uD83C\uDFAF Enemy ".concat(e.id," distance from player: ").concat(t.toFixed(2),", collision radius: ").concat(2.5)),t<=2.5&&(W.current.add(e.id),b(e.id,40),D&&P&&D(t=>[...t,{id:P.current++,damage:40,position:e.position.clone(),isCritical:!1,isBreach:!0}]),console.log("⚔️ Charge hit enemy ".concat(e.id," for ").concat(40," damage at distance ").concat(t.toFixed(2))))}A.current.rotation.set(Math.PI/2,0,-.175),A.current.position.set(Z[0],Z[1]+.2,Z[2]+1.5);return}if(!d&&null!==N.current&&!_.current&&!U.current&&(console.log("\uD83C\uDF2A️ Charge completed by ControlSystem - triggering spin phase"),U.current=!0,C&&C.length>0&&b&&E)){let e=0;for(let t of C)!(t.health<=0)&&4>=E.distanceTo(t.position)&&(b(t.id,15),e++,D&&P&&D(e=>[...e,{id:P.current++,damage:15,position:t.position.clone(),isCritical:!1,isFireball:!0}]));console.log("\uD83D\uDCA5 Charge explosion hit ".concat(e," enemies"))}if(U.current&&!_.current&&(console.log("\uD83C\uDF2A️ Starting charge spin phase"),N.current=null,z.current=null,W.current.clear(),L.current=[],U.current=!1,_.current=!0,O.current=0,H.current=Date.now(),console.log("\uD83C\uDF2A️ Spin state set: isChargeSpinning=".concat(_.current,", rotation=").concat(O.current))),!d&&_.current&&console.log("\uD83C\uDF2A️ isCharging=false but spin is active - allowing spin to continue"),d||null===N.current||U.current||_.current||(console.log("⚔️ Charge cancelled early - resetting state"),N.current=null,z.current=null,W.current.clear(),L.current=[],U.current=!1,A.current.rotation.set(0,0,0),A.current.position.set(...Z)),d&&!N.current&&(U.current=!1,_.current=!1,O.current=0),r){let e,t,r,o,i;T.current+=n*(T.current<Math.PI/2?3:6);let a=Math.min(T.current/Math.PI,1);if(a<.5){let n=.45*a;e=-Math.PI/3-n*Math.PI/3,t=n*Math.PI/4,r=Z[0]+1.5*n,o=Z[1]+1.5*n,i=Z[2]-1.5*n}else{let n=(a-.5)*2;e=-2*Math.PI/3+3*n*Math.PI/2,t=Math.PI/4*(1-n),r=Z[0]+1.5*(1-n),o=Z[1]+(1.5-2*n),i=Z[2]-(1.5-3*n)}A.current.position.set(r,o,i),A.current.rotation.set(e,t,0),T.current>=Math.PI&&(T.current=0,A.current.rotation.set(0,0,0),A.current.position.set(...Z),null==p||p());return}if(c){let e,t,r,o,i;k.current+=n*(k.current<Math.PI/2?3:6);let a=Math.min(k.current/Math.PI,1);if(a<.5){let n=.45*a;e=-Math.PI/3-n*Math.PI/3,t=n*Math.PI/4,r=Z[0]+1.5*n,o=Z[1]+1.5*n,i=Z[2]-1.5*n}else{let n=(a-.5)*2;e=-2*Math.PI/3+3*n*Math.PI/2,t=Math.PI/4*(1-n),r=Z[0]+1.5*(1-n),o=Z[1]+(1.5-2*n),i=Z[2]-(1.5-3*n)}A.current.position.set(r,o,i),A.current.rotation.set(e,t,0),k.current>=Math.PI&&(k.current=0,A.current.rotation.set(0,0,0),A.current.position.set(...Z),null==y||y());return}if(t){K.current!==w&&(console.log("\uD83D\uDD04 Combo step sync: ".concat(K.current," → ").concat(w)),K.current=w),0===B.current&&(console.log("\uD83D\uDDE1️ Swing started for combo step: ".concat(w,", currentComboStep: ").concat(K.current)),J.current=!1),B.current+=8*n;let e=Math.min(B.current/Math.PI/1.5,1),t=K.current,r=3===t?.9*Math.PI:.55*Math.PI;if((3===t?e>=.25&&e<=.75:e>=.15&&e<=.65)&&!J.current&&(console.log("⚔️ Sword damage window active! Phase: ".concat(e.toFixed(2),", Combo: ").concat(t,", Enemies: ").concat(C.length)),console.log("\uD83D\uDD0D Debug: comboStep prop=".concat(w,", currentComboStep.current=").concat(K.current,", effectiveComboStep=").concat(t)),console.log("\uD83C\uDFAF Damage window: ".concat(e>=.25&&e<=.75?"3rd hit":"1st/2nd hit"," (").concat(e.toFixed(2),")")),eo(t),J.current=!0),B.current>=r){console.log("✅ Swing ".concat(t," completed at threshold ").concat(r.toFixed(2))),B.current=0,J.current=!1,Q.current={},ee.current=t,console.log("\uD83D\uDCDD Updated lastComboStep: ".concat(ee.current)),2===t?(console.log("⚡ Skipping transition after 2nd swing - 3rd swing starts immediately"),X.current=!1):(X.current=!0,$.current=0,console.log("\uD83D\uDD04 Starting combo transition: ".concat(t," → next step, isInCombo: ").concat(X.current))),null==g||g();return}if(1===t){let t=e<=.25?2*e:.725-(e-.115)*1.1,r=Z[0]+2*Math.sin(t*Math.PI),n=Z[1]+-2*Math.sin(t*Math.PI),o=Z[2]+1*Math.cos(t*Math.PI);A.current.position.set(r,n,o),A.current.rotation.set(-.75*Math.sin(t*Math.PI)+1.25,Math.sin(t*Math.PI)*Math.PI/1.125,Math.PI/3*Math.sin(t*Math.PI))}else if(2===t){let t=e<=.275?2*e:.625-(e-.075)*1.2,r=Z[0]+2.5-2.5*Math.sin(t*Math.PI),n=Z[1]+-.2*Math.sin(t*Math.PI),o=Z[2]+1.1*Math.cos(t*Math.PI);A.current.position.set(r,n,o),A.current.rotation.set(-.75*Math.sin(t*Math.PI)+1.5,-Math.sin(t*Math.PI)*Math.PI,-(Math.PI/1.75*Math.sin(t*Math.PI)))}else if(3===t){let t,r,o,i,s;if(B.current<=3*n){let e=A.current.position,t=A.current.rotation;A.current.userData={startPos:[e.x,e.y,e.z],startRot:[t.x,t.y,t.z]}}let l=(null===(a=A.current.userData)||void 0===a?void 0:a.startPos)||Z,c=(null===(m=A.current.userData)||void 0===m?void 0:m.startRot)||[0,0,0];if(e<.2){let n=5*e,a=Z[0]+1.5,d=Z[1]+1.5,u=Z[2]-1.5;o=l[0]+(a-l[0])*n,i=l[1]+(d-l[1])*n,s=l[2]+(u-l[2])*n,t=c[0]+(-Math.PI/3-Math.PI/3-c[0])*n,r=c[1]+(Math.PI/4-c[1])*n}else{let n=(e-.2)*2;t=-2*Math.PI/3+3*n*Math.PI/2,r=Math.PI/4*(1-n),o=Z[0]+1.5*(1-n),i=Z[1]+(2-5*n),s=Z[2]-(1.5-3.5*n)}A.current.position.set(o,i,s),A.current.rotation.set(t,r,0)}}else t||r||c||l||s||d||u||X.current||2===ee.current&&3===w||(A.current.rotation.x*=.85,A.current.rotation.y*=.85,A.current.rotation.z*=.85,A.current.position.x+=(Z[0]-A.current.position.x)*.14,A.current.position.y+=(Z[1]-A.current.position.y)*.14,A.current.position.z+=(Z[2]-A.current.position.z)*.14);if(j&&A.current){if(.8>Math.random())for(let e=0;e<3;e++){let e=2.2*Math.random(),t=new i.Vector3((Math.random()-.5)*.4,e,(Math.random()-.5)*.4);Y.current.push({position:t,velocity:new i.Vector3((Math.random()-.5)*4,(Math.random()-.2)*4,(Math.random()-.5)*4).multiplyScalar(.8),life:1,scale:.02*Math.random()+.005})}Y.current.forEach(e=>{e.velocity.x+=Math.sin(.01*Date.now())*n*.5,e.velocity.z+=Math.cos(.01*Date.now())*n*.5,e.position.add(e.velocity.clone().multiplyScalar(n)),e.life-=1.5*n,e.velocity.y+=.5*n}),Y.current.length>120&&(Y.current=Y.current.slice(-120)),Y.current=Y.current.filter(e=>e.life>0)}}});let en=e=>{switch(e){case 1:return{position:[Z[0]+.3,Z[1]+.2,Z[2]+.1],rotation:[.2,.3,.1]};case 2:return{position:[Z[0]-.3,Z[1]-.1,Z[2]+.1],rotation:[.2,-.3,-.1]};case 3:return{position:[Z[0],Z[1]-.15,Z[2]-.2],rotation:[-.5,0,0]};default:return{position:[...Z],rotation:[0,0,0]}}},eo=e=>{if(!E||!C.length)return;let t=Date.now(),r={1:25,2:30,3:40}[e];console.log("\uD83D\uDDE1️ Checking sword collision for combo ".concat(e,", enemies in range:"),C.length);let n=0,o=0;if(C.forEach(o=>{if(!o.health||o.health<=0||t-(Q.current[o.id]||0)<100)return;let a=E.distanceTo(o.position);console.log("\uD83C\uDFAF Enemy ".concat(o.id," distance: ").concat(a.toFixed(2),", range: ").concat(5)),a<=5&&(3===e||o.position.clone().sub(E).normalize().dot(new i.Vector3(0,0,-1))>-.5?(Q.current[o.id]=t,null==b||b(o.id,r),n++,D&&P&&D(e=>[...e,{id:P.current++,damage:r,position:o.position.clone(),isCritical:!1}]),console.log("\uD83D\uDDE1️ Sword combo ".concat(e," hit enemy ").concat(o.id," for ").concat(r," damage (distance: ").concat(a.toFixed(2),")"))):console.log("❌ Enemy ".concat(o.id," in range but outside attack arc")))}),n>0){let t=window.gameUI;if(t){let r=t.getCurrentRage?t.getCurrentRage():"unknown",i=Math.min(5*n,5);t.gainRage(i);let a=t.getCurrentRage?t.getCurrentRage():"unknown";console.log("\uD83D\uDDE1️ Gained ".concat(i," rage from hitting ").concat(n," enemies with sword swing ").concat(e," - Rage: ").concat(r," → ").concat(a)),o=i}}console.log("\uD83D\uDCCA Swing ".concat(e," summary: Hit ").concat(n," enemies, gained ").concat(o," rage total"))},ei=()=>{let e=new i.Shape;return e.moveTo(0,0),e.lineTo(-.25,.25),e.lineTo(-.15,-.15),e.lineTo(0,0),e.lineTo(.25,.25),e.lineTo(.15,-.15),e.lineTo(0,0),e.lineTo(0,.08),e.lineTo(.2,.2),e.quadraticCurveTo(.8,.15,1.5,.18),e.quadraticCurveTo(2,.1,2.2,0),e.quadraticCurveTo(2,-.1,1.5,-.18),e.quadraticCurveTo(.8,-.15,.2,-.2),e.lineTo(0,-.08),e.lineTo(0,0),e},ea={steps:2,depth:.05,bevelEnabled:!0,bevelThickness:.014,bevelSize:.02,bevelOffset:.04,bevelSegments:2},es={...ea,depth:.06,bevelThickness:.02,bevelSize:.02,bevelOffset:0,bevelSegments:6};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{rotation:[-.65,0,.2],scale:[.8,.9,.65],children:[(0,n.jsxs)("group",{ref:A,position:[Z[0],Z[1],Z[2]],rotation:[0,0,Math.PI],scale:[.75,.8,.65],children:[(0,n.jsxs)("group",{position:[.25,-.55,.35],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.04,.9,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.35-.11*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.045,.016,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[.25,.225,.35],rotation:[Math.PI,1.5,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.26,.07,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.25*Math.cos(t*Math.PI/4),.25*Math.sin(t*Math.PI/4),0],rotation:[0,0,t*Math.PI/4-Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.07,.55,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]},"spike-".concat(t))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.155,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new i.Color(11907088),emissive:new i.Color(11907088),emissiveIntensity:3,transparent:!0,opacity:1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new i.Color(1087413),emissive:new i.Color(1087413),emissiveIntensity:40,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.145,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new i.Color(1087413),emissive:new i.Color(1087413),emissiveIntensity:35,transparent:!0,opacity:.6})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.175,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new i.Color(1087413),emissive:new i.Color(1087413),emissiveIntensity:30,transparent:!0,opacity:.4})]}),(0,n.jsx)("pointLight",{color:new i.Color(1160495),intensity:2,distance:1,decay:2})]}),(0,n.jsxs)("group",{position:[.25,.5,.35],rotation:[0,-Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[ei(),ea]}),(0,n.jsx)("meshStandardMaterial",{color:new i.Color(1087413),emissive:new i.Color(1087413),emissiveIntensity:1.5,metalness:.3,roughness:.1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new i.Shape;return e.moveTo(0,0),e.lineTo(0,.06),e.lineTo(.15,.15),e.quadraticCurveTo(1.2,.12,1.5,.15),e.quadraticCurveTo(2,.08,2.15,0),e.quadraticCurveTo(2,-.08,1.5,-.15),e.quadraticCurveTo(1.2,-.12,.15,-.15),e.lineTo(0,-.05),e.lineTo(0,0),e})(),es]}),(0,n.jsx)("meshStandardMaterial",{color:new i.Color(1087413),emissive:new i.Color(1087413),emissiveIntensity:3,metalness:.2,roughness:.1,opacity:.8,transparent:!0})]})]}),(0,n.jsx)("group",{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("group",{position:[.25,.7,.35],rotation:[0,-Math.PI/2,Math.PI/2],scale:[.95,1.1,.95],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[ei(),{...ea,depth:.07}]}),(0,n.jsx)("meshStandardMaterial",{color:new i.Color(8900331),emissive:new i.Color(4620980),emissiveIntensity:1.5,transparent:!0,opacity:.3,blending:i.AdditiveBlending})]})}),Y.current.map((e,t)=>(0,n.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],children:[(0,n.jsx)("sphereGeometry",{args:[1.25,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:new i.Color(8900331),emissive:new i.Color(4620980),emissiveIntensity:3*e.life,transparent:!0,opacity:.6*e.life,blending:i.AdditiveBlending})]},t))]})})]}),d&&L.current.map(e=>(0,n.jsxs)("mesh",{position:[e.position.x,e.position.y,e.position.z],scale:[.2*e.life,.2*e.life,.2*e.life],children:[(0,n.jsx)("sphereGeometry",{args:[.5,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:new i.Color(11907088),emissive:new i.Color(11907088),emissiveIntensity:3*e.life,transparent:!0,opacity:.9*e.life,blending:i.AdditiveBlending})]},e.id)),l&&(0,n.jsx)("group",{children:(0,n.jsx)("pointLight",{color:new i.Color(11907088),intensity:1,distance:8,decay:1})})]}),(0,n.jsx)(x.Z,{isActive:u,duration:3,onComplete:M,playerPosition:E,playerRotation:F,dragonGroupRef:R})]})}let M=(e,t,r)=>e*(1-r)+t*r;function j(e){let{isSwinging:t,onSwingComplete:r,onLeftSwingStart:s,onRightSwingStart:l,isCharging:c=!1,isSkyfalling:d=!1,isBackstabbing:u=!1,onBackstabComplete:h=()=>{},subclass:g="FROST"}=e;o.useEffect(()=>{u&&console.log("\uD83D\uDDE1️ DEBUG: Sabres component received isBackstabbing:",u)},[u]);let p=(0,o.useRef)(null),m=(0,o.useRef)(0),f=(0,o.useRef)(null),y=(0,o.useRef)(0),x=[-.8,.75,.65],v=[.8,.75,.65],j=(0,o.useRef)(0),w=(0,o.useRef)(!1),S=(0,o.useRef)(0),C=(0,o.useRef)(0),b=(0,o.useRef)("none"),D=(0,o.useRef)(!1),P=(0,o.useRef)({left:{x:0,y:0,z:0},right:{x:0,y:0,z:0}}),I=(0,o.useRef)(!1);(0,o.useEffect)(()=>{u||(D.current=!1,b.current="none",C.current=0)},[u]),(0,o.useEffect)(()=>{d||(I.current=!1)},[d]),(0,a.F)((e,n)=>{if(p.current&&f.current){if(d&&!I.current)p.current.position.x+=(-.8-p.current.position.x)*.3,p.current.position.y+=(-.2-p.current.position.y)*.3,p.current.position.z+=(.5-p.current.position.z)*.3,f.current.position.x+=(.8-f.current.position.x)*.3,f.current.position.y+=(-.2-f.current.position.y)*.3,f.current.position.z+=(.5-f.current.position.z)*.3,p.current.rotation.x=M(1.05*p.current.rotation.x,.37*Math.PI,.3),p.current.rotation.z=M(p.current.rotation.z,1.65*Math.PI,.2),f.current.rotation.x=M(1.05*f.current.rotation.x,.37*Math.PI,.3),f.current.rotation.z=M(f.current.rotation.z,-(1.65*Math.PI),.2),m.current=0,y.current=0,S.current=0,j.current=0,w.current=!1,C.current=0,b.current="none";else if(u&&!D.current){if("none"===b.current){b.current="windup",C.current=0;let e=x[0]+14695761589768238e-32-.45,t=x[1]+-.25*Math.sin(2*Math.PI),r=x[2]+13471114790620887e-32,n=v[0]-14695761589768238e-32+.45,o=v[1]+-.25*Math.sin(2*Math.PI),i=v[2]+13471114790620887e-32;p.current.position.set(e,t,r),f.current.position.set(n,o,i),p.current.rotation.set(.5*Math.PI*Math.sin(.95*Math.PI),.5*Math.PI*Math.sin(.95*Math.PI),-.1*Math.PI*Math.sin(.95*Math.PI)),f.current.rotation.set(.5*Math.PI*Math.sin(.95*Math.PI),-(.5*Math.PI*Math.sin(.95*Math.PI)),.1*Math.PI*Math.sin(.95*Math.PI))}if(C.current+=1*n,"windup"===b.current){let e=Math.min(C.current/.125,1),t=.125*Math.sin(e*Math.PI*.15);p.current.position.z=p.current.position.z-t,f.current.position.z=f.current.position.z-t;let r=Math.sin(.225*Math.PI)*(.5*Math.PI+Math.PI/4),n=.3*Math.PI*Math.sin(.225*Math.PI)-Math.PI/1.75,o=-.1*Math.PI*Math.sin(.225*Math.PI),i=Math.sin(.225*Math.PI)*(.5*Math.PI+Math.PI/4),a=-(.3*Math.PI*Math.sin(.225*Math.PI))+Math.PI/1.75,s=.1*Math.PI*Math.sin(.225*Math.PI);p.current.rotation.x=r,p.current.rotation.y=n,p.current.rotation.z=o,f.current.rotation.x=i,f.current.rotation.y=a,f.current.rotation.z=s,P.current={left:{x:r,y:n,z:o},right:{x:i,y:a,z:s}},e>=1&&(b.current="thrust",C.current=0)}else if("thrust"===b.current){let e=Math.min(C.current/.15,1),t=Math.sin(e*Math.PI*.175);p.current.position.z+=t,f.current.position.z+=t;let r=.325*t;p.current.position.x+=r,f.current.position.x-=r,p.current.rotation.x=P.current.left.x,p.current.rotation.y=P.current.left.y,p.current.rotation.z=P.current.left.z,f.current.rotation.x=P.current.right.x,f.current.rotation.y=P.current.right.y,f.current.rotation.z=P.current.right.z,e>=.85&&(b.current="recover",C.current=0)}else if("recover"===b.current){let e=Math.min(C.current/.2,1),t=1-Math.pow(1-e,.175);p.current.position.x=M(p.current.position.x,x[0],t),p.current.position.y=M(p.current.position.y,x[1],t),p.current.position.z=M(p.current.position.z,x[2],t),f.current.position.x=M(f.current.position.x,v[0],t),f.current.position.y=M(f.current.position.y,v[1],t),f.current.position.z=M(f.current.position.z,v[2],t),p.current.rotation.x=M(p.current.rotation.x,0,t),p.current.rotation.y=M(p.current.rotation.y,0,t),p.current.rotation.z=M(p.current.rotation.z,0,t),f.current.rotation.x=M(f.current.rotation.x,0,t),f.current.rotation.y=M(f.current.rotation.y,0,t),f.current.rotation.z=M(f.current.rotation.z,0,t),e>=1&&(b.current="none",C.current=0,D.current=!0,h())}}else if(t){if(0===m.current&&0===y.current&&(w.current=!1),p.current){if(S.current<.115)S.current+=n;else{0===m.current&&s(),m.current+=12*n;let e=Math.min(m.current/Math.PI,1),t=x[0]+1.2*Math.sin(e*Math.PI)-.45,r=x[1]+-.25*Math.sin(e*Math.PI*2),o=x[2]+1.75*Math.sin(e*Math.PI);p.current.position.set(t,r,o),p.current.rotation.set(.65*Math.PI*Math.sin(e*Math.PI),.3*Math.PI*Math.sin(e*Math.PI),-.1*Math.PI*Math.sin(e*Math.PI)),m.current>=Math.PI&&(m.current=0,S.current=0,p.current.rotation.set(0,0,0),p.current.position.set(...x))}}if(f.current){0===y.current&&l(),y.current+=12*n;let e=Math.min(y.current/Math.PI,1),t=v[0]-1.2*Math.sin(e*Math.PI)+.45,o=v[1]+-.25*Math.sin(e*Math.PI*2),i=v[2]+1.75*Math.sin(e*Math.PI);f.current.position.set(t,o,i),f.current.rotation.set(.5*Math.PI*Math.sin(e*Math.PI),-(.3*Math.PI*Math.sin(e*Math.PI)),.2*Math.PI*Math.sin(e*Math.PI)),y.current>=Math.PI&&(y.current=0,j.current=0,f.current.rotation.set(0,0,0),f.current.position.set(...v),w.current=!0,r())}}else p.current.position.x+=(x[0]-p.current.position.x)*.2,p.current.position.y+=(x[1]-p.current.position.y)*.2,p.current.position.z+=(x[2]-p.current.position.z)*.2,f.current.position.x+=(v[0]-f.current.position.x)*.2,f.current.position.y+=(v[1]-f.current.position.y)*.2,f.current.position.z+=(v[2]-f.current.position.z)*.2,p.current.rotation.x*=.85,p.current.rotation.y*=.85,p.current.rotation.z*=.85,f.current.rotation.x*=.85,f.current.rotation.y*=.85,f.current.rotation.z*=.85,t||(m.current=0,y.current=0,S.current=0,j.current=0,w.current=!1),u||(C.current=0,b.current="none")}});let E=()=>{let e=new i.Shape;return e.moveTo(0,0),e.lineTo(-.15,.1),e.lineTo(-.2,0),e.lineTo(-.2,-.05),e.lineTo(0,0),e.lineTo(.15,.1),e.lineTo(.2,0),e.lineTo(.3,0),e.lineTo(0,0),e.lineTo(0,.05),e.quadraticCurveTo(.3,.15,.5,.2),e.quadraticCurveTo(.7,.25,.9,.15),e.quadraticCurveTo(1,.1,1.1,0),e.quadraticCurveTo(1,-.05,.8,-.1),e.lineTo(.7,-.15),e.lineTo(.65,-.1),e.quadraticCurveTo(.4,-.08,.2,-.05),e.quadraticCurveTo(.1,-.02,0,0),e},F=()=>{let e=new i.Shape;return e.moveTo(0,0),e.lineTo(-.13,.08),e.lineTo(-.18,0),e.lineTo(-.08,-.04),e.lineTo(0,0),e.lineTo(.13,.08),e.lineTo(.18,0),e.lineTo(.08,-.04),e.lineTo(0,0),e.lineTo(0,.04),e.quadraticCurveTo(.28,.13,.48,.18),e.quadraticCurveTo(.68,.23,.88,.13),e.quadraticCurveTo(.98,.08,1.08,0),e.quadraticCurveTo(.98,-.04,.78,-.08),e.lineTo(.68,-.13),e.lineTo(.63,-.08),e.quadraticCurveTo(.38,-.06,.18,-.04),e.quadraticCurveTo(.08,-.02,0,0),e},R={steps:2,depth:.02,bevelEnabled:!0,bevelThickness:.004,bevelSize:.01,bevelSegments:3},A={...R,depth:.025,bevelThickness:.003,bevelSize:.004,bevelOffset:0},B=(()=>{switch(g){case"FROST":default:return{primary:"#ff0000",emissive:"#ff2200",secondary:"#cc0000",secondaryEmissive:"#ff0000"};case"ASSASSIN":return{primary:"#8b0000",emissive:"#ff0000",secondary:"#4b0000",secondaryEmissive:"#cc0000"}}})();return(0,n.jsxs)("group",{position:[0,-.6,.5],rotation:[-.55,0,0],scale:[.775,.775,.775],children:[(0,n.jsxs)("group",{ref:p,position:[x[0],x[1],x[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,n.jsxs)("group",{position:[.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,n.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[E(),R]}),(0,n.jsx)("meshStandardMaterial",{color:B.primary,emissive:B.emissive,emissiveIntensity:3,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[0,0,-.02],children:[(0,n.jsx)("extrudeGeometry",{args:[F(),{...A,depth:.06}]}),(0,n.jsx)("meshStandardMaterial",{color:B.secondary,emissive:B.secondaryEmissive,emissiveIntensity:8,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,n.jsx)("pointLight",{color:B.emissive,intensity:5,distance:2,decay:2})]})]}),(0,n.jsxs)("group",{ref:f,position:[v[0],v[1],v[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,n.jsxs)("group",{position:[-.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,n.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[-.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[E(),R]}),(0,n.jsx)("meshStandardMaterial",{color:B.primary,emissive:B.emissive,emissiveIntensity:2,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[0,0,-.02],children:[(0,n.jsx)("extrudeGeometry",{args:[F(),{...A,depth:.06}]}),(0,n.jsx)("meshStandardMaterial",{color:B.secondary,emissive:B.secondaryEmissive,emissiveIntensity:3.5,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,n.jsx)("pointLight",{color:B.emissive,intensity:1.5,distance:2,decay:2})]})]})]})}var w=r(4937);let S=o.memo(e=>{let{position:t,onComplete:r}=e,[i,s]=(0,o.useState)(0),l=(0,o.useCallback)((e,t)=>{s(e=>{let n=e+t;return n>=1.5&&r(),n})},[1.5,r]);(0,a.F)(l);let c=i/1.5,d=Math.sin(c*Math.PI),u=1+2*c,h=(0,o.useMemo)(()=>({color:"#60FF38",emissive:"#60FF38",emissiveIntensity:1.5,transparent:!0}),[]),g=(0,o.useMemo)(()=>({color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2.5,transparent:!0}),[]),p=(0,o.useMemo)(()=>[void 0,void 0,void 0],[]),m=(0,o.useMemo)(()=>[...Array(12)],[]);return(0,n.jsxs)("group",{position:t.toArray(),children:[p.map((e,t)=>(0,n.jsxs)("mesh",{position:[0,2*c+.5*t,0],rotation:[Math.PI/2,0,2*i],children:[(0,n.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,n.jsx)("meshStandardMaterial",{...h,opacity:d*(1-.2*t)})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{scale:[u,u,u],children:[(0,n.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2,transparent:!0,opacity:.3*d})]}),m.map((e,t)=>{let r=t/12*Math.PI*2,o=.75+c;return(0,n.jsxs)("mesh",{position:[Math.cos(r+2*i)*o/1.1,2*c+.5*Math.sin(3*i+t),Math.sin(r+2*i)*o/1.1],children:[(0,n.jsx)("sphereGeometry",{args:[.095,8,8]}),(0,n.jsx)("meshStandardMaterial",{...g,opacity:.8*d})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#60FF38",intensity:2*d,distance:5,decay:2})]})});S.displayName="HealingEffect";let C=(0,o.forwardRef)((e,t)=>{let{parentRef:r}=e,[a,s]=(0,o.useState)(!1),l=(0,o.useCallback)(()=>{s(!0)},[]);return(0,o.useImperativeHandle)(t,()=>({triggerHealingEffect:l})),a&&r.current?(0,n.jsx)(S,{position:r.current.position.clone().add(new i.Vector3(0,0,0)),onComplete:()=>s(!1)}):null});function b(e){let{position:t=new i.Vector3(0,0,0),movementDirection:r=new i.Vector3(0,0,0),isDashing:a=!1,dashCharges:g=[{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0}],chargeDirection:f,currentWeapon:x=u.v.BOW,currentSubclass:M=u.p.ELEMENTAL,isCharging:S=!1,chargeProgress:b=0,isSwinging:D=!1,isSpinning:P=!1,onBowRelease:I=()=>{},onScytheSwingComplete:E=()=>{},onSwordSwingComplete:F=()=>{},onSabresSwingComplete:R=()=>{},onSabresLeftSwingStart:A=()=>{},onSabresRightSwingStart:B=()=>{},onBackstabComplete:T=()=>{},swordComboStep:k=1,isSkyfalling:V=!1,isBackstabbing:z=!1,isDivineStorming:G=!1,isSwordCharging:N=!1,isDeflecting:W=!1,onChargeComplete:L=()=>{},onDeflectComplete:O=()=>{},enemyData:H=[],onHit:_=()=>{},setDamageNumbers:U=()=>{},nextDamageNumberId:Z={current:0},playerPosition:Y,playerRotation:q=new i.Vector3(0,0,0),isViperStingCharging:Q=!1,viperStingChargeProgress:J=0,isBarrageCharging:K=!1,barrageChargeProgress:X=0,isCobraShotCharging:$=!1,cobraShotChargeProgress:ee=0,reanimateRef:et,setActiveEffects:er=()=>{}}=e,en=(0,o.useRef)(null),eo=(0,o.useMemo)(()=>(0,n.jsx)("group",{scale:[.8,.55,.8],position:[0,.04,-.015],rotation:[.4,0,0],children:(0,n.jsx)(s.Z,{})}),[]),ei=(0,o.useMemo)(()=>(0,n.jsx)("group",{scale:[.85,.85,.85],position:[0,.05,.1],children:(0,n.jsx)(l.Z,{movementDirection:r})}),[r]),ea=(0,o.useMemo)(()=>(0,n.jsx)("group",{scale:[.235,.335,.235],position:[-.05,.215,.35],rotation:[.15,0,-5],children:(0,n.jsx)(d,{isLeft:!0})}),[]),es=(0,o.useMemo)(()=>(0,n.jsx)("group",{scale:[.235,.335,.235],position:[.05,.215,.35],rotation:[.15,0,5],children:(0,n.jsx)(d,{isLeft:!1})}),[]),el=(0,o.useMemo)(()=>(0,n.jsxs)("group",{position:[0,.2,-.15],children:[(0,n.jsx)("group",{rotation:[0,Math.PI/5.5,0],children:(0,n.jsx)(c,{isLeftWing:!0,parentRef:en,isDashing:a})}),(0,n.jsx)("group",{rotation:[0,-Math.PI/5.5,0],children:(0,n.jsx)(c,{isLeftWing:!1,parentRef:en,isDashing:a})})]}),[a]);return(0,n.jsxs)("group",{ref:en,position:[t.x,t.y+.2,t.z],children:[ea,es,eo,ei,el,(0,n.jsx)(h,{parentRef:en,dashCharges:g,weaponType:x,weaponSubclass:M}),(0,n.jsx)(p,{parentRef:en}),x===u.v.BOW?(0,n.jsx)(m,{position:t,direction:r,chargeProgress:b,isCharging:S,onRelease:I,currentSubclass:M,hasInstantPowershot:!1,isAbilityBowAnimation:!1,isViperStingCharging:Q,viperStingChargeProgress:J,isBarrageCharging:K,barrageChargeProgress:X,isCobraShotCharging:$,cobraShotChargeProgress:ee}):x===u.v.SCYTHE?(0,n.jsx)(y,{parentRef:en,currentSubclass:M,level:1,isEmpowered:!1,isSpinning:P}):x===u.v.SWORD?(0,n.jsx)(v,{isSwinging:D,isSmiting:!1,isOathstriking:!1,isDivineStorming:G,isColossusStriking:!1,isCharging:N,isDeflecting:W,chargeDirectionProp:f,onSwingComplete:F,onSmiteComplete:()=>{},onOathstrikeComplete:()=>{},onDivineStormComplete:()=>{},onColossusStrikeComplete:()=>{},onChargeComplete:L,onDeflectComplete:O,hasChainLightning:!1,comboStep:k,currentSubclass:M,enemyData:H,onHit:_,setDamageNumbers:U,nextDamageNumberId:Z,setActiveEffects:er,playerPosition:Y,playerRotation:q,dragonGroupRef:en}):x===u.v.SABRES?(0,n.jsx)(j,{isSwinging:D,onSwingComplete:R||(()=>{}),onLeftSwingStart:A||(()=>{}),onRightSwingStart:B||(()=>{}),isCharging:S,isSkyfalling:V,isBackstabbing:z,onBackstabComplete:T,subclass:M}):null,G&&x===u.v.SWORD&&(0,n.jsx)(w.Z,{position:t,onComplete:()=>{},parentRef:en,isActive:G,enemyData:H,onHitTarget:(e,t,r,n,o)=>{null==_||_(e,t),U&&Z&&U(e=>[...e,{id:Z.current++,damage:t,position:n.clone(),isCritical:r,isDivineStorm:o}])}}),x===u.v.SCYTHE&&(0,n.jsx)(C,{parentRef:en,ref:et})]})}C.displayName="Reanimate";var D=r(319);let P=o.memo(e=>{let{parentRef:t,weaponType:r,weaponSubclass:s,targetPosition:l}=e,c=(0,o.useRef)([]),d=(0,o.useRef)([]),[h,g]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e;l?(e=l.clone(),d.current=Array(30).fill(0).map(()=>e.clone()),g(!0)):t.current&&(e=t.current.position.clone(),d.current=Array(30).fill(0).map(()=>e.clone()),g(!0))},[t,l,30]);let p=()=>{if(s)switch(s){case u.p.CHAOS:case u.p.ABYSSAL:return"#17CE54";case u.p.DIVINITY:return"#87CEEB";case u.p.VENGEANCE:return"#4682B4";case u.p.FROST:case u.p.ASSASSIN:case u.p.PYRO:case u.p.STORM:return"#FF544E";case u.p.ELEMENTAL:return"#3EB0FC";case u.p.VENOM:return"#17CC93"}switch(r){case u.v.SCYTHE:return"#17CE54";case u.v.SWORD:return"#6DFF9E";case u.v.SABRES:return"#FF544E";case u.v.SPEAR:return"#C6C6C6";case u.v.BOW:return"#3A905E"}};return((0,a.F)(()=>{let e;if(h){if(l&&l.clone)e=l.clone();else{if(!t.current||!t.current.position||!t.current.position.clone)return;e=t.current.position.clone()}e.y+=.3,d.current.unshift(e),d.current=d.current.slice(0,30),c.current.forEach((e,t)=>{e&&d.current[t]&&(e.position.copy(d.current[t]),e.scale.setScalar(1-t/30*.6),e.material&&e.material instanceof i.MeshBasicMaterial&&(e.material.opacity=(1-t/30)*.2))})}}),h)?(0,n.jsx)(n.Fragment,{children:Array.from({length:30}).map((e,t)=>(0,n.jsxs)("mesh",{ref:e=>{e&&(c.current[t]=e)},children:[(0,n.jsx)("sphereGeometry",{args:[.43,32,32]}),(0,n.jsx)("meshBasicMaterial",{color:new i.Color(p()),transparent:!0,opacity:.3,depthWrite:!1})]},t))}):null});P.displayName="GhostTrail";var I=r(7771),E=r(73),F=r(6862),R=r(8001),A=r(244);function B(e){let{entityId:t,position:r,world:s,onMeshReady:l,currentWeapon:c=u.v.BOW,currentSubclass:d=u.p.ELEMENTAL,isCharging:h=!1,chargeProgress:g=0,isSwinging:p=!1,isSpinning:m=!1,isDeflecting:f=!1,onBowRelease:y=()=>{},onScytheSwingComplete:x=()=>{},onSwordSwingComplete:v=()=>{},onSabresSwingComplete:M=()=>{},onBackstabComplete:j=()=>{},swordComboStep:w=1,isSkyfalling:S=!1,isBackstabbing:C=!1,isDivineStorming:B=!1,isSwordCharging:T=!1,onChargeComplete:k=()=>{},onDeflectComplete:V=()=>{},rotation:z,isLocalPlayer:G=!0,isViperStingCharging:N=!1,viperStingChargeProgress:W=0,isBarrageCharging:L=!1,barrageChargeProgress:O=0,isCobraShotCharging:H=!1,cobraShotChargeProgress:_=0,reanimateRef:U}=e,Z=(0,o.useRef)(!1);Z.current||(Z.current=!0);let{camera:Y}=(0,a.D)(),q=(0,o.useRef)(null),Q=(0,o.useRef)(new i.Vector3(0,0,0)),J=(0,o.useRef)(r?r.clone():new i.Vector3(0,.5,0)),K=(0,o.useRef)(!1),[X,$]=(0,o.useState)(new i.Vector3(0,0,0)),ee=(0,o.useRef)(new i.Vector3(0,0,-1)),[et,er]=(0,o.useState)([]),[en,eo]=(0,o.useState)([{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0},{isAvailable:!0,cooldownRemaining:0}]),[ei,ea]=(0,o.useState)(void 0),[es,el]=(0,o.useState)([]),ec=(0,o.useRef)(0),ed=(0,o.useRef)(!1),[eu,eh]=(0,o.useState)([]);(0,a.F)(()=>{if(q.current){if(T&&!ed.current){let e=new i.Vector3;Y.getWorldDirection(e),e.y=0,e.normalize(),ea(e)}ed.current=T;let e=Date.now();eh(t=>t.filter(t=>!t.startTime||!t.duration||e-t.startTime<1e3*t.duration)),r&&q.current.position.copy(r);let n=s.getEntity(t);if(n){.01>Math.random()&&(n.getAllComponents(),n.getComponentNames());let e=n.getComponent(I.i);e&&("function"==typeof e.getDashChargeStatus||"Movement"===e.componentType||"Movement"===e.constructor.name)&&(K.current=e.isDashing,"function"==typeof e.getDashChargeStatus&&eo(e.getDashChargeStatus()),e.isCharging?ea(e.chargeDirection.clone()):ea(void 0))}if(r){let e=r.clone().sub(J.current);e.length()>.001?Q.current.copy(e.normalize()):Q.current.set(0,0,0),J.current.copy(r)}if(G&&Y){let e=new i.Vector3;Y.getWorldDirection(e);let r=Math.atan2(e.x,e.z);q.current.rotation.y=r;let n=s.getEntity(t),o=new i.Vector3(0,r,0);if(n){let e=n.getComponent(I.i);if(e&&e.inputStrength>.1){let t=e.moveDirection;if(t.length()>.1){let e=Math.atan2(t.x,t.z);o=new i.Vector3(0,e,0),ee.current.set(t.x,0,t.z).normalize()}}else{let e=Math.atan2(ee.current.x,ee.current.z);o=new i.Vector3(0,e,0)}}$(o)}else!G&&z&&(q.current.rotation.set(z.x,z.y,z.z),$(new i.Vector3(z.x,z.y,z.z)));if(c===u.v.SWORD){let e=s.queryEntities([E.w,F.S,R.C]).map(e=>{let t=e.getComponent(E.w),r=e.getComponent(F.S);return{id:e.id.toString(),position:t.getWorldPosition(),health:r.currentHealth}}).filter(e=>e.health>0);er(e),p&&e.length}}}),(0,o.useEffect)(()=>{q.current&&l&&l(q.current)},[l]);let eg=(e,r)=>{let n=s.getEntity(parseInt(e)),o=s.getEntity(t);if(n&&o){let e=s.getSystem(A.b);e&&e.queueDamage(n,r,o,"sword")}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("group",{ref:q,children:(0,n.jsx)(b,{position:new i.Vector3(0,0,0),movementDirection:Q.current,isDashing:K.current,dashCharges:en,chargeDirection:ei,currentWeapon:c,currentSubclass:d,isCharging:h,chargeProgress:g,isSwinging:p,isSpinning:m,onBowRelease:y,onScytheSwingComplete:x,onSwordSwingComplete:v,onSabresSwingComplete:M,onBackstabComplete:j,swordComboStep:w,isSkyfalling:S,isBackstabbing:C,isDivineStorming:B,isSwordCharging:T,isDeflecting:f,onChargeComplete:k,onDeflectComplete:V,enemyData:et,onHit:eg,setDamageNumbers:el,nextDamageNumberId:ec,playerPosition:r,playerRotation:X,isViperStingCharging:N,viperStingChargeProgress:W,isBarrageCharging:L,barrageChargeProgress:O,isCobraShotCharging:H,cobraShotChargeProgress:_,reanimateRef:U,setActiveEffects:eh})}),(0,n.jsx)(P,{parentRef:q,weaponType:c,weaponSubclass:d}),G&&c===u.v.BOW&&(0,n.jsx)(D.default,{parentRef:q,enemyData:et,onHit:eg,setDamageNumbers:el,nextDamageNumberId:ec,onHealthChange:e=>{},charges:en.map((e,t)=>({id:t+1,available:e.isAvailable,cooldownStartTime:e.cooldownRemaining>0?Date.now()-(15e3-1e3*e.cooldownRemaining):null})),setCharges:e=>{"function"==typeof e?eo(t=>e(t.map((e,t)=>({id:t+1,available:e.isAvailable,cooldownStartTime:e.cooldownRemaining>0?Date.now()-(15e3-1e3*e.cooldownRemaining):null}))).map((e,t)=>({isAvailable:e.available,cooldownRemaining:e.cooldownStartTime?Math.max(0,(15e3-(Date.now()-e.cooldownStartTime))/1e3):0}))):eo(e.map(e=>({isAvailable:e.available,cooldownRemaining:e.cooldownStartTime?Math.max(0,(15e3-(Date.now()-e.cooldownStartTime))/1e3):0})))}})]})}},7125:function(e,t,r){var n,o,i,a;r.d(t,{p:function(){return o},v:function(){return n}}),(i=n||(n={})).SCYTHE="SCYTHE",i.SWORD="SWORD",i.SABRES="SABRES",i.SPEAR="SPEAR",i.BOW="BOW",(a=o||(o={})).CHAOS="CHAOS",a.ABYSSAL="ABYSSAL",a.DIVINITY="DIVINITY",a.VENGEANCE="VENGEANCE",a.FROST="FROST",a.ASSASSIN="ASSASSIN",a.PYRO="PYRO",a.STORM="STORM",a.ELEMENTAL="ELEMENTAL",a.VENOM="VENOM"},3680:function(e,t,r){r.d(t,{Z:function(){return d}});var n=r(7437),o=r(2265),i=r(1276),a=r(1448),s=r(8001);let l=()=>(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.15,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#4FC3F7",emissiveIntensity:.8,transparent:!0,opacity:.7,blending:a.AdditiveBlending,depthWrite:!1})]})});var c=function(e){let{parentRef:t}=e,r=(0,o.useRef)([]),a=(0,o.useRef)(null);return(0,i.F)(e=>{let{clock:t}=e;a.current&&r.current.forEach((e,r)=>{if(!e)return;let n=t.getElapsedTime(),o=r/40*1.25-.175,i=r/40*Math.PI*6+1.5*n,a=1*(.8-.4*o)+.2*Math.sin(2*n+.5*r),s=Math.cos(i)*a,l=Math.sin(i)*a;e.position.set(s,o+.3*Math.sin(2*n+r)+.2,l),e.rotation.y=i+Math.PI/2,e.rotation.x=.2*Math.sin(n+r),e.rotation.z=.2*Math.cos(.8*n+r);let c=e.children[0];if(c&&c.material){let t=c.material,r=o/1.5;t.opacity=Math.max(.2,.8*(1-r)),e.scale.setScalar(1-.3*r)}})}),(0,n.jsxs)("group",{ref:a,children:[Array.from({length:40}).map((e,t)=>(0,n.jsx)("group",{ref:e=>{e&&(r.current[t]=e)},children:l()},t)),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:12,distance:12,decay:1.2,position:[0,.5,0]})]})};function d(e){let{entityId:t,position:r,world:l,onMeshReady:d}=e,u=(0,o.useRef)(null),h=(0,o.useRef)(0),g=(0,o.useRef)(!1);return(0,i.F)((e,n)=>{if(h.current+=n,u.current){u.current.position.copy(r);let e=l.getEntity(t);if(e){let t=e.getComponent(s.C);if(t){let e=Date.now()/1e3-t.lastAttackTime,r=Math.sin(.5*h.current)>.7;g.current=e<.5||r}}u.current.position.y+=.1*Math.sin(2*h.current),g.current||(u.current.rotation.y+=.5*n);let o=u.current.getObjectByName("LeftArm");if(o){if(g.current){let e=o.rotation.x,t=8*n;o.rotation.x=a.MathUtils.lerp(e,-Math.PI/3,t),o.rotation.z=a.MathUtils.lerp(o.rotation.z,.2,t)}else{let e=o.rotation.x,t=o.rotation.z,r=6*n;o.rotation.x=a.MathUtils.lerp(e,0,r),o.rotation.z=a.MathUtils.lerp(t,0,r)}}}}),(0,o.useEffect)(()=>{u.current&&d&&d(u.current)},[d]),(0,n.jsxs)("group",{ref:u,children:[(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.8,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#29B6F6",emissiveIntensity:.3,transparent:!0,opacity:.9,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{position:[0,2.7,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.4,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#81D4FA",emissive:"#4FC3F7",emissiveIntensity:.4,transparent:!0,opacity:.85,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[-.7,2.35,0],children:[(0,n.jsx)("sphereGeometry",{args:[.325,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#81D4FA",emissive:"#4FC3F7",emissiveIntensity:.3,transparent:!0,opacity:.85,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[-.7,2.35,0],rotation:[Math.PI/2,-Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.4,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#B3E5FC",emissiveIntensity:.5,transparent:!0,opacity:.9,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{name:"LeftArm",position:[-.7,2,.2],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#29B6F6",emissiveIntensity:.2,transparent:!0,opacity:.675,metalness:.6,roughness:.4})]}),(0,n.jsxs)("mesh",{position:[.7,2.35,0],children:[(0,n.jsx)("sphereGeometry",{args:[.325,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#81D4FA",emissive:"#4FC3F7",emissiveIntensity:.3,transparent:!0,opacity:.85,metalness:.7,roughness:.3})]}),(0,n.jsxs)("mesh",{position:[.7,2.35,0],rotation:[Math.PI/2,Math.PI/4,0],children:[(0,n.jsx)("torusGeometry",{args:[.4,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#B3E5FC",emissiveIntensity:.5,transparent:!0,opacity:.9,metalness:.8,roughness:.2})]}),(0,n.jsxs)("mesh",{position:[.7,2,0],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,1,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#4FC3F7",emissive:"#29B6F6",emissiveIntensity:.2,transparent:!0,opacity:.675,metalness:.6,roughness:.4})]}),(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("sphereGeometry",{args:[1.35,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#29B6F6",emissive:"#0277BD",emissiveIntensity:.1,transparent:!0,opacity:.4,depthWrite:!1,blending:a.AdditiveBlending})]}),(0,n.jsx)(c,{parentRef:u}),g.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,2.2,1.5],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.1,.8,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#81D4FA",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]}),(0,n.jsxs)("mesh",{position:[.5,2.2,1.3],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,n.jsx)("coneGeometry",{args:[.08,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#81D4FA",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]}),(0,n.jsxs)("mesh",{position:[-.5,2.2,1.3],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,n.jsx)("coneGeometry",{args:[.08,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#81D4FA",emissiveIntensity:.8,transparent:!0,opacity:.9,metalness:.9,roughness:.1})]})]}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2+1.2*h.current,o=.8*Math.cos(r),i=2.5+.8*Math.sin(r),a=.2*Math.cos(1.5*h.current+t);return(0,n.jsx)("group",{position:[o,i,a],rotation:[Math.PI/2,r+Math.PI,-Math.PI/2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.075,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#CCFFFF",emissive:"#CCFFFF",emissiveIntensity:.8,transparent:!0,opacity:1})]})},"horizontal-".concat(t))}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2+1.2*h.current+Math.PI/8,o=.8*Math.cos(r),i=2.5+.8*Math.sin(r),a=.2*Math.cos(1.5*h.current+t);return(0,n.jsx)("group",{position:[o,i,a],rotation:[Math.PI/2,r,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.075,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#AAEEFF",emissive:"#AAEEFF",emissiveIntensity:.8,transparent:!0,opacity:1})]})},"vertical-".concat(t))}),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:.5,distance:3,decay:2})]})}},5658:function(e,t,r){r.d(t,{Z:function(){return x}});var n=r(7437),o=r(2265),i=r(1448);let a=e=>{switch(e){case 1:case 5:return{color:"#ff0000",emissive:"#600000"};case 2:return{color:"#ffa500",emissive:"#cc8400"};case 3:return{color:"#87ceeb",emissive:"#4682b4"};case 4:return{color:"#dda0dd",emissive:"#9370db"};default:return{color:"#00ff00",emissive:"#006600"}}},s=e=>{let t=a(e),r=new i.Color(t.color);return{uniforms:{topColor:{value:r.clone().multiplyScalar(.5)},middleColor:{value:r.clone().multiplyScalar(.85)},bottomColor:{value:r.clone().lerp(new i.Color("#87CEEB"),.6)},offset:{value:33},exponent:{value:.6}},vertexShader:"\n      varying vec3 vWorldPosition;\n      \n      void main() {\n        vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n        vWorldPosition = worldPosition.xyz;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n    ",fragmentShader:"\n      uniform vec3 topColor;\n      uniform vec3 middleColor;\n      uniform vec3 bottomColor;\n      uniform float offset;\n      uniform float exponent;\n      \n      varying vec3 vWorldPosition;\n      \n      void main() {\n        float h = normalize(vWorldPosition + vec3(0.0, offset, 0.0)).y;\n        float mixStrength = max(pow(max(h, 0.0), exponent), 0.0);\n        vec3 color = mix(middleColor, topColor, mixStrength);\n        color = mix(bottomColor, color, smoothstep(0.0, 1.0, h));\n        gl_FragColor = vec4(color, 1.0);\n      }\n    "}};var l=e=>{let{level:t=1}=e,r=(0,o.useMemo)(()=>{let e=s(t);return{uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:i.BackSide}},[t]),a=(0,o.useMemo)(()=>new i.SphereGeometry(500,32,32),[]);return(0,n.jsx)("mesh",{geometry:a,children:(0,n.jsx)("shaderMaterial",{attach:"material",args:[r]})})},c=r(1276),d=()=>{let e=(0,o.useRef)(null),t=(0,o.useRef)(null),r=(0,o.useMemo)(()=>new i.SphereGeometry(1,24,24),[]),a=(0,o.useMemo)(()=>new i.RingGeometry(1.4,2.1,48),[]),s=(0,o.useMemo)(()=>new i.MeshStandardMaterial({color:"#B8E0D2",roughness:.7,metalness:.2,emissive:"#B8E0D2",emissiveIntensity:.675}),[]),l=(0,o.useMemo)(()=>new i.MeshBasicMaterial({color:"#4dff90",transparent:!0,opacity:.5}),[]),d=(0,o.useMemo)(()=>new i.MeshBasicMaterial({color:"#4dff90",transparent:!0,opacity:.2,side:i.BackSide}),[]),u=(0,o.useMemo)(()=>{let e=document.createElement("canvas");e.width=256,e.height=256;let t=e.getContext("2d"),r=t.createRadialGradient(128,128,50,128,128,128);r.addColorStop(0,"rgba(255, 255, 255, 0)"),r.addColorStop(.3,"rgba(255, 255, 255, 0.8)"),r.addColorStop(.5,"rgba(255, 255, 255, 1)"),r.addColorStop(.7,"rgba(255, 255, 255, 0.6)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=r,t.fillRect(0,0,256,256);let n=new i.CanvasTexture(e);return n.minFilter=i.LinearFilter,n.magFilter=i.LinearFilter,n.generateMipmaps=!1,n},[]),h=(0,o.useMemo)(()=>new i.MeshStandardMaterial({map:u,color:"#A8DBFF",transparent:!0,opacity:1,side:i.DoubleSide,alphaMap:u,roughness:.7,metalness:.2,emissive:"#77FFC0",emissiveIntensity:1.1}),[u]),g=(0,o.useMemo)(()=>new i.Frustum,[]),p=(0,o.useMemo)(()=>new i.Matrix4,[]),m=(0,o.useMemo)(()=>new i.Sphere(new i.Vector3,24*Math.sqrt(3)),[]);return(0,c.F)((r,n)=>{e.current&&(e.current.rotation.z+=.006*n),t.current&&(p.multiplyMatrices(r.camera.projectionMatrix,r.camera.matrixWorldInverse),g.setFromProjectionMatrix(p),m.center.copy(t.current.position),t.current.visible=g.intersectsSphere(m))}),(0,n.jsxs)("group",{ref:t,position:[100,80,-150],scale:[24,24,24],rotation:[1,.1,.1],children:[(0,n.jsx)("mesh",{geometry:r,material:s}),(0,n.jsx)("mesh",{ref:e,rotation:[Math.PI/2.8,0,0],geometry:a,material:h}),(0,n.jsx)("mesh",{scale:[1.05,1.05,1.05],geometry:r,material:l}),(0,n.jsx)("mesh",{scale:[1.1,1.1,1.1],geometry:r,material:d})]})},u=r(6018),h=e=>{let{mountains:t}=e,r=(0,o.useRef)(null),a=(0,o.useRef)(null),s=(0,o.useMemo)(()=>t.map((e,t)=>(0,u.C)(t)),[t]),l=(0,o.useMemo)(()=>new i.MeshStandardMaterial({color:"#8B7355",roughness:.8,metalness:.1}),[]),c=(0,o.useMemo)(()=>new i.MeshStandardMaterial({color:"#6B5B47",roughness:.9,metalness:.05}),[]),d=(0,o.useMemo)(()=>new i.MeshStandardMaterial({color:"#f0f0f0",roughness:.3,metalness:0}),[]),h=(0,o.useMemo)(()=>new i.ConeGeometry(23,34.5,24,6),[]),g=(0,o.useMemo)(()=>new i.ConeGeometry(24,29,25,5),[]);return(0,o.useEffect)(()=>{if(!r.current||!a.current)return;let e=new i.Matrix4;t.forEach((t,n)=>{var o;e.makeTranslation(t.position.x,t.position.y,t.position.z);let a=new i.Matrix4().makeScale(t.scale,t.scale,t.scale);e.multiply(a),null===(o=r.current)||void 0===o||o.setMatrixAt(n,e)}),t.forEach((t,r)=>{var n;let o=new i.Matrix4().makeRotationFromEuler(new i.Euler(0,.5,.1)),s=-4*t.scale,l=-5*t.scale,c=-2*t.scale;e.makeTranslation(t.position.x+s,t.position.y+l,t.position.z+c);let d=new i.Matrix4().makeScale(t.scale,t.scale,t.scale);e.multiply(o).multiply(d),null===(n=a.current)||void 0===n||n.setMatrixAt(r,e)}),r.current.instanceMatrix.needsUpdate=!0,a.current.instanceMatrix.needsUpdate=!0},[t]),(0,n.jsxs)("group",{children:[(0,n.jsx)("instancedMesh",{args:[h,l,t.length],ref:r,castShadow:!0,receiveShadow:!0}),(0,n.jsx)("instancedMesh",{args:[g,c,t.length],ref:a,castShadow:!0}),t.map((e,t)=>(0,n.jsx)("mesh",{geometry:s[t],material:d,position:[e.position.x,e.position.y+14*e.scale,e.position.z],scale:[.9*e.scale,e.scale,.9*e.scale],castShadow:!0},"peak-".concat(t)))]})},g=o.memo(e=>{let{position:t=[0,0,0],level:r=1}=e,a=e=>{switch(e){case 1:return{color:"#FF6E6E",emissive:"#FF6E6E"};case 2:return{color:"#ffa500",emissive:"#cc8400"};case 3:return{color:"#87ceeb",emissive:"#4682b4"};case 4:return{color:"#dda0dd",emissive:"#9370db"};case 5:return{color:"#ff0000",emissive:"#600000"};default:return{color:"#00ff00",emissive:"#006600"}}},{pillarGeometries:s,materials:l}=(0,o.useMemo)(()=>{let e=new i.CylinderGeometry(2,2.2,1,8),t=new i.CylinderGeometry(1.5,1.5,8,8),n=new i.CylinderGeometry(2.2,2,1,8),o=new i.MeshStandardMaterial({color:"#ffffff",roughness:.7,metalness:.2}),s=new i.SphereGeometry(1,32,32),l=a(r);return{pillarGeometries:{base:e,column:t,top:n,orb:s},materials:{stone:o,orb:new i.MeshStandardMaterial({color:l.color,emissive:l.emissive,metalness:1,roughness:.2})}}},[r]),[c,d]=o.useState(0);o.useEffect(()=>{let e;let t=()=>{d(e=>(e+.02)%(2*Math.PI)),e=requestAnimationFrame(t)};return t(),()=>{cancelAnimationFrame(e)}},[]),o.useEffect(()=>()=>{Object.values(s).forEach(e=>e.dispose()),Object.values(l).forEach(e=>e.dispose())},[s,l]);let u=a(r);return(0,n.jsxs)("group",{position:t,scale:[.35,.35,.35],children:[(0,n.jsx)("mesh",{geometry:s.base,material:l.stone,position:[0,0,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.column,material:l.stone,position:[0,.25,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.top,material:l.stone,position:[0,3,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.orb,material:l.orb,position:[0,5,0],rotation:[c,c,0],children:(0,n.jsx)("pointLight",{color:u.color,intensity:.5,distance:5})})]})}),p=o.memo(e=>{let{position:t=[0,0,0],scale:r=1,level:a=1}=e,{pedestalGeometry:s,material:l}=(0,o.useMemo)(()=>({pedestalGeometry:{base:new i.CylinderGeometry(4,4.5,2.5,12),topRing:new i.CylinderGeometry(4.2,4.2,.3,12)},material:new i.MeshStandardMaterial({color:"#e8e8e8",roughness:.8,metalness:.1})}),[]);return o.useEffect(()=>()=>{Object.values(s).forEach(e=>e.dispose()),l.dispose()},[s,l]),(0,n.jsxs)("group",{position:t,scale:[r/1.25,r/1.25,r/1.25],children:[(0,n.jsx)("mesh",{geometry:s.base,material:l,position:[0,0,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("mesh",{geometry:s.topRing,material:l,position:[0,.6,0],castShadow:!0,receiveShadow:!0}),(0,n.jsx)("pointLight",{position:[0,2.5,0],color:(e=>{switch(e){case 1:return{color:"#FF6E6E",emissive:"#FF6E6E"};case 2:return{color:"#ffa500",emissive:"#cc8400"};case 3:return{color:"#87ceeb",emissive:"#4682b4"};case 4:return{color:"#dda0dd",emissive:"#9370db"};case 5:return{color:"#ff0000",emissive:"#600000"};default:return{color:"#00ff00",emissive:"#006600"}}})(a).color,intensity:.8,distance:8,decay:2})]})}),m=r(73),f=r(3478),y=e=>{let{world:t,positions:r}=e,n=(0,o.useRef)([]);return(0,o.useEffect)(()=>{let e=[];return r.forEach(r=>{let n=t.createEntity(),o=t.createComponent(m.w);o.setPosition(r[0],r[1]+1,r[2]),n.addComponent(o);let i=t.createComponent(f.YM);i.type=f.F5.CYLINDER,i.radius=.7,i.height=3,i.layer=f.aB.ENVIRONMENT,i.isStatic=!0,i.isTrigger=!1,i.setOffset(0,0,0),n.addComponent(i),t.notifyEntityAdded(n),e.push(n),console.log("\uD83C\uDFDB️ Created pillar collision entity at position [".concat(r.join(", "),"] with radius ").concat(i.radius))}),n.current=e,()=>{e.forEach(e=>{t.getEntity(e.id)&&t.destroyEntity(e.id)}),n.current=[]}},[t,r]),null},x=e=>{let{level:t=1,enableMountains:r=!0,enablePlanet:i=!0,enableSky:a=!0,world:s}=e,c=(0,o.useMemo)(()=>(0,u.m)(),[]),m=(0,o.useMemo)(()=>[[0,0,-5],[-4.25,0,2.5],[4.25,0,2.5]],[]),f=(0,o.useMemo)(()=>[0,0,0],[]);return(0,n.jsxs)("group",{name:"environment",children:[a&&(0,n.jsx)(l,{level:t}),i&&(0,n.jsx)(d,{}),r&&(0,n.jsx)(h,{mountains:c}),(0,n.jsx)(p,{position:f,scale:.4,level:t}),(0,n.jsx)(g,{position:m[0],level:t}),(0,n.jsx)(g,{position:m[1],level:t}),(0,n.jsx)(g,{position:m[2],level:t}),s&&(0,n.jsx)(y,{world:s,positions:m})]})}},2824:function(e,t,r){r.d(t,{Z:function(){return S}});var n=r(7437),o=r(2265),i=r(1276),a=r(73),s=r(1168),l=r(246),c=r(8001),d=r(6862),u=r(1448),h=e=>{let{color:t,size:r,mesh1Ref:a,mesh2Ref:s,opacity:l=1}=e,c=(0,o.useRef)(null),d=(0,o.useRef)(null),h=(0,o.useRef)(new Float32Array(135)),g=(0,o.useRef)(new Float32Array(135)),p=(0,o.useRef)(new Float32Array(45)),m=(0,o.useRef)(new Float32Array(45)),f=(0,o.useRef)(new Float32Array(45)),y=(0,o.useRef)(new Float32Array(45)),x=(0,o.useRef)(!1),v=(0,o.useRef)(new u.Vector3),M=(0,o.useRef)(new u.Vector3),j=(0,o.useRef)(0);return(0,o.useEffect)(()=>{if(a.current&&s.current&&!x.current){let{x:e,y:t,z:r}=a.current.position,{x:n,y:o,z:i}=s.current.position;v.current.set(e,t,r),M.current.set(n,o,i);for(let a=0;a<45;a++)h.current[3*a]=e,h.current[3*a+1]=t,h.current[3*a+2]=r,g.current[3*a]=n,g.current[3*a+1]=o,g.current[3*a+2]=i,p.current[a]=0,m.current[a]=0,f.current[a]=0,y.current[a]=0;x.current=!0}},[a,s]),(0,i.F)((e,t)=>{var n,o;if(!(null===(n=c.current)||void 0===n?void 0:n.parent)||!(null===(o=d.current)||void 0===o?void 0:o.parent)||!a.current||!s.current||!x.current||(j.current+=t,j.current<.016))return;j.current=0;let i=a.current.position,u=s.current.position,w=i.distanceTo(v.current),S=u.distanceTo(M.current);if(w>.05||S>.05){v.current.copy(i),M.current.copy(u);for(let e=44;e>0;e--)h.current[3*e]=h.current[(e-1)*3],h.current[3*e+1]=h.current[(e-1)*3+1],h.current[3*e+2]=h.current[(e-1)*3+2],g.current[3*e]=g.current[(e-1)*3],g.current[3*e+1]=g.current[(e-1)*3+1],g.current[3*e+2]=g.current[(e-1)*3+2];if(h.current[0]=i.x,h.current[1]=i.y,h.current[2]=i.z,g.current[0]=u.x,g.current[1]=u.y,g.current[2]=u.z,c.current&&d.current){let e=c.current.geometry,t=d.current.geometry;e.attributes.position.needsUpdate=!0,t.attributes.position.needsUpdate=!0}}for(let e=0;e<45;e++)p.current[e]=.6*Math.pow(1-e/45,2)*l,m.current[e]=.6*Math.pow(1-e/45,2)*l,f.current[e]=.5*r*Math.pow(1-e/45,.5),y.current[e]=.5*r*Math.pow(1-e/45,.5);if(c.current&&d.current){let e=c.current.geometry,t=d.current.geometry;e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0,t.attributes.opacity.needsUpdate=!0,t.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("points",{ref:c,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:45,array:h.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:45,array:p.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:45,array:f.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:u.AdditiveBlending,vertexShader:"\n            attribute float opacity;\n            attribute float scale;\n            varying float vOpacity;\n            void main() {\n              vOpacity = opacity;\n              vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n              gl_Position = projectionMatrix * mvPosition;\n              gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n            }\n          ",fragmentShader:"\n            varying float vOpacity;\n            uniform vec3 uColor;\n            void main() {\n              float d = length(gl_PointCoord - vec2(0.5));\n              float strength = smoothstep(0.5, 0.1, d);\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n              gl_FragColor = vec4(glowColor, vOpacity * strength);\n            }\n          ",uniforms:{uColor:{value:t}}})]}),(0,n.jsxs)("points",{ref:d,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:45,array:g.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:45,array:m.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:45,array:y.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:u.AdditiveBlending,vertexShader:"\n            attribute float opacity;\n            attribute float scale;\n            varying float vOpacity;\n            void main() {\n              vOpacity = opacity;\n              vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n              gl_Position = projectionMatrix * mvPosition;\n              gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n            }\n          ",fragmentShader:"\n            varying float vOpacity;\n            uniform vec3 uColor;\n            void main() {\n              float d = length(gl_PointCoord - vec2(0.5));\n              float strength = smoothstep(0.5, 0.1, d);\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n              gl_FragColor = vec4(glowColor, vOpacity * strength);\n            }\n          ",uniforms:{uColor:{value:t}}})]})]})};function g(e){let{id:t,position:r,direction:a,onImpact:s,checkCollisions:l}=e,c=(0,o.useRef)(null),d=(0,o.useRef)(null),g=(0,o.useRef)(new u.Clock),p=(0,o.useRef)(r.clone()),m=(0,o.useRef)(r.clone()),f=(0,o.useRef)(!1),y=(0,o.useRef)(null),[x,v]=(0,o.useState)(1),{scene:M}=(0,i.D)(),j=new u.Color("#8B00FF"),w=(0,o.useRef)(0);return(0,i.F)((e,r)=>{if(!c.current||!d.current)return;let n=Date.now();if(null!==y.current){let e=Math.min((n-y.current)/500,1);if(v(1-e),e>=1){c.current.removeFromParent(),d.current.removeFromParent(),s&&s();return}}if(f.current)return;if(g.current.getElapsedTime()>5){f.current=!0,y.current=n;return}w.current+=r;let o=a.clone().multiplyScalar(.25*r*60);if(p.current.add(o),p.current.distanceTo(m.current)>=20){f.current=!0,y.current=n,s&&s(p.current.clone());return}if(l){let e=p.current.clone();if(l(t,e)){f.current=!0,y.current=n,s&&s(e);return}}let i=3.5*w.current*Math.PI*2,h=new u.Vector3(.375*Math.cos(i),.375*Math.sin(.5*i)*.3,0),x=new u.Vector3(.375*Math.cos(i+Math.PI),.375*Math.sin((i+Math.PI)*.5)*.3,0),M=new u.Vector3,j=new u.Vector3(0,1,0);M.crossVectors(a,j).normalize(),j.crossVectors(M,a).normalize();let S=M.clone().multiplyScalar(h.x).add(j.clone().multiplyScalar(h.y)),C=M.clone().multiplyScalar(x.x).add(j.clone().multiplyScalar(x.y));c.current.position.copy(p.current.clone().add(S)),d.current.position.copy(p.current.clone().add(C))}),(0,n.jsxs)("group",{name:"crossentropy-bolt-group",children:[(0,n.jsxs)("mesh",{ref:c,position:p.current,children:[(0,n.jsx)("sphereGeometry",{args:[.25,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#A020F0",emissiveIntensity:2*x,transparent:!0,opacity:.9*x,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1}),(0,n.jsx)("pointLight",{color:j,intensity:5*x,distance:12})]}),(0,n.jsxs)("mesh",{ref:d,position:p.current,children:[(0,n.jsx)("sphereGeometry",{args:[.25,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#A020F0",emissiveIntensity:2*x,transparent:!0,opacity:.9*x,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1}),(0,n.jsx)("pointLight",{color:j,intensity:5*x,distance:12})]}),(0,n.jsx)(h,{color:j,size:.225,mesh1Ref:c,mesh2Ref:d,opacity:x}),(0,n.jsx)("pointLight",{color:j,intensity:8*x,distance:4,decay:2})]})}var p=e=>{let{color:t,size:r,meshRef:a,opacity:s=1}=e,l=(0,o.useRef)(null),c=(0,o.useRef)(new Float32Array(66)),d=(0,o.useRef)(new Float32Array(22)),h=(0,o.useRef)(new Float32Array(22)),g=(0,o.useRef)(!1),p=(0,o.useRef)(new u.Vector3),m=(0,o.useRef)(0);return(0,o.useEffect)(()=>{if(a.current&&!g.current){let e=new u.Vector3;a.current.getWorldPosition(e);let{x:t,y:r,z:n}=e;p.current.set(t,r,n);for(let e=0;e<22;e++)c.current[3*e]=t,c.current[3*e+1]=r,c.current[3*e+2]=n,d.current[e]=0,h.current[e]=0;g.current=!0}},[a]),(0,i.F)((e,t)=>{var n;if(!(null===(n=l.current)||void 0===n?void 0:n.parent)||!a.current||!g.current||(m.current+=t,m.current<.02))return;m.current=0;let o=new u.Vector3;if(a.current.getWorldPosition(o),o.distanceTo(p.current)>.08){p.current.copy(o);for(let e=21;e>0;e--)c.current[3*e]=c.current[(e-1)*3],c.current[3*e+1]=c.current[(e-1)*3+1],c.current[3*e+2]=c.current[(e-1)*3+2];c.current[0]=o.x,c.current[1]=o.y,c.current[2]=o.z,l.current&&(l.current.geometry.attributes.position.needsUpdate=!0)}for(let e=0;e<22;e++)d.current[e]=.7*Math.pow(1-e/22,2)*s,h.current[e]=.6*r*Math.pow(1-e/22,.6);if(l.current){let e=l.current.geometry;e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:l,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:22,array:c.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:22,array:d.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:22,array:h.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:u.AdditiveBlending,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 18.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            // Entropic effect with green energy glow\n            vec3 glowColor = mix(uColor, vec3(0.4, 1.0, 0.6), 0.3);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})};function m(e){let{id:t,position:r,direction:a,onImpact:s,checkCollisions:l}=e,c=(0,o.useRef)(null);(0,o.useRef)(null);let d=(0,o.useRef)(r.clone()),h=(0,o.useRef)(!1),[g,m]=(0,o.useState)(!1),[y,x]=(0,o.useState)(null),v=(0,o.useRef)(r.clone().add(a.clone().multiplyScalar(25))),M=(0,o.useRef)(0),j=(0,o.useRef)(1e3*Math.random()),w=(0,o.useRef)(new u.Vector3);return(0,o.useEffect)(()=>{c.current&&c.current.position.copy(r)},[r]),(0,i.F)((e,r)=>{if(!c.current||h.current)return;M.current+=r;let n=Math.min(1.6666666666666667*M.current,1),o=d.current.clone().lerp(v.current,n),i=M.current,a=j.current,u=(1-n)*.15;w.current.set(.3*Math.sin(8*i+a)*Math.sin(3*i+.5*a)*2.5+(Math.random()-.5)*u,.4*Math.cos(6*i+1.5*a)*Math.sin(4*i+.8*a)*2.6+(Math.random()-.5)*u,.25*Math.sin(7*i+2*a)*Math.cos(5*i+1.2*a)*2.4+(Math.random()-.5)*u);let g=o.clone().add(w.current);if(c.current.position.copy(g),l){let e=c.current.position.clone();if(l(t,e)){h.current=!0,x(e),m(!0),s&&s(e);return}}n>=1&&!h.current&&(h.current=!0,x(v.current.clone()),m(!0),s&&s(v.current.clone()))}),(0,n.jsxs)("group",{children:[!h.current&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p,{color:new u.Color("#00ff44"),size:.225,meshRef:c,opacity:1}),(0,n.jsx)("group",{ref:c,position:r.toArray(),children:(0,n.jsx)("group",{rotation:[0,Math.atan2(a.x,a.z),0],children:(0,n.jsx)("pointLight",{color:"#00ff44",intensity:3,distance:4,decay:2})})})]}),g&&y&&(0,n.jsx)(f,{position:y,onComplete:()=>{setTimeout(()=>{s&&s()},200)}})]})}function f(e){let{position:t,onComplete:r}=e,i=(0,o.useRef)(Date.now()),[,a]=(0,o.useState)({});(0,o.useEffect)(()=>{let e=setInterval(()=>{a({}),(Date.now()-i.current)/1e3>.6&&(clearInterval(e),r&&r())},16),t=setTimeout(()=>{clearInterval(e),r&&r()},600);return()=>{clearInterval(e),clearTimeout(t)}},[r]);let s=(Date.now()-i.current)/1e3,l=Math.max(0,1-s/.6);return l<=0?null:(0,n.jsxs)("group",{position:t,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.8*(1+1.5*s),12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#00ff44",emissiveIntensity:1*l,transparent:!0,opacity:.6*l,blending:u.AdditiveBlending,depthWrite:!1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.55*(1+2*s),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#33ff66",emissive:"#33ff66",emissiveIntensity:1*l,transparent:!0,opacity:.7*l,blending:u.AdditiveBlending,depthWrite:!1})]}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2,o=1.5*(1+1.2*s);return(0,n.jsxs)("mesh",{position:[Math.sin(r)*o,Math.cos(r)*o*.2,Math.cos(r+Math.PI/3)*o*.4],rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("coneGeometry",{args:[.08,.4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#66ff88",emissiveIntensity:1.5*l,transparent:!0,opacity:.8*l})]},t)}),[void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,t*Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[1*(1+1.5*s)+.2*t,.08,6,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#00ff44",emissiveIntensity:1.5*l,transparent:!0,opacity:.5*l*(1-.3*t),blending:u.AdditiveBlending})]},"energy-ring-".concat(t))),(0,n.jsx)("pointLight",{color:"#00ff44",intensity:8*l,distance:4,decay:2})]})}var y=function(e){let{color:t,size:r,arrowHeadRef:a,arrowShaftRef:s,opacity:l=1}=e,c=(0,o.useRef)(null),d=(0,o.useRef)([]),h=(0,o.useRef)(!1),g=(0,o.useMemo)(()=>{let e=new u.BufferGeometry,t=new Float32Array(225),r=new Float32Array(225),n=[];for(let e=0;e<75;e++){t[3*e]=0,t[3*e+1]=0,t[3*e+2]=0;let n=1-e/75;r[3*e]=1,r[3*e+1]=.6*n,r[3*e+2]=0}for(let e=0;e<74;e++)n.push(e,e+1);return e.setAttribute("position",new u.BufferAttribute(t,3)),e.setAttribute("color",new u.BufferAttribute(r,3)),e.setIndex(n),e},[75]),p=(0,o.useMemo)(()=>new u.LineBasicMaterial({vertexColors:!0,transparent:!0,opacity:.8*l,blending:u.AdditiveBlending,depthWrite:!1,linewidth:3}),[l]);return(0,i.F)(()=>{if(!a.current||!c.current)return;let e=new u.Vector3;if(a.current.getWorldPosition(e),.01>e.lengthSq())return;if(!h.current){for(let t=0;t<75;t++)d.current.push(e.clone());h.current=!0;let t=g.attributes.position.array;for(let r=0;r<75;r++)t[3*r]=e.x,t[3*r+1]=e.y,t[3*r+2]=e.z;g.attributes.position.needsUpdate=!0;return}d.current.unshift(e),d.current.length>75&&d.current.pop();let t=g.attributes.position.array;for(let e=0;e<d.current.length;e++){let r=d.current[e];t[3*e]=r.x,t[3*e+1]=r.y,t[3*e+2]=r.z}g.attributes.position.needsUpdate=!0}),(0,n.jsxs)("group",{name:"charged-arrow-trail",children:[(0,n.jsx)("primitive",{ref:c,object:new u.Line(g,p)}),d.current.slice(0,5).map((e,o)=>(0,n.jsxs)("mesh",{position:e,children:[(0,n.jsx)("sphereGeometry",{args:[2*r*(.3-.05*o),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:t,emissive:t,emissiveIntensity:2-.3*o,transparent:!0,opacity:l*(1-.2*o),depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]},o)),d.current.slice(0,3).map((e,t)=>(0,n.jsx)("group",{position:e,children:[0,1,2].map(e=>(0,n.jsxs)("mesh",{position:[(Math.random()-.5)*.3,(Math.random()-.5)*.3,(Math.random()-.5)*.3],children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc00",emissive:"#ff8800",emissiveIntensity:3,transparent:!0,opacity:l*(1-.3*t),depthWrite:!1,blending:u.AdditiveBlending})]},e))},"spark-".concat(t)))]})};function x(e){let{position:t,direction:r,onImpact:a}=e,s=(0,o.useRef)(null),l="#ffaa00",c=(0,o.useRef)(null),d=(0,o.useRef)(null);return(0,i.F)((e,n)=>{if(!s.current)return;s.current.position.copy(t);let o=t.clone().add(r.clone().normalize());s.current.lookAt(o)}),(0,n.jsxs)("group",{name:"charged-arrow-group",children:[(0,n.jsxs)("group",{ref:s,position:t,children:[(0,n.jsxs)("mesh",{ref:c,position:[0,0,.2],children:[(0,n.jsx)("coneGeometry",{args:[.08,.25,8]}),(0,n.jsx)("meshStandardMaterial",{color:l,emissive:"#ff6600",emissiveIntensity:3,transparent:!0,opacity:.9,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1}),(0,n.jsx)("pointLight",{color:l,intensity:8,distance:6})]}),(0,n.jsxs)("mesh",{ref:d,children:[(0,n.jsx)("cylinderGeometry",{args:[.02,.03,.4,8]}),(0,n.jsx)("meshStandardMaterial",{color:l,emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:.8,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]}),(0,n.jsx)("group",{position:[0,0,-.15],children:[0,120,240].map((e,t)=>(0,n.jsxs)("mesh",{position:[.04*Math.cos(e*Math.PI/180),.04*Math.sin(e*Math.PI/180),0],rotation:[0,0,e*Math.PI/180],children:[(0,n.jsx)("planeGeometry",{args:[.08,.12]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc44",emissive:"#ff9900",emissiveIntensity:1.5,transparent:!0,opacity:.7,side:u.DoubleSide,depthWrite:!1,blending:u.AdditiveBlending})]},t))}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.22499999999999998,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:l,emissive:"#ffaa00",emissiveIntensity:1,transparent:!0,opacity:.3,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]}),(0,n.jsx)("pointLight",{color:l,intensity:12,distance:8,decay:2})]}),(0,n.jsx)(y,{color:l,size:.15,arrowHeadRef:c,arrowShaftRef:d,opacity:1})]})}function v(e){let{position:t,direction:r,onImpact:a,distanceTraveled:s=0,maxDistance:l=25}=e,c=(0,o.useRef)(null),d="#ffaa00",h=.7*l,g=Math.max(.1,1-Math.max(0,Math.min(1,(s-h)/(l-h))));return(0,i.F)((e,n)=>{if(!c.current)return;c.current.position.copy(t);let o=t.clone().add(r.clone().normalize());c.current.lookAt(o)}),(0,n.jsx)("group",{name:"regular-arrow-group",children:(0,n.jsxs)("group",{ref:c,position:t,children:[(0,n.jsxs)("mesh",{position:[0,0,.2],children:[(0,n.jsx)("coneGeometry",{args:[.08,.25,8]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:"#ff6600",emissiveIntensity:3*g,transparent:!0,opacity:.9*g,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.02,.03,.4,8]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:"#ff8800",emissiveIntensity:2*g,transparent:!0,opacity:.8*g,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]}),(0,n.jsx)("group",{position:[0,0,-.15],children:[0,120,240].map((e,t)=>(0,n.jsxs)("mesh",{position:[.04*Math.cos(e*Math.PI/180),.04*Math.sin(e*Math.PI/180),0],rotation:[0,0,e*Math.PI/180],children:[(0,n.jsx)("planeGeometry",{args:[.08,.12]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc44",emissive:"#ff9900",emissiveIntensity:1.5*g,transparent:!0,opacity:.7*g,side:u.DoubleSide,depthWrite:!1,blending:u.AdditiveBlending})]},t))}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.22499999999999998,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:"#ffaa00",emissiveIntensity:1*g,transparent:!0,opacity:.3*g,depthWrite:!1,blending:u.AdditiveBlending,toneMapped:!1})]})]})})}var M=r(6374);function j(e){let{position:t,onComplete:r,color:a=new u.Color("#00ff44"),size:s=.15,duration:l=.5}=e,c=(0,o.useRef)(null),d=(0,o.useRef)(null);return(0,i.F)(e=>{if(!c.current)return;null===d.current&&(d.current=e.clock.getElapsedTime());let t=(e.clock.getElapsedTime()-d.current)/l;if(t>=1){r();return}let n=Math.max(0,1-t);if(c.current.scale.setScalar(1+3*t),c.current.material instanceof u.Material){let e=c.current.material;e.opacity=.8*n,e.emissiveIntensity=1.5*n}}),(0,n.jsxs)("mesh",{ref:c,position:t,children:[(0,n.jsx)("torusGeometry",{args:[2*s,.3*s,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:a,emissive:a,emissiveIntensity:1.5,transparent:!0,opacity:.8,depthWrite:!1,blending:u.AdditiveBlending})]})}function w(e){let{position:t,chargeTime:r=1,explosionStartTime:i,onComplete:a}=e,s=(0,o.useRef)(i||Date.now()),[,l]=(0,o.useState)({}),c=Math.min(r/4,1),d=.6+1*c,h=2.5+4*c;(0,o.useEffect)(()=>{let e=setInterval(()=>{l({}),(Date.now()-s.current)/1e3>1&&(clearInterval(e),a&&a())},16),t=setTimeout(()=>{clearInterval(e),a&&a()},1e3);return()=>{clearInterval(e),clearTimeout(t)}},[a]);let g=(Date.now()-s.current)/1e3,p=Math.max(0,1-g/1);if(p<=0)return null;let m=4+(g<.15?10:0);return(0,n.jsxs)("group",{position:t,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.4*d*(1+g*m),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#AA00FF",emissiveIntensity:h*p*.6,transparent:!0,opacity:.85*p,depthWrite:!1,blending:u.AdditiveBlending})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.5*d*(1+g*(m+1)),24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#9932CC",emissive:"#DA70D6",emissiveIntensity:.6*h*p,transparent:!0,opacity:.9*p,depthWrite:!1,blending:u.AdditiveBlending})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.6*d*(1+g*(m+2)),16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF00FF",emissive:"#FF69B4",emissiveIntensity:.4*h*p,transparent:!0,opacity:.7*p,depthWrite:!1,blending:u.AdditiveBlending})]}),[.5,.7,.85,1,1.2,1.4].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[e*d*(1+g*(m+2)),.08*d,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B00FF",emissive:"#AA00FF",emissiveIntensity:h*p*.4,transparent:!0,opacity:.8*p*(1-.12*t),depthWrite:!1,blending:u.AdditiveBlending})]},t)),[...Array(16)].map((e,t)=>{let r=t/16*Math.PI*2,o=d*(1+g*(m-.5))*(1+.4*Math.random());return(0,n.jsxs)("mesh",{position:[Math.sin(r)*o,Math.cos(r)*o+(Math.random()-.5)*.6,(Math.random()-.5)*.4],children:[(0,n.jsx)("sphereGeometry",{args:[.1*d,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF00FF",emissive:"#FF69B4",emissiveIntensity:1.5*h*p,transparent:!0,opacity:.95*p,depthWrite:!1,blending:u.AdditiveBlending})]},"spark-".concat(t))}),[...Array(32)].map((e,t)=>{let r=t/32*Math.PI*2+.5*Math.random(),o=.7*d*(1+g*(m+1))*(1+.3*Math.random());return(0,n.jsxs)("mesh",{position:[Math.sin(r)*o,Math.cos(r)*o+(Math.random()-.5)*.4,(Math.random()-.5)*.3],children:[(0,n.jsx)("sphereGeometry",{args:[.05*d,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#DA70D6",emissive:"#FF1493",emissiveIntensity:1.8*h*p,transparent:!0,opacity:.9*p,depthWrite:!1,blending:u.AdditiveBlending})]},"small-spark-".concat(t))}),(0,n.jsx)("pointLight",{color:"#8B00FF",intensity:4*h*p,distance:6*d,decay:1.8}),(0,n.jsx)("pointLight",{color:"#FF00FF",intensity:2*h*p,distance:9*d,decay:1.5}),g<.15&&(0,n.jsx)("pointLight",{color:"#DA70D6",intensity:8*h*(1-6.67*g),distance:4*d,decay:1}),(0,n.jsx)("pointLight",{color:"#9932CC",intensity:1.2*h*p,distance:12*d,decay:2})]})}function S(e){let{world:t}=e,[r,h]=(0,o.useState)({crossentropy:[],entropic:[],charged:[],regular:[],barrage:[]}),[p,f]=(0,o.useState)([]),y=(0,o.useRef)(0),S=(0,o.useRef)(0),C=(0,o.useRef)(0),b=(0,o.useRef)(0),D=(0,o.useRef)(0),P=(0,o.useRef)(0),I=(0,o.useRef)(0),E=(e,r)=>{if(!t)return!1;for(let n of t.getAllEntities()){let t=n.getComponent(c.C),o=n.getComponent(d.S),i=n.getComponent(a.w);if(!t||!o||!i||o.isDead)continue;let s=new u.Vector3(r.x,0,r.z),l=new u.Vector3(i.position.x,0,i.position.z),h=s.distanceTo(l);if(h<=1.5)return console.log("⚡ EntropicBolt ".concat(e," hit enemy ").concat(n.id," at distance ").concat(h.toFixed(2))),!0}return!1},F=(e,r)=>{if(!t)return!1;for(let n of t.getAllEntities()){let t=n.getComponent(c.C),o=n.getComponent(d.S),i=n.getComponent(a.w);if(!t||!o||!i||o.isDead)continue;let s=new u.Vector3(r.x,0,r.z),l=new u.Vector3(i.position.x,0,i.position.z),h=s.distanceTo(l);if(h<=1.6)return console.log("⚔️ CrossentropyBolt ".concat(e," hit enemy ").concat(n.id," at distance ").concat(h.toFixed(2))),!0}return!1};(0,i.F)(e=>{var n,o;let i=e.clock.getElapsedTime();if(i-I.current<.016||(I.current=i,!t))return;let c=t.queryEntities([a.w,s.W,l.T]),d=[],g=[],m=[],x=[],v=[];for(let e of c){let t=e.getComponent(l.T),n=e.getComponent(a.w),o=e.getComponent(s.W);if(!(null==t?void 0:t.mesh)||!n||!o)continue;let i=t.mesh.userData,c=i.direction||o.velocity.clone().normalize();if(i.isCrossentropyBolt){let t=r.crossentropy.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),d.push(t)):(d.push({id:y.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id}),console.log("⚔️ Created new CrossentropyBolt visual for entity ".concat(e.id)))}else if(i.isEntropicBolt){let t=r.entropic.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),g.push(t)):(g.push({id:S.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id}),console.log("⚡ Created new EntropicBolt visual for entity ".concat(e.id)))}else if(i.isChargedArrow){let t=r.charged.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),m.push(t)):(m.push({id:C.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id,subclass:i.subclass,level:i.level,opacity:i.opacity||1}),console.log("\uD83C\uDFF9 Created new ChargedArrow visual for entity ".concat(e.id)))}else if(i.isBarrageArrow){let t=r.barrage.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),v.push(t)):(v.push({id:D.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id,subclass:i.subclass,level:i.level,opacity:i.opacity||1}),console.log("\uD83C\uDFF9 Created new BarrageArrow visual for entity ".concat(e.id)))}else if(i.isRegularArrow){let t=r.regular.find(t=>t.entityId===e.id);t?(t.position.copy(n.position),x.push(t)):(x.push({id:b.current++,position:n.position.clone(),direction:c.clone(),entityId:e.id,subclass:i.subclass,level:i.level,opacity:i.opacity||1}),console.log("\uD83C\uDFF9 Created new RegularArrow visual for entity ".concat(e.id)))}}let M=(null===(n=t.getEvents)||void 0===n?void 0:n.call(t,"explosion"))||[],j=[...p];for(let e of M){let t={id:P.current++,position:e.position.clone(),color:e.color||new u.Color("#00ff44"),size:e.size||1,duration:e.duration||2};j.push(t),console.log("\uD83D\uDCA5 Created optimized explosion effect (".concat(t.duration,"s) at position:"),e.position)}M.length>0&&(null===(o=t.clearEvents)||void 0===o||o.call(t,"explosion")),(d.length!==r.crossentropy.length||g.length!==r.entropic.length||m.length!==r.charged.length||x.length!==r.regular.length||v.length!==r.barrage.length||d.some(e=>!r.crossentropy.find(t=>t.entityId===e.entityId))||g.some(e=>!r.entropic.find(t=>t.entityId===e.entityId))||m.some(e=>!r.charged.find(t=>t.entityId===e.entityId))||x.some(e=>!r.regular.find(t=>t.entityId===e.entityId))||v.some(e=>!r.barrage.find(t=>t.entityId===e.entityId)))&&h({crossentropy:d,entropic:g,charged:m,regular:x,barrage:v}),j.length!==p.length&&f(j)});let R=e=>{f(t=>t.filter(t=>t.id!==e))};return(0,n.jsxs)(n.Fragment,{children:[r.crossentropy.map(e=>(0,n.jsx)(g,{id:e.id,position:e.position,direction:e.direction,checkCollisions:F,onImpact:t=>{if(console.log("⚔️ CrossentropyBolt ".concat(e.id," impact at position:"),null==t?void 0:t.toArray()),t){let e={id:P.current++,position:t.clone(),color:new u.Color("#8B00FF"),size:2.5,duration:1,type:"crossentropy",chargeTime:1};f(t=>[...t,e])}}},e.id)),r.entropic.map(e=>(0,n.jsx)(m,{id:e.id,position:e.position,direction:e.direction,checkCollisions:E,onImpact:t=>{console.log("⚡ EntropicBolt ".concat(e.id," impact at position:"),null==t?void 0:t.toArray())}},e.id)),r.charged.map(e=>(0,n.jsx)(x,{position:e.position,direction:e.direction,onImpact:()=>{console.log("\uD83C\uDFF9 ChargedArrow ".concat(e.id," impact"))}},e.id)),r.regular.map(e=>{let r=null==t?void 0:t.getEntity(e.entityId),o=null==r?void 0:r.getComponent(s.W),i=(null==o?void 0:o.distanceTraveled)||0,a=(null==o?void 0:o.maxDistance)||25;return(0,n.jsx)(v,{position:e.position,direction:e.direction,distanceTraveled:i,maxDistance:a,onImpact:()=>{console.log("\uD83C\uDFF9 RegularArrow ".concat(e.id," impact"))}},e.id)}),(0,n.jsx)(M.Z,{projectiles:r.barrage.map(e=>{let r=null==t?void 0:t.getEntity(e.entityId),n=null==r?void 0:r.getComponent(s.W),o=(null==n?void 0:n.distanceTraveled)||0,i=(null==n?void 0:n.maxDistance)||25;return{id:e.id,position:e.position,direction:e.direction,startPosition:e.position.clone(),maxDistance:i,damage:30,startTime:Date.now(),hasCollided:!1,hitEnemies:new Set,opacity:e.opacity,distanceTraveled:o}})}),p.map(e=>"crossentropy"===e.type?(0,n.jsx)(w,{position:e.position,chargeTime:e.chargeTime||.75,explosionStartTime:Date.now(),onComplete:()=>R(e.id)},e.id):(0,n.jsx)(j,{position:e.position,color:e.color,size:e.size/2,duration:e.duration,onComplete:()=>R(e.id)},e.id))]})}},6374:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(7437);r(2265);var o=r(1448);function i(e){let{projectiles:t}=e;return(0,n.jsx)(n.Fragment,{children:t.map(e=>{let t=e.distanceTraveled||e.position.distanceTo(e.startPosition),r=e.maxDistance||25,i=.7*r,a=(void 0!==e.opacity?e.opacity:1)*Math.max(.1,1-Math.max(0,Math.min(1,(t-i)/(r-i))));return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.025,.1,1.8,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#0088ff",emissive:"#0088ff",emissiveIntensity:1.2*a,transparent:!0,opacity:a})]}),[void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,0,-(.4*t)+.4],rotation:[Math.PI,0,.004*Date.now()+t*Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.1+.03*t,.04,6,10]}),(0,n.jsx)("meshStandardMaterial",{color:"#0088ff",emissive:"#0088ff",emissiveIntensity:2.5*a,transparent:!0,opacity:(.8-.1*t)*a,blending:o.AdditiveBlending})]},"barrage-ring-".concat(t))),(0,n.jsx)("pointLight",{color:"#0088ff",intensity:2.5*a,distance:4,decay:2})]})},e.id)})})}},7057:function(e,t,r){r.d(t,{Z:function(){return d}});var n=r(7437),o=r(2265),i=r(4244),a=r(1448),s=r(1276),l=r(7125),c=e=>{let{position:t,direction:r,onComplete:i,subclass:c,isElementalShotsUnlocked:d=!0,isPerfectShot:u=!1}=e,h=(0,o.useRef)(null),g=(0,o.useRef)(Date.now()),p=u?200:166,m=(0,o.useRef)(null);u&&console.log("⚡ BowPowershot: Rendering PERFECT SHOT with enhanced effects!");let f=c===l.p.VENOM?{core:"#00ff40",emissive:"#00aa20",outer:"#00ff60"}:c===l.p.ELEMENTAL?d?{core:"#ff4400",emissive:"#cc0000",outer:"#ff6600"}:{core:"#0066ff",emissive:"#0044cc",outer:"#0088ff"}:{core:"#ffffff",emissive:"#cccccc",outer:"#ffffff"};(0,s.F)(()=>{if(Date.now()-g.current>=p&&!m.current&&(m.current=Date.now()),m.current&&Date.now()-m.current>=300){i();return}});let y=m.current?Math.max(0,1-(Date.now()-m.current)/300):1;return(0,n.jsx)("group",{ref:h,position:t.toArray(),children:(0,n.jsxs)("group",{rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[u?.035:.025,u?.035:.025,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:f.core,emissive:f.emissive,emissiveIntensity:(u?15:12)*y,transparent:!0,opacity:.95*y})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[u?.08:.0625,u?.08:.0625,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:f.core,emissive:f.emissive,emissiveIntensity:(u?10:8)*y,transparent:!0,opacity:.7*y})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[u?.095:.075,u?.095:.075,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:f.outer,emissive:f.emissive,emissiveIntensity:(u?6:4)*y,transparent:!0,opacity:.5*y})]}),[...Array(u?8:6)].map((e,t)=>{let r=Math.min(1,(Date.now()-g.current)/800),o=m.current?Math.max(0,1-(Date.now()-m.current)/600):1,i=1-.1*t;return(0,n.jsxs)("group",{position:[0,0,3*t],children:[(0,n.jsxs)("mesh",{rotation:[0,.002*Date.now()+t,0],scale:[i,i,i],children:[(0,n.jsx)("torusGeometry",{args:[.4,.08,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:f.outer,emissive:f.emissive,emissiveIntensity:2*o,transparent:!0,opacity:.4*o*(1-.5*r),blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,-.003*Date.now()+t,0],scale:[.7*i,.7*i,.7*i],children:[(0,n.jsx)("torusGeometry",{args:[.3,.06,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:f.core,emissive:f.emissive,emissiveIntensity:1.5*o,transparent:!0,opacity:.3*o*(1-.3*r),blending:a.AdditiveBlending})]})]},"ring-".concat(t))}),(0,n.jsx)("pointLight",{color:f.core,intensity:(u?20:15)*y,distance:u?10:8,decay:2,position:[0,0,10]}),u&&(0,n.jsxs)(n.Fragment,{children:[[void 0,void 0,void 0,void 0].map((e,t)=>{let r=t/4*Math.PI*2;return(0,n.jsx)("group",{position:[.15*Math.sin(r+.01*Date.now()),.15*Math.cos(r+.01*Date.now()),10+2*Math.sin(.005*Date.now()+t)],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:8*y,transparent:!0,opacity:.8*y,blending:a.AdditiveBlending})]})},"lightning-".concat(t))}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.12,.12,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:2*y,transparent:!0,opacity:.3*y,blending:a.AdditiveBlending})]})]})]})})};function d(){let{activeEffects:e,removeEffect:t}=(0,i.sf)();return(0,n.jsx)(n.Fragment,{children:e.map(e=>(0,n.jsx)(c,{position:e.position,direction:e.direction,subclass:e.subclass,isElementalShotsUnlocked:e.isElementalShotsUnlocked,isPerfectShot:e.isPerfectShot,onComplete:()=>t(e.id)},e.id))})}},7019:function(e,t,r){r.r(t),r.d(t,{default:function(){return w},getGlobalCobraShotProjectiles:function(){return j},triggerGlobalCobraShot:function(){return M}});var n=r(7437),o=r(2265),i=r(1276),a=r(1448);let s=e=>{let{projectile:t}=e,r=(0,o.useRef)(null);return((0,i.F)(()=>{if(!r.current)return;r.current.position.copy(t.position);let e=t.direction.clone().normalize(),n=Math.atan2(e.x,e.z),o=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z));r.current.rotation.set(o,n,0)}),t.active)?(0,n.jsx)("group",{ref:r,children:(0,n.jsx)("pointLight",{color:"#00ff40",intensity:2*t.opacity,distance:4,decay:2})}):null};function l(e){let{projectilePool:t}=e;return(0,n.jsx)(n.Fragment,{children:t.map(e=>(0,n.jsx)(s,{projectile:e},e.id))})}var c=e=>{let{position:t,direction:r,onComplete:a,isReturning:s=!1}=e,l=(0,o.useRef)(null),c=(0,o.useRef)(Date.now()),d=(0,o.useRef)(null),u="#00ff40",h="#00aa20",g="#00ff60";(0,i.F)(()=>{if(Date.now()-c.current>=175&&!d.current&&(d.current=Date.now()),d.current&&Date.now()-d.current>=150){a();return}});let p=d.current?Math.max(0,1-(Date.now()-d.current)/400):1;return(0,n.jsxs)("group",{ref:l,position:t.toArray(),children:[(0,n.jsxs)("group",{rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:u,emissive:h,emissiveIntensity:16*p,transparent:!0,opacity:.98*p})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:h,emissiveIntensity:12*p,transparent:!0,opacity:.8*p})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.12,.12,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:g,emissive:u,emissiveIntensity:8*p,transparent:!0,opacity:.6*p})]}),[...Array(8)].map((e,t)=>{let r=Math.min(1,(Date.now()-c.current)/140),o=.8+.3*Math.sin(r*Math.PI*4+t);return(0,n.jsxs)("mesh",{position:[0,0,20*r-10],rotation:[Math.PI/2,0,(.01*Date.now()+t)%(2*Math.PI)],scale:[o,o,1],children:[(0,n.jsx)("torusGeometry",{args:[.15,.03,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:u,emissive:u,emissiveIntensity:8*p,transparent:!0,opacity:p*(1-r)*.8,blending:2,depthWrite:!1})]},t)}),[...Array(12)].map((e,t)=>{let r=Math.min(1,(Date.now()-c.current)/157.5);return(0,n.jsxs)("mesh",{position:[.5*Math.sin(r*Math.PI*6+t),0,20*r-10],scale:[.3,.3,.3],children:[(0,n.jsx)("sphereGeometry",{args:[.08,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:g,emissive:g,emissiveIntensity:10*p,transparent:!0,opacity:p*(1-r)*.6,blending:2,depthWrite:!1})]},"particle-".concat(t))})]}),(0,n.jsx)("pointLight",{color:u,intensity:8*p,distance:8,decay:1})]})},d=r(3351),u=r(8001),h=r(73),g=r(6862);let p=null,m=(e,t)=>!!p&&!!p.addVenomousEnemy&&(p.addVenomousEnemy(e,t),!0);function f(e){let{world:t}=e,[r,a]=(0,o.useState)([]),s=(0,o.useRef)(0),l=(0,o.useRef)(0),c=(0,o.useCallback)(()=>t?t.getAllEntities().filter(e=>e.hasComponent(u.C)&&e.hasComponent(h.w)&&e.hasComponent(g.S)).map(e=>{e.getComponent(u.C);let t=e.getComponent(h.w),r=e.getComponent(g.S);return{id:e.id.toString(),position:t.position.clone(),health:r.currentHealth,isDying:r.isDead,deathStartTime:r.isDead?Date.now():void 0}}):[],[t]),m=(0,o.useCallback)((e,t)=>{let r={id:s.current++,enemyId:e,position:t.clone(),startTime:Date.now(),duration:6e3};a(e=>[...e,r]),console.log("☠️ Created venom effect for enemy:",e,"at position:",t)},[]);o.useEffect(()=>(p={addVenomousEnemy:m},()=>{p=null}),[m]),(0,i.F)(e=>{let n=e.clock.getElapsedTime();if(n-l.current<.1||(l.current=n,!t))return;let o=t.getAllEntities();o.forEach(e=>{let t=e.getComponent(u.C),n=e.getComponent(h.w);t&&n&&t.isVenomous&&!r.find(t=>t.enemyId===e.id.toString())&&m(e.id.toString(),n.position)}),a(e=>e.filter(e=>{let t=o.find(t=>t.id.toString()===e.enemyId);if(!t)return!1;let r=t.getComponent(u.C),n=t.getComponent(g.S);return!!r&&!!n&&!n.isDead&&r.isVenomous}))});let f=e=>{a(t=>t.filter(t=>t.id!==e))};return(0,n.jsx)(n.Fragment,{children:r.map(e=>(0,n.jsx)(d.Z,{position:e.position,enemyId:e.enemyId,enemyData:c(),duration:e.duration,startTime:e.startTime,onComplete:()=>f(e.id)},e.id))})}var y=r(244);let x=null,v=null;function M(e,t){console.log("\uD83D\uDC0D triggerGlobalCobraShot called!",{position:e.toArray(),direction:t.toArray()}),x?(console.log("\uD83D\uDC0D Calling globalCobraShotTrigger"),x(e,t)):console.warn("\uD83D\uDC0D globalCobraShotTrigger is null - CobraShotManager may not be mounted")}function j(){return v?v():[]}function w(e){let{world:t}=e,r=(0,o.useRef)([]),s=(0,o.useRef)([]),p=(0,o.useRef)([]);(0,o.useRef)(0),(0,o.useRef)(0);let M=(0,o.useRef)(0),j=(0,o.useRef)(0);(0,o.useEffect)(()=>{r.current=[,,,].fill(null).map((e,t)=>({id:t,position:new a.Vector3,direction:new a.Vector3,startPosition:new a.Vector3,maxDistance:25,active:!1,startTime:0,hitEnemies:new Set,opacity:1,fadeStartTime:null}))},[]);let w=(0,o.useCallback)(()=>r.current.find(e=>!e.active),[]),S=(0,o.useCallback)((e,t)=>{console.log("\uD83D\uDC0D shootCobraShot called!",{position:e.toArray(),direction:t.toArray()});let r=w();if(!r){console.log("\uD83D\uDC0D No available Cobra Shot projectiles in pool");return}let n=Date.now();r.position.copy(e),r.direction.copy(t).normalize(),r.startPosition.copy(e),r.active=!0,r.startTime=n,r.hitEnemies.clear(),r.opacity=1,r.fadeStartTime=null,console.log("\uD83D\uDC0D Cobra Shot fired!",{position:e.toArray(),direction:t.toArray(),projectileId:r.id}),D(e,t)},[w]);(0,o.useEffect)(()=>(x=S,v=()=>r.current,()=>{x=null,v=null}),[S]);let C=(0,o.useCallback)(e=>{let t={id:M.current++,position:e.clone(),startTime:Date.now()};s.current.push(t),console.log("☠️ Venom effect created at",e.toArray())},[]),b=(0,o.useCallback)(e=>{s.current=s.current.filter(t=>t.id!==e)},[]),D=(0,o.useCallback)((e,t)=>{let r={id:j.current++,position:e.clone(),direction:t.clone(),startTime:Date.now()};p.current.push(r),console.log("\uD83D\uDC0D Cobra Shot beam effect created at",e.toArray())},[]),P=(0,o.useCallback)(e=>{p.current=p.current.filter(t=>t.id!==e)},[]);return(0,i.F)(()=>{let e=Date.now();r.current.forEach(r=>{if(!r.active)return;let n=e-r.startTime,o=r.direction.clone().multiplyScalar(1);r.position.add(o);let i=r.position.distanceTo(r.startPosition);if(Math.floor(n/16)%30==0&&console.log("\uD83D\uDC0D Cobra Shot projectile ".concat(r.id," at distance ").concat(i.toFixed(2)," / ").concat(25)),i>20&&!r.fadeStartTime&&(r.fadeStartTime=e),r.fadeStartTime){let t=e-r.fadeStartTime;if(r.opacity=Math.max(0,1-t/1e3),r.opacity<=0||i>25){r.active=!1,r.opacity=1,r.fadeStartTime=null,console.log("\uD83D\uDC0D Cobra Shot projectile deactivated (max distance/fade)");return}}t.getAllEntities().forEach(e=>{if(r.hitEnemies.has(e.id))return;let n=e.getComponent(u.C),o=e.getComponent(g.S),i=e.getComponent(h.w);if(n&&o&&i&&!o.isDead&&1.25>=r.position.distanceTo(i.position)){r.hitEnemies.add(e.id);let o=t.getSystem(y.b);o&&(o.queueDamage(e,29,void 0,"cobra_shot"),console.log("\uD83D\uDC0D Cobra Shot hit ".concat(n.getDisplayName()," for ").concat(29," damage")));let a=Date.now()/1e3;n.applyVenom(6,17,a),console.log("☠️ Applied venom to ".concat(n.getDisplayName()," (").concat(17," DPS for ").concat(6,"s)")),m(e.id.toString(),i.position),C(i.position),r.active=!1,r.opacity=1,r.fadeStartTime=null,console.log("\uD83D\uDC0D Cobra Shot projectile deactivated (hit enemy)")}})});let n=t.getAllEntities(),o=t.getSystem(y.b);n.forEach(t=>{let r=t.getComponent(u.C),n=t.getComponent(g.S),i=t.getComponent(h.w);if(!r||!n||!i||n.isDead)return;let a=r.updateVenomStatus(e/1e3);a.shouldDealDamage&&o&&(o.queueDamage(t,a.damage,void 0,"venom"),console.log("☠️ Venom dealt ".concat(a.damage," damage to ").concat(r.getDisplayName())),C(i.position))})}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{projectilePool:r.current}),(0,n.jsx)(f,{world:t}),s.current.map(e=>(0,n.jsx)(d.Z,{position:e.position,onComplete:()=>b(e.id)},e.id)),p.current.map(e=>(0,n.jsx)(c,{position:e.position,direction:e.direction,onComplete:()=>P(e.id)},e.id))]})}},3351:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(7437),o=r(2265),i=r(1276),a=r(1448);function s(e){let{position:t,onComplete:r,duration:s=1e3,startTime:l=Date.now(),enemyId:c,enemyData:d=[]}=e,u=(0,o.useRef)(null),h=(0,o.useRef)(l);(0,i.F)(()=>{if(!u.current)return;let e=Date.now()-h.current,t=Math.min(e/s,1);if(c&&d.length>0){let e=d.find(e=>e.id===c);if(e&&e.health>0&&!e.isDying&&!e.deathStartTime){let t=e.position.clone();t.y+=1,u.current.position.copy(t)}}let n=1+1.5*t;u.current.scale.set(n,n,n);let o=c?.8+.2*Math.sin(.01*e):1-t;u.current.children.forEach(e=>{if(e instanceof a.Mesh){let t=e.material;void 0!==t.opacity&&(t.opacity=o)}}),t>=1&&!c&&r()});let g=(0,o.useRef)(Math.random()*Math.PI*2);return(0,n.jsxs)("group",{ref:u,position:[t.x,t.y+1,t.z],rotation:[0,g.current,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.4,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#00FF44",emissive:"#00FF44",emissiveIntensity:1.5,transparent:!0,opacity:.8,depthWrite:!1,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.2,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#33FF33",emissive:"#33FF33",emissiveIntensity:2,transparent:!0,opacity:.9,depthWrite:!1,blending:a.AdditiveBlending})]}),[...Array(6)].map((e,t)=>{let r=t/6*Math.PI*2;return(0,n.jsxs)("mesh",{position:[Math.cos(r)*(.3+.2*Math.random()),.4*Math.random()-.2,Math.sin(r)*(.3+.2*Math.random())],children:[(0,n.jsx)("sphereGeometry",{args:[.15+.1*Math.random(),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#00BB33",emissive:"#00BB33",emissiveIntensity:1.5,transparent:!0,opacity:.7,depthWrite:!1,blending:a.AdditiveBlending})]},t)}),[...Array(10)].map((e,t)=>{let r=Math.random()*Math.PI*2,o=.5*Math.random();return(0,n.jsxs)("mesh",{position:[Math.cos(r)*o,.4*Math.random()-.2,Math.sin(r)*o],children:[(0,n.jsx)("sphereGeometry",{args:[.05+.04*Math.random(),6,6]}),(0,n.jsx)("meshStandardMaterial",{color:t%2==0?"#00FF44":"#55FF00",emissive:t%2==0?"#00FF44":"#55FF00",emissiveIntensity:2,transparent:!0,opacity:.8,depthWrite:!1,blending:a.AdditiveBlending})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#00FF44",intensity:1.5,distance:3,decay:2})]})}},319:function(e,t,r){r.r(t),r.d(t,{default:function(){return g},triggerGlobalViperSting:function(){return h}});var n=r(7437),o=r(2265),i=r(1448),a=r(1276);let s=e=>{let{projectile:t}=e,r=(0,o.useRef)(null);return((0,a.F)(()=>{if(!r.current)return;r.current.position.copy(t.position);let e=t.direction.clone().normalize(),n=Math.atan2(e.x,e.z),o=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z));r.current.rotation.set(o,n,0)}),t.active)?(0,n.jsxs)("group",{ref:r,children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.15,2.5,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B3F9B",emissive:"#5A2B5F",emissiveIntensity:1.2,transparent:!0,opacity:t.opacity})]}),(0,n.jsxs)("mesh",{position:[0,0,1.25],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.15,.6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#A855C7",emissive:"#7E3A9F",emissiveIntensity:1.5,transparent:!0,opacity:t.opacity})]}),[void 0,void 0].map((e,r)=>(0,n.jsx)("group",{position:[0,0,.3-.4*r],children:(0,n.jsxs)("mesh",{rotation:[0,0,.01*Date.now()+r*Math.PI/3],children:[(0,n.jsx)("torusGeometry",{args:[.15+.05*r,.02,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#A855C7",emissive:"#A855C7",emissiveIntensity:2.5,transparent:!0,opacity:.7*t.opacity,blending:i.AdditiveBlending,depthWrite:!1})]})},"ring-".concat(r))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#C084FC",emissive:"#A855C7",emissiveIntensity:3,transparent:!0,opacity:t.opacity,blending:i.AdditiveBlending,depthWrite:!1})]}),[...Array(8)].map((e,r)=>{let o=t.opacity*(1-r/8)*.6,a=1-r/8*.5;return(0,n.jsxs)("group",{position:[0,0,-(.8*(r+1))],children:[(0,n.jsxs)("mesh",{scale:[a,a,a],children:[(0,n.jsx)("sphereGeometry",{args:[.15,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#A855C7",emissive:"#A855C7",emissiveIntensity:6,transparent:!0,opacity:o,blending:i.AdditiveBlending,depthWrite:!1})]}),(0,n.jsxs)("mesh",{scale:[1.5*a,1.5*a,1.5*a],children:[(0,n.jsx)("sphereGeometry",{args:[.2,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#C084FC",emissive:"#C084FC",emissiveIntensity:3,transparent:!0,opacity:.5*o,blending:i.AdditiveBlending,depthWrite:!1})]})]},"trail-".concat(r))}),(0,n.jsx)("pointLight",{color:"#A855C7",intensity:2*t.opacity,distance:4,decay:2})]}):null};function l(e){let{projectilePool:t}=e;return(0,n.jsx)(n.Fragment,{children:t.current.filter(e=>e.active).map(e=>(0,n.jsx)(s,{projectile:e},"viper-sting-".concat(e.id)))})}var c=e=>{let{position:t,direction:r,onComplete:s,isReturning:l=!1}=e,c=(0,o.useRef)(null),d=(0,o.useRef)(Date.now()),u=(0,o.useRef)(null),h="#8B3F9B",g="#A855C7",p="#C084FC";(0,a.F)(()=>{if(Date.now()-d.current>=200&&!u.current&&(u.current=Date.now()),u.current&&Date.now()-u.current>=250){s();return}});let m=u.current?Math.max(0,1-(Date.now()-u.current)/350):1;return(0,n.jsx)("group",{ref:c,position:t.toArray(),children:(0,n.jsxs)("group",{rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.03,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:g,emissiveIntensity:14*m,transparent:!0,opacity:.95*m})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.07,.07,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:g,emissive:g,emissiveIntensity:9*m,transparent:!0,opacity:.7*m})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.09,.09,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:p,emissive:h,emissiveIntensity:5*m,transparent:!0,opacity:.5*m})]}),[...Array(7)].map((e,t)=>{let r=Math.min(1,(Date.now()-d.current)/900),o=u.current?Math.max(0,1-(Date.now()-u.current)/700):1,a=1-.08*t;return(0,n.jsxs)("group",{position:[0,0,2.8*t],children:[(0,n.jsxs)("mesh",{rotation:[0,.0025*Date.now()+t,0],scale:[a,a,a],children:[(0,n.jsx)("torusGeometry",{args:[.35,.07,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:p,emissive:g,emissiveIntensity:2.5*o,transparent:!0,opacity:.45*o*(1-.4*r),blending:i.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,-.0035*Date.now()+t,0],scale:[.75*a,.75*a,.75*a],children:[(0,n.jsx)("torusGeometry",{args:[.28,.05,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:g,emissiveIntensity:1.8*o,transparent:!0,opacity:.35*o*(1-.25*r),blending:i.AdditiveBlending})]})]},"ring-".concat(t))}),[...Array(6)].map((e,t)=>{let r=t/6*Math.PI*2,o=.05*Math.sin(.003*Date.now()+t);return(0,n.jsx)("group",{position:[.12*Math.sin(r+.002*Date.now()),.12*Math.cos(r+.002*Date.now())+o,8+3*Math.sin(.004*Date.now()+t)],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.025,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:p,emissive:p,emissiveIntensity:6*m,transparent:!0,opacity:.7*m,blending:i.AdditiveBlending})]})},"venom-particle-".concat(t))}),(0,n.jsx)("pointLight",{color:g,intensity:18*m,distance:9,decay:2,position:[0,0,10]}),l&&(0,n.jsxs)(n.Fragment,{children:[[void 0,void 0,void 0,void 0,void 0].map((e,t)=>{let r=t/5*Math.PI*2;return(0,n.jsx)("group",{position:[.18*Math.sin(r+.012*Date.now()),.18*Math.cos(r+.012*Date.now()),10+2.5*Math.sin(.006*Date.now()+t)],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#E879F9",emissive:"#E879F9",emissiveIntensity:10*m,transparent:!0,opacity:.9*m,blending:i.AdditiveBlending})]})},"soul-energy-".concat(t))}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],position:[0,0,10],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.15,20,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#E879F9",emissive:"#E879F9",emissiveIntensity:3*m,transparent:!0,opacity:.4*m,blending:i.AdditiveBlending})]})]})]})})};let d=()=>{let[e,t]=(0,o.useState)([]),r=(0,o.useRef)(1);return{activeEffects:e,createBeamEffect:(0,o.useCallback)(function(e,n){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=r.current++,a={id:i,position:e.clone(),direction:n.clone().normalize(),isReturning:o,startTime:Date.now()};return t(e=>[...e,a]),i},[]),removeEffect:(0,o.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]),clearAllEffects:(0,o.useCallback)(()=>{t([])},[])}},u={},h=()=>!!u.shootViperSting&&u.shootViperSting();function g(e){let{parentRef:t,enemyData:r,onHit:a,setDamageNumbers:s,nextDamageNumberId:h,onHealthChange:g,charges:p,setCharges:m}=e,[f,y]=(0,o.useState)([]);(0,o.useRef)(0);let{activeEffects:x,createBeamEffect:v,removeEffect:M}=d(),{shootViperSting:j,projectilePool:w}=function(e){let{parentRef:t,onHit:r,enemyData:n,setDamageNumbers:a,nextDamageNumberId:s,onHealthChange:l,createBeamEffect:c,applyDoT:d,charges:u,setCharges:h}=e,g=(0,o.useRef)([]),p=(0,o.useRef)([]),m=(0,o.useRef)(0),f=(0,o.useRef)(0),y=(0,o.useRef)(0);(0,o.useEffect)(()=>{g.current=[,,,].fill(null).map((e,t)=>({id:t,position:new i.Vector3,direction:new i.Vector3,startPosition:new i.Vector3,maxDistance:20,active:!1,startTime:0,hitEnemies:new Set,opacity:1,fadeStartTime:null,isReturning:!1,returnHitEnemies:new Set}))},[]);let x=(0,o.useCallback)(()=>g.current.find(e=>!e.active),[]),v=(0,o.useCallback)(()=>{let e=Date.now();if(e-m.current<2e3||!t.current)return!1;let r=x();if(!r)return!1;m.current=e;let n=t.current.position.clone();n.y+=0;let o=new i.Vector3(0,0,1);return t.current.quaternion&&"number"==typeof t.current.quaternion.x?o.applyQuaternion(t.current.quaternion):o.set(0,0,1),r.position.copy(n),r.direction.copy(o),r.startPosition.copy(n),r.startTime=e,r.active=!0,r.hitEnemies.clear(),r.returnHitEnemies.clear(),r.opacity=1,r.fadeStartTime=null,r.isReturning=!1,r.id=f.current++,c&&c(n,o,!1),!0},[c,t,x,u,h]),M=(0,o.useCallback)(e=>{if(!t.current)return;let r={id:y.current++,position:e.clone(),targetPosition:t.current.position.clone(),startTime:Date.now(),duration:1250,active:!0};p.current.push(r)},[t]);return(0,o.useEffect)(()=>{let e;let o=()=>{let l=Date.now();g.current.forEach(e=>{if(e.active){if(e.fadeStartTime){let t=(l-e.fadeStartTime)/500;if(e.opacity=Math.max(0,1-t),t>=1){e.active=!1;return}}if(e.isReturning){if(!t.current)return;if(e.position.distanceTo(e.startPosition)>1.5&&!e.fadeStartTime)for(let t of(e.position.add(e.direction.clone().multiplyScalar(.75)),n)){if(t.isDying||t.health<=0||e.returnHitEnemies.has(t.id))continue;let n=new i.Vector3(e.position.x,0,e.position.z),o=new i.Vector3(t.position.x,0,t.position.z);1.3>n.distanceTo(o)&&(e.returnHitEnemies.add(t.id),r(t.id,61),d&&d(t.id),a(e=>[...e,{id:s.current++,damage:61,position:t.position.clone(),isCritical:!1,isViperSting:!0}]),M(t.position))}else e.fadeStartTime||(e.fadeStartTime=l)}else if(e.position.distanceTo(e.startPosition)<e.maxDistance&&!e.fadeStartTime)for(let t of(e.position.add(e.direction.clone().multiplyScalar(.75)),n)){if(t.isDying||t.health<=0||e.hitEnemies.has(t.id))continue;let n=new i.Vector3(e.position.x,0,e.position.z),o=new i.Vector3(t.position.x,0,t.position.z);1.3>n.distanceTo(o)&&(e.hitEnemies.add(t.id),r(t.id,61),d&&d(t.id),a(e=>[...e,{id:s.current++,damage:61,position:t.position.clone(),isCritical:!1,isViperSting:!0}]),M(t.position))}else!e.fadeStartTime&&(e.isReturning=!0,e.direction=new i.Vector3().subVectors(e.startPosition,e.position).normalize(),c&&c(e.position,e.direction,!0))}}),g.current.some(e=>e.active)&&(e=requestAnimationFrame(o))};return e=requestAnimationFrame(o),()=>{cancelAnimationFrame(e)}},[n,r,a,s,l,M,t,c,d]),{shootViperSting:v,projectilePool:g,soulStealEffects:p}}({parentRef:t,onHit:a,enemyData:r,setDamageNumbers:s,nextDamageNumberId:h,onHealthChange:g,createBeamEffect:v,applyDoT:e=>{},charges:p,setCharges:m});return(0,o.useEffect)(()=>(u.shootViperSting=j,()=>{u={}}),[j]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{projectilePool:w}),x.map(e=>(0,n.jsx)(c,{position:e.position,direction:e.direction,isReturning:e.isReturning,onComplete:()=>M(e.id)},e.id))]})}},4244:function(e,t,r){r.d(t,{sf:function(){return c}});var n=r(2265);let o=[],i=1,a=null,s=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=!(arguments.length>4)||void 0===arguments[4]||arguments[4],l=i++,c={id:l,position:e.clone(),direction:t.clone().normalize(),subclass:r,isElementalShotsUnlocked:s,isPerfectShot:n,startTime:Date.now()};return o=[...o,c],a&&a(o),l},l=e=>{o=o.filter(t=>t.id!==e),a&&a(o)},c=()=>{let[e,t]=(0,n.useState)(o);return a=t,{activeEffects:e,createPowershotEffect:(0,n.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4)||void 0===arguments[4]||arguments[4];return s(e,t,r,n,o)},[]),removeEffect:(0,n.useCallback)(e=>{l(e)},[]),clearAllEffects:(0,n.useCallback)(()=>{o=[],t([])},[])}}},2295:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(7437),o=r(2265),i=r(7125);function a(e){let{content:t,visible:r,x:o,y:i}=e;return r?(0,n.jsxs)("div",{className:"fixed z-50 bg-gray-900 border border-gray-600 rounded-lg p-3 text-white text-sm max-w-xs pointer-events-none",style:{left:o-150,top:i-80,transform:"translateX(-50%)"},children:[(0,n.jsx)("div",{className:"font-semibold text-blue-300 mb-1",children:t.name}),(0,n.jsx)("div",{className:"text-gray-300",children:t.description})]}):null}function s(e){let{currentWeapon:t,controlSystem:r}=e,[s,l]=(0,o.useState)(null),[c,d]=(0,o.useState)({x:0,y:0}),[u,h]=(0,o.useState)({}),[g,p]=(0,o.useState)({current:0,max:5}),m=[{name:"Sword",type:i.v.SWORD,key:"1",icon:"⚔️"},{name:"Bow",type:i.v.BOW,key:"2",icon:"\uD83C\uDFF9"},{name:"Scythe",type:i.v.SCYTHE,key:"3",icon:"⚡"},{name:"Sabres",type:i.v.SABRES,key:"4",icon:"⚔️"}],f={[i.v.SWORD]:[{name:"Deflect Barrier",key:"Q",cooldown:8,currentCooldown:0,description:"Creates a protective barrier that blocks damage and reflects projectiles for 3 seconds."},{name:"Charge",key:"E",cooldown:3,currentCooldown:0,description:"Dash forward 10.5 units, gaining 20 rage. Can damage enemies in your path."},{name:"Divine Storm",key:"R",cooldown:4,currentCooldown:0,description:"Consumes all rage (min 20) to create a devastating storm. Duration: 4s + 1s per 10 rage consumed."}],[i.v.BOW]:[{name:"Barrage",key:"Q",cooldown:5,currentCooldown:0,description:"Fires 5 arrows in a spread pattern after a short charge. High damage per arrow."},{name:"Cobra Shot",key:"E",cooldown:2,currentCooldown:0,description:"Fires a venomous green arrow that applies poison damage over time to enemies."},{name:"Viper Sting",key:"R",cooldown:7,currentCooldown:0,description:"Charges for 1 second then fires a powerful piercing projectile with special effects."}],[i.v.SCYTHE]:[{name:"Reanimate",key:"Q",cooldown:1,currentCooldown:0,description:"Costs 20 mana. Heals 20 HP and creates visual healing effects around the player."},{name:"Entropic Bolt",key:"E",cooldown:.5,currentCooldown:0,description:"Fires a chaotic bolt that moves erratically and deals high damage to enemies."},{name:"Crossentropy Bolt",key:"R",cooldown:1,currentCooldown:0,description:"Costs 40 mana. Fires a slow, high-damage piercing projectile with extended range."}],[i.v.SABRES]:[{name:"Backstab",key:"Q",cooldown:2,currentCooldown:0,description:"Deals 75 damage to enemies in front (175 if attacking from behind). Costs 60 energy."},{name:"Skyfall",key:"E",cooldown:4,currentCooldown:0,description:"Leap high into the air and crash down, dealing 150 damage to enemies below. Costs 40 energy."},{name:"Not Assigned",key:"R",cooldown:0,currentCooldown:0,description:"No ability assigned to this slot yet."}],[i.v.SPEAR]:[]};(0,o.useEffect)(()=>{if(!r||!r.getAbilityCooldowns)return;let e=()=>{let e=r.getAbilityCooldowns(),t={};Object.keys(e).forEach(r=>{t[r]=e[r].current}),h(t),r.getWeaponSwitchCooldown&&p(r.getWeaponSwitchCooldown())},t=setInterval(e,100);return e(),()=>clearInterval(t)},[r,t]);let y=(e,t)=>{let r=e.currentTarget.getBoundingClientRect();l({name:t.name,description:t.description}),d({x:r.left+r.width/2,y:r.top})},x=(e,t)=>{let r=e.currentTarget.getBoundingClientRect();l({name:t.name,description:"Switch to ".concat(t.name," (").concat(t.key,")")}),d({x:r.left+r.width/2,y:r.top})},v=()=>{l(null)},M=f[t]||[];return 0===M.length?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-40",children:(0,n.jsx)("div",{className:"bg-black bg-opacity-70 backdrop-blur-sm rounded-lg p-3 border border-gray-600",children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[m.map(e=>{let r=e.type===t,o=g.current>0;return g.max>0&&(g.current,g.max),(0,n.jsxs)("div",{className:"relative w-12 h-12 rounded-lg border-2 transition-all duration-200 ".concat(r?"border-yellow-400 bg-yellow-900 bg-opacity-50":o?"border-red-500 bg-red-900 bg-opacity-30":"border-gray-400 bg-gray-900 bg-opacity-30 hover:bg-opacity-50"," cursor-pointer flex items-center justify-center"),onMouseEnter:t=>x(t,e),onMouseLeave:v,children:[(0,n.jsx)("div",{className:"absolute -top-2 -left-2 bg-gray-800 border border-gray-600 rounded text-xs text-white px-1 py-0.5 font-semibold",children:e.key}),(0,n.jsx)("div",{className:"text-2xl ".concat(r?"text-yellow-400":o?"text-red-400":"text-gray-300"),children:e.icon}),o&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-60 rounded-lg"}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-white text-sm font-bold bg-black bg-opacity-60 rounded px-1",children:Math.ceil(g.current)})})]})]},e.key)}),(0,n.jsx)("div",{className:"w-px h-8 bg-gray-600"}),M.map(e=>{var o,a;let s=u[e.key]||0;e.cooldown>0&&e.cooldown;let l=s>0,c="Not Assigned"===e.name;return(0,n.jsxs)("div",{className:"relative w-12 h-12 rounded-lg border-2 transition-all duration-200 ".concat(c?"border-gray-600 bg-gray-800 opacity-50":l?"border-red-500 bg-red-900 bg-opacity-30":"border-green-400 bg-green-900 bg-opacity-30 hover:bg-opacity-50"," cursor-pointer flex items-center justify-center"),onMouseEnter:t=>y(t,e),onMouseLeave:v,children:[(0,n.jsx)("div",{className:"absolute -top-2 -left-2 bg-gray-800 border border-gray-600 rounded text-xs text-white px-1 py-0.5 font-semibold",children:e.key}),(0,n.jsx)("div",{className:"w-8 h-8 rounded flex items-center justify-center text-lg font-bold ".concat(c?"text-gray-500":l?"text-red-400":"text-green-400"),children:(o=e.key,(null===(a=({[i.v.SWORD]:{Q:"\uD83D\uDEE1️",E:"⚡",R:"\uD83C\uDF2A️"},[i.v.BOW]:{Q:"\uD83C\uDFF9",E:"\uD83D\uDC0D",R:"\uD83D\uDC0D"},[i.v.SCYTHE]:{Q:"\uD83D\uDC9A",E:"⚡",R:"⚔️"},[i.v.SABRES]:{Q:"\uD83D\uDDE1️",E:"\uD83C\uDF1F",R:"❓"},[i.v.SPEAR]:{Q:"❓",E:"❓",R:"❓"}})[t])||void 0===a?void 0:a[o])||"❓")}),l&&!c&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-white text-sm font-bold bg-black bg-opacity-60 rounded px-1",children:Math.ceil(s)})})}),(()=>{var o,a,s,l,c,d,u;if(!r||!r.getAbilityCooldowns)return null;let h=r.getAbilityCooldowns()[e.key];if(h&&h.isActive)return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-yellow-400 bg-opacity-20 border-2 border-yellow-400 animate-pulse"});if("R"===e.key&&t===i.v.BOW&&(null===(o=r.isViperStingChargingActive)||void 0===o?void 0:o.call(r))){let e=(null===(c=r.getViperStingChargeProgress)||void 0===c?void 0:c.call(r))||0;return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-purple-400 bg-opacity-20 border-2 border-purple-400",children:(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-purple-400 bg-opacity-60 transition-all duration-100",style:{height:"".concat(100*e,"%")}})})}if("Q"===e.key&&t===i.v.BOW&&(null===(a=r.isBarrageChargingActive)||void 0===a?void 0:a.call(r))){let e=(null===(d=r.getBarrageChargeProgress)||void 0===d?void 0:d.call(r))||0;return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-orange-400 bg-opacity-20 border-2 border-orange-400",children:(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-orange-400 bg-opacity-60 transition-all duration-100",style:{height:"".concat(100*e,"%")}})})}if("E"===e.key&&t===i.v.BOW&&(null===(s=r.isCobraShotChargingActive)||void 0===s?void 0:s.call(r))){let e=(null===(u=r.getCobraShotChargeProgress)||void 0===u?void 0:u.call(r))||0;return(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-green-400 bg-opacity-20 border-2 border-green-400",children:(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-green-400 bg-opacity-60 transition-all duration-100",style:{height:"".concat(100*e,"%")}})})}return"E"===e.key&&t===i.v.SABRES&&(null===(l=r.isSkyfallActive)||void 0===l?void 0:l.call(r))?(0,n.jsx)("div",{className:"absolute inset-0 rounded-lg bg-yellow-400 bg-opacity-20 border-2 border-yellow-400 animate-pulse"}):null})()]},e.key)})]})})}),s&&(0,n.jsx)(a,{content:s,visible:!0,x:c.x,y:c.y})]})}function l(e){let{current:t,max:r,color:o,backgroundColor:i="#333"}=e,a=Math.max(0,Math.min(100,t/r*100));return(0,n.jsx)("div",{className:"w-full",children:(0,n.jsxs)("div",{className:"w-full h-6 rounded-lg border-2 border-gray-600 overflow-hidden relative",style:{backgroundColor:i},children:[(0,n.jsx)("div",{className:"h-full transition-all duration-300 ease-out rounded-sm",style:{width:"".concat(a,"%"),backgroundColor:o,boxShadow:"0 0 10px ".concat(o,"40")}}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsxs)("span",{className:"text-sm text-white font-medium drop-shadow-lg",children:[Math.round(t),"/",r]})})]})})}function c(e){let{currentWeapon:t,playerHealth:r,maxHealth:a,playerShield:c=200,maxShield:d=200,mana:u=200,maxMana:h=200,energy:g=100,maxEnergy:p=100,rage:m=0,maxRage:f=100,controlSystem:y}=e,[x,v]=(0,o.useState)(u),[M,j]=(0,o.useState)(g),[w,S]=(0,o.useState)(m),[C,b]=(0,o.useState)(Date.now());(0,o.useEffect)(()=>{if(t===i.v.SCYTHE){let e=setInterval(()=>{v(e=>Math.min(h,e+4))},500);return()=>clearInterval(e)}},[t,h]),(0,o.useEffect)(()=>{if(t===i.v.BOW||t===i.v.SABRES){let e=setInterval(()=>{j(e=>Math.min(p,e+7))},500);return()=>clearInterval(e)}},[t,p]),(0,o.useEffect)(()=>{if(t===i.v.SWORD){let e=setInterval(()=>{Date.now()-C>6e3&&S(e=>Math.max(0,e-5))},1e3);return()=>clearInterval(e)}},[t,C]),(0,o.useEffect)(()=>{t===i.v.SCYTHE?(v(h),j(p),S(0)):t===i.v.SWORD?(S(0),v(h),j(p),b(Date.now())):(t===i.v.BOW||t===i.v.SABRES)&&(j(p),v(h),S(0))},[t,h,p,f]);let D=e=>{t===i.v.SCYTHE&&v(t=>Math.max(0,t-e))},P=e=>{(t===i.v.BOW||t===i.v.SABRES)&&j(t=>Math.max(0,t-e))},I=e=>{t===i.v.SWORD&&(S(t=>Math.min(f,t+e)),b(Date.now()))},E=e=>{t===i.v.SWORD&&S(t=>Math.max(0,t-e))},F=()=>{t===i.v.SWORD&&S(0)};return(0,o.useEffect)(()=>{window.gameUI={consumeMana:D,consumeEnergy:P,gainRage:I,consumeRage:E,consumeAllRage:F,getCurrentMana:()=>x,getCurrentEnergy:()=>M,getCurrentRage:()=>w,canCastCrossentropy:()=>x>=40,canCastEntropicBolt:()=>x>=10,canCastCrossentropyBolt:()=>x>=40,canCastReanimate:()=>x>=20,canCastFrostNova:()=>x>=25,canCastDivineStorm:()=>w>=40,canCastBarrage:()=>M>=40,canCastCobraShot:()=>M>=40,canCastViperSting:()=>M>=60,canCastBackstab:()=>M>=60,canCastSkyfall:()=>M>=40}},[x,M,w,t]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed bottom-32 left-1/2 transform -translate-x-1/2 z-50",children:(0,n.jsxs)("div",{className:"bg-black bg-opacity-60 backdrop-blur-sm rounded-lg p-4 border border-gray-600 min-w-80",children:[(0,n.jsx)("div",{className:"w-full mb-2",children:(0,n.jsxs)("div",{className:"w-full h-3 rounded-lg border border-blue-500 overflow-hidden relative",style:{backgroundColor:"#1a2332"},children:[(0,n.jsx)("div",{className:"h-full transition-all duration-300 ease-out rounded-sm",style:{width:"".concat(Math.max(0,Math.min(100,c/d*100)),"%"),backgroundColor:"#4A90E2",boxShadow:"0 0 8px #4A90E240"}}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsxs)("span",{className:"text-xs text-white font-medium drop-shadow-lg",children:[Math.round(c),"/",d]})})]})}),(0,n.jsx)("div",{className:"mb-2",children:(0,n.jsx)(l,{current:r,max:a,color:"#DC2626",backgroundColor:"#331a1a"})}),(()=>{switch(t){case i.v.SCYTHE:return(0,n.jsx)(l,{current:x,max:h,color:"#4A90E2",backgroundColor:"#1a2332"});case i.v.SWORD:return(0,n.jsx)(l,{current:w,max:f,color:"#FF6B35",backgroundColor:"#332318"});case i.v.BOW:case i.v.SABRES:return(0,n.jsx)(l,{current:M,max:p,color:"#FFD700",backgroundColor:"#332b18"});default:return null}})()]})}),(0,n.jsx)(s,{currentWeapon:t,controlSystem:y})]})}},4954:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),o=r(2265),i=r(946);function a(e){let{onJoinSuccess:t,currentWeapon:r,currentSubclass:a,gameMode:s="multiplayer"}=e,{joinRoom:l,isConnected:c,isInRoom:d,connectionError:u,players:h,previewRoom:g,clearPreview:p,currentPreview:m,startGame:f,gameStarted:y}=(0,i.p)(),[x,v]=(0,o.useState)("default"),[M,j]=(0,o.useState)(""),[w,S]=(0,o.useState)(!1),[C,b]=(0,o.useState)(!1),[D,P]=(0,o.useState)(!1);(0,o.useEffect)(()=>{m&&P(!1)},[m]);let I=async()=>{if(!M.trim()){alert("Please enter a player name");return}S(!0);try{await l(x,M.trim(),r,a,s),p(),b(!1),setTimeout(()=>{S(!1)},1e3)}catch(e){console.error("Failed to join room:",e),S(!1)}},E=()=>{b(!1),p()};return d?(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/95 p-8 rounded-xl border-2 ".concat("pvp"===s?"border-red-500":"border-green-500"," text-white max-w-md w-11/12 z-50 text-center"),children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-4",children:["pvp"===s?"PVP":"Multiplayer"," Room: ",x]}),(0,n.jsxs)("p",{className:"mb-4",children:["Players connected: ",h.size,"/5"]}),(0,n.jsx)("div",{className:"flex flex-col gap-3 mb-6",children:Array.from(h.values()).map(e=>(0,n.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white/10 rounded-lg border border-gray-600",children:[(0,n.jsx)("span",{className:"font-bold text-green-500",children:e.name}),(0,n.jsxs)("span",{className:"text-orange-500 capitalize",children:["(",e.weapon,")"]}),(0,n.jsxs)("span",{className:"text-red-400 font-mono",children:[e.health,"/",e.maxHealth," HP"]})]},e.id))}),(0,n.jsx)("button",{className:"w-full px-8 py-4 text-xl ".concat("pvp"===s?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"," text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:-translate-y-1"),onClick:()=>{f(),t()},disabled:!1,children:y?"Join Game":"Start ".concat("pvp"===s?"PVP":"Game")})]}):C&&m?(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/95 p-8 rounded-xl border-2 ".concat("pvp"===s?"border-red-500":"border-green-500"," text-white max-w-2xl w-11/12 z-50"),children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-6",children:["pvp"===s?"PVP":"Multiplayer"," Room Preview: ",m.roomId]}),m.exists?(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,n.jsxs)("div",{className:"flex justify-around bg-white/5 p-4 rounded-lg mb-4",children:[(0,n.jsxs)("p",{className:"m-0 font-bold text-green-500",children:["Players: ",m.playerCount,"/",m.maxPlayers]}),"pvp"!==s&&(0,n.jsxs)("p",{className:"m-0 font-bold text-green-500",children:["Enemies: ",m.enemies.length]}),"pvp"===s&&(0,n.jsx)("p",{className:"m-0 font-bold text-red-500",children:"Mode: Player vs Player"})]}),m.playerCount>0?(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsx)("h3",{className:"text-lg font-bold",children:"Players in Room:"}),m.players.map(e=>(0,n.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white/10 rounded-lg border border-gray-600",children:[(0,n.jsx)("span",{className:"font-bold text-green-500",children:e.name}),(0,n.jsxs)("span",{className:"text-orange-500 capitalize",children:["(",e.weapon,")"]}),(0,n.jsxs)("span",{className:"text-red-400 font-mono",children:[e.health,"/",e.maxHealth," HP"]})]},e.id))]}):(0,n.jsx)("div",{className:"text-center p-8 bg-white/5 rounded-lg text-gray-300",children:(0,n.jsx)("p",{children:"This room is empty. You'll be the first player!"})}),(0,n.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-green-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-green-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:I,disabled:w||!M.trim()||m.playerCount>=m.maxPlayers,children:w?"Joining...":m.playerCount>=m.maxPlayers?"Room Full":"Join This Room"}),(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-gray-600 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-gray-500 hover:-translate-y-1 disabled:bg-gray-800 disabled:cursor-not-allowed disabled:transform-none",onClick:E,disabled:w,children:"Back"})]})]}):(0,n.jsxs)("div",{className:"text-center p-8 bg-white/5 rounded-lg text-gray-300",children:[(0,n.jsx)("p",{children:"This room doesn't exist yet. You'll create it when you join!"}),(0,n.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-green-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-green-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:I,disabled:w||!M.trim(),children:w?"Creating Room...":"Create & Join Room"}),(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-gray-600 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-gray-500 hover:-translate-y-1 disabled:bg-gray-800 disabled:cursor-not-allowed disabled:transform-none",onClick:E,disabled:w,children:"Back"})]})]})]}):(0,n.jsxs)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/95 p-8 rounded-xl border-2 ".concat("pvp"===s?"border-red-500":"border-green-500"," text-white max-w-lg w-11/12 z-50"),children:[(0,n.jsxs)("h2",{className:"text-2xl font-bold mb-2",children:["Join ","pvp"===s?"PVP":"Multiplayer"," Game"]}),(0,n.jsx)("p",{className:"mb-6 text-gray-300",children:"pvp"===s?"Battle against other players":"Play with up to 5 players per room"}),(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("label",{htmlFor:"playerName",className:"font-bold text-green-500",children:"Your Name:"}),(0,n.jsx)("input",{id:"playerName",type:"text",value:M,onChange:e=>j(e.target.value),placeholder:"Enter your name",maxLength:20,disabled:w,className:"p-3 border-2 border-gray-600 rounded-lg bg-white/10 text-white text-base focus:outline-none focus:border-green-500 focus:bg-white/15 disabled:opacity-60 disabled:cursor-not-allowed"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("label",{htmlFor:"roomId",className:"font-bold text-green-500",children:"Room ID:"}),(0,n.jsx)("input",{id:"roomId",type:"text",value:x,onChange:e=>v(e.target.value),placeholder:"Room ID (e.g., 'default', 'room1')",maxLength:50,disabled:w,className:"p-3 border-2 border-gray-600 rounded-lg bg-white/10 text-white text-base focus:outline-none focus:border-green-500 focus:bg-white/15 disabled:opacity-60 disabled:cursor-not-allowed"})]}),u&&(0,n.jsxs)("div",{className:"bg-red-500/20 border border-red-400 text-red-400 p-4 rounded-lg text-center",children:["Error: ",u]}),(0,n.jsxs)("div",{className:"text-center p-2 rounded-lg bg-white/10 font-bold",children:["Status: ",c?"Connected":"Connecting..."]}),(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-blue-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-blue-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:()=>{if(!x.trim()){alert("Please enter a room ID");return}if(!c){alert("Not connected to server. Please wait for connection.");return}console.log("Previewing room:",x.trim()),P(!0),g(x.trim()),b(!0),setTimeout(()=>{D&&(P(!1),alert("Room preview timed out. Please try again."),b(!1))},5e3)},disabled:!c||!x.trim()||D,children:D?"Loading...":"Preview Room"}),(0,n.jsx)("button",{className:"flex-1 px-8 py-4 text-lg bg-green-500 text-white border-none rounded-lg cursor-pointer transition-all duration-300 font-bold hover:bg-green-600 hover:-translate-y-1 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none",onClick:I,disabled:w||!c||!M.trim(),children:w?"Joining...":"Join Directly"})]}),(0,n.jsxs)("div",{className:"bg-white/5 p-4 rounded-lg text-sm",children:[(0,n.jsx)("p",{className:"m-0 mb-2 font-bold ".concat("pvp"===s?"text-red-500":"text-green-500"),children:"Tips:"}),(0,n.jsxs)("ul",{className:"m-0 pl-6",children:[(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Use the same Room ID to play with friends"}),(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Maximum 5 players per room"}),"pvp"===s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Fight against other players to win"}),(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"No AI enemies - only player vs player combat"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"All players fight the same enemies together"}),(0,n.jsx)("li",{className:"mb-1 text-gray-300",children:"Damage and kills are shared across all players"})]})]})]})]})]})}},8815:function(e,t,r){r.d(t,{l:function(){return l}});var n=r(1448),o=r(73),i=r(3478),a=r(1168),s=r(6862);class l{updatePosition(e,t){if(!this.isActive||!this.entity)return;this.playerPosition.copy(e),this.playerRotation.copy(t);let r=new n.Vector3(Math.sin(t.y),0,-Math.cos(t.y)),i=e.clone().add(r.multiplyScalar(2.5));i.y+=.5;let a=this.entity.getComponent(o.w);a&&(a.setPosition(i.x,i.y,i.z),a.setRotation(t.x,t.y,t.z))}activate(e,t,r){if(this.isActive)return;if(this.playerPosition.copy(e),this.playerRotation.copy(t),this.playerEntity=r||null,this.isActive=!0,this.playerEntity){let e=this.playerEntity.getComponent(s.S);e&&e.setInvulnerable(3)}this.entity=this.world.createEntity();let a=new n.Vector3(Math.sin(t.y),0,-Math.cos(t.y)),l=e.clone().add(a.multiplyScalar(2.5));l.y+=.5;let c=new o.w;c.setPosition(l.x,l.y,l.z),c.setRotation(t.x,t.y,t.z),this.entity.addComponent(c);let d=new i.YM(i.F5.SPHERE,3);d.layer=i.aB.PLAYER,d.isTrigger=!0,d.onTriggerEnter=(e,t)=>{this.handleProjectileCollision(t)},this.entity.addComponent(d),console.log("\uD83D\uDEE1️ Deflect barrier activated at position:",l)}deactivate(){this.isActive&&this.entity&&(this.world.destroyEntity(this.entity.id),this.entity=null,this.isActive=!1,console.log("\uD83D\uDEE1️ Deflect barrier deactivated"))}handleProjectileCollision(e){let t=e.getComponent(a.W);if(!t)return;let r=e.getComponent(o.w);if(!r)return;console.log("\uD83D\uDEE1️ Deflect barrier hit by projectile!");let n=r.getWorldPosition(),i=this.entity.getComponent(o.w).getWorldPosition(),s=n.clone().sub(i).normalize(),l=t.velocity.clone().reflect(s);t.velocity.copy(l),t.owner=-2,t.hitTargets.clear(),t.lifetime=0,console.log("\uD83D\uDD04 Projectile reflected! New velocity:",l)}isBarrierActive(){return this.isActive}getBarrierPosition(){if(!this.entity)return null;let e=this.entity.getComponent(o.w);return e?e.getWorldPosition():null}constructor(e){this.entity=null,this.isActive=!1,this.playerEntity=null,this.world=e,this.playerPosition=new n.Vector3,this.playerRotation=new n.Vector3}}},6663:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(7437),o=r(2265),i=r(1276),a=r(1448);function s(e){let{isActive:t,duration:r,onComplete:s,playerPosition:l=new a.Vector3(0,0,0),playerRotation:c=new a.Vector3(0,0,0),dragonGroupRef:d}=e,u=(0,o.useRef)(null),h=(0,o.useRef)(null),g=(0,o.useRef)(0);return((0,o.useEffect)(()=>{t?(h.current=Date.now(),g.current=0,console.log("\uD83D\uDEE1️ Deflect shield activated!")):(h.current=null,g.current=0)},[t]),(0,i.F)((e,n)=>{if(!u.current||!t||!h.current)return;let o=(Date.now()-h.current)/1e3,i=Math.min(o/r,1);g.current=i;let p=l,m=c;(null==d?void 0:d.current)&&(p=d.current.position,m=new a.Vector3(d.current.rotation.x,d.current.rotation.y,d.current.rotation.z));let f=new a.Vector3(Math.sin(m.y),0,Math.cos(m.y-.75)),y=p.clone().add(f.multiplyScalar(2.5));y.y+=.25,u.current.position.copy(y),u.current.rotation.set(m.x,m.y,m.z);let x=1;i<.1?x=i/.1:i>.9&&(x=1-(i-.9)/.1),u.current.scale.setScalar(.325),u.current.traverse(e=>{e.material&&(e.material.opacity=x)});let v=1+.3*Math.sin(8*o);u.current.traverse(e=>{e.material&&void 0!==e.material.emissiveIntensity&&(e.material.emissiveIntensity=v)}),i>=1&&(console.log("\uD83D\uDEE1️ Deflect shield duration complete"),null==s||s())}),t)?(0,n.jsxs)("group",{ref:u,children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[3,3,.1,32]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16766720),emissive:new a.Color(16753920),emissiveIntensity:1.5,transparent:!0,opacity:.7,side:a.DoubleSide,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[2.2,2.2,.05,32]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:2,transparent:!0,opacity:.5,side:a.DoubleSide,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[3.5,3.5,.02,32]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16753920),emissive:new a.Color(16740096),emissiveIntensity:1,transparent:!0,opacity:.3,side:a.DoubleSide,blending:a.AdditiveBlending})]}),(0,n.jsx)("group",{rotation:[Math.PI/2,0,0],children:[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[1.5*Math.cos(t*Math.PI/4),1.5*Math.sin(t*Math.PI/4),.05],rotation:[0,0,t*Math.PI/4],children:[(0,n.jsx)("boxGeometry",{args:[.8,.1,.05]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:3,transparent:!0,opacity:.8,blending:a.AdditiveBlending})]},t))}),(0,n.jsxs)("group",{rotation:[Math.PI/2,0,0],children:[(0,n.jsxs)("mesh",{position:[0,0,.1],children:[(0,n.jsx)("boxGeometry",{args:[.15,2.5,.05]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:4,transparent:!0,opacity:.9,blending:a.AdditiveBlending})]}),(0,n.jsxs)("mesh",{position:[0,0,.1],children:[(0,n.jsx)("boxGeometry",{args:[2.5,.15,.05]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16777215),emissive:new a.Color(16766720),emissiveIntensity:4,transparent:!0,opacity:.9,blending:a.AdditiveBlending})]})]}),(0,n.jsx)("group",{rotation:[Math.PI/2,0,0],children:[...Array(12)].map((e,t)=>(0,n.jsxs)("mesh",{position:[Math.cos(t*Math.PI/6)*(3.8+.3*Math.sin(.005*Date.now()+t)),Math.sin(t*Math.PI/6)*(3.8+.3*Math.sin(.005*Date.now()+t)),.2*Math.sin(.003*Date.now()+t)],children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:new a.Color(16766720),emissive:new a.Color(16753920),emissiveIntensity:2,transparent:!0,opacity:.6,blending:a.AdditiveBlending})]},"particle-".concat(t)))}),(0,n.jsx)("pointLight",{color:new a.Color(16766720),intensity:2,distance:8,decay:2})]}):null}},1151:function(e,t,r){r.d(t,{Z0:function(){return c},ZP:function(){return d}});var n=r(7437),o=r(2265),i=r(1276),a=r(6663);let s=[],l=1;function c(e,t,r){let n={id:l++,position:e.clone(),rotation:t.clone(),startTime:Date.now(),duration:3e3,playerId:r};return s.push(n),console.log("\uD83D\uDEE1️ Global Deflect Shield triggered at position:",e.toArray(),"ID:",n.id),n.id}function d(e){let{}=e,[t,r]=(0,o.useState)([]);return(0,i.F)(()=>{let e=Date.now(),t=s.filter(t=>e-t.startTime<t.duration);s=t,r(t)}),(0,n.jsx)(n.Fragment,{children:t.map(e=>(0,n.jsx)(a.Z,{isActive:!0,duration:e.duration/1e3,playerPosition:e.position,playerRotation:e.rotation,onComplete:()=>{var t;t=e.id,s=s.filter(e=>e.id!==t)}},e.id))})}},4937:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(7437),o=r(2265),i=r(1448),a=r(1276);function s(e){let{position:t,onComplete:r,parentRef:s,isActive:l=!0,enemyData:c=[],onHitTarget:d}=e,u=(0,o.useRef)(null),h=(0,o.useRef)(0),g=(0,o.useRef)([]),p=(0,o.useRef)({});return(0,a.F)((e,n)=>{var o;if(!u.current)return;let a=(null==s?void 0:null===(o=s.current)||void 0===o?void 0:o.position)||t;u.current.position.copy(a);let m=Date.now();if(!l){r();return}if(h.current+=n,u.current.rotation.y+=4*n,c.forEach(e=>{e.health&&!(e.health<=0)&&!(m-(p.current[e.id]||0)<200)&&4>=a.distanceTo(e.position)&&(p.current[e.id]=m,null==d||d(e.id,40,!1,e.position,!0))}),.6>Math.random()){let e=Math.random()*Math.PI*2,t=1.5*Math.random(),r=new i.Vector3(Math.cos(e)*t,-2+.6*Math.random(),Math.sin(e)*t);g.current.push({id:Date.now()+Math.random(),position:r,type:"orbital"})}if(.4>Math.random()){let e=Math.random()*Math.PI*2,t=1*Math.random(),r=new i.Vector3(Math.cos(e)*t,1+1.2*Math.random(),Math.sin(e)*t);g.current.push({id:Date.now()+Math.random(),position:r,type:"falling"})}g.current.length>50&&(g.current=g.current.slice(-50))}),(0,n.jsx)("group",{ref:u,children:(0,n.jsx)("pointLight",{color:new i.Color(16766720),intensity:1,distance:8,decay:1})})}},9709:function(e,t,r){r.d(t,{ZP:function(){return u},e6:function(){return d}});var n=r(7437),o=r(2265),i=r(1276),a=r(1448),s=r(4937);let l=[],c=1;function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,n={id:c++,position:e.clone(),startTime:Date.now(),duration:r,playerId:t};return l.push(n),console.log("⚡ Global Divine Storm triggered at position:",e.toArray(),"duration:",r+"ms","ID:",n.id),n.id}function u(e){let{enemyData:t=[],onHitTarget:r}=e,[c,d]=(0,o.useState)([]),u=(0,o.useRef)(new Map);return(0,i.F)(()=>{let e=Date.now(),t=l.filter(t=>e-t.startTime<t.duration);l=t,d(t);let r=new Set(t.map(e=>e.id));u.current.forEach((e,t)=>{r.has(t)||u.current.delete(t)}),t.forEach(e=>{u.current.has(e.id)?u.current.get(e.id).position.copy(e.position):u.current.set(e.id,{position:e.position.clone()})})}),(0,n.jsx)(n.Fragment,{children:c.map(e=>{let o=u.current.get(e.id);return o||(o={position:e.position&&e.position.clone?e.position.clone():new a.Vector3(0,0,0)},u.current.set(e.id,o)),(0,n.jsx)(s.Z,{position:e.position,parentRef:{current:o},isActive:!0,enemyData:t,onHitTarget:r,onComplete:()=>{var t;t=e.id,l=l.filter(e=>e.id!==t),u.current.delete(e.id)}},e.id)})})}},6923:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),o=r(2265),i=r(1276);function a(e){let{position:t,duration:r=1500,startTime:a=Date.now(),onComplete:s}=e,l=(0,o.useRef)(null),[c,d]=(0,o.useState)(1),[u,h]=(0,o.useState)(1),[g,p]=(0,o.useState)(0),m=(0,o.useRef)(.05*Math.random()+.02);(0,o.useEffect)(()=>{let e=setTimeout(()=>{console.log("❄️ Frost Nova effect completed after",r,"ms"),s&&s()},r);return()=>{clearTimeout(e)}},[r,s]),(0,i.F)(()=>{if(!l.current)return;let e=Date.now()-a,t=Math.min(e/r,1);if(t>=1&&s){console.log("❄️ Frost Nova effect exceeded duration, forcing completion"),s();return}t<.3?p(t/.3):p(1),t>.6?h(1-(t-.6)/.4):h(1),d((.7+.3*Math.sin(.008*e))*u),l.current.rotation.y+=m.current,l.current.rotation.x=.1*Math.sin(.002*e)});let f=.1+2.5*g,y=1.15*f;return(0,n.jsxs)("group",{ref:l,position:t,children:[(0,n.jsxs)("mesh",{position:[0,.5,0],children:[(0,n.jsx)("sphereGeometry",{args:[1*f,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#4FC3F7",emissiveIntensity:.8*c,transparent:!0,opacity:.3*u,roughness:.1,metalness:.2})]}),[...Array(12)].map((e,t)=>{let r=t*Math.PI*2/12,o=.8*f;return(0,n.jsx)("group",{rotation:[0,r,0],position:[Math.cos(r)*o,0,Math.sin(r)*o],children:(0,n.jsxs)("mesh",{rotation:[Math.PI/6,0,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.4*f,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#29B6F6",emissiveIntensity:.6*c,transparent:!0,opacity:.8*u,roughness:.05,metalness:.15})]})},t)}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.1+.15*t,0],rotation:[Math.PI/2,0,t*Math.PI/6],scale:[y*(.8+.2*t),y*(.8+.2*t),1],children:[(0,n.jsx)("torusGeometry",{args:[1,.08,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#29B6F6",emissiveIntensity:.7*c,transparent:!0,opacity:.6*u*(1-.2*t),roughness:.1,metalness:.2})]},"ring-".concat(t))),[...Array(24)].map((e,t)=>{let r=t*Math.PI*2/24,o=f*(.6+.4*Math.random());return(0,n.jsxs)("mesh",{position:[Math.cos(r)*o+(Math.random()-.5)*2,2*Math.random()+.2,Math.sin(r)*o+(Math.random()-.5)*2],rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("octahedronGeometry",{args:[.08+.12*Math.random(),0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.9*c,transparent:!0,opacity:.5*u})]},"particle-".concat(t))}),(0,n.jsxs)("mesh",{position:[0,-.1,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("circleGeometry",{args:[1.1*f,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.3*c,transparent:!0,opacity:.4*u,roughness:.8,metalness:.1})]}),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:8*c*u,distance:2*f,position:[0,1,0]}),(0,n.jsx)("pointLight",{color:"#B3E5FC",intensity:3*c*u,distance:3*f,position:[0,.5,0]})]})}},6932:function(e,t,r){r.r(t),r.d(t,{addGlobalFrozenEnemy:function(){return g},default:function(){return m},getActiveFrostNovas:function(){return p},triggerGlobalFrostNova:function(){return h}});var n=r(7437),o=r(2265),i=r(1276),a=r(6923),s=r(8787),l=r(8001),c=r(73),d=r(6862);let u=null,h=e=>!!u&&(u.triggerFrostNova(e),!0),g=(e,t)=>!!u&&(u.addFrozenEnemy(e,t),!0),p=()=>u&&u.getActiveFrostNovas?u.getActiveFrostNovas():[];function m(e){let{world:t}=e,[r,h]=(0,o.useState)([]),[g,p]=(0,o.useState)([]),m=(0,o.useRef)(0),f=(0,o.useRef)(0),y=(0,o.useRef)(0),x=(0,o.useCallback)(()=>t?t.getAllEntities().filter(e=>e.hasComponent(l.C)&&e.hasComponent(c.w)&&e.hasComponent(d.S)).map(e=>{e.getComponent(l.C);let t=e.getComponent(c.w),r=e.getComponent(d.S);return{id:e.id.toString(),position:t.position.clone(),health:r.currentHealth,isDying:r.isDead,deathStartTime:r.isDead?Date.now():void 0}}):[],[t]),v=(0,o.useCallback)(e=>{let t={id:m.current++,position:e.clone(),startTime:Date.now(),duration:1200};h(e=>[...e,t]),console.log("❄️ Created Frost Nova effect at position:",e)},[]),M=(0,o.useCallback)((e,t)=>{let r={id:f.current++,enemyId:e,position:t.clone(),startTime:Date.now(),duration:5e3};p(e=>[...e,r]),console.log("❄️ Created frozen effect for enemy:",e,"at position:",t)},[]),j=(0,o.useCallback)(()=>r,[r]);o.useEffect(()=>(u={triggerFrostNova:v,addFrozenEnemy:M,getActiveFrostNovas:j},()=>{u=null}),[v,M,j]),(0,i.F)(e=>{let r=e.clock.getElapsedTime();if(r-y.current<.1||(y.current=r,!t))return;let n=Date.now(),o=t.getAllEntities();o.forEach(e=>{let t=e.getComponent(l.C),r=e.getComponent(c.w);t&&r&&t.isFrozen&&!g.find(t=>t.enemyId===e.id.toString())&&M(e.id.toString(),r.position)}),p(e=>e.filter(e=>{let t=n-e.startTime;if(t>=e.duration)return console.log("❄️ Removing expired frozen effect for enemy ".concat(e.enemyId," (duration: ").concat(t,"ms)")),!1;let r=o.find(t=>t.id.toString()===e.enemyId);if(!r)return console.log("❄️ Removing frozen effect for non-existent enemy ".concat(e.enemyId)),!1;let i=r.getComponent(l.C),a=r.getComponent(d.S);return i&&a?!a.isDead||(console.log("❄️ Removing frozen effect for dead enemy ".concat(e.enemyId)),!1):(console.log("❄️ Removing frozen effect for invalid enemy ".concat(e.enemyId)),!1)})),h(e=>e.filter(e=>{let t=n-e.startTime;return!(t>=e.duration)||(console.log("❄️ Removing expired frost nova explosion effect (duration: ".concat(t,"ms)")),!1)}))});let w=e=>{h(t=>t.filter(t=>t.id!==e))},S=e=>{p(t=>t.filter(t=>t.id!==e))},C=x();return(0,n.jsxs)(n.Fragment,{children:[r.map(e=>(0,n.jsx)(a.Z,{position:e.position,duration:e.duration,startTime:e.startTime,onComplete:()=>w(e.id)},e.id)),g.map(e=>(0,n.jsx)(s.Z,{position:e.position,duration:e.duration,startTime:e.startTime,enemyId:e.enemyId,enemyData:C,onComplete:()=>S(e.id)},e.id))]})}},8787:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(7437),o=r(2265),i=r(1276);function a(e){let{position:t,duration:r=5e3,startTime:a=Date.now(),enemyId:s,enemyData:l=[],onComplete:c}=e,d=(0,o.useRef)(null),[u,h]=(0,o.useState)(1),[g,p]=(0,o.useState)(1),m=(0,o.useRef)(.02*Math.random()+.01);return(0,o.useEffect)(()=>{let e=setTimeout(()=>{console.log("❄️ Frozen effect completed after",r,"ms for enemy",s),c&&c()},r);return()=>{clearTimeout(e)}},[r,c,s]),(0,i.F)(()=>{if(!d.current)return;let e=Date.now()-a,t=Math.min(e/r,1);if(t>=1&&c){console.log("❄️ Frozen effect exceeded duration, forcing completion for enemy",s),c();return}if(s&&l.length>0){let e=l.find(e=>e.id===s);if(e&&e.health>0&&!e.isDying&&!e.deathStartTime){let t=e.position.clone();t.y+=.5,d.current.position.copy(t)}else if(!e){console.log("❄️ Frozen effect target no longer exists, completing effect for enemy",s),c&&c();return}}t>.9?p(1-(t-.9)/.09999999999999998):p(1),h((.8+.2*Math.sin(.005*e))*g),d.current.rotation.y+=m.current,d.current.rotation.x=.1*Math.sin(.003*e)}),(0,n.jsxs)("group",{ref:d,position:t,children:[(0,n.jsxs)("mesh",{position:[0,-.6,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.8,.9,.5,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#81D4FA",emissiveIntensity:.3*u,transparent:!0,opacity:.7*g,roughness:.1,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,.95,0],children:[(0,n.jsx)("octahedronGeometry",{args:[.9,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.5*u,transparent:!0,opacity:.8*g,roughness:.05,metalness:.1})]}),[...Array(6)].map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI/3,0],position:[.7*Math.cos(t*Math.PI/3),-.2+.3*Math.sin(t),.7*Math.sin(t*Math.PI/3)],children:(0,n.jsxs)("mesh",{rotation:[Math.PI/6,0,Math.PI/4],children:[(0,n.jsx)("octahedronGeometry",{args:[.25,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#29B6F6",emissiveIntensity:.4*u,transparent:!0,opacity:.6*g,roughness:.1,metalness:.15})]})},t)),[...Array(12)].map((e,t)=>(0,n.jsxs)("mesh",{position:[(Math.random()-.5)*2,2.5*Math.random()-.2,(Math.random()-.5)*2],rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("octahedronGeometry",{args:[.05+.1*Math.random(),0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.8*u,transparent:!0,opacity:.4*g})]},"particle-".concat(t))),[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,-0+.2*t,0],rotation:[Math.PI/2,0,t*Math.PI/4],children:[(0,n.jsx)("torusGeometry",{args:[.6+.25*t,.05,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#B3E5FC",emissive:"#29B6F6",emissiveIntensity:.6*u,transparent:!0,opacity:.5*g,roughness:.1,metalness:.2})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#E1F5FE",emissive:"#4FC3F7",emissiveIntensity:.2*u,transparent:!0,opacity:.4*g})]}),(0,n.jsx)("pointLight",{color:"#4FC3F7",intensity:3*u*g,distance:6,position:[0,1,0]})]})}}}]);